{"ast":null,"code":"import _createForOfIteratorHelper from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _classCallCheck from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _assertThisInitialized from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";import _get from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/get.js\";import _getPrototypeOf from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js\";import _inherits from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import{NitroManager}from'../../core/common/NitroManager';import{RoomEngineEvent}from'../room/events/RoomEngineEvent';import{RoomSessionEvent}from'./events/RoomSessionEvent';import{GenericErrorHandler}from'./handler/GenericErrorHandler';import{PollHandler}from'./handler/PollHandler';import{RoomChatHandler}from'./handler/RoomChatHandler';import{RoomDataHandler}from'./handler/RoomDataHandler';import{RoomDimmerPresetsHandler}from'./handler/RoomDimmerPresetsHandler';import{RoomPermissionsHandler}from'./handler/RoomPermissionsHandler';import{RoomPresentHandler}from'./handler/RoomPresentHandler';import{RoomSessionHandler}from'./handler/RoomSessionHandler';import{RoomUsersHandler}from'./handler/RoomUsersHandler';import{WordQuizHandler}from'./handler/WordQuizHandler';import{RoomSession}from'./RoomSession';export var RoomSessionManager=/*#__PURE__*/function(_NitroManager){_inherits(RoomSessionManager,_NitroManager);var _super=_createSuper(RoomSessionManager);function RoomSessionManager(communication,roomEngine){var _this;_classCallCheck(this,RoomSessionManager);_this=_super.call(this);_this._communication=void 0;_this._roomEngine=void 0;_this._handlers=void 0;_this._sessions=void 0;_this._pendingSession=void 0;_this._sessionStarting=void 0;_this._viewerSession=void 0;_this._communication=communication;_this._roomEngine=roomEngine;_this._handlers=[];_this._sessions=new Map();_this._pendingSession=null;_this._sessionStarting=false;_this._viewerSession=null;_this.onRoomEngineEvent=_this.onRoomEngineEvent.bind(_assertThisInitialized(_this));return _this;}_createClass(RoomSessionManager,[{key:\"onInit\",value:function onInit(){this.createHandlers();this.processPendingSession();this._roomEngine.events.addEventListener(RoomEngineEvent.ENGINE_INITIALIZED,this.onRoomEngineEvent);}},{key:\"onDispose\",value:function onDispose(){this._roomEngine.events.removeEventListener(RoomEngineEvent.ENGINE_INITIALIZED,this.onRoomEngineEvent);_get(_getPrototypeOf(RoomSessionManager.prototype),\"onDispose\",this).call(this);}},{key:\"createHandlers\",value:function createHandlers(){var connection=this._communication&&this._communication.connection;if(!connection)return;this._handlers.push(new RoomChatHandler(connection,this),new RoomDataHandler(connection,this),new RoomDimmerPresetsHandler(connection,this),new RoomPermissionsHandler(connection,this),new RoomSessionHandler(connection,this),new RoomUsersHandler(connection,this),new RoomPresentHandler(connection,this),new GenericErrorHandler(connection,this),new WordQuizHandler(connection,this),new PollHandler(connection,this));}},{key:\"setHandlers\",value:function setHandlers(session){if(!this._handlers||!this._handlers.length)return;var _iterator=_createForOfIteratorHelper(this._handlers),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var handler=_step.value;if(!handler)continue;handler.setRoomId(session.roomId);}}catch(err){_iterator.e(err);}finally{_iterator.f();}}},{key:\"onRoomEngineEvent\",value:function onRoomEngineEvent(event){this.processPendingSession();}},{key:\"processPendingSession\",value:function processPendingSession(){if(!this._pendingSession||!this._roomEngine.ready)return;this.addSession(this._pendingSession);this._pendingSession=null;}},{key:\"getSession\",value:function getSession(id){var existing=this._sessions.get(this.getRoomId(id));if(!existing)return null;return existing;}},{key:\"createSession\",value:function createSession(roomId){var password=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var session=new RoomSession();session.roomId=roomId;session.password=password;return this.addSession(session);}},{key:\"addSession\",value:function addSession(roomSession){if(!this._roomEngine.ready){this._pendingSession=roomSession;return false;}this._sessionStarting=true;if(this._sessions.get(this.getRoomId(roomSession.roomId))){this.removeSession(roomSession.roomId,false);}roomSession.setConnection(this._communication.connection);this._sessions.set(this.getRoomId(roomSession.roomId),roomSession);this.events.dispatchEvent(new RoomSessionEvent(RoomSessionEvent.CREATED,roomSession));this._viewerSession=roomSession;this.startSession(this._viewerSession);return true;}},{key:\"startSession\",value:function startSession(session){if(session.state===RoomSessionEvent.STARTED)return false;this._sessionStarting=false;if(!session.start()){this.removeSession(session.roomId);return false;}this.events.dispatchEvent(new RoomSessionEvent(RoomSessionEvent.STARTED,session));this.setHandlers(session);return true;}},{key:\"removeSession\",value:function removeSession(id){var openLandingView=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var session=this.getSession(id);if(!session)return;this._sessions.delete(this.getRoomId(id));this.events.dispatchEvent(new RoomSessionEvent(RoomSessionEvent.ENDED,session,openLandingView));session.dispose();}},{key:\"sessionUpdate\",value:function sessionUpdate(id,type){var session=this.getSession(id);if(!session)return;switch(type){case RoomSessionHandler.RS_CONNECTED:return;case RoomSessionHandler.RS_READY:return;case RoomSessionHandler.RS_DISCONNECTED:this.removeSession(id);return;}}},{key:\"sessionReinitialize\",value:function sessionReinitialize(fromRoomId,toRoomId){var existing=this.getSession(fromRoomId);if(!existing)return;this._sessions.delete(this.getRoomId(fromRoomId));existing.reset(toRoomId);this._sessions.set(this.getRoomId(toRoomId),existing);this.setHandlers(existing);}},{key:\"getRoomId\",value:function getRoomId(id){return'hard_coded_room_id';}},{key:\"communication\",get:function get(){return this._communication;}},{key:\"roomEngine\",get:function get(){return this._roomEngine;}},{key:\"viewerSession\",get:function get(){return this._viewerSession;}}]);return RoomSessionManager;}(NitroManager);","map":null,"metadata":{},"sourceType":"module"}