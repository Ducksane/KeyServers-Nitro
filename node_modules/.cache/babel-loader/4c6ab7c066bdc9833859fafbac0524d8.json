{"ast":null,"code":"import _slicedToArray from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{ColorConverter,NitroAdjustmentFilter,NitroSprite,NitroTexture,RoomBackgroundColorEvent,RoomEngineDimmerStateEvent,RoomId,RoomObjectHSLColorEnabledEvent}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useState}from'react';import{GetNitroInstance,GetRoomEngine,RoomWidgetUpdateBackgroundColorPreviewEvent}from'../../api';import{UseEventDispatcherHook,UseRoomEngineEvent}from'../../hooks';import{useRoomContext}from'./RoomContext';export var RoomColorView=function RoomColorView(props){var _useState=useState(null),_useState2=_slicedToArray(_useState,2),roomBackground=_useState2[0],setRoomBackground=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),roomFilter=_useState4[0],setRoomFilter=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),originalRoomBackgroundColor=_useState6[0],setOriginalRoomBackgroundColor=_useState6[1];var _useRoomContext=useRoomContext(),_useRoomContext$roomS=_useRoomContext.roomSession,roomSession=_useRoomContext$roomS===void 0?null:_useRoomContext$roomS,_useRoomContext$widge=_useRoomContext.widgetHandler,widgetHandler=_useRoomContext$widge===void 0?null:_useRoomContext$widge,_useRoomContext$event=_useRoomContext.eventDispatcher,eventDispatcher=_useRoomContext$event===void 0?null:_useRoomContext$event;var updateRoomBackgroundColor=useCallback(function(hue,saturation,lightness){var original=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;if(!roomBackground)return;var newColor=ColorConverter.hslToRGB(((hue&0xFF)<<16)+((saturation&0xFF)<<8)+(lightness&0xFF));if(original)setOriginalRoomBackgroundColor(newColor);if(!hue&&!saturation&&!lightness){roomBackground.tint=0;}else{roomBackground.tint=newColor;}},[roomBackground]);var updateRoomFilter=useCallback(function(color){if(!roomFilter)return;var r=color>>16&0xFF;var g=color>>8&0xFF;var b=color&0xFF;roomFilter.red=r/255;roomFilter.green=g/255;roomFilter.blue=b/255;},[roomFilter]);var onRoomEngineEvent=useCallback(function(event){if(RoomId.isRoomPreviewerId(event.roomId))return;switch(event.type){case RoomObjectHSLColorEnabledEvent.ROOM_BACKGROUND_COLOR:{var hslColorEvent=event;if(hslColorEvent.enable)updateRoomBackgroundColor(hslColorEvent.hue,hslColorEvent.saturation,hslColorEvent.lightness,true);else updateRoomBackgroundColor(0,0,0,true);return;}case RoomBackgroundColorEvent.ROOM_COLOR:{var colorEvent=event;var color=0x000000;var brightness=0xFF;if(!colorEvent.bgOnly){color=colorEvent.color;brightness=colorEvent.brightness;}updateRoomFilter(ColorConverter.hslToRGB((ColorConverter.rgbToHSL(color)&0xFFFF00)+brightness));return;}case RoomEngineDimmerStateEvent.ROOM_COLOR:{widgetHandler.processEvent(event);}}},[widgetHandler,updateRoomBackgroundColor,updateRoomFilter]);UseRoomEngineEvent(RoomObjectHSLColorEnabledEvent.ROOM_BACKGROUND_COLOR,onRoomEngineEvent);UseRoomEngineEvent(RoomBackgroundColorEvent.ROOM_COLOR,onRoomEngineEvent);UseRoomEngineEvent(RoomEngineDimmerStateEvent.ROOM_COLOR,onRoomEngineEvent);var onRoomWidgetUpdateBackgroundColorPreviewEvent=useCallback(function(event){switch(event.type){case RoomWidgetUpdateBackgroundColorPreviewEvent.PREVIEW:{updateRoomBackgroundColor(event.hue,event.saturation,event.lightness);return;}case RoomWidgetUpdateBackgroundColorPreviewEvent.CLEAR_PREVIEW:{if(!roomBackground)return;roomBackground.tint=originalRoomBackgroundColor;return;}}},[roomBackground,originalRoomBackgroundColor,updateRoomBackgroundColor]);UseEventDispatcherHook(RoomWidgetUpdateBackgroundColorPreviewEvent.PREVIEW,eventDispatcher,onRoomWidgetUpdateBackgroundColorPreviewEvent);UseEventDispatcherHook(RoomWidgetUpdateBackgroundColorPreviewEvent.CLEAR_PREVIEW,eventDispatcher,onRoomWidgetUpdateBackgroundColorPreviewEvent);useEffect(function(){if(!roomSession)return;var canvas=GetRoomEngine().getRoomInstanceRenderingCanvas(roomSession.roomId,1);if(!canvas)return;var background=new NitroSprite(NitroTexture.WHITE);var filter=new NitroAdjustmentFilter();var master=canvas.master;background.tint=0;background.width=GetNitroInstance().width;background.height=GetNitroInstance().height;master.addChildAt(background,0);master.filters=[filter];setRoomBackground(background);setRoomFilter(filter);var resize=function resize(event){background.width=GetNitroInstance().width;background.height=GetNitroInstance().height;};window.addEventListener('resize',resize);return function(){setRoomBackground(function(prevValue){if(prevValue)prevValue.destroy();return null;});setRoomFilter(function(prevValue){if(prevValue)prevValue.destroy();return null;});setOriginalRoomBackgroundColor(0);window.removeEventListener('resize',resize);};},[roomSession]);return null;};","map":null,"metadata":{},"sourceType":"module"}