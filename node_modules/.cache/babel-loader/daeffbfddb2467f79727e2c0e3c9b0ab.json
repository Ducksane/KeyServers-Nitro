{"ast":null,"code":"import _slicedToArray from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{EventDispatcher,RoomEngineEvent,RoomGeometry,RoomId,RoomSessionEvent,RoomVariableEnum,Vector3d}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useRef,useState}from'react';import{DispatchMouseEvent,DispatchTouchEvent,FurniChooserWidgetHandler,FurnitureContextMenuWidgetHandler,FurnitureCreditWidgetHandler,FurnitureCustomStackHeightWidgetHandler,FurnitureDimmerWidgetHandler,FurnitureExternalImageWidgetHandler,FurnitureInternalLinkHandler,FurnitureMannequinWidgetHandler,FurniturePresentWidgetHandler,FurnitureRoomLinkHandler,FurnitureYoutubeDisplayWidgetHandler,GetNitroInstance,GetRoomEngine,GetRoomSession,InitializeRoomInstanceRenderingCanvas,PollWidgetHandler,RoomWidgetAvatarInfoHandler,RoomWidgetChatHandler,RoomWidgetChatInputHandler,RoomWidgetHandlerManager,RoomWidgetInfostandHandler,SetActiveRoomId,StartRoomSession,UserChooserWidgetHandler,WordQuizWidgetHandler}from'../../api';import{Base}from'../../common';import{UseRoomEngineEvent,UseRoomSessionManagerEvent}from'../../hooks';import{RoomColorView}from'./RoomColorView';import{RoomContextProvider}from'./RoomContext';import{RoomSpectatorView}from'./spectator/RoomSpectatorView';import{RoomWidgetsView}from'./widgets/RoomWidgetsView';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var RoomView=function RoomView(props){var _useState=useState(null),_useState2=_slicedToArray(_useState,2),roomSession=_useState2[0],setRoomSession=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),widgetHandler=_useState4[0],setWidgetHandler=_useState4[1];var elementRef=useRef();var onRoomEngineEvent=useCallback(function(event){if(RoomId.isRoomPreviewerId(event.roomId))return;var session=GetRoomSession();if(!session)return;switch(event.type){case RoomEngineEvent.INITIALIZED:SetActiveRoomId(event.roomId);setRoomSession(session);return;case RoomEngineEvent.DISPOSED:setRoomSession(null);return;}},[]);UseRoomEngineEvent(RoomEngineEvent.INITIALIZED,onRoomEngineEvent);UseRoomEngineEvent(RoomEngineEvent.DISPOSED,onRoomEngineEvent);var onRoomSessionEvent=useCallback(function(event){switch(event.type){case RoomSessionEvent.CREATED:StartRoomSession(event.session);return;case RoomSessionEvent.ENDED:setRoomSession(null);return;}},[]);UseRoomSessionManagerEvent(RoomSessionEvent.CREATED,onRoomSessionEvent);UseRoomSessionManagerEvent(RoomSessionEvent.ENDED,onRoomSessionEvent);var resize=useCallback(function(){var event=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var canvas=GetNitroInstance().renderer.view;if(!canvas)return;canvas.style.width=\"\".concat(Math.floor(window.innerWidth),\"px\");canvas.style.height=\"\".concat(Math.floor(window.innerHeight),\"px\");var nitroInstance=GetNitroInstance();nitroInstance.renderer.resolution=window.devicePixelRatio;nitroInstance.renderer.resize(window.innerWidth,window.innerHeight);InitializeRoomInstanceRenderingCanvas(window.innerWidth,window.innerHeight,1);nitroInstance.render();},[]);useEffect(function(){if(!roomSession){setWidgetHandler(null);return;}var widgetHandlerManager=new RoomWidgetHandlerManager(roomSession,new EventDispatcher());widgetHandlerManager.registerHandler(new RoomWidgetAvatarInfoHandler());widgetHandlerManager.registerHandler(new RoomWidgetInfostandHandler());widgetHandlerManager.registerHandler(new RoomWidgetChatInputHandler());widgetHandlerManager.registerHandler(new RoomWidgetChatHandler());widgetHandlerManager.registerHandler(new UserChooserWidgetHandler());widgetHandlerManager.registerHandler(new WordQuizWidgetHandler());widgetHandlerManager.registerHandler(new PollWidgetHandler());widgetHandlerManager.registerHandler(new FurniChooserWidgetHandler());widgetHandlerManager.registerHandler(new FurnitureContextMenuWidgetHandler());widgetHandlerManager.registerHandler(new FurnitureCreditWidgetHandler());widgetHandlerManager.registerHandler(new FurnitureCustomStackHeightWidgetHandler());widgetHandlerManager.registerHandler(new FurnitureExternalImageWidgetHandler());widgetHandlerManager.registerHandler(new FurniturePresentWidgetHandler());widgetHandlerManager.registerHandler(new FurnitureDimmerWidgetHandler());widgetHandlerManager.registerHandler(new FurnitureYoutubeDisplayWidgetHandler());widgetHandlerManager.registerHandler(new FurnitureMannequinWidgetHandler());widgetHandlerManager.registerHandler(new FurnitureInternalLinkHandler());widgetHandlerManager.registerHandler(new FurnitureRoomLinkHandler());setWidgetHandler(widgetHandlerManager);var roomEngine=GetRoomEngine();var roomId=roomSession.roomId;var canvasId=1;resize();var displayObject=roomEngine.getRoomInstanceDisplay(roomId,canvasId,window.innerWidth,window.innerHeight,RoomGeometry.SCALE_ZOOMED_IN);if(!displayObject)return;var geometry=roomEngine.getRoomInstanceGeometry(roomId,canvasId);if(geometry){var minX=roomEngine.getRoomInstanceVariable(roomId,RoomVariableEnum.ROOM_MIN_X)||0;var maxX=roomEngine.getRoomInstanceVariable(roomId,RoomVariableEnum.ROOM_MAX_X)||0;var minY=roomEngine.getRoomInstanceVariable(roomId,RoomVariableEnum.ROOM_MIN_Y)||0;var maxY=roomEngine.getRoomInstanceVariable(roomId,RoomVariableEnum.ROOM_MAX_Y)||0;var x=(minX+maxX)/2;var y=(minY+maxY)/2;var offset=20;x=x+(offset-1);y=y+(offset-1);var z=Math.sqrt(offset*offset+offset*offset)*Math.tan(30/180*Math.PI);geometry.location=new Vector3d(x,y,z);}var stage=GetNitroInstance().stage;if(!stage)return;stage.addChild(displayObject);SetActiveRoomId(roomSession.roomId);},[roomSession,resize]);useEffect(function(){var canvas=GetNitroInstance().renderer.view;if(!canvas)return;canvas.onclick=function(event){return DispatchMouseEvent(event);};canvas.onmousemove=function(event){return DispatchMouseEvent(event);};canvas.onmousedown=function(event){return DispatchMouseEvent(event);};canvas.onmouseup=function(event){return DispatchMouseEvent(event);};canvas.ontouchstart=function(event){return DispatchTouchEvent(event);};canvas.ontouchmove=function(event){return DispatchTouchEvent(event);};canvas.ontouchend=function(event){return DispatchTouchEvent(event);};canvas.ontouchcancel=function(event){return DispatchTouchEvent(event);};resize();var element=elementRef.current;if(element)element.appendChild(canvas);window.addEventListener('resize',resize);return function(){if(element)element.removeChild(canvas);window.removeEventListener('resize',resize);};},[resize]);return/*#__PURE__*/_jsx(RoomContextProvider,{value:{roomSession:roomSession,eventDispatcher:widgetHandler&&widgetHandler.eventDispatcher,widgetHandler:widgetHandler},children:/*#__PURE__*/_jsx(Base,{fit:true,innerRef:elementRef,className:!roomSession&&'d-none',children:roomSession&&widgetHandler&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(RoomColorView,{}),/*#__PURE__*/_jsx(RoomWidgetsView,{}),roomSession.isSpectator&&/*#__PURE__*/_jsx(RoomSpectatorView,{})]})})});};","map":null,"metadata":{},"sourceType":"module"}