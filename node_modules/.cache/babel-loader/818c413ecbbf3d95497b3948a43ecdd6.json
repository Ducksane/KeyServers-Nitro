{"ast":null,"code":"import _classCallCheck from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _get from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/get.js\";import _getPrototypeOf from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js\";import _inherits from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import{Nitro}from'../../../../Nitro';import{RoomObjectVariable}from'../../RoomObjectVariable';import{RoomObjectVisualizationType}from'../../RoomObjectVisualizationType';import{AnimationData}from'../data/AnimationData';import{AnimationStateData}from'../data/AnimationStateData';import{DirectionData}from'../data/DirectionData';import{LayerData}from'../data/LayerData';import{FurnitureAnimatedVisualization}from'../furniture/FurnitureAnimatedVisualization';import{FurnitureVisualizationData}from'../furniture/FurnitureVisualizationData';import{ExperienceData}from'./ExperienceData';import{PetVisualizationData}from'./PetVisualizationData';export var PetVisualization=/*#__PURE__*/function(_FurnitureAnimatedVis){_inherits(PetVisualization,_FurnitureAnimatedVis);var _super=_createSuper(PetVisualization);function PetVisualization(){var _this;_classCallCheck(this,PetVisualization);_this=_super.call(this);_this._data=void 0;_this._posture=void 0;_this._gesture=void 0;_this._isSleeping=void 0;_this._headDirection=void 0;_this._headOnly=void 0;_this._nonHeadSprites=void 0;_this._headSprites=void 0;_this._saddleSprites=void 0;_this._animationOver=void 0;_this._paletteIndex=void 0;_this._paletteName=void 0;_this._customLayerIds=void 0;_this._customPartIds=void 0;_this._customPaletteIds=void 0;_this._isRiding=void 0;_this._color=void 0;_this._experience=void 0;_this._experienceTimestamp=void 0;_this._experienceData=void 0;_this._previousAnimationDirection=void 0;_this._animationStates=void 0;_this._data=null;_this._posture='';_this._gesture='';_this._isSleeping=false;_this._headDirection=-1;_this._headOnly=false;_this._nonHeadSprites=[];_this._headSprites=[];_this._saddleSprites=[];_this._animationOver=false;_this._paletteIndex=-1;_this._paletteName='';_this._customLayerIds=[];_this._customPartIds=[];_this._customPaletteIds=[];_this._isRiding=false;_this._color=0xFFFFFF;_this._experience=0;_this._experienceTimestamp=0;_this._experienceData=null;_this._previousAnimationDirection=-1;_this._animationStates=[];while(_this._animationStates.length<PetVisualization.ANIMATION_INDEX_COUNT){_this._animationStates.push(new AnimationStateData());}return _this;}_createClass(PetVisualization,[{key:\"initialize\",value:function initialize(data){if(!(data instanceof PetVisualizationData))return false;var texture=this.getPetAdditionAsset(PetVisualization.PET_EXPERIENCE_BUBBLE);if(texture){this._experienceData=new ExperienceData(texture);}return _get(_getPrototypeOf(PetVisualization.prototype),\"initialize\",this).call(this,data);}},{key:\"dispose\",value:function dispose(){_get(_getPrototypeOf(PetVisualization.prototype),\"dispose\",this).call(this);if(this._animationStates){while(this._animationStates.length){var animationState=this._animationStates[0];if(animationState)animationState.dispose();this._animationStates.pop();}this._animationStates=null;}}},{key:\"getAnimationId\",value:function getAnimationId(animationData){return animationData.animationId;}},{key:\"update\",value:function update(geometry,time,_update,skipUpdate){_get(_getPrototypeOf(PetVisualization.prototype),\"update\",this).call(this,geometry,time,_update,skipUpdate);this.updateExperienceBubble(time);}},{key:\"updateExperienceBubble\",value:function updateExperienceBubble(time){if(!this._experienceData)return;this._experienceData.alpha=0;if(this._experienceTimestamp){var difference=time-this._experienceTimestamp;if(difference<PetVisualization.EXPERIENCE_BUBBLE_VISIBLE_IN_MS){this._experienceData.alpha=Math.sin(difference/PetVisualization.EXPERIENCE_BUBBLE_VISIBLE_IN_MS*Math.PI)*0xFF;}else{this._experienceTimestamp=0;}var sprite=this.getSprite(this.totalSprites-1);if(sprite){if(this._experienceData.alpha>0){var texture=this._experienceData.renderBubble(this._experience);if(texture){sprite.texture=texture;sprite.offsetX=-20;sprite.offsetY=-80;sprite.alpha=this._experienceData.alpha;sprite.visible=true;sprite.relativeDepth=-0.2;return;}}sprite.texture=null;sprite.visible=false;}}}},{key:\"updateModel\",value:function updateModel(scale){var model=this.object&&this.object.model;if(!model)return false;if(this.updateModelCounter===model.updateCounter)return false;var posture=model.getValue(RoomObjectVariable.FIGURE_POSTURE);var gesture=model.getValue(RoomObjectVariable.FIGURE_GESTURE);this.setPostureAndGesture(posture,gesture);var alphaMultiplier=model.getValue(RoomObjectVariable.FURNITURE_ALPHA_MULTIPLIER)||null;if(alphaMultiplier===null||isNaN(alphaMultiplier))alphaMultiplier=1;if(this._alphaMultiplier!==alphaMultiplier){this._alphaMultiplier=alphaMultiplier;this._alphaChanged=true;}this._isSleeping=model.getValue(RoomObjectVariable.FIGURE_SLEEP)>0;var headDirection=model.getValue(RoomObjectVariable.HEAD_DIRECTION);if(!isNaN(headDirection)&&this._data.isAllowedToTurnHead){this._headDirection=headDirection;}else{this._headDirection=this.object.getDirection().x;}this._experience=model.getValue(RoomObjectVariable.FIGURE_GAINED_EXPERIENCE);this._experienceTimestamp=model.getValue(RoomObjectVariable.FIGURE_EXPERIENCE_TIMESTAMP);var customPaletteIndex=model.getValue(RoomObjectVariable.PET_PALETTE_INDEX);var customLayerIds=model.getValue(RoomObjectVariable.PET_CUSTOM_LAYER_IDS);var customPartIds=model.getValue(RoomObjectVariable.PET_CUSTOM_PARTS_IDS);var customPaletteIds=model.getValue(RoomObjectVariable.PET_CUSTOM_PALETTE_IDS);var isRiding=model.getValue(RoomObjectVariable.PET_IS_RIDING);var headOnly=model.getValue(RoomObjectVariable.PET_HEAD_ONLY);var color=model.getValue(RoomObjectVariable.PET_COLOR);if(customPaletteIndex!==this._paletteIndex){this._paletteIndex=customPaletteIndex;this._paletteName=this._paletteIndex.toString();}this._customLayerIds=customLayerIds?customLayerIds:[];this._customPartIds=customPartIds?customPartIds:[];this._customPaletteIds=customPaletteIds?customPaletteIds:[];this._isRiding=!isNaN(isRiding)&&isRiding>0;this._headOnly=!isNaN(headOnly)&&headOnly>0;if(!isNaN(color)&&this._color!==color)this._color=color;this.updateModelCounter=model.updateCounter;return true;}},{key:\"updateAnimation\",value:function updateAnimation(scale){if(this.object){var direction=this.object.getDirection().x;if(direction!==this._previousAnimationDirection){this._previousAnimationDirection=direction;this.resetAllAnimationFrames();}}return _get(_getPrototypeOf(PetVisualization.prototype),\"updateAnimation\",this).call(this,scale);}},{key:\"setPostureAndGesture\",value:function setPostureAndGesture(posture,gesture){if(posture!==this._posture){this._posture=posture;this.setAnimationForIndex(PetVisualization.POSTURE_ANIMATION_INDEX,this._data.postureToAnimation(this._scale,posture));}if(this._data.getGestureDisabled(this._scale,posture))gesture=null;if(gesture!==this._gesture){this._gesture=gesture;this.setAnimationForIndex(PetVisualization.GESTURE_ANIMATION_INDEX,this._data.gestureToAnimation(this._scale,gesture));}}},{key:\"getAnimationStateData\",value:function getAnimationStateData(k){if(k>=0&&k<this._animationStates.length)return this._animationStates[k];return null;}},{key:\"setAnimationForIndex\",value:function setAnimationForIndex(k,_arg_2){var animationStateData=this.getAnimationStateData(k);if(animationStateData){if(this.setSubAnimation(animationStateData,_arg_2))this._animationOver=false;}}},{key:\"resetAllAnimationFrames\",value:function resetAllAnimationFrames(){this._animationOver=false;var index=this._animationStates.length-1;while(index>=0){var stateData=this._animationStates[index];if(stateData)stateData.setLayerCount(this.animatedLayerCount);index--;}}},{key:\"updateAnimations\",value:function updateAnimations(scale){if(this._animationOver)return 0;var animationOver=true;var _local_3=0;var index=0;while(index<this._animationStates.length){var stateData=this._animationStates[index];if(stateData){if(!stateData.animationOver){var _local_6=this.updateFramesForAnimation(stateData,scale);_local_3=_local_3|_local_6;if(!stateData.animationOver){animationOver=false;}else{if(AnimationData.isTransitionFromAnimation(stateData.animationId)||AnimationData.isTransitionToAnimation(stateData.animationId)){this.setAnimationForIndex(index,stateData.animationAfterTransitionId);animationOver=false;}}}}index++;}this._animationOver=animationOver;return _local_3;}},{key:\"getSpriteAssetName\",value:function getSpriteAssetName(scale,layerId){if(this._headOnly&&this.isNonHeadSprite(layerId))return null;if(this._isRiding&&this._parser3(layerId))return null;var totalSprites=this.totalSprites;if(layerId<totalSprites-PetVisualization.ADDITIONAL_SPRITE_COUNT){var validScale=this.getValidSize(scale);if(layerId<totalSprites-(1+PetVisualization.ADDITIONAL_SPRITE_COUNT)){if(layerId>=FurnitureVisualizationData.LAYER_LETTERS.length)return null;var layerLetter=FurnitureVisualizationData.LAYER_LETTERS[layerId];if(validScale===1)return this._type+'_icon_'+layerLetter;return this._type+'_'+validScale+'_'+layerLetter+'_'+this.getDirection(scale,layerId)+'_'+this.getFrameNumber(validScale,layerId);}return this._type+'_'+validScale+'_sd_'+this.getDirection(scale,layerId)+'_0';}return null;}},{key:\"getLayerColor\",value:function getLayerColor(scale,layerId,colorId){if(layerId<this.totalSprites-PetVisualization.ADDITIONAL_SPRITE_COUNT)return this._color;return 0xFFFFFF;}},{key:\"getLayerXOffset\",value:function getLayerXOffset(scale,direction,layerId){var offset=_get(_getPrototypeOf(PetVisualization.prototype),\"getLayerXOffset\",this).call(this,scale,direction,layerId);var index=this._animationStates.length-1;while(index>=0){var stateData=this._animationStates[index];if(stateData){var frame=stateData.getFrame(layerId);if(frame)offset+=frame.x;}index--;}return offset;}},{key:\"getLayerYOffset\",value:function getLayerYOffset(scale,direction,layerId){var offset=_get(_getPrototypeOf(PetVisualization.prototype),\"getLayerYOffset\",this).call(this,scale,direction,layerId);var index=this._animationStates.length-1;while(index>=0){var stateData=this._animationStates[index];if(stateData){var frame=stateData.getFrame(layerId);if(frame)offset+=frame.y;}index--;}return offset;}},{key:\"getLayerZOffset\",value:function getLayerZOffset(scale,direction,layerId){if(!this._data)return LayerData.DEFAULT_ZOFFSET;return this._data.getLayerZOffset(scale,this.getDirection(scale,layerId),layerId);}},{key:\"getDirection\",value:function getDirection(scale,layerId){if(!this.isHeadSprite(layerId))return this._direction;return this._data.getValidDirection(scale,this._headDirection);}},{key:\"getFrameNumber\",value:function getFrameNumber(scale,layerId){var index=this._animationStates.length-1;while(index>=0){var stateData=this._animationStates[index];if(stateData){var frame=stateData.getFrame(layerId);if(frame)return frame.id;}index--;}return _get(_getPrototypeOf(PetVisualization.prototype),\"getFrameNumber\",this).call(this,scale,layerId);}},{key:\"isHeadSprite\",value:function isHeadSprite(layerId){if(this._headSprites[layerId]===undefined){var isHead=this._data.getLayerTag(this._scale,DirectionData.USE_DEFAULT_DIRECTION,layerId)===PetVisualization.HEAD;var isHair=this._data.getLayerTag(this._scale,DirectionData.USE_DEFAULT_DIRECTION,layerId)===PetVisualization.HAIR;if(isHead||isHair)this._headSprites[layerId]=true;else this._headSprites[layerId]=false;}return this._headSprites[layerId];}},{key:\"isNonHeadSprite\",value:function isNonHeadSprite(layerId){if(this._nonHeadSprites[layerId]===undefined){if(layerId<this.totalSprites-(1+PetVisualization.ADDITIONAL_SPRITE_COUNT)){var tag=this._data.getLayerTag(this._scale,DirectionData.USE_DEFAULT_DIRECTION,layerId);if(tag&&tag.length>0&&tag!==PetVisualization.HEAD&&tag!==PetVisualization.HAIR){this._nonHeadSprites[layerId]=true;}else{this._nonHeadSprites[layerId]=false;}}else{this._nonHeadSprites[layerId]=true;}}return this._nonHeadSprites[layerId];}},{key:\"_parser3\",value:function _parser3(layerId){if(this._saddleSprites[layerId]===undefined){if(this._data.getLayerTag(this._scale,DirectionData.USE_DEFAULT_DIRECTION,layerId)===PetVisualization.SADDLE){this._saddleSprites[layerId]=true;}else{this._saddleSprites[layerId]=false;}}return this._saddleSprites[layerId];}},{key:\"getAsset\",value:function getAsset(name){var layerId=arguments.length>1&&arguments[1]!==undefined?arguments[1]:-1;if(!this.asset)return null;var layerIndex=this._customLayerIds.indexOf(layerId);var paletteName=this._paletteName;var partId=-1;var paletteId=-1;if(layerIndex>-1){partId=this._customPartIds[layerIndex];paletteId=this._customPaletteIds[layerIndex];paletteName=paletteId>-1?paletteId.toString():this._paletteName;}if(!isNaN(partId)&&partId>-1){name=name+'_'+partId;}return this.asset.getAssetWithPalette(name,paletteName);}},{key:\"getAdditionalLayerCount\",value:function getAdditionalLayerCount(){return _get(_getPrototypeOf(PetVisualization.prototype),\"getAdditionalLayerCount\",this).call(this)+PetVisualization.ADDITIONAL_SPRITE_COUNT;}},{key:\"setLayerCount\",value:function setLayerCount(count){_get(_getPrototypeOf(PetVisualization.prototype),\"setLayerCount\",this).call(this,count);this._headSprites=[];}},{key:\"getPostureForAsset\",value:function getPostureForAsset(scale,name){var parts=name.split('_');var length=parts.length;var i=0;while(i<parts.length){if(parts[i]==='64'||parts[i]==='32'){length=i+3;break;}i++;}var posture=null;if(length<parts.length){var part=parts[length];part=part.split('@')[0];posture=this._data.animationToPosture(scale,parseInt(part)/100,false);if(!posture)posture=this._data.getGestureForAnimationId(scale,parseInt(part)/100);}return posture;}},{key:\"getPetAdditionAsset\",value:function getPetAdditionAsset(name){return Nitro.instance.core.asset.getTexture(name);}}]);return PetVisualization;}(FurnitureAnimatedVisualization);PetVisualization.TYPE=RoomObjectVisualizationType.PET_ANIMATED;PetVisualization.HEAD='head';PetVisualization.SADDLE='saddle';PetVisualization.HAIR='hair';PetVisualization.ADDITIONAL_SPRITE_COUNT=1;PetVisualization.EXPERIENCE_BUBBLE_VISIBLE_IN_MS=1000;PetVisualization.PET_EXPERIENCE_BUBBLE='avatar_addition_pet_experience_bubble';PetVisualization.POSTURE_ANIMATION_INDEX=0;PetVisualization.GESTURE_ANIMATION_INDEX=1;PetVisualization.ANIMATION_INDEX_COUNT=2;","map":null,"metadata":{},"sourceType":"module"}