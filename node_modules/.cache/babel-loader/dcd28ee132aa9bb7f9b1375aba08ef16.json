{"ast":null,"code":"import _slicedToArray from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useCallback,useEffect,useMemo,useRef,useState}from'react';import{AutoSizer,CellMeasurer,CellMeasurerCache,List}from'react-virtualized';import{AddEventLinkTracker,LocalizeText,RemoveLinkEventTracker}from'../../api';import{Flex,NitroCardContentView,NitroCardHeaderView,NitroCardView,Text}from'../../common';import{ChatHistoryContextProvider}from'./ChatHistoryContext';import{ChatHistoryMessageHandler}from'./ChatHistoryMessageHandler';import{ChatEntryType}from'./common/ChatEntryType';import{ChatHistoryState}from'./common/ChatHistoryState';import{SetChatHistory}from'./common/GetChatHistory';import{RoomHistoryState}from'./common/RoomHistoryState';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var ChatHistoryView=function ChatHistoryView(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isVisible=_useState2[0],setIsVisible=_useState2[1];var _useState3=useState(-1),_useState4=_slicedToArray(_useState3,2),chatHistoryUpdateId=_useState4[0],setChatHistoryUpdateId=_useState4[1];var _useState5=useState(-1),_useState6=_slicedToArray(_useState5,2),roomHistoryUpdateId=_useState6[0],setRoomHistoryUpdateId=_useState6[1];var _useState7=useState(new ChatHistoryState()),_useState8=_slicedToArray(_useState7,2),chatHistoryState=_useState8[0],setChatHistoryState=_useState8[1];var _useState9=useState(new RoomHistoryState()),_useState10=_slicedToArray(_useState9,2),roomHistoryState=_useState10[0],setRoomHistoryState=_useState10[1];var elementRef=useRef(null);var cache=useMemo(function(){return new CellMeasurerCache({defaultHeight:25,fixedWidth:true});},[]);var RowRenderer=function RowRenderer(props){var item=chatHistoryState.chats[props.index];var isDark=props.index%2===0;return/*#__PURE__*/_jsx(CellMeasurer,{cache:cache,columnIndex:0,parent:props.parent,rowIndex:props.index,children:/*#__PURE__*/_jsxs(Flex,{style:props.style,className:\"p-1\",gap:1,children:[/*#__PURE__*/_jsx(Text,{variant:\"muted\",children:item.timestamp}),item.type===ChatEntryType.TYPE_CHAT&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Text,{variant:\"none\",style:{color:\"--var(test-galaxytext)\"},pointer:true,noWrap:true,dangerouslySetInnerHTML:{__html:item.name+':'}}),/*#__PURE__*/_jsx(Text,{variant:\"none\",style:{color:\"--var(test-galaxytext)\"},textBreak:true,wrap:true,grow:true,children:item.message})]}),item.type===ChatEntryType.TYPE_ROOM_INFO&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"i\",{className:\"icon icon-small-room\"}),/*#__PURE__*/_jsx(Text,{variant:\"none\",style:{color:\"--var(test-galaxytext)\"},textBreak:true,wrap:true,grow:true,children:item.name})]})]},props.key)},props.key);};var onResize=function onResize(info){return cache.clearAll();};var linkReceived=useCallback(function(url){var parts=url.split('/');if(parts.length<2)return;switch(parts[1]){case'show':setIsVisible(true);return;case'hide':setIsVisible(false);return;case'toggle':setIsVisible(function(prevValue){return!prevValue;});return;}},[]);useEffect(function(){var linkTracker={linkReceived:linkReceived,eventUrlPrefix:'chat-history/'};AddEventLinkTracker(linkTracker);return function(){return RemoveLinkEventTracker(linkTracker);};},[linkReceived]);useEffect(function(){var chatState=new ChatHistoryState();var roomState=new RoomHistoryState();SetChatHistory(chatState);chatState.notifier=function(){return setChatHistoryUpdateId(function(prevValue){return prevValue+1;});};roomState.notifier=function(){return setRoomHistoryUpdateId(function(prevValue){return prevValue+1;});};setChatHistoryState(chatState);setRoomHistoryState(roomState);return function(){chatState.notifier=null;roomState.notifier=null;};},[]);useEffect(function(){if(elementRef&&elementRef.current&&isVisible)elementRef.current.scrollToRow(-1);},[isVisible]);return/*#__PURE__*/_jsxs(ChatHistoryContextProvider,{value:{chatHistoryState:chatHistoryState,roomHistoryState:roomHistoryState},children:[/*#__PURE__*/_jsx(ChatHistoryMessageHandler,{}),isVisible&&/*#__PURE__*/_jsxs(NitroCardView,{uniqueKey:\"chat-history\",className:\"nitro-chat-history\",theme:\"primary-slim\",children:[/*#__PURE__*/_jsx(NitroCardHeaderView,{headerText:LocalizeText('room.chathistory.button.text'),onCloseClick:function onCloseClick(event){return setIsVisible(false);}}),/*#__PURE__*/_jsx(NitroCardContentView,{children:/*#__PURE__*/_jsx(AutoSizer,{defaultWidth:300,defaultHeight:200,onResize:onResize,children:function children(_ref){var height=_ref.height,width=_ref.width;return/*#__PURE__*/_jsx(List,{ref:elementRef,width:width,height:height,rowCount:chatHistoryState.chats.length,rowHeight:cache.rowHeight,className:'chat-history-list',rowRenderer:RowRenderer,deferredMeasurementCache:cache});}})})]})]});};","map":null,"metadata":{},"sourceType":"module"}