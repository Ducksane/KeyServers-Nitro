{"ast":null,"code":"import _createForOfIteratorHelper from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _slicedToArray from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{GiftReceiverNotFoundEvent,PurchaseFromCatalogAsGiftComposer}from'@nitrots/nitro-renderer';import classNames from'classnames';import{useCallback,useEffect,useMemo,useState}from'react';import{GetSessionDataManager,LocalizeText,ProductTypeEnum,SendMessageComposer}from'../../../../api';import{Base,Button,ButtonGroup,Column,Flex,FormGroup,LayoutCurrencyIcon,LayoutFurniImageView,LayoutGiftTagView,NitroCardContentView,NitroCardHeaderView,NitroCardView,Text}from'../../../../common';import{CatalogEvent,CatalogPurchasedEvent}from'../../../../events';import{useCatalog,UseMessageEventHook,UseUiEvent}from'../../../../hooks';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var CatalogGiftView=function CatalogGiftView(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isVisible=_useState2[0],setIsVisible=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),pageId=_useState4[0],setPageId=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),offerId=_useState6[0],setOfferId=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),extraData=_useState8[0],setExtraData=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),receiverName=_useState10[0],setReceiverName=_useState10[1];var _useState11=useState(true),_useState12=_slicedToArray(_useState11,2),showMyFace=_useState12[0],setShowMyFace=_useState12[1];var _useState13=useState(''),_useState14=_slicedToArray(_useState13,2),message=_useState14[0],setMessage=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),colors=_useState16[0],setColors=_useState16[1];var _useState17=useState(0),_useState18=_slicedToArray(_useState17,2),selectedBoxIndex=_useState18[0],setSelectedBoxIndex=_useState18[1];var _useState19=useState(0),_useState20=_slicedToArray(_useState19,2),selectedRibbonIndex=_useState20[0],setSelectedRibbonIndex=_useState20[1];var _useState21=useState(0),_useState22=_slicedToArray(_useState21,2),selectedColorId=_useState22[0],setSelectedColorId=_useState22[1];var _useState23=useState(0),_useState24=_slicedToArray(_useState23,2),maxBoxIndex=_useState24[0],setMaxBoxIndex=_useState24[1];var _useState25=useState(0),_useState26=_slicedToArray(_useState25,2),maxRibbonIndex=_useState26[0],setMaxRibbonIndex=_useState26[1];var _useState27=useState(false),_useState28=_slicedToArray(_useState27,2),receiverNotFound=_useState28[0],setReceiverNotFound=_useState28[1];var _useCatalog=useCatalog(),_useCatalog$catalogOp=_useCatalog.catalogOptions,catalogOptions=_useCatalog$catalogOp===void 0?null:_useCatalog$catalogOp;var _catalogOptions$giftC=catalogOptions.giftConfiguration,giftConfiguration=_catalogOptions$giftC===void 0?null:_catalogOptions$giftC;var close=useCallback(function(){setIsVisible(false);setPageId(0);setOfferId(0);setExtraData('');setReceiverName('');setShowMyFace(true);setMessage('');setSelectedBoxIndex(0);setSelectedRibbonIndex(0);if(colors.length)setSelectedColorId(colors[0].id);},[colors]);var onCatalogEvent=useCallback(function(event){switch(event.type){case CatalogPurchasedEvent.PURCHASE_SUCCESS:close();return;case CatalogEvent.INIT_GIFT:var castedEvent=event;close();setPageId(castedEvent.pageId);setOfferId(castedEvent.offerId);setExtraData(castedEvent.extraData);setIsVisible(true);return;}},[close]);UseUiEvent(CatalogPurchasedEvent.PURCHASE_SUCCESS,onCatalogEvent);UseUiEvent(CatalogEvent.INIT_GIFT,onCatalogEvent);var isBoxDefault=useMemo(function(){return giftConfiguration?giftConfiguration.defaultStuffTypes.findIndex(function(s){return s===giftConfiguration.boxTypes[selectedBoxIndex];})>-1:true;},[giftConfiguration,selectedBoxIndex]);var boxExtraData=useMemo(function(){if(!giftConfiguration)return'';return(giftConfiguration.boxTypes[selectedBoxIndex]*1000+giftConfiguration.ribbonTypes[selectedRibbonIndex]).toString();},[giftConfiguration,selectedBoxIndex,selectedRibbonIndex]);var isColorable=useMemo(function(){if(!giftConfiguration)return false;var boxType=giftConfiguration.boxTypes[selectedBoxIndex];return boxType===8||boxType>=3&&boxType<=6?false:true;},[giftConfiguration,selectedBoxIndex]);var handleAction=useCallback(function(action){switch(action){case'prev_box':setSelectedBoxIndex(function(value){return value===0?maxBoxIndex:value-1;});return;case'next_box':setSelectedBoxIndex(function(value){return value===maxBoxIndex?0:value+1;});return;case'prev_ribbon':setSelectedRibbonIndex(function(value){return value===0?maxRibbonIndex:value-1;});return;case'next_ribbon':setSelectedRibbonIndex(function(value){return value===maxRibbonIndex?0:value+1;});return;case'buy':if(!receiverName||receiverName.length===0){setReceiverNotFound(true);return;}SendMessageComposer(new PurchaseFromCatalogAsGiftComposer(pageId,offerId,extraData,receiverName,message,selectedColorId,selectedBoxIndex,selectedRibbonIndex,showMyFace));return;}},[extraData,maxBoxIndex,maxRibbonIndex,message,offerId,pageId,receiverName,selectedBoxIndex,selectedColorId,selectedRibbonIndex,showMyFace]);var onGiftReceiverNotFoundEvent=useCallback(function(){setReceiverNotFound(true);},[]);UseMessageEventHook(GiftReceiverNotFoundEvent,onGiftReceiverNotFoundEvent);useEffect(function(){setReceiverNotFound(false);},[receiverName]);useEffect(function(){if(!giftConfiguration)return;var newColors=[];var _iterator=_createForOfIteratorHelper(giftConfiguration.stuffTypes),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var colorId=_step.value;var giftData=GetSessionDataManager().getFloorItemData(colorId);if(!giftData)continue;if(giftData.colors&&giftData.colors.length>0)newColors.push({id:colorId,color:\"#\".concat(giftData.colors[0].toString(16))});}}catch(err){_iterator.e(err);}finally{_iterator.f();}setMaxBoxIndex(giftConfiguration.boxTypes.length-1);setMaxRibbonIndex(giftConfiguration.ribbonTypes.length-1);if(newColors.length){setSelectedColorId(newColors[0].id);setColors(newColors);}},[giftConfiguration]);if(!giftConfiguration||!giftConfiguration.isEnabled||!isVisible)return null;var boxName='catalog.gift_wrapping_new.box.'+(isBoxDefault?'default':selectedBoxIndex);var ribbonName=\"catalog.gift_wrapping_new.ribbon.\".concat(selectedRibbonIndex);var priceText='catalog.gift_wrapping_new.'+(isBoxDefault?'freeprice':'price');return/*#__PURE__*/_jsxs(NitroCardView,{uniqueKey:\"catalog-gift\",className:\"nitro-catalog-gift\",theme:\"primary-slim\",children:[/*#__PURE__*/_jsx(NitroCardHeaderView,{headerText:LocalizeText('catalog.gift_wrapping.title'),onCloseClick:close}),/*#__PURE__*/_jsxs(NitroCardContentView,{className:\"text-black\",children:[/*#__PURE__*/_jsxs(FormGroup,{column:true,children:[/*#__PURE__*/_jsx(Text,{style:{color:\"var(--test-galaxytext)\"},variant:\"none\",children:LocalizeText('catalog.gift_wrapping.receiver')}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:'form-control form-control-sm'+classNames({' is-invalid':receiverNotFound}),value:receiverName,onChange:function onChange(e){return setReceiverName(e.target.value);}}),receiverNotFound&&/*#__PURE__*/_jsx(Base,{className:\"invalid-feedback\",children:LocalizeText('catalog.gift_wrapping.receiver_not_found.title')})]}),/*#__PURE__*/_jsx(LayoutGiftTagView,{figure:GetSessionDataManager().figure,userName:GetSessionDataManager().userName,message:message,editable:true,onChange:function onChange(value){return setMessage(value);}}),/*#__PURE__*/_jsxs(Base,{className:\"form-check\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"form-check-input\",type:\"checkbox\",name:\"showMyFace\",checked:showMyFace,onChange:function onChange(e){return setShowMyFace(function(value){return!value;});}}),/*#__PURE__*/_jsx(\"label\",{style:{color:\"var(--test-galaxytext)\"},className:\"form-check-label\",children:LocalizeText('catalog.gift_wrapping.show_face.title')})]}),/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",gap:2,children:[selectedColorId&&/*#__PURE__*/_jsx(Base,{className:\"gift-preview\",children:/*#__PURE__*/_jsx(LayoutFurniImageView,{productType:ProductTypeEnum.FLOOR,productClassId:selectedColorId,extraData:boxExtraData})}),/*#__PURE__*/_jsxs(Column,{gap:1,children:[/*#__PURE__*/_jsxs(Flex,{gap:2,children:[/*#__PURE__*/_jsxs(ButtonGroup,{children:[/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:function onClick(){return handleAction('prev_box');},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-left\"})}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:function onClick(){return handleAction('next_box');},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-right\"})})]}),/*#__PURE__*/_jsxs(Column,{gap:1,children:[/*#__PURE__*/_jsx(Text,{style:{color:\"var(--test-galaxytext)\"},variant:\"none\",fontWeight:\"bold\",children:LocalizeText(boxName)}),/*#__PURE__*/_jsxs(Flex,{style:{color:\"var(--test-galaxytext)\"},alignItems:\"center\",gap:1,children:[LocalizeText(priceText,['price'],[giftConfiguration.price.toString()]),/*#__PURE__*/_jsx(LayoutCurrencyIcon,{type:-1})]})]})]}),/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",gap:2,children:[/*#__PURE__*/_jsxs(ButtonGroup,{children:[/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:function onClick(){return handleAction('prev_ribbon');},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-left\"})}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:function onClick(){return handleAction('next_ribbon');},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-right\"})})]}),/*#__PURE__*/_jsx(Text,{style:{color:\"var(--test-galaxytext)\"},variant:\"none\",fontWeight:\"bold\",children:LocalizeText(ribbonName)})]})]})]}),/*#__PURE__*/_jsxs(Column,{gap:1,children:[/*#__PURE__*/_jsx(Text,{style:{color:\"var(--test-galaxytext)\"},variant:\"none\",fontWeight:\"bold\",children:LocalizeText('catalog.gift_wrapping.pick_color')}),/*#__PURE__*/_jsx(ButtonGroup,{fullWidth:true,children:colors.map(function(color){return/*#__PURE__*/_jsx(Button,{variant:\"dark\",active:color.id===selectedColorId,disabled:!isColorable,style:{backgroundColor:color.color},onClick:function onClick(){return setSelectedColorId(color.id);}},color.id);})})]}),/*#__PURE__*/_jsxs(Flex,{justifyContent:\"between\",alignItems:\"center\",children:[/*#__PURE__*/_jsx(Button,{variant:\"link\",onClick:close,style:{color:\"var(--test-galaxytext)\"},children:LocalizeText('cancel')}),/*#__PURE__*/_jsx(Button,{variant:\"success\",onClick:function onClick(){return handleAction('buy');},children:LocalizeText('catalog.gift_wrapping.give_gift')})]})]})]});};","map":null,"metadata":{},"sourceType":"module"}