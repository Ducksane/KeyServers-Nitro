{"ast":null,"code":"import _slicedToArray from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{CameraPublishStatusMessageEvent,CameraPurchaseOKMessageEvent,CameraStorageUrlMessageEvent,PublishPhotoMessageComposer,PurchasePhotoMessageComposer}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useMemo,useState}from'react';import{CreateLinkEvent,GetConfiguration,GetRoomEngine,LocalizeText,SendMessageComposer}from'../../../../api';import{Button,Column,Flex,LayoutCurrencyIcon,LayoutImage,NitroCardContentView,NitroCardHeaderView,NitroCardView,Text}from'../../../../common';import{UseMessageEventHook}from'../../../../hooks';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var CameraWidgetCheckoutView=function CameraWidgetCheckoutView(props){var _props$base64Url=props.base64Url,base64Url=_props$base64Url===void 0?null:_props$base64Url,_props$onCloseClick=props.onCloseClick,onCloseClick=_props$onCloseClick===void 0?null:_props$onCloseClick,_props$onCancelClick=props.onCancelClick,onCancelClick=_props$onCancelClick===void 0?null:_props$onCancelClick,_props$price=props.price,price=_props$price===void 0?null:_props$price;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),pictureUrl=_useState2[0],setPictureUrl=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),publishUrl=_useState4[0],setPublishUrl=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),picturesBought=_useState6[0],setPicturesBought=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),wasPicturePublished=_useState8[0],setWasPicturePublished=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isWaiting=_useState10[0],setIsWaiting=_useState10[1];var _useState11=useState(0),_useState12=_slicedToArray(_useState11,2),publishCooldown=_useState12[0],setPublishCooldown=_useState12[1];var publishDisabled=useMemo(function(){return GetConfiguration('camera.publish.disabled',false);},[]);var onCameraPurchaseOKMessageEvent=useCallback(function(event){setPicturesBought(function(value){return value+1;});setIsWaiting(false);},[]);UseMessageEventHook(CameraPurchaseOKMessageEvent,onCameraPurchaseOKMessageEvent);var onCameraPublishStatusMessageEvent=useCallback(function(event){var parser=event.getParser();setPublishUrl(parser.extraDataId);setPublishCooldown(parser.secondsToWait);setWasPicturePublished(parser.ok);setIsWaiting(false);},[]);UseMessageEventHook(CameraPublishStatusMessageEvent,onCameraPublishStatusMessageEvent);var onCameraStorageUrlMessageEvent=useCallback(function(event){var parser=event.getParser();setPictureUrl(GetConfiguration('camera.url')+'/'+parser.url);},[]);UseMessageEventHook(CameraStorageUrlMessageEvent,onCameraStorageUrlMessageEvent);var processAction=function processAction(type){var value=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;switch(type){case'close':onCloseClick();return;case'buy':if(isWaiting)return;setIsWaiting(true);SendMessageComposer(new PurchasePhotoMessageComposer(''));return;case'publish':if(isWaiting)return;setIsWaiting(true);SendMessageComposer(new PublishPhotoMessageComposer());return;case'cancel':onCancelClick();return;}};useEffect(function(){if(!base64Url)return;GetRoomEngine().saveBase64AsScreenshot(base64Url);},[base64Url]);if(!price)return null;return/*#__PURE__*/_jsxs(NitroCardView,{className:\"nitro-camera-checkout\",theme:\"primary-slim\",children:[/*#__PURE__*/_jsx(NitroCardHeaderView,{headerText:LocalizeText('camera.confirm_phase.title'),onCloseClick:function onCloseClick(event){return processAction('close');}}),/*#__PURE__*/_jsxs(NitroCardContentView,{children:[/*#__PURE__*/_jsxs(Flex,{center:true,children:[pictureUrl&&pictureUrl.length&&/*#__PURE__*/_jsx(LayoutImage,{className:\"picture-preview border\",imageUrl:pictureUrl}),(!pictureUrl||!pictureUrl.length)&&/*#__PURE__*/_jsx(Flex,{center:true,className:\"picture-preview border\",children:/*#__PURE__*/_jsx(Text,{bold:true,children:LocalizeText('camera.loading')})})]}),/*#__PURE__*/_jsxs(Flex,{justifyContent:\"between\",alignItems:\"center\",className:\"bg-muted rounded p-2\",children:[/*#__PURE__*/_jsxs(Column,{size:publishDisabled?10:6,gap:1,children:[/*#__PURE__*/_jsx(Text,{bold:true,children:LocalizeText('camera.purchase.header')}),(price.credits>0||price.duckets>0)&&/*#__PURE__*/_jsxs(Flex,{gap:1,children:[/*#__PURE__*/_jsx(Text,{children:LocalizeText('catalog.purchase.confirmation.dialog.cost')}),price.credits>0&&/*#__PURE__*/_jsxs(Flex,{gap:1,children:[/*#__PURE__*/_jsx(Text,{bold:true,children:price.credits}),/*#__PURE__*/_jsx(LayoutCurrencyIcon,{type:-1})]}),price.duckets>0&&/*#__PURE__*/_jsxs(Flex,{gap:1,children:[/*#__PURE__*/_jsx(Text,{bold:true,children:price.duckets}),/*#__PURE__*/_jsx(LayoutCurrencyIcon,{type:5})]})]}),picturesBought>0&&/*#__PURE__*/_jsxs(Text,{children:[/*#__PURE__*/_jsx(Text,{bold:true,children:LocalizeText('camera.purchase.count.info')}),\" \",picturesBought,/*#__PURE__*/_jsx(\"u\",{className:\"ms-1 cursor-pointer\",onClick:function onClick(){return CreateLinkEvent('inventory/toggle');},children:LocalizeText('camera.open.inventory')})]})]}),/*#__PURE__*/_jsx(Flex,{alignItems:\"center\",children:/*#__PURE__*/_jsx(Button,{variant:\"success\",disabled:isWaiting,onClick:function onClick(event){return processAction('buy');},children:LocalizeText(!picturesBought?'buy':'camera.buy.another.button.text')})})]}),!publishDisabled&&/*#__PURE__*/_jsxs(Flex,{justifyContent:\"between\",alignItems:\"center\",className:\"bg-muted rounded p-2\",children:[/*#__PURE__*/_jsxs(Column,{gap:1,children:[/*#__PURE__*/_jsx(Text,{bold:true,children:LocalizeText(wasPicturePublished?'camera.publish.successful':'camera.publish.explanation')}),/*#__PURE__*/_jsx(Text,{children:LocalizeText(wasPicturePublished?'camera.publish.success.short.info':'camera.publish.detailed.explanation')}),wasPicturePublished&&/*#__PURE__*/_jsx(\"a\",{href:publishUrl,rel:\"noreferrer\",target:\"_blank\",children:LocalizeText('camera.link.to.published')}),!wasPicturePublished&&price.publishDucketPrice>0&&/*#__PURE__*/_jsxs(Flex,{gap:1,children:[/*#__PURE__*/_jsx(Text,{children:LocalizeText('catalog.purchase.confirmation.dialog.cost')}),/*#__PURE__*/_jsxs(Flex,{gap:1,children:[/*#__PURE__*/_jsx(Text,{bold:true,children:price.publishDucketPrice}),/*#__PURE__*/_jsx(LayoutCurrencyIcon,{type:5})]})]}),publishCooldown>0&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-1 text-center fw-bold\",children:LocalizeText('camera.publish.wait',['minutes'],[Math.ceil(publishCooldown/60).toString()])})]}),!wasPicturePublished&&/*#__PURE__*/_jsx(Flex,{className:\"d-flex align-items-end\",children:/*#__PURE__*/_jsx(Button,{variant:\"success\",disabled:isWaiting||publishCooldown>0,onClick:function onClick(event){return processAction('publish');},children:LocalizeText('camera.publish.button.text')})})]}),/*#__PURE__*/_jsx(Text,{style:{color:\"var(--test-galaxytext)\"},variant:\"none\",center:true,children:LocalizeText('camera.warning.disclaimer')}),/*#__PURE__*/_jsx(Flex,{justifyContent:\"end\",children:/*#__PURE__*/_jsx(Button,{onClick:function onClick(event){return processAction('cancel');},children:LocalizeText('generic.cancel')})})]})]});};","map":null,"metadata":{},"sourceType":"module"}