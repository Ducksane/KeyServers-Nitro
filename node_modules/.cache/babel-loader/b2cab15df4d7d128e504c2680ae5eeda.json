{"ast":null,"code":"import _objectSpread from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _toConsumableArray from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _createForOfIteratorHelper from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _slicedToArray from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import classNames from'classnames';import{useCallback,useEffect,useMemo,useState}from'react';import ReactSlider from'react-slider';import{ColorUtils,GetConfiguration,LocalizeText,RoomWidgetDimmerChangeStateMessage,RoomWidgetDimmerPreviewMessage,RoomWidgetDimmerSavePresetMessage,RoomWidgetUpdateDimmerEvent,RoomWidgetUpdateDimmerStateEvent}from'../../../../../api';import{Base,Button,Column,Flex,Grid,NitroCardContentView,NitroCardHeaderView,NitroCardTabsItemView,NitroCardTabsView,NitroCardView,Text}from'../../../../../common';import{UseEventDispatcherHook}from'../../../../../hooks';import{useRoomContext}from'../../../RoomContext';import{DimmerFurnitureWidgetPresetItem}from'./DimmerFurnitureWidgetPresetItem';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var AVAILABLE_COLORS=[7665141,21495,15161822,15353138,15923281,8581961,0];var HTML_COLORS=['#74F5F5','#0053F7','#E759DE','#EA4532','#F2F851','#82F349','#000000'];var MIN_BRIGHTNESS=76;var MAX_BRIGHTNESS=255;export var FurnitureDimmerView=function FurnitureDimmerView(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isVisible=_useState2[0],setIsVisible=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),presets=_useState4[0],setPresets=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),selectedPresetId=_useState6[0],setSelectedPresetId=_useState6[1];var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),dimmerState=_useState8[0],setDimmerState=_useState8[1];var _useState9=useState(0),_useState10=_slicedToArray(_useState9,2),lastDimmerState=_useState10[0],setLastDimmerState=_useState10[1];var _useState11=useState(0),_useState12=_slicedToArray(_useState11,2),effectId=_useState12[0],setEffectId=_useState12[1];var _useState13=useState(0xFFFFFF),_useState14=_slicedToArray(_useState13,2),color=_useState14[0],setColor=_useState14[1];var _useState15=useState(0xFF),_useState16=_slicedToArray(_useState15,2),brightness=_useState16[0],setBrightness=_useState16[1];var _useState17=useState(0),_useState18=_slicedToArray(_useState17,2),selectedEffectId=_useState18[0],setSelectedEffectId=_useState18[1];var _useState19=useState(0),_useState20=_slicedToArray(_useState19,2),selectedColor=_useState20[0],setSelectedColor=_useState20[1];var _useState21=useState(0),_useState22=_slicedToArray(_useState21,2),selectedBrightness=_useState22[0],setSelectedBrightness=_useState22[1];var _useRoomContext=useRoomContext(),_useRoomContext$event=_useRoomContext.eventDispatcher,eventDispatcher=_useRoomContext$event===void 0?null:_useRoomContext$event,_useRoomContext$widge=_useRoomContext.widgetHandler,widgetHandler=_useRoomContext$widge===void 0?null:_useRoomContext$widge;var onNitroEvent=useCallback(function(event){switch(event.type){case RoomWidgetUpdateDimmerEvent.PRESETS:{var widgetEvent=event;var _presets=[];var _iterator=_createForOfIteratorHelper(widgetEvent.presets),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var preset=_step.value;_presets.push(new DimmerFurnitureWidgetPresetItem(preset.id,preset.type,preset.color,preset.brightness));}}catch(err){_iterator.e(err);}finally{_iterator.f();}setPresets(_presets);setSelectedPresetId(widgetEvent.selectedPresetId);setIsVisible(true);return;}case RoomWidgetUpdateDimmerEvent.HIDE:{setIsVisible(false);return;}case RoomWidgetUpdateDimmerStateEvent.DIMMER_STATE:{var _widgetEvent=event;setLastDimmerState(dimmerState);setDimmerState(_widgetEvent.state);setSelectedPresetId(_widgetEvent.presetId);setEffectId(_widgetEvent.effectId);setSelectedEffectId(_widgetEvent.effectId);setColor(_widgetEvent.color);setSelectedColor(_widgetEvent.color);setBrightness(_widgetEvent.brightness);setSelectedBrightness(_widgetEvent.brightness);return;}}},[dimmerState]);UseEventDispatcherHook(RoomWidgetUpdateDimmerEvent.PRESETS,eventDispatcher,onNitroEvent);UseEventDispatcherHook(RoomWidgetUpdateDimmerEvent.HIDE,eventDispatcher,onNitroEvent);UseEventDispatcherHook(RoomWidgetUpdateDimmerStateEvent.DIMMER_STATE,eventDispatcher,onNitroEvent);var selectPresetId=useCallback(function(id){var preset=presets[id-1];if(!preset)return;setSelectedPresetId(preset.id);setSelectedEffectId(preset.type);setSelectedColor(preset.color);setSelectedBrightness(preset.light);},[presets]);var close=useCallback(function(){widgetHandler.processWidgetMessage(new RoomWidgetDimmerPreviewMessage(color,brightness,effectId===2));setIsVisible(false);},[widgetHandler,color,brightness,effectId]);var toggleState=useCallback(function(){widgetHandler.processWidgetMessage(new RoomWidgetDimmerChangeStateMessage());},[widgetHandler]);var applyChanges=useCallback(function(){if(dimmerState===0)return;var selectedPresetIndex=selectedPresetId-1;if(selectedPresetId<1||selectedPresetId>presets.length)return;var preset=presets[selectedPresetIndex];if(!preset||selectedEffectId===preset.type&&selectedColor===preset.color&&selectedBrightness===preset.light)return;setPresets(function(prevValue){var newValue=_toConsumableArray(prevValue);newValue[selectedPresetIndex]=new DimmerFurnitureWidgetPresetItem(preset.id,selectedEffectId,selectedColor,selectedBrightness);return newValue;});widgetHandler.processWidgetMessage(new RoomWidgetDimmerSavePresetMessage(preset.id,selectedEffectId,selectedColor,selectedBrightness,true));},[widgetHandler,dimmerState,selectedPresetId,presets,selectedEffectId,selectedColor,selectedBrightness]);var scaledBrightness=useCallback(function(value){return~~((value-MIN_BRIGHTNESS)*(100-0)/(MAX_BRIGHTNESS-MIN_BRIGHTNESS)+0);},[]);var isFreeColorMode=useMemo(function(){return GetConfiguration('widget.dimmer.colorwheel',false);},[]);useEffect(function(){if(dimmerState===0&&lastDimmerState===0)return;widgetHandler.processWidgetMessage(new RoomWidgetDimmerPreviewMessage(selectedColor,selectedBrightness,selectedEffectId===2));},[widgetHandler,dimmerState,lastDimmerState,selectedColor,selectedBrightness,selectedEffectId]);if(!isVisible)return null;return/*#__PURE__*/_jsxs(NitroCardView,{className:\"nitro-room-widget-dimmer\",children:[/*#__PURE__*/_jsx(NitroCardHeaderView,{headerText:LocalizeText('widget.dimmer.title'),onCloseClick:close}),dimmerState===1&&/*#__PURE__*/_jsx(NitroCardTabsView,{children:presets.map(function(preset){return/*#__PURE__*/_jsx(NitroCardTabsItemView,{isActive:selectedPresetId===preset.id,onClick:function onClick(event){return selectPresetId(preset.id);},children:LocalizeText(\"widget.dimmer.tab.\".concat(preset.id))},preset.id);})}),/*#__PURE__*/_jsxs(NitroCardContentView,{children:[dimmerState===0&&/*#__PURE__*/_jsxs(Column,{alignItems:\"center\",children:[/*#__PURE__*/_jsx(Base,{className:\"dimmer-banner\"}),/*#__PURE__*/_jsx(Text,{center:true,className:\"bg-muted rounded p-1\",children:LocalizeText('widget.dimmer.info.off')}),/*#__PURE__*/_jsx(Button,{fullWidth:true,variant:\"success\",onClick:toggleState,children:LocalizeText('widget.dimmer.button.on')})]}),dimmerState===1&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Column,{gap:1,children:[/*#__PURE__*/_jsx(Text,{fontWeight:\"bold\",children:LocalizeText('widget.backgroundcolor.hue')}),isFreeColorMode&&/*#__PURE__*/_jsx(\"input\",{type:\"color\",className:\"form-control\",value:ColorUtils.makeColorNumberHex(selectedColor),onChange:function onChange(event){return setSelectedColor(ColorUtils.convertFromHex(event.target.value));}}),!isFreeColorMode&&/*#__PURE__*/_jsx(Grid,{gap:1,columnCount:7,children:AVAILABLE_COLORS.map(function(color,index){return/*#__PURE__*/_jsx(Column,{fullWidth:true,pointer:true,className:'color-swatch rounded'+classNames({' active':color===selectedColor}),onClick:function onClick(){return setSelectedColor(color);},style:{backgroundColor:HTML_COLORS[index]}},index);})})]}),/*#__PURE__*/_jsxs(Column,{gap:1,children:[/*#__PURE__*/_jsx(Text,{fontWeight:\"bold\",children:LocalizeText('widget.backgroundcolor.lightness')}),/*#__PURE__*/_jsx(ReactSlider,{className:\"nitro-slider\",min:MIN_BRIGHTNESS,max:MAX_BRIGHTNESS,value:selectedBrightness,onChange:function onChange(value){return setSelectedBrightness(value);},thumbClassName:'thumb percent',renderThumb:function renderThumb(props,state){return/*#__PURE__*/_jsx(\"div\",_objectSpread(_objectSpread({},props),{},{children:scaledBrightness(state.valueNow)}));}})]}),/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",gap:1,children:[/*#__PURE__*/_jsx(\"input\",{className:\"form-check-input\",type:\"checkbox\",checked:selectedEffectId===2,onChange:function onChange(event){return setSelectedEffectId(event.target.checked?2:1);}}),/*#__PURE__*/_jsx(Text,{children:LocalizeText('widget.dimmer.type.checkbox')})]}),/*#__PURE__*/_jsxs(Flex,{gap:1,children:[/*#__PURE__*/_jsx(Button,{fullWidth:true,variant:\"danger\",onClick:toggleState,children:LocalizeText('widget.dimmer.button.off')}),/*#__PURE__*/_jsx(Button,{fullWidth:true,variant:\"success\",onClick:applyChanges,children:LocalizeText('widget.dimmer.button.apply')})]})]})]})]});};","map":null,"metadata":{},"sourceType":"module"}