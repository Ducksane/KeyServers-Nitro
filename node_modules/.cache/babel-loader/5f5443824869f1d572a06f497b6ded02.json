{"ast":null,"code":"import _createForOfIteratorHelper from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _classCallCheck from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _get from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/get.js\";import _getPrototypeOf from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js\";import _inherits from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import{RoomObjectMouseEvent}from'../../../../../room/events/RoomObjectMouseEvent';import{Vector3d}from'../../../../../room/utils/Vector3d';import{PetFigureData}from'../../../../avatar/pets/PetFigureData';import{PetType}from'../../../../avatar/pets/PetType';import{MouseEventType}from'../../../../ui/MouseEventType';import{RoomObjectMoveEvent}from'../../../events/RoomObjectMoveEvent';import{ObjectAvatarExperienceUpdateMessage}from'../../../messages';import{ObjectAvatarChatUpdateMessage}from'../../../messages/ObjectAvatarChatUpdateMessage';import{ObjectAvatarFigureUpdateMessage}from'../../../messages/ObjectAvatarFigureUpdateMessage';import{ObjectAvatarPetGestureUpdateMessage}from'../../../messages/ObjectAvatarPetGestureUpdateMessage';import{ObjectAvatarPostureUpdateMessage}from'../../../messages/ObjectAvatarPostureUpdateMessage';import{ObjectAvatarSelectedMessage}from'../../../messages/ObjectAvatarSelectedMessage';import{ObjectAvatarSleepUpdateMessage}from'../../../messages/ObjectAvatarSleepUpdateMessage';import{ObjectAvatarUpdateMessage}from'../../../messages/ObjectAvatarUpdateMessage';import{RoomObjectVariable}from'../../RoomObjectVariable';import{MovingObjectLogic}from'../MovingObjectLogic';export var PetLogic=/*#__PURE__*/function(_MovingObjectLogic){_inherits(PetLogic,_MovingObjectLogic);var _super=_createSuper(PetLogic);function PetLogic(){var _this;_classCallCheck(this,PetLogic);_this=_super.call(this);_this._selected=void 0;_this._reportedLocation=void 0;_this._postureIndex=void 0;_this._gestureIndex=void 0;_this._headDirectionDelta=void 0;_this._directions=void 0;_this._talkingEndTimestamp=void 0;_this._gestureEndTimestamp=void 0;_this._expressionEndTimestamp=void 0;_this._selected=false;_this._reportedLocation=null;_this._postureIndex=0;_this._gestureIndex=0;_this._headDirectionDelta=0;_this._directions=[];_this._talkingEndTimestamp=0;_this._gestureEndTimestamp=0;_this._expressionEndTimestamp=0;return _this;}_createClass(PetLogic,[{key:\"getEventTypes\",value:function getEventTypes(){var types=[RoomObjectMouseEvent.CLICK,RoomObjectMoveEvent.POSITION_CHANGED];return this.mergeTypes(_get(_getPrototypeOf(PetLogic.prototype),\"getEventTypes\",this).call(this),types);}},{key:\"initialize\",value:function initialize(asset){if(!asset)return;var model=this.object&&this.object.model;if(!model)return;if(asset.logic){if(asset.logic.model){var directions=asset.logic.model.directions;if(directions&&directions.length){var _iterator=_createForOfIteratorHelper(directions),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var direction=_step.value;this._directions.push(direction);}}catch(err){_iterator.e(err);}finally{_iterator.f();}this._directions.sort();}}}model.setValue(RoomObjectVariable.PET_ALLOWED_DIRECTIONS,this._directions);}},{key:\"dispose\",value:function dispose(){if(this._selected&&this.object){if(this.eventDispatcher)this.eventDispatcher.dispatchEvent(new RoomObjectMoveEvent(RoomObjectMoveEvent.OBJECT_REMOVED,this.object));}this._directions=null;this._reportedLocation=null;}},{key:\"update\",value:function update(totalTimeRunning){_get(_getPrototypeOf(PetLogic.prototype),\"update\",this).call(this,totalTimeRunning);if(this._selected&&this.object){if(this.eventDispatcher){var location=this.object.getLocation();if(!this._reportedLocation||this._reportedLocation.x!==location.x||this._reportedLocation.y!==location.y||this._reportedLocation.z!==location.z){if(!this._reportedLocation)this._reportedLocation=new Vector3d();this._reportedLocation.assign(location);this.eventDispatcher.dispatchEvent(new RoomObjectMoveEvent(RoomObjectMoveEvent.POSITION_CHANGED,this.object));}}}if(this.object&&this.object.model)this.updateModel(totalTimeRunning,this.object.model);}},{key:\"updateModel\",value:function updateModel(time,model){if(this._gestureEndTimestamp>0&&time>this._gestureEndTimestamp){model.setValue(RoomObjectVariable.FIGURE_GESTURE,null);this._gestureEndTimestamp=0;}if(this._talkingEndTimestamp>0){if(time>this._talkingEndTimestamp){model.setValue(RoomObjectVariable.FIGURE_TALK,0);this._talkingEndTimestamp=0;}}if(this._expressionEndTimestamp>0&&time>this._expressionEndTimestamp){model.setValue(RoomObjectVariable.FIGURE_EXPRESSION,0);this._expressionEndTimestamp=0;}}},{key:\"processUpdateMessage\",value:function processUpdateMessage(message){if(!message||!this.object)return;_get(_getPrototypeOf(PetLogic.prototype),\"processUpdateMessage\",this).call(this,message);var model=this.object&&this.object.model;if(!model)return;if(message instanceof ObjectAvatarUpdateMessage){model.setValue(RoomObjectVariable.HEAD_DIRECTION,message.headDirection);return;}if(message instanceof ObjectAvatarFigureUpdateMessage){var petFigureData=new PetFigureData(message.figure);model.setValue(RoomObjectVariable.FIGURE,message.figure);model.setValue(RoomObjectVariable.RACE,message.subType);model.setValue(RoomObjectVariable.PET_PALETTE_INDEX,petFigureData.paletteId);model.setValue(RoomObjectVariable.PET_COLOR,petFigureData.color);model.setValue(RoomObjectVariable.PET_TYPE,petFigureData.typeId);model.setValue(RoomObjectVariable.PET_CUSTOM_LAYER_IDS,petFigureData.customLayerIds);model.setValue(RoomObjectVariable.PET_CUSTOM_PARTS_IDS,petFigureData.customPartIds);model.setValue(RoomObjectVariable.PET_CUSTOM_PALETTE_IDS,petFigureData.customPaletteIds);model.setValue(RoomObjectVariable.PET_IS_RIDING,message.isRiding?1:0);return;}if(message instanceof ObjectAvatarPostureUpdateMessage){model.setValue(RoomObjectVariable.FIGURE_POSTURE,message.postureType);return;}if(message instanceof ObjectAvatarChatUpdateMessage){model.setValue(RoomObjectVariable.FIGURE_TALK,1);this._talkingEndTimestamp=this.time+message.numberOfWords*1000;return;}if(message instanceof ObjectAvatarSleepUpdateMessage){model.setValue(RoomObjectVariable.FIGURE_SLEEP,message.isSleeping?1:0);return;}if(message instanceof ObjectAvatarPetGestureUpdateMessage){model.setValue(RoomObjectVariable.FIGURE_GESTURE,message.gesture);this._gestureEndTimestamp=this.time+3000;return;}if(message instanceof ObjectAvatarSelectedMessage){this._selected=message.selected;this._reportedLocation=null;return;}if(message instanceof ObjectAvatarExperienceUpdateMessage){model.setValue(RoomObjectVariable.FIGURE_EXPERIENCE_TIMESTAMP,this.time);model.setValue(RoomObjectVariable.FIGURE_GAINED_EXPERIENCE,message.gainedExperience);return;}}},{key:\"mouseEvent\",value:function mouseEvent(event,geometry){var eventType=null;switch(event.type){case MouseEventType.MOUSE_CLICK:eventType=RoomObjectMouseEvent.CLICK;break;case MouseEventType.DOUBLE_CLICK:break;case MouseEventType.MOUSE_DOWN:{var petType=this.object.model.getValue(RoomObjectVariable.PET_TYPE);if(petType===PetType.MONSTERPLANT){if(this.eventDispatcher)this.eventDispatcher.dispatchEvent(new RoomObjectMouseEvent(RoomObjectMouseEvent.MOUSE_DOWN,this.object,event.eventId,event.altKey,event.ctrlKey,event.shiftKey,event.buttonDown));}break;}}if(eventType&&this.eventDispatcher)this.eventDispatcher.dispatchEvent(new RoomObjectMouseEvent(eventType,this.object,event.eventId,event.altKey,event.ctrlKey,event.shiftKey,event.buttonDown));}}]);return PetLogic;}(MovingObjectLogic);","map":null,"metadata":{},"sourceType":"module"}