{"ast":null,"code":"import _slicedToArray from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _createForOfIteratorHelper from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _classCallCheck from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/createClass.js\";import{RoomObjectSpriteData}from'../../data/RoomObjectSpriteData';import{RoomObjectSpriteType}from'../../object/enum/RoomObjectSpriteType';import{RoomObjectCacheItem}from'./RoomObjectCacheItem';export var RoomObjectCache=/*#__PURE__*/function(){function RoomObjectCache(accurateZ){_classCallCheck(this,RoomObjectCache);this._data=void 0;this._roomObjectVariableAccurateZ=void 0;this._data=new Map();this._roomObjectVariableAccurateZ=accurateZ;}_createClass(RoomObjectCache,[{key:\"dispose\",value:function dispose(){if(this._data){var _iterator=_createForOfIteratorHelper(this._data.entries()),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var _step$value=_slicedToArray(_step.value,2),key=_step$value[0],item=_step$value[1];if(!item)continue;this._data.delete(key);item.dispose();}}catch(err){_iterator.e(err);}finally{_iterator.f();}this._data=null;}}},{key:\"getObjectCache\",value:function getObjectCache(k){var existing=this._data.get(k);if(!existing){existing=new RoomObjectCacheItem(this._roomObjectVariableAccurateZ);this._data.set(k,existing);}return existing;}},{key:\"removeObjectCache\",value:function removeObjectCache(k){var existing=this._data.get(k);if(!existing)return;this._data.delete(k);existing.dispose();}},{key:\"getSortableSpriteList\",value:function getSortableSpriteList(){var spriteData=[];var _iterator2=_createForOfIteratorHelper(this._data.values()),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var item=_step2.value;if(!item)continue;var sprites=item.sprites&&item.sprites.sprites;if(!sprites||!sprites.length)continue;var _iterator3=_createForOfIteratorHelper(sprites),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var sprite=_step3.value;if(!sprite)continue;if(sprite.sprite.spriteType!==RoomObjectSpriteType.ROOM_PLANE&&sprite.sprite.name!==''){var data=new RoomObjectSpriteData();data.objectId=item.objectId;data.x=sprite.x;data.y=sprite.y;data.z=sprite.z;data.name=sprite.sprite.name||'';data.flipH=sprite.sprite.flipH;data.alpha=sprite.sprite.alpha;data.color=sprite.sprite.color.toString();data.blendMode=sprite.sprite.blendMode.toString();data.width=sprite.sprite.width;data.height=sprite.sprite.height;data.type=sprite.sprite.type;data.posture=sprite.sprite.posture;var isSkewed=this.isSkewedSprite(sprite.sprite);if(isSkewed){data.skew=sprite.sprite.direction%4===0?-0.5:0.5;}if((isSkewed||sprite.name.indexOf('%image.library.url%')>=0||sprite.name.indexOf('%group.badge.url%')>=0)&&data.width<=RoomObjectCache.MAX_SIZE_FOR_AVG_COLOR&&data.height<=RoomObjectCache.MAX_SIZE_FOR_AVG_COLOR){//data.color = Canvas._Str_23439(sprite.sprite.texture).toString();\nif(sprite.sprite.name.indexOf('external_image_wallitem')===0){data.frame=true;}}spriteData.push(data);}}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}if(!spriteData||!spriteData.length)return null;return spriteData;}},{key:\"isSkewedSprite\",value:function isSkewedSprite(k){if(!k.type)return false;if(k.type.indexOf('external_image_wallitem')===0&&k.tag==='THUMBNAIL')return true;if(k.type.indexOf('guild_forum')===0&&k.tag==='THUMBNAIL')return true;return false;}},{key:\"getPlaneSortableSprites\",value:function getPlaneSortableSprites(){var sprites=[];var _iterator4=_createForOfIteratorHelper(this._data.values()),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var item=_step4.value;var _iterator5=_createForOfIteratorHelper(item.sprites.sprites),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var sprite=_step5.value;if(sprite.sprite.spriteType===RoomObjectSpriteType.ROOM_PLANE)sprites.push(sprite);}}catch(err){_iterator5.e(err);}finally{_iterator5.f();}}}catch(err){_iterator4.e(err);}finally{_iterator4.f();}return sprites;}}]);return RoomObjectCache;}();RoomObjectCache.MAX_SIZE_FOR_AVG_COLOR=200;","map":null,"metadata":{},"sourceType":"module"}