{"ast":null,"code":"import _toConsumableArray from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{InitCameraMessageEvent,RequestCameraConfigurationComposer,RoomCameraWidgetManagerEvent,RoomSessionEvent}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useState}from'react';import{AddEventLinkTracker,GetRoomCameraWidgetManager,RemoveLinkEventTracker,SendMessageComposer}from'../../api';import{UseCameraEvent,UseMessageEventHook,UseRoomSessionManagerEvent}from'../../hooks';import{CameraWidgetContextProvider}from'./CameraWidgetContext';import{CameraWidgetCaptureView}from'./views/capture/CameraWidgetCaptureView';import{CameraWidgetCheckoutView}from'./views/checkout/CameraWidgetCheckoutView';import{CameraWidgetEditorView}from'./views/editor/CameraWidgetEditorView';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var MODE_NONE=0;var MODE_CAPTURE=1;var MODE_EDITOR=2;var MODE_CHECKOUT=3;export var CameraWidgetView=function CameraWidgetView(props){var _useState=useState(MODE_NONE),_useState2=_slicedToArray(_useState,2),mode=_useState2[0],setMode=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),availableEffects=_useState4[0],setAvailableEffects=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),cameraRoll=_useState6[0],setCameraRoll=_useState6[1];var _useState7=useState(-1),_useState8=_slicedToArray(_useState7,2),selectedPictureIndex=_useState8[0],setSelectedPictureIndex=_useState8[1];var _useState9=useState(10),_useState10=_slicedToArray(_useState9,2),myLevel=_useState10[0],setMyLevel=_useState10[1];var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),base64Url=_useState12[0],setSavedPictureUrl=_useState12[1];var _useState13=useState(null),_useState14=_slicedToArray(_useState13,2),price=_useState14[0],setPrice=_useState14[1];var onRoomCameraWidgetManagerEvent=useCallback(function(event){setAvailableEffects(Array.from(GetRoomCameraWidgetManager().effects.values()));},[]);UseCameraEvent(RoomCameraWidgetManagerEvent.INITIALIZED,onRoomCameraWidgetManagerEvent);var onCameraConfigurationEvent=useCallback(function(event){var parser=event.getParser();setPrice({credits:parser.creditPrice,duckets:parser.ducketPrice,publishDucketPrice:parser.publishDucketPrice});},[]);UseMessageEventHook(InitCameraMessageEvent,onCameraConfigurationEvent);var onRoomSessionEvent=useCallback(function(event){setMode(MODE_NONE);},[]);UseRoomSessionManagerEvent(RoomSessionEvent.ENDED,onRoomSessionEvent);useEffect(function(){if(!GetRoomCameraWidgetManager().isLoaded){GetRoomCameraWidgetManager().init();SendMessageComposer(new RequestCameraConfigurationComposer());return;}},[]);var processAction=useCallback(function(type){switch(type){case'close':setMode(MODE_NONE);return;case'edit':setMode(MODE_EDITOR);return;case'delete':setCameraRoll(function(prevValue){var clone=_toConsumableArray(prevValue);clone.splice(selectedPictureIndex,1);return clone;});return;case'editor_cancel':setMode(MODE_CAPTURE);return;}},[selectedPictureIndex]);var checkoutPictureUrl=useCallback(function(pictureUrl){setSavedPictureUrl(pictureUrl);setMode(MODE_CHECKOUT);},[]);var linkReceived=useCallback(function(url){var parts=url.split('/');if(parts.length<2)return;switch(parts[1]){case'show':setMode(MODE_CAPTURE);return;case'hide':setMode(MODE_NONE);return;case'toggle':setMode(function(prevValue){if(!prevValue)return MODE_CAPTURE;else return MODE_NONE;});return;}},[]);useEffect(function(){var linkTracker={linkReceived:linkReceived,eventUrlPrefix:'camera/'};AddEventLinkTracker(linkTracker);return function(){return RemoveLinkEventTracker(linkTracker);};},[linkReceived]);if(mode===MODE_NONE)return null;return/*#__PURE__*/_jsxs(CameraWidgetContextProvider,{value:{cameraRoll:cameraRoll,setCameraRoll:setCameraRoll,selectedPictureIndex:selectedPictureIndex,setSelectedPictureIndex:setSelectedPictureIndex},children:[mode===MODE_CAPTURE&&/*#__PURE__*/_jsx(CameraWidgetCaptureView,{onClose:function onClose(){return processAction('close');},onEdit:function onEdit(){return processAction('edit');},onDelete:function onDelete(){return processAction('delete');}}),mode===MODE_EDITOR&&/*#__PURE__*/_jsx(CameraWidgetEditorView,{picture:cameraRoll[selectedPictureIndex],myLevel:myLevel,onClose:function onClose(){return processAction('close');},onCancel:function onCancel(){return processAction('editor_cancel');},onCheckout:checkoutPictureUrl,availableEffects:availableEffects}),mode===MODE_CHECKOUT&&/*#__PURE__*/_jsx(CameraWidgetCheckoutView,{base64Url:base64Url,onCloseClick:function onCloseClick(){return processAction('close');},onCancelClick:function onCancelClick(){return processAction('editor_cancel');},price:price})]});};","map":null,"metadata":{},"sourceType":"module"}