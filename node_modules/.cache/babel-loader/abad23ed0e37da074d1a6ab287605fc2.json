{"ast":null,"code":"import _classCallCheck from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import{PetFigureData,RoomObjectCategory,RoomObjectVariable,RoomSessionPresentEvent,RoomWidgetEnum,TextureUtils,Vector3d}from'@nitrots/nitro-renderer';import{GetSessionDataManager,IsOwnerOfFurniture}from'../../..';import{GetRoomEngine,LocalizeText}from'../../../..';import{ProductTypeEnum}from'../../../../catalog';import{RoomWidgetUpdatePresentDataEvent}from'../events';import{RoomWidgetFurniToWidgetMessage,RoomWidgetPresentOpenMessage}from'../messages';import{RoomWidgetHandler}from'./RoomWidgetHandler';export var FurniturePresentWidgetHandler=/*#__PURE__*/function(_RoomWidgetHandler){_inherits(FurniturePresentWidgetHandler,_RoomWidgetHandler);var _super=_createSuper(FurniturePresentWidgetHandler);function FurniturePresentWidgetHandler(){var _this;_classCallCheck(this,FurniturePresentWidgetHandler);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this._lastFurniId=-1;_this._name=null;return _this;}_createClass(FurniturePresentWidgetHandler,[{key:\"processEvent\",value:function processEvent(event){switch(event.type){case RoomSessionPresentEvent.RSPE_PRESENT_OPENED:{var presentEvent=event;var furniData=null;if(presentEvent.itemType===ProductTypeEnum.FLOOR){furniData=GetSessionDataManager().getFloorItemData(presentEvent.classId);}else if(presentEvent.itemType===ProductTypeEnum.WALL){furniData=GetSessionDataManager().getWallItemData(presentEvent.classId);}var isOwnerOfFurni=false;if(presentEvent.placedInRoom){var roomObject=GetRoomEngine().getRoomObject(this.container.roomSession.roomId,presentEvent.placedItemId,RoomObjectCategory.FLOOR);if(roomObject)isOwnerOfFurni=IsOwnerOfFurniture(roomObject);}var giftImage=null;var dataUpdateEvent=null;switch(presentEvent.itemType){case ProductTypeEnum.WALL:{if(furniData){switch(furniData.className){case FurniturePresentWidgetHandler.FLOOR:dataUpdateEvent=new RoomWidgetUpdatePresentDataEvent(RoomWidgetUpdatePresentDataEvent.CONTENTS_FLOOR,0,LocalizeText('inventory.furni.item.floor.name'),isOwnerOfFurni);break;case FurniturePresentWidgetHandler.LANDSCAPE:dataUpdateEvent=new RoomWidgetUpdatePresentDataEvent(RoomWidgetUpdatePresentDataEvent.CONTENTS_LANDSCAPE,0,LocalizeText('inventory.furni.item.landscape.name'),isOwnerOfFurni);break;case FurniturePresentWidgetHandler.WALLPAPER:dataUpdateEvent=new RoomWidgetUpdatePresentDataEvent(RoomWidgetUpdatePresentDataEvent.CONTENTS_WALLPAPER,0,LocalizeText('inventory.furni.item.wallpaper.name'),isOwnerOfFurni);break;case FurniturePresentWidgetHandler.POSTER:{var productCode=presentEvent.productCode;var extras=null;if(productCode.indexOf('poster')===0)extras=productCode.replace('poster','');giftImage=GetRoomEngine().getFurnitureWallIconUrl(presentEvent.classId,extras);var productData=GetSessionDataManager().getProductData(productCode);if(productData)this._name=productData.name;else if(furniData)this._name=furniData.name;dataUpdateEvent=new RoomWidgetUpdatePresentDataEvent(RoomWidgetUpdatePresentDataEvent.CONTENTS,0,this._name,isOwnerOfFurni,giftImage);break;}default:{giftImage=GetRoomEngine().getFurnitureWallIconUrl(presentEvent.classId);if(furniData)this._name=furniData.name;dataUpdateEvent=new RoomWidgetUpdatePresentDataEvent(RoomWidgetUpdatePresentDataEvent.CONTENTS,0,this._name,isOwnerOfFurni,giftImage);break;}}}break;}case ProductTypeEnum.HABBO_CLUB:dataUpdateEvent=new RoomWidgetUpdatePresentDataEvent(RoomWidgetUpdatePresentDataEvent.CONTENTS_CLUB,0,LocalizeText('widget.furni.present.hc'),false);break;default:{if(presentEvent.placedItemType===ProductTypeEnum.PET){var petfigureString=presentEvent.petFigureString;if(petfigureString&&petfigureString.length){var petFigureData=new PetFigureData(petfigureString);var petImage=GetRoomEngine().getRoomObjectPetImage(petFigureData.typeId,petFigureData.paletteId,petFigureData.color,new Vector3d(90),64,this,true,0,petFigureData.customParts);if(petImage)giftImage=petImage.getImage().src;}}if(!giftImage){var furniImage=GetRoomEngine().getFurnitureFloorImage(presentEvent.classId,new Vector3d(90),64,this);if(furniImage)giftImage=furniImage.getImage().src;}var _productData=GetSessionDataManager().getProductData(presentEvent.productCode);if(_productData)this._name=_productData.name;else this._name=furniData.name;if(giftImage)dataUpdateEvent=new RoomWidgetUpdatePresentDataEvent(RoomWidgetUpdatePresentDataEvent.CONTENTS,0,this._name,isOwnerOfFurni,giftImage);break;}}if(dataUpdateEvent){dataUpdateEvent.classId=presentEvent.classId;dataUpdateEvent.itemType=presentEvent.itemType;dataUpdateEvent.placedItemId=presentEvent.placedItemId;dataUpdateEvent.placedInRoom=presentEvent.placedInRoom;dataUpdateEvent.placedItemType=presentEvent.placedItemType;this.container.eventDispatcher.dispatchEvent(dataUpdateEvent);}return;}}}},{key:\"processWidgetMessage\",value:function processWidgetMessage(message){switch(message.type){case RoomWidgetFurniToWidgetMessage.REQUEST_PRESENT:{var widgetMessage=message;var roomObject=GetRoomEngine().getRoomObject(widgetMessage.roomId,widgetMessage.objectId,widgetMessage.category);if(!roomObject)return null;this._lastFurniId=widgetMessage.objectId;var giftMessage=roomObject.model.getValue(RoomObjectVariable.FURNITURE_DATA)||'';var purchaserName=roomObject.model.getValue(RoomObjectVariable.FURNITURE_PURCHASER_NAME);var purchaserFigure=roomObject.model.getValue(RoomObjectVariable.FURNITURE_PURCHASER_FIGURE);var typeId=roomObject.model.getValue(RoomObjectVariable.FURNITURE_TYPE_ID);var extras=roomObject.model.getValue(RoomObjectVariable.FURNITURE_EXTRAS);var giftImage=GetRoomEngine().getFurnitureFloorImage(typeId,new Vector3d(180),64,null,0,extras);this.container.eventDispatcher.dispatchEvent(new RoomWidgetUpdatePresentDataEvent(RoomWidgetUpdatePresentDataEvent.PACKAGEINFO,widgetMessage.objectId,giftMessage,IsOwnerOfFurniture(roomObject),giftImage.getImage().src,purchaserName,purchaserFigure));break;}case RoomWidgetPresentOpenMessage.OPEN_PRESENT:{var openMessage=message;if(openMessage.objectId!==this._lastFurniId)return null;this.container.roomSession.openGift(openMessage.objectId);GetRoomEngine().changeObjectModelData(GetRoomEngine().activeRoomId,openMessage.objectId,RoomObjectCategory.FLOOR,RoomObjectVariable.FURNITURE_DISABLE_PICKING_ANIMATION,1);break;}}return null;}},{key:\"imageReady\",value:function imageReady(id,texture){var image=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var imageUrl=null;if(image)imageUrl=image.src;else if(texture)imageUrl=TextureUtils.generateImageUrl(texture);this.container.eventDispatcher.dispatchEvent(new RoomWidgetUpdatePresentDataEvent(RoomWidgetUpdatePresentDataEvent.CONTENTS_IMAGE,0,this._name,false,imageUrl));}},{key:\"imageFailed\",value:function imageFailed(id){}},{key:\"type\",get:function get(){return RoomWidgetEnum.FURNI_PRESENT_WIDGET;}},{key:\"eventTypes\",get:function get(){return[RoomSessionPresentEvent.RSPE_PRESENT_OPENED];}},{key:\"messageTypes\",get:function get(){return[RoomWidgetFurniToWidgetMessage.REQUEST_PRESENT,RoomWidgetPresentOpenMessage.OPEN_PRESENT];}}]);return FurniturePresentWidgetHandler;}(RoomWidgetHandler);FurniturePresentWidgetHandler.FLOOR='floor';FurniturePresentWidgetHandler.WALLPAPER='wallpaper';FurniturePresentWidgetHandler.LANDSCAPE='landscape';FurniturePresentWidgetHandler.POSTER='poster';","map":null,"metadata":{},"sourceType":"module"}