{"ast":null,"code":"import _objectSpread from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _toConsumableArray from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _objectWithoutProperties from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";var _excluded=[\"objectId\",\"category\",\"userType\",\"fades\",\"close\",\"position\",\"classNames\",\"style\",\"children\",\"collapsable\"];import{FixedSizeStack,RoomObjectType}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useMemo,useRef,useState}from'react';import{GetNitroInstance,GetRoomObjectBounds,GetRoomObjectScreenLocation,GetRoomSession,GetTicker}from'../../../../api';import{Base}from'../../../../common';import{ContextMenuCaretView}from'./ContextMenuCaretView';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var LOCATION_STACK_SIZE=25;var BUBBLE_DROP_SPEED=3;var fadeDelay=3000;var fadeLength=75;var SPACE_AROUND_EDGES=10;var COLLAPSED=false;export var ContextMenuView=function ContextMenuView(props){var _props$objectId=props.objectId,objectId=_props$objectId===void 0?-1:_props$objectId,_props$category=props.category,category=_props$category===void 0?-1:_props$category,_props$userType=props.userType,userType=_props$userType===void 0?-1:_props$userType,_props$fades=props.fades,fades=_props$fades===void 0?false:_props$fades,_props$close=props.close,close=_props$close===void 0?null:_props$close,_props$position=props.position,position=_props$position===void 0?'absolute':_props$position,_props$classNames=props.classNames,classNames=_props$classNames===void 0?[]:_props$classNames,_props$style=props.style,style=_props$style===void 0?{}:_props$style,_props$children=props.children,children=_props$children===void 0?null:_props$children,_props$collapsable=props.collapsable,collapsable=_props$collapsable===void 0?false:_props$collapsable,rest=_objectWithoutProperties(props,_excluded);var _useState=useState({x:null,y:null}),_useState2=_slicedToArray(_useState,2),pos=_useState2[0],setPos=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),deltaYStack=_useState4[0],setDeltaYStack=_useState4[1];var _useState5=useState(-1000000),_useState6=_slicedToArray(_useState5,2),currentDeltaY=_useState6[0],setCurrentDeltaY=_useState6[1];var _useState7=useState(1),_useState8=_slicedToArray(_useState7,2),opacity=_useState8[0],setOpacity=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isFading=_useState10[0],setIsFading=_useState10[1];var _useState11=useState(0),_useState12=_slicedToArray(_useState11,2),fadeTime=_useState12[0],setFadeTime=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),isFrozen=_useState14[0],setIsFrozen=_useState14[1];var elementRef=useRef();var _useState15=useState(COLLAPSED),_useState16=_slicedToArray(_useState15,2),collapsed=_useState16[0],setCollapsed=_useState16[1];var getOffset=useCallback(function(bounds){var height=-elementRef.current.offsetHeight;if(userType>-1&&(userType===RoomObjectType.USER||userType===RoomObjectType.BOT||userType===RoomObjectType.RENTABLE_BOT)){height=height+(bounds.height>50?15:0);}else{height=height-14;}return height;},[userType]);var updateFade=useCallback(function(time){var newFadeTime=time;var newOpacity=1;if(isFading){setFadeTime(function(prevValue){newFadeTime+=prevValue;return newFadeTime;});newOpacity=(1-newFadeTime/fadeLength)*1;if(newOpacity<=0){close();return false;}setOpacity(newOpacity);}return true;},[isFading,close]);var updatePosition=useCallback(function(bounds,location){if(!bounds||!location||!deltaYStack)return;var offset=getOffset(bounds);deltaYStack.addValue(location.y-bounds.top);var maxStack=deltaYStack.getMax();if(maxStack<currentDeltaY-BUBBLE_DROP_SPEED)maxStack=currentDeltaY-BUBBLE_DROP_SPEED;var deltaY=location.y-maxStack;var x=~~(location.x-elementRef.current.offsetWidth/2);var y=~~(deltaY+offset);var maxLeft=GetNitroInstance().width-elementRef.current.offsetWidth-SPACE_AROUND_EDGES;var maxTop=GetNitroInstance().height-elementRef.current.offsetHeight-SPACE_AROUND_EDGES;if(x<SPACE_AROUND_EDGES)x=SPACE_AROUND_EDGES;else if(x>maxLeft)x=maxLeft;if(y<SPACE_AROUND_EDGES)y=SPACE_AROUND_EDGES;else if(y>maxTop)y=maxTop;setCurrentDeltaY(maxStack);setPos({x:x,y:y});},[deltaYStack,currentDeltaY,getOffset]);var update=useCallback(function(time){if(!elementRef.current||!updateFade(time))return;var bounds=GetRoomObjectBounds(GetRoomSession().roomId,objectId,category);var location=GetRoomObjectScreenLocation(GetRoomSession().roomId,objectId,category);updatePosition(bounds,location);},[objectId,category,updateFade,updatePosition]);var getClassNames=useMemo(function(){var newClassNames=['nitro-context-menu animate__animated animate__pulse animate__slow animate__infinite'];if(collapsed)newClassNames.push('menu-hidden');newClassNames.push(pos.x!==null?'visible':'invisible');if(classNames.length)newClassNames.push.apply(newClassNames,_toConsumableArray(classNames));return newClassNames;},[pos,classNames,collapsed]);var getStyle=useMemo(function(){var newStyle={};newStyle.left=pos.x||0;newStyle.top=pos.y||0;newStyle.opacity=opacity;if(Object.keys(style).length)newStyle=_objectSpread(_objectSpread({},newStyle),style);return newStyle;},[pos,opacity,style]);useEffect(function(){setDeltaYStack(new FixedSizeStack(LOCATION_STACK_SIZE));setCurrentDeltaY(-1000000);},[]);useEffect(function(){var added=false;if(!isFrozen){added=true;GetTicker().add(update);}return function(){if(added)GetTicker().remove(update);};},[isFrozen,update]);useEffect(function(){if(!fades)return;var timeout=setTimeout(function(){return setIsFading(true);},fadeDelay);return function(){return clearTimeout(timeout);};},[fades]);var toggleCollapse=function toggleCollapse(){COLLAPSED=!COLLAPSED;setCollapsed(COLLAPSED);};return/*#__PURE__*/_jsxs(Base,_objectSpread(_objectSpread({innerRef:elementRef,position:position,classNames:getClassNames,style:getStyle,onMouseOver:function onMouseOver(event){return setIsFrozen(true);},onMouseOut:function onMouseOut(event){return setIsFrozen(false);}},rest),{},{children:[!(collapsable&&COLLAPSED)&&children,collapsable&&/*#__PURE__*/_jsx(ContextMenuCaretView,{onClick:function onClick(){return toggleCollapse();},collapsed:collapsed})]}));};","map":null,"metadata":{},"sourceType":"module"}