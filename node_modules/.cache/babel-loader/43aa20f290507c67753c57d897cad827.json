{"ast":null,"code":"import _slicedToArray from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{PurchaseFromCatalogComposer}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useMemo,useState}from'react';import{CatalogPurchaseState,CreateLinkEvent,GetClubMemberLevel,LocalizeText,LocalStorageKeys,Offer,SendMessageComposer}from'../../../../../api';import{Button,LayoutLoadingSpinnerView}from'../../../../../common';import{CatalogInitGiftEvent,CatalogPurchasedEvent,CatalogPurchaseFailureEvent,CatalogPurchaseNotAllowedEvent,CatalogPurchaseSoldOutEvent}from'../../../../../events';import{DispatchUiEvent,useCatalog,useLocalStorage,usePurse,UseUiEvent}from'../../../../../hooks';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var CatalogPurchaseWidgetView=function CatalogPurchaseWidgetView(props){var _props$noGiftOption=props.noGiftOption,noGiftOption=_props$noGiftOption===void 0?false:_props$noGiftOption,_props$purchaseCallba=props.purchaseCallback,purchaseCallback=_props$purchaseCallba===void 0?null:_props$purchaseCallba;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),purchaseWillBeGift=_useState2[0],setPurchaseWillBeGift=_useState2[1];var _useState3=useState(CatalogPurchaseState.NONE),_useState4=_slicedToArray(_useState3,2),purchaseState=_useState4[0],setPurchaseState=_useState4[1];var _useLocalStorage=useLocalStorage(LocalStorageKeys.CATALOG_SKIP_PURCHASE_CONFIRMATION,false),_useLocalStorage2=_slicedToArray(_useLocalStorage,2),catalogSkipPurchaseConfirmation=_useLocalStorage2[0],setCatalogSkipPurchaseConfirmation=_useLocalStorage2[1];var _useCatalog=useCatalog(),_useCatalog$currentOf=_useCatalog.currentOffer,currentOffer=_useCatalog$currentOf===void 0?null:_useCatalog$currentOf,_useCatalog$currentPa=_useCatalog.currentPage,currentPage=_useCatalog$currentPa===void 0?null:_useCatalog$currentPa,_useCatalog$purchaseO=_useCatalog.purchaseOptions,purchaseOptions=_useCatalog$purchaseO===void 0?null:_useCatalog$purchaseO,_useCatalog$setPurcha=_useCatalog.setPurchaseOptions,setPurchaseOptions=_useCatalog$setPurcha===void 0?null:_useCatalog$setPurcha;var _usePurse=usePurse(),_usePurse$getCurrency=_usePurse.getCurrencyAmount,getCurrencyAmount=_usePurse$getCurrency===void 0?null:_usePurse$getCurrency;var onCatalogEvent=useCallback(function(event){switch(event.type){case CatalogPurchasedEvent.PURCHASE_SUCCESS:setPurchaseState(CatalogPurchaseState.NONE);return;case CatalogPurchaseFailureEvent.PURCHASE_FAILED:setPurchaseState(CatalogPurchaseState.FAILED);return;case CatalogPurchaseNotAllowedEvent.NOT_ALLOWED:setPurchaseState(CatalogPurchaseState.FAILED);return;case CatalogPurchaseSoldOutEvent.SOLD_OUT:setPurchaseState(CatalogPurchaseState.SOLD_OUT);return;}},[]);UseUiEvent(CatalogPurchasedEvent.PURCHASE_SUCCESS,onCatalogEvent);UseUiEvent(CatalogPurchaseFailureEvent.PURCHASE_FAILED,onCatalogEvent);UseUiEvent(CatalogPurchaseNotAllowedEvent.NOT_ALLOWED,onCatalogEvent);UseUiEvent(CatalogPurchaseSoldOutEvent.SOLD_OUT,onCatalogEvent);var isLimitedSoldOut=useMemo(function(){if(!currentOffer)return false;if(purchaseOptions.extraParamRequired&&(!purchaseOptions.extraData||!purchaseOptions.extraData.length))return false;if(currentOffer.pricingModel===Offer.PRICING_MODEL_SINGLE){var product=currentOffer.product;if(product&&product.isUniqueLimitedItem)return!product.uniqueLimitedItemsLeft;}return false;},[currentOffer,purchaseOptions]);var purchase=function purchase(){var isGift=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!currentOffer)return;if(GetClubMemberLevel()<currentOffer.clubLevel){CreateLinkEvent('habboUI/open/hccenter');return;}if(isGift){DispatchUiEvent(new CatalogInitGiftEvent(currentOffer.page.pageId,currentOffer.offerId,purchaseOptions.extraData));return;}setPurchaseState(CatalogPurchaseState.PURCHASE);if(purchaseCallback){purchaseCallback();return;}var pageId=currentOffer.page.pageId;// if(pageId === -1)\n// {\n//     const nodes = getNodesByOfferId(currentOffer.offerId);\n//     if(nodes) pageId = nodes[0].pageId;\n// }\nSendMessageComposer(new PurchaseFromCatalogComposer(pageId,currentOffer.offerId,purchaseOptions.extraData,purchaseOptions.quantity));};useEffect(function(){if(!currentOffer)return;return function(){setPurchaseState(CatalogPurchaseState.NONE);setPurchaseOptions({quantity:1,extraData:null,extraParamRequired:false,previewStuffData:null});};},[currentOffer,setPurchaseOptions]);useEffect(function(){var timeout=null;if(purchaseState===CatalogPurchaseState.CONFIRM||purchaseState===CatalogPurchaseState.FAILED){timeout=setTimeout(function(){return setPurchaseState(CatalogPurchaseState.NONE);},3000);}return function(){if(timeout)clearTimeout(timeout);};},[purchaseState]);if(!currentOffer)return null;var PurchaseButton=function PurchaseButton(){var priceCredits=currentOffer.priceInCredits*purchaseOptions.quantity;var pricePoints=currentOffer.priceInActivityPoints*purchaseOptions.quantity;if(GetClubMemberLevel()<currentOffer.clubLevel)return/*#__PURE__*/_jsx(Button,{variant:\"danger\",disabled:true,children:LocalizeText('catalog.alert.hc.required')});if(isLimitedSoldOut)return/*#__PURE__*/_jsx(Button,{variant:\"danger\",disabled:true,children:LocalizeText('catalog.alert.limited_edition_sold_out.title')});if(priceCredits>getCurrencyAmount(-1))return/*#__PURE__*/_jsx(Button,{variant:\"danger\",disabled:true,children:LocalizeText('catalog.alert.notenough.title')});if(pricePoints>getCurrencyAmount(currentOffer.activityPointType))return/*#__PURE__*/_jsx(Button,{variant:\"danger\",disabled:true,children:LocalizeText('catalog.alert.notenough.activitypoints.title.'+currentOffer.activityPointType)});switch(purchaseState){case CatalogPurchaseState.CONFIRM:return/*#__PURE__*/_jsx(Button,{variant:\"warning\",onClick:function onClick(event){return purchase();},children:LocalizeText('catalog.marketplace.confirm_title')});case CatalogPurchaseState.PURCHASE:return/*#__PURE__*/_jsx(Button,{disabled:true,children:/*#__PURE__*/_jsx(LayoutLoadingSpinnerView,{})});case CatalogPurchaseState.FAILED:return/*#__PURE__*/_jsx(Button,{variant:\"danger\",children:LocalizeText('generic.failed')});case CatalogPurchaseState.SOLD_OUT:return/*#__PURE__*/_jsx(Button,{variant:\"danger\",children:LocalizeText('generic.failed')+' - '+LocalizeText('catalog.alert.limited_edition_sold_out.title')});case CatalogPurchaseState.NONE:default:return/*#__PURE__*/_jsx(Button,{disabled:purchaseOptions.extraParamRequired&&(!purchaseOptions.extraData||!purchaseOptions.extraData.length),onClick:function onClick(event){return setPurchaseState(CatalogPurchaseState.CONFIRM);},children:LocalizeText('catalog.purchase_confirmation.'+(currentOffer.isRentOffer?'rent':'buy'))});}};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(PurchaseButton,{}),!noGiftOption&&!currentOffer.isRentOffer&&/*#__PURE__*/_jsx(Button,{disabled:purchaseOptions.quantity>1||!currentOffer.giftable||isLimitedSoldOut||purchaseOptions.extraParamRequired&&(!purchaseOptions.extraData||!purchaseOptions.extraData.length),onClick:function onClick(event){return purchase(true);},children:LocalizeText('catalog.purchase_confirmation.gift')})]});};","map":null,"metadata":{},"sourceType":"module"}