{"ast":null,"code":"import _createForOfIteratorHelper from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _classCallCheck from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import{NitroLogger}from'../../../core/common/logger/NitroLogger';import{EventDispatcher}from'../../../core/events/EventDispatcher';import{NitroEvent}from'../../../core/events/NitroEvent';import{FurnitureData}from'./FurnitureData';import{FurnitureType}from'./FurnitureType';export var FurnitureDataLoader=/*#__PURE__*/function(_EventDispatcher){_inherits(FurnitureDataLoader,_EventDispatcher);var _super=_createSuper(FurnitureDataLoader);function FurnitureDataLoader(floorItems,wallItems,localization){var _this;_classCallCheck(this,FurnitureDataLoader);_this=_super.call(this);_this._floorItems=void 0;_this._wallItems=void 0;_this._localization=void 0;_this._nitroLogger=void 0;_this._floorItems=floorItems;_this._wallItems=wallItems;_this._localization=localization;_this._nitroLogger=new NitroLogger(_this.constructor.name);return _this;}_createClass(FurnitureDataLoader,[{key:\"loadFurnitureData\",value:function loadFurnitureData(url){var _this2=this;if(!url)return;fetch(url).then(function(response){return response.json();}).then(function(data){return _this2.onFurnitureDataLoaded(data);}).catch(function(err){return _this2.onFurnitureDataError(err);});}},{key:\"onFurnitureDataLoaded\",value:function onFurnitureDataLoaded(data){if(!data)return;if(typeof data.roomitemtypes=='undefined'||typeof data.wallitemtypes=='undefined')this._nitroLogger.warn('Could not find `roomitemtypes` or `wallitemtypes` in furnidata.');if(data.roomitemtypes)this.parseFloorItems(data.roomitemtypes);if(data.wallitemtypes)this.parseWallItems(data.wallitemtypes);this.dispatchEvent(new NitroEvent(FurnitureDataLoader.FURNITURE_DATA_READY));}},{key:\"onFurnitureDataError\",value:function onFurnitureDataError(error){if(!error)return;console.error(error);this.dispatchEvent(new NitroEvent(FurnitureDataLoader.FURNITURE_DATA_ERROR));}},{key:\"parseFloorItems\",value:function parseFloorItems(data){if(!data||!data.furnitype)return;var _iterator=_createForOfIteratorHelper(data.furnitype),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var furniture=_step.value;if(!furniture)continue;var colors=[];if(furniture.partcolors){var _iterator2=_createForOfIteratorHelper(furniture.partcolors.color),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var color=_step2.value;var colorCode=color;if(colorCode.charAt(0)==='#'){colorCode=colorCode.replace('#','');colors.push(parseInt(colorCode,16));}else{colors.push(parseInt(colorCode,16));}}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}}var classSplit=furniture.classname.split('*');var className=classSplit[0];var colorIndex=classSplit.length>1?parseInt(classSplit[1]):0;var hasColorIndex=classSplit.length>1;var furnitureData=new FurnitureData(FurnitureType.FLOOR,furniture.id,furniture.classname,className,furniture.category,furniture.name,furniture.description,furniture.revision,furniture.xdim,furniture.ydim,0,colors,hasColorIndex,colorIndex,furniture.adurl,furniture.offerid,furniture.buyout,furniture.rentofferid,furniture.rentbuyout,furniture.bc,furniture.customparams,furniture.specialtype,furniture.canstandon,furniture.cansiton,furniture.canlayon,furniture.excludeddynamic,furniture.furniline,furniture.environment,furniture.rare);this._floorItems.set(furnitureData.id,furnitureData);this.updateLocalizations(furnitureData);}}catch(err){_iterator.e(err);}finally{_iterator.f();}}},{key:\"parseWallItems\",value:function parseWallItems(data){if(!data||!data.furnitype)return;var _iterator3=_createForOfIteratorHelper(data.furnitype),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var furniture=_step3.value;if(!furniture)continue;var furnitureData=new FurnitureData(FurnitureType.WALL,furniture.id,furniture.classname,furniture.classname,furniture.category,furniture.name,furniture.description,furniture.revision,0,0,0,null,false,0,furniture.adurl,furniture.offerid,furniture.buyout,furniture.rentofferid,furniture.rentbuyout,furniture.bc,null,furniture.specialtype,false,false,false,furniture.excludeddynamic,furniture.furniline,furniture.environment,furniture.rare);this._wallItems.set(furnitureData.id,furnitureData);this.updateLocalizations(furnitureData);}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}}},{key:\"updateLocalizations\",value:function updateLocalizations(furniture){if(!this._localization)return;switch(furniture.type){case FurnitureType.FLOOR:this._localization.setValue('roomItem.name.'+furniture.id,furniture.name);this._localization.setValue('roomItem.desc.'+furniture.id,furniture.description);return;case FurnitureType.WALL:this._localization.setValue('wallItem.name.'+furniture.id,furniture.name);this._localization.setValue('wallItem.desc.'+furniture.id,furniture.description);return;}}}]);return FurnitureDataLoader;}(EventDispatcher);FurnitureDataLoader.FURNITURE_DATA_READY='FDP_FURNITURE_DATA_READY';FurnitureDataLoader.FURNITURE_DATA_ERROR='FDP_FURNITURE_DATA_ERROR';","map":null,"metadata":{},"sourceType":"module"}