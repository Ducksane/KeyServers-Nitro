{"ast":null,"code":"import _createForOfIteratorHelper from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _toConsumableArray from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{RoomEnterEffect,RoomObjectCategory}from'@nitrots/nitro-renderer';import{useCallback,useMemo,useState}from'react';import{GetRoomSession,GetSessionDataManager,RoomWidgetObjectNameEvent,RoomWidgetRoomObjectMessage,RoomWidgetUpdateDanceStatusEvent,RoomWidgetUpdateDecorateModeEvent,RoomWidgetUpdateInfostandFurniEvent,RoomWidgetUpdateInfostandPetEvent,RoomWidgetUpdateInfostandRentableBotEvent,RoomWidgetUpdateInfostandUserEvent,RoomWidgetUpdateRentableBotChatEvent,RoomWidgetUpdateRoomEngineEvent,RoomWidgetUpdateRoomObjectEvent,RoomWidgetUseProductBubbleEvent}from'../../../../api';import{UseEventDispatcherHook}from'../../../../hooks';import{useRoomContext}from'../../RoomContext';import{AvatarInfoRentableBotChatView}from'./AvatarInfoRentableBotChatView';import{AvatarInfoUseProductConfirmView}from'./AvatarInfoUseProductConfirmView';import{AvatarInfoUseProductView}from'./AvatarInfoUseProductView';import{AvatarInfoWidgetAvatarView}from'./AvatarInfoWidgetAvatarView';import{AvatarInfoWidgetDecorateView}from'./AvatarInfoWidgetDecorateView';import{AvatarInfoWidgetNameView}from'./AvatarInfoWidgetNameView';import{AvatarInfoWidgetOwnAvatarView}from'./AvatarInfoWidgetOwnAvatarView';import{AvatarInfoWidgetOwnPetView}from'./AvatarInfoWidgetOwnPetView';import{AvatarInfoWidgetPetView}from'./AvatarInfoWidgetPetView';import{AvatarInfoWidgetRentableBotView}from'./AvatarInfoWidgetRentableBotView';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var AvatarInfoWidgetView=function AvatarInfoWidgetView(props){var _useState=useState(null),_useState2=_slicedToArray(_useState,2),name=_useState2[0],setName=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),nameBubbles=_useState4[0],setNameBubbles=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),productBubbles=_useState6[0],setProductBubbles=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),confirmingProduct=_useState8[0],setConfirmingProduct=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),infoStandEvent=_useState10[0],setInfoStandEvent=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isGameMode=_useState12[0],setGameMode=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),isDancing=_useState14[0],setIsDancing=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),isDecorating=_useState16[0],setIsDecorating=_useState16[1];var _useState17=useState(null),_useState18=_slicedToArray(_useState17,2),rentableBotChatEvent=_useState18[0],setRentableBotChatEvent=_useState18[1];var _useRoomContext=useRoomContext(),_useRoomContext$roomS=_useRoomContext.roomSession,roomSession=_useRoomContext$roomS===void 0?null:_useRoomContext$roomS,_useRoomContext$event=_useRoomContext.eventDispatcher,eventDispatcher=_useRoomContext$event===void 0?null:_useRoomContext$event,_useRoomContext$widge=_useRoomContext.widgetHandler,widgetHandler=_useRoomContext$widge===void 0?null:_useRoomContext$widge;var removeNameBubble=useCallback(function(index){setNameBubbles(function(prevValue){var newValue=_toConsumableArray(prevValue);newValue.splice(index,1);return newValue;});},[]);var removeProductBubble=useCallback(function(index){setProductBubbles(function(prevValue){var newValue=_toConsumableArray(prevValue);var item=newValue.splice(index,1)[0];if(confirmingProduct===item)setConfirmingProduct(null);return newValue;});},[confirmingProduct]);var clearProductBubbles=useCallback(function(){setProductBubbles([]);},[]);var clearInfoStandEvent=useCallback(function(){setInfoStandEvent(null);},[]);var clearName=useCallback(function(){setName(null);},[]);var updateConfirmingProduct=useCallback(function(product){setConfirmingProduct(product);setProductBubbles([]);},[]);var onRoomWidgetRoomEngineUpdateEvent=useCallback(function(event){switch(event.type){case RoomWidgetUpdateRoomEngineEvent.NORMAL_MODE:{if(isGameMode)setGameMode(false);return;}case RoomWidgetUpdateRoomEngineEvent.GAME_MODE:{if(!isGameMode)setGameMode(true);return;}}},[isGameMode]);UseEventDispatcherHook(RoomWidgetUpdateRoomEngineEvent.NORMAL_MODE,eventDispatcher,onRoomWidgetRoomEngineUpdateEvent);UseEventDispatcherHook(RoomWidgetUpdateRoomEngineEvent.GAME_MODE,eventDispatcher,onRoomWidgetRoomEngineUpdateEvent);var onRoomObjectRemoved=useCallback(function(event){if(name){if(event.id===name.id)setName(null);}if(event.category===RoomObjectCategory.UNIT){var nameBubbleIndex=nameBubbles.findIndex(function(bubble){return bubble.roomIndex===event.id;});if(nameBubbleIndex>-1)removeNameBubble(nameBubbleIndex);if(productBubbles.length){setProductBubbles(function(prevValue){return prevValue.filter(function(bubble){return bubble.id!==event.id;});});}}else if(event.category===RoomObjectCategory.FLOOR){if(productBubbles.length){setProductBubbles(function(prevValue){return prevValue.filter(function(bubble){return bubble.requestRoomObjectId!==event.id;});});}}if(infoStandEvent){if(infoStandEvent instanceof RoomWidgetUpdateInfostandFurniEvent){if(infoStandEvent.id===event.id)clearInfoStandEvent();}else if(infoStandEvent instanceof RoomWidgetUpdateInfostandUserEvent||infoStandEvent instanceof RoomWidgetUpdateInfostandRentableBotEvent){if(infoStandEvent.roomIndex===event.id)clearInfoStandEvent();}else if(infoStandEvent instanceof RoomWidgetUpdateInfostandPetEvent){if(infoStandEvent.roomIndex===event.id)clearInfoStandEvent();}}},[name,infoStandEvent,nameBubbles,productBubbles,removeNameBubble,clearInfoStandEvent]);UseEventDispatcherHook(RoomWidgetUpdateRoomObjectEvent.USER_REMOVED,eventDispatcher,onRoomObjectRemoved);UseEventDispatcherHook(RoomWidgetUpdateRoomObjectEvent.FURNI_REMOVED,eventDispatcher,onRoomObjectRemoved);var onObjectRolled=useCallback(function(event){switch(event.type){case RoomWidgetUpdateRoomObjectEvent.OBJECT_ROLL_OVER:{var roomObjectEvent=event;if(infoStandEvent)return;widgetHandler.processWidgetMessage(new RoomWidgetRoomObjectMessage(RoomWidgetRoomObjectMessage.GET_OBJECT_NAME,roomObjectEvent.id,roomObjectEvent.category));return;}case RoomWidgetUpdateRoomObjectEvent.OBJECT_ROLL_OUT:{var _roomObjectEvent=event;if(!name||name.roomIndex!==_roomObjectEvent.id)return;setName(null);return;}}},[infoStandEvent,name,widgetHandler]);UseEventDispatcherHook(RoomWidgetUpdateRoomObjectEvent.OBJECT_ROLL_OVER,eventDispatcher,onObjectRolled);UseEventDispatcherHook(RoomWidgetUpdateRoomObjectEvent.OBJECT_ROLL_OUT,eventDispatcher,onObjectRolled);var onObjectDeselected=useCallback(function(event){if(infoStandEvent)clearInfoStandEvent();if(productBubbles.length)setProductBubbles([]);},[infoStandEvent,productBubbles,clearInfoStandEvent]);UseEventDispatcherHook(RoomWidgetUpdateRoomObjectEvent.OBJECT_DESELECTED,eventDispatcher,onObjectDeselected);var onRoomWidgetObjectNameEvent=useCallback(function(event){if(event.category!==RoomObjectCategory.UNIT)return;setName(event);clearProductBubbles();},[clearProductBubbles]);UseEventDispatcherHook(RoomWidgetObjectNameEvent.TYPE,eventDispatcher,onRoomWidgetObjectNameEvent);var onRoomWidgetUpdateInfostandEvent=useCallback(function(event){if(name)setName(null);if(event.type===RoomWidgetUpdateInfostandFurniEvent.FURNI)clearInfoStandEvent();else setInfoStandEvent(event);clearProductBubbles();},[name,clearInfoStandEvent,clearProductBubbles]);UseEventDispatcherHook(RoomWidgetUpdateInfostandFurniEvent.FURNI,eventDispatcher,onRoomWidgetUpdateInfostandEvent);UseEventDispatcherHook(RoomWidgetUpdateInfostandUserEvent.OWN_USER,eventDispatcher,onRoomWidgetUpdateInfostandEvent);UseEventDispatcherHook(RoomWidgetUpdateInfostandUserEvent.PEER,eventDispatcher,onRoomWidgetUpdateInfostandEvent);UseEventDispatcherHook(RoomWidgetUpdateInfostandUserEvent.BOT,eventDispatcher,onRoomWidgetUpdateInfostandEvent);UseEventDispatcherHook(RoomWidgetUpdateInfostandRentableBotEvent.RENTABLE_BOT,eventDispatcher,onRoomWidgetUpdateInfostandEvent);UseEventDispatcherHook(RoomWidgetUpdateInfostandPetEvent.PET_INFO,eventDispatcher,onRoomWidgetUpdateInfostandEvent);var onRoomWidgetUpdateDanceStatusEvent=useCallback(function(event){setIsDancing(event.isDancing);},[]);UseEventDispatcherHook(RoomWidgetUpdateDanceStatusEvent.UPDATE_DANCE,eventDispatcher,onRoomWidgetUpdateDanceStatusEvent);var onRoomWidgetUpdateRentableBotChatEvent=useCallback(function(event){setRentableBotChatEvent(event);},[]);UseEventDispatcherHook(RoomWidgetUpdateRentableBotChatEvent.UPDATE_CHAT,eventDispatcher,onRoomWidgetUpdateRentableBotChatEvent);var onRoomWidgetUseProductBubbleEvent=useCallback(function(event){setConfirmingProduct(null);setProductBubbles(function(prevValue){var newBubbles=_toConsumableArray(prevValue);var _iterator=_createForOfIteratorHelper(event.items),_step;try{var _loop=function _loop(){var item=_step.value;var index=newBubbles.findIndex(function(bubble){return bubble.id===item.id;});if(index>-1)newBubbles.splice(index,1);newBubbles.push(item);};for(_iterator.s();!(_step=_iterator.n()).done;){_loop();}}catch(err){_iterator.e(err);}finally{_iterator.f();}return newBubbles;});},[]);UseEventDispatcherHook(RoomWidgetUseProductBubbleEvent.USE_PRODUCT_BUBBLES,eventDispatcher,onRoomWidgetUseProductBubbleEvent);// const onFriendEnteredRoomEvent = useCallback((event: FriendEnteredRoomEvent) =>\n// {\n//     setNameBubbles(prevValue =>\n//         {\n//             return [ ...prevValue, event  ];\n//         })\n// }, []);\n// useUiEvent(FriendEnteredRoomEvent.ENTERED, onFriendEnteredRoomEvent);\nvar onRoomWidgetUpdateDecorateModeEvent=useCallback(function(event){setIsDecorating(event.isDecorating);},[]);UseEventDispatcherHook(RoomWidgetUpdateDecorateModeEvent.UPDATE_DECORATE,eventDispatcher,onRoomWidgetUpdateDecorateModeEvent);var decorateView=useMemo(function(){GetRoomSession().isDecorating=isDecorating;if(!isDecorating)return null;var userId=GetSessionDataManager().userId;var userName=GetSessionDataManager().userName;var roomIndex=GetRoomSession().ownRoomIndex;return/*#__PURE__*/_jsx(AvatarInfoWidgetDecorateView,{userId:userId,userName:userName,roomIndex:roomIndex});},[isDecorating]);var currentView=useMemo(function(){if(isGameMode)return null;if(decorateView)return decorateView;if(name){var nameBubbleIndex=nameBubbles.findIndex(function(bubble){return bubble.roomIndex===name.roomIndex;});if(nameBubbleIndex>-1)removeNameBubble(nameBubbleIndex);return/*#__PURE__*/_jsx(AvatarInfoWidgetNameView,{nameData:name,close:clearName});}if(infoStandEvent){switch(infoStandEvent.type){case RoomWidgetUpdateInfostandUserEvent.OWN_USER:case RoomWidgetUpdateInfostandUserEvent.PEER:{var event=infoStandEvent;if(event.isSpectatorMode)return null;var _nameBubbleIndex=nameBubbles.findIndex(function(bubble){return bubble.roomIndex===event.roomIndex;});if(_nameBubbleIndex>-1)removeNameBubble(_nameBubbleIndex);if(event.isOwnUser){if(RoomEnterEffect.isRunning())return null;return/*#__PURE__*/_jsx(AvatarInfoWidgetOwnAvatarView,{userData:event,isDancing:isDancing,close:clearInfoStandEvent});}return/*#__PURE__*/_jsx(AvatarInfoWidgetAvatarView,{userData:event,close:clearInfoStandEvent});}case RoomWidgetUpdateInfostandPetEvent.PET_INFO:{var _event=infoStandEvent;if(_event.isOwner){return/*#__PURE__*/_jsx(AvatarInfoWidgetOwnPetView,{petData:_event,close:clearInfoStandEvent});}return/*#__PURE__*/_jsx(AvatarInfoWidgetPetView,{petData:_event,close:clearInfoStandEvent});}case RoomWidgetUpdateInfostandRentableBotEvent.RENTABLE_BOT:{return/*#__PURE__*/_jsx(AvatarInfoWidgetRentableBotView,{rentableBotData:infoStandEvent,close:clearInfoStandEvent});}case RoomWidgetUpdateInfostandFurniEvent.FURNI:{return null;}}}return null;},[isGameMode,decorateView,name,nameBubbles,isDancing,infoStandEvent,clearName,clearInfoStandEvent,removeNameBubble]);return/*#__PURE__*/_jsxs(_Fragment,{children:[currentView,nameBubbles.length>0&&nameBubbles.map(function(name,index){return/*#__PURE__*/_jsx(AvatarInfoWidgetNameView,{nameData:name,close:function close(){return removeNameBubble(index);}},index);}),productBubbles.length>0&&productBubbles.map(function(item,index){return/*#__PURE__*/_jsx(AvatarInfoUseProductView,{item:item,updateConfirmingProduct:updateConfirmingProduct,close:function close(){return removeProductBubble(index);}},item.id);}),rentableBotChatEvent&&/*#__PURE__*/_jsx(AvatarInfoRentableBotChatView,{chatEvent:rentableBotChatEvent,close:function close(){return setRentableBotChatEvent(null);}}),confirmingProduct&&/*#__PURE__*/_jsx(AvatarInfoUseProductConfirmView,{item:confirmingProduct,close:function close(){return setConfirmingProduct(null);}})]});};","map":null,"metadata":{},"sourceType":"module"}