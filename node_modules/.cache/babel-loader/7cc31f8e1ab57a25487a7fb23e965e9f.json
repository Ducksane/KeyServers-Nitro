{"ast":null,"code":"import _createForOfIteratorHelper from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _classCallCheck from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createClass.js\";import{Point}from'@pixi/math';import{Rasterizer}from'../../../../../../../room/utils/Rasterizer';import{RoomGeometry}from'../../../../../../../room/utils/RoomGeometry';import{Vector3d}from'../../../../../../../room/utils/Vector3d';import{FloorPlane}from'./FloorPlane';import{PlaneMaterial}from'./PlaneMaterial';import{PlaneMaterialCell}from'./PlaneMaterialCell';import{PlaneMaterialCellColumn}from'./PlaneMaterialCellColumn';import{PlaneMaterialCellMatrix}from'./PlaneMaterialCellMatrix';import{PlaneTexture}from'./PlaneTexture';import{PlaneVisualizationLayer}from'./PlaneVisualizationLayer';export var PlaneRasterizer=/*#__PURE__*/function(){function PlaneRasterizer(){_classCallCheck(this,PlaneRasterizer);this._assetCollection=void 0;this._materials=void 0;this._textures=void 0;this._planes=void 0;this._geometries=void 0;this._data=void 0;this._assetCollection=null;this._textures=new Map();this._materials=new Map();this._planes=new Map();this._geometries=new Map();this._data=null;}_createClass(PlaneRasterizer,[{key:\"data\",get:function get(){return this._data;}},{key:\"assetCollection\",get:function get(){return this._assetCollection;}},{key:\"initializeDimensions\",value:function initializeDimensions(k,_arg_2){return true;}},{key:\"dispose\",value:function dispose(){if(this._planes){var _iterator=_createForOfIteratorHelper(this._planes.values()),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var plane=_step.value;if(!plane)continue;plane.dispose();}}catch(err){_iterator.e(err);}finally{_iterator.f();}this._planes=null;}if(this._materials){this.resetMaterials();this._materials=null;}if(this._textures){this.resetTextures();this._textures=null;}if(this._geometries){var _iterator2=_createForOfIteratorHelper(this._geometries.values()),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var geometry=_step2.value;if(!geometry)continue;geometry.dispose();}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}this._geometries=null;}this._data=null;this._assetCollection=null;}},{key:\"clearCache\",value:function clearCache(){var _iterator3=_createForOfIteratorHelper(this._planes.values()),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var plane=_step3.value;if(!plane)continue;plane.clearCache();}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}var _iterator4=_createForOfIteratorHelper(this._materials.values()),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var material=_step4.value;if(!material)continue;material.clearCache();}}catch(err){_iterator4.e(err);}finally{_iterator4.f();}}},{key:\"initialize\",value:function initialize(data){this._data=data;}},{key:\"reinitialize\",value:function reinitialize(){this.resetTextures();this.resetMaterials();this.initializeAll();}},{key:\"resetMaterials\",value:function resetMaterials(){var _iterator5=_createForOfIteratorHelper(this._materials.values()),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var material=_step5.value;if(!material)continue;material.dispose();}}catch(err){_iterator5.e(err);}finally{_iterator5.f();}this._materials.clear();}},{key:\"resetTextures\",value:function resetTextures(){var _iterator6=_createForOfIteratorHelper(this._textures.values()),_step6;try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var texture=_step6.value;if(!texture)continue;texture.dispose();}}catch(err){_iterator6.e(err);}finally{_iterator6.f();}this._textures.clear();}},{key:\"getTexture\",value:function getTexture(textureId){return this._textures.get(textureId);}},{key:\"getMaterial\",value:function getMaterial(materialId){return this._materials.get(materialId);}},{key:\"getPlane\",value:function getPlane(planeId){return this._planes.get(planeId);}},{key:\"addPlane\",value:function addPlane(id,plane){if(!plane)return false;var existing=this._planes.get(id);if(!existing){this._planes.set(id,plane);return true;}return false;}},{key:\"initializeAssetCollection\",value:function initializeAssetCollection(collection){if(!this._data)return;this._assetCollection=collection;this.initializeAll();}},{key:\"initializeAll\",value:function initializeAll(){if(!this._data)return;this.initializeTexturesAndMaterials();this.initializePlanes();}},{key:\"initializeTexturesAndMaterials\",value:function initializeTexturesAndMaterials(){if(this._data.textures&&this._data.textures.length)this.parseTextures(this._data.textures,this.assetCollection);if(this._data.materials&&this._data.materials.length)this.parsePlaneMaterials(this._data.materials);}},{key:\"initializePlanes\",value:function initializePlanes(){}},{key:\"parseTextures\",value:function parseTextures(textures,collection){if(!textures||!collection)return;if(textures.length){var _iterator7=_createForOfIteratorHelper(textures),_step7;try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var texture=_step7.value;if(!texture)continue;var id=texture.id;if(!this._textures.get(id)){var plane=new PlaneTexture();if(texture.bitmaps&&texture.bitmaps.length){var _iterator8=_createForOfIteratorHelper(texture.bitmaps),_step8;try{for(_iterator8.s();!(_step8=_iterator8.n()).done;){var bitmap=_step8.value;if(!bitmap)continue;var assetName=bitmap.assetName;var normalMinX=PlaneTexture.MIN_NORMAL_COORDINATE_VALUE;var normalMaxX=PlaneTexture.MAX_NORMAL_COORDINATE_VALUE;var normalMinY=PlaneTexture.MIN_NORMAL_COORDINATE_VALUE;var normalMaxY=PlaneTexture.MAX_NORMAL_COORDINATE_VALUE;if(bitmap.normalMinX!==undefined)normalMinX=bitmap.normalMinX;if(bitmap.normalMaxX!==undefined)normalMaxX=bitmap.normalMaxX;if(bitmap.normalMinY!==undefined)normalMinY=bitmap.normalMinY;if(bitmap.normalMaxY!==undefined)normalMaxY=bitmap.normalMaxY;var asset=collection.getAsset(assetName);if(asset){var _texture=asset.texture;if(_texture){var newTexture=_texture;if(asset.flipH){newTexture=Rasterizer.getFlipHBitmapData(_texture);}plane.addBitmap(newTexture,normalMinX,normalMaxX,normalMinY,normalMaxY,assetName);}}}}catch(err){_iterator8.e(err);}finally{_iterator8.f();}}this._textures.set(id,plane);}}}catch(err){_iterator7.e(err);}finally{_iterator7.f();}}}},{key:\"parsePlaneMaterials\",value:function parsePlaneMaterials(materials){if(!materials||!materials.length)return;var _iterator9=_createForOfIteratorHelper(materials),_step9;try{for(_iterator9.s();!(_step9=_iterator9.n()).done;){var material=_step9.value;if(!material)continue;var id=material.id;var newMaterial=new PlaneMaterial();if(material.matrices&&material.matrices.length){var _iterator10=_createForOfIteratorHelper(material.matrices),_step10;try{for(_iterator10.s();!(_step10=_iterator10.n()).done;){var matrix=_step10.value;if(!matrix)continue;var repeatMode=matrix.repeatMode;var align=matrix.align;var normalMinX=PlaneMaterialCellMatrix.MIN_NORMAL_COORDINATE_VALUE;var normalMaxX=PlaneMaterialCellMatrix.MAX_NORMAL_COORDINATE_VALUE;var normalMinY=PlaneMaterialCellMatrix.MIN_NORMAL_COORDINATE_VALUE;var normalMaxY=PlaneMaterialCellMatrix.MAX_NORMAL_COORDINATE_VALUE;switch(repeatMode){case'borders':repeatMode=PlaneMaterialCellMatrix.REPEAT_MODE_BORDERS;break;case'center':repeatMode=PlaneMaterialCellMatrix.REPEAT_MODE_CENTER;break;case'first':repeatMode=PlaneMaterialCellMatrix.REPEAT_MODE_FIRST;break;case'last':repeatMode=PlaneMaterialCellMatrix.REPEAT_MODE_LAST;break;case'random':repeatMode=PlaneMaterialCellMatrix.REPEAT_MODE_RANDOM;break;default:repeatMode=PlaneMaterialCellMatrix.REPEAT_MODE_DEFAULT;break;}switch(align){case'top':align=PlaneMaterialCellMatrix.ALIGN_TOP;break;case'bottom':align=PlaneMaterialCellMatrix.ALIGN_BOTTOM;break;default:align=PlaneMaterialCellMatrix.ALIGN_DEFAULT;break;}if(matrix.columns&&matrix.columns.length){var cellMatrix=newMaterial.addMaterialCellMatrix(matrix.columns.length,repeatMode,align,normalMinX,normalMaxX,normalMinY,normalMaxY);var index=0;while(index<matrix.columns.length){var column=matrix.columns[index];if(column)this.parsePlaneMaterialCellColumn(column,cellMatrix,index);index++;}}}}catch(err){_iterator10.e(err);}finally{_iterator10.f();}}this._materials.set(id,newMaterial);}}catch(err){_iterator9.e(err);}finally{_iterator9.f();}}},{key:\"parsePlaneMaterialCellColumn\",value:function parsePlaneMaterialCellColumn(column,cellMatrix,index){if(!column||!cellMatrix)return;var repeatMode=PlaneMaterialCellColumn.REPEAT_MODE_ALL;var width=column.width;var cells=this.parsePlaneMaterialCells(column);switch(column.repeatMode){case'borders':repeatMode=PlaneMaterialCellColumn.REPEAT_MODE_BORDERS;break;case'center':repeatMode=PlaneMaterialCellColumn.REPEAT_MODE_CENTER;break;case'first':repeatMode=PlaneMaterialCellColumn.REPEAT_MODE_FIRST;break;case'last':repeatMode=PlaneMaterialCellColumn.REPEAT_MODE_LAST;break;case'none':repeatMode=PlaneMaterialCellColumn.REPEAT_MODE_NONE;break;default:repeatMode=PlaneMaterialCellColumn.REPEAT_MODE_ALL;break;}cellMatrix.createColumn(index,width,cells,repeatMode);}},{key:\"parsePlaneMaterialCells\",value:function parsePlaneMaterialCells(column){if(!column||!column.cells||!column.cells.length)return null;var cells=[];var index=0;while(index<column.cells.length){var cell=column.cells[index];if(cell){var textureId=cell.textureId;var assetNames=null;var offsetPoints=null;var graphics=null;var limit=0;if(cell.extras&&cell.extras.length){var extra=cell.extras[0];var types=extra.types;var offsets=extra.offsets;if(types&&offsets){if(types.length&&offsets.length){var type=types[0];var offset=offsets[0];assetNames=this.parseExtraItemTypes(type);offsetPoints=this.parseExtraItemOffsets(offset);limit=offsetPoints.length;if(extra.limitMax)limit=extra.limitMax;}}}if(assetNames&&assetNames.length){graphics=[];var _iterator11=_createForOfIteratorHelper(assetNames),_step11;try{for(_iterator11.s();!(_step11=_iterator11.n()).done;){var assetName=_step11.value;if(!assetName)continue;var asset=this._assetCollection.getAsset(assetName);if(!asset)continue;graphics.push(asset);}}catch(err){_iterator11.e(err);}finally{_iterator11.f();}}var texture=this.getTexture(textureId);var newCell=new PlaneMaterialCell(texture,graphics,offsetPoints,limit);cells.push(newCell);}index++;}if(!cells||!cells.length)return null;return cells;}},{key:\"parseExtraItemTypes\",value:function parseExtraItemTypes(k){var assetNames=[];if(k&&k.types&&k.types.length){var index=0;while(index<k.types.length){var type=k.types[index];var assetName=type.assetName;if(assetName)assetNames.push(assetName);index++;}}return assetNames;}},{key:\"parseExtraItemOffsets\",value:function parseExtraItemOffsets(k){var offsets=[];if(k&&k.offsets&&k.offsets.length){var index=0;while(index<k.offsets.length){var offset=k.offsets[index];var x=offset.x;var y=offset.y;offsets.push(new Point(x,y));index++;}}return offsets;}},{key:\"getGeometry\",value:function getGeometry(size,horizontalAngle,verticalAngle){horizontalAngle=Math.abs(horizontalAngle);if(horizontalAngle>90)horizontalAngle=90;verticalAngle=Math.abs(verticalAngle);if(verticalAngle>90)verticalAngle=90;var identifier=\"\".concat(size,\"_\").concat(Math.round(horizontalAngle),\"_\").concat(Math.round(verticalAngle));var geometry=this._geometries.get(identifier);if(geometry)return geometry;geometry=new RoomGeometry(size,new Vector3d(horizontalAngle,verticalAngle),new Vector3d(-10,0,0));this._geometries.set(identifier,geometry);return geometry;}},{key:\"parseVisualizations\",value:function parseVisualizations(plane,visualizations){if(!plane||!visualizations)return;if(visualizations&&visualizations.length){var _iterator12=_createForOfIteratorHelper(visualizations),_step12;try{for(_iterator12.s();!(_step12=_iterator12.n()).done;){var visualization=_step12.value;if(!visualization)continue;var size=visualization.size;var horizontalAngle=FloorPlane.HORIZONTAL_ANGLE_DEFAULT;var verticalAngle=FloorPlane.VERTICAL_ANGLE_DEFAULT;if(visualization.horizontalAngle)horizontalAngle=visualization.horizontalAngle;if(visualization.verticalAngle)verticalAngle=visualization.verticalAngle;var layers=visualization.layers;var planeVisualization=plane.createPlaneVisualization(size,layers&&layers.length||0,this.getGeometry(size,horizontalAngle,verticalAngle));if(planeVisualization&&layers&&layers.length){var layerId=0;while(layerId<layers.length){var layer=layers[layerId];if(layer){var material=null;var align=PlaneVisualizationLayer.ALIGN_DEFAULT;var color=FloorPlane.DEFAULT_COLOR;var offset=PlaneVisualizationLayer.DEFAULT_OFFSET;if(layer.materialId)material=this.getMaterial(layer.materialId);if(layer.color)color=layer.color;if(layer.offset)offset=layer.offset;if(layer.align){if(layer.align==='bottom')align=PlaneVisualizationLayer.ALIGN_BOTTOM;else if(layer.align=='top')align=PlaneVisualizationLayer.ALIGN_TOP;}planeVisualization.setLayer(layerId,material,color,align,offset);}layerId++;}}}}catch(err){_iterator12.e(err);}finally{_iterator12.f();}}}},{key:\"render\",value:function render(canvas,id,width,height,size,normal,useTexture){var offsetX=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;var offsetY=arguments.length>8&&arguments[8]!==undefined?arguments[8]:0;var maxX=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;var maxY=arguments.length>10&&arguments[10]!==undefined?arguments[10]:0;var timeSinceStartMs=arguments.length>11&&arguments[11]!==undefined?arguments[11]:0;return null;}},{key:\"getTextureIdentifier\",value:function getTextureIdentifier(k,normal){return k.toString();}},{key:\"getLayers\",value:function getLayers(id){var planes=this.getPlane(id);if(!planes)planes=this.getPlane(PlaneRasterizer.DEFAULT);return planes.getLayers();}}]);return PlaneRasterizer;}();PlaneRasterizer.DEFAULT='default';","map":null,"metadata":{},"sourceType":"module"}