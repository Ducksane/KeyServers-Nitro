{"ast":null,"code":"import _classCallCheck from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _get from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/get.js\";import _getPrototypeOf from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js\";import _inherits from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import{RoomObjectMouseEvent}from'../../../../../room/events/RoomObjectMouseEvent';import{Vector3d}from'../../../../../room/utils/Vector3d';import{AvatarAction}from'../../../../avatar/enum/AvatarAction';import{Nitro}from'../../../../Nitro';import{MouseEventType}from'../../../../ui/MouseEventType';import{RoomObjectFurnitureActionEvent}from'../../../events/RoomObjectFurnitureActionEvent';import{RoomObjectMoveEvent}from'../../../events/RoomObjectMoveEvent';import{ObjectAvatarCarryObjectUpdateMessage}from'../../../messages/ObjectAvatarCarryObjectUpdateMessage';import{ObjectAvatarChatUpdateMessage}from'../../../messages/ObjectAvatarChatUpdateMessage';import{ObjectAvatarDanceUpdateMessage}from'../../../messages/ObjectAvatarDanceUpdateMessage';import{ObjectAvatarEffectUpdateMessage}from'../../../messages/ObjectAvatarEffectUpdateMessage';import{ObjectAvatarExpressionUpdateMessage}from'../../../messages/ObjectAvatarExpressionUpdateMessage';import{ObjectAvatarFigureUpdateMessage}from'../../../messages/ObjectAvatarFigureUpdateMessage';import{ObjectAvatarFlatControlUpdateMessage}from'../../../messages/ObjectAvatarFlatControlUpdateMessage';import{ObjectAvatarGestureUpdateMessage}from'../../../messages/ObjectAvatarGestureUpdateMessage';import{ObjectAvatarMutedUpdateMessage}from'../../../messages/ObjectAvatarMutedUpdateMessage';import{ObjectAvatarOwnMessage}from'../../../messages/ObjectAvatarOwnMessage';import{ObjectAvatarPlayerValueUpdateMessage}from'../../../messages/ObjectAvatarPlayerValueUpdateMessage';import{ObjectAvatarPlayingGameUpdateMessage}from'../../../messages/ObjectAvatarPlayingGameUpdateMessage';import{ObjectAvatarPostureUpdateMessage}from'../../../messages/ObjectAvatarPostureUpdateMessage';import{ObjectAvatarSelectedMessage}from'../../../messages/ObjectAvatarSelectedMessage';import{ObjectAvatarSignUpdateMessage}from'../../../messages/ObjectAvatarSignUpdateMessage';import{ObjectAvatarSleepUpdateMessage}from'../../../messages/ObjectAvatarSleepUpdateMessage';import{ObjectAvatarTypingUpdateMessage}from'../../../messages/ObjectAvatarTypingUpdateMessage';import{ObjectAvatarUpdateMessage}from'../../../messages/ObjectAvatarUpdateMessage';import{ObjectAvatarUseObjectUpdateMessage}from'../../../messages/ObjectAvatarUseObjectUpdateMessage';import{RoomObjectVariable}from'../../RoomObjectVariable';import{MovingObjectLogic}from'../MovingObjectLogic';export var AvatarLogic=/*#__PURE__*/function(_MovingObjectLogic){_inherits(AvatarLogic,_MovingObjectLogic);var _super=_createSuper(AvatarLogic);function AvatarLogic(){var _this;_classCallCheck(this,AvatarLogic);_this=_super.call(this);_this._selected=void 0;_this._reportedLocation=void 0;_this._effectChangeTimeStamp=void 0;_this._newEffect=void 0;_this._blinkingStartTimestamp=void 0;_this._blinkingEndTimestamp=void 0;_this._talkingEndTimestamp=void 0;_this._talkingPauseStartTimestamp=void 0;_this._talkingPauseEndTimestamp=void 0;_this._carryObjectStartTimestamp=void 0;_this._carryObjectEndTimestamp=void 0;_this._allowUseCarryObject=void 0;_this._animationEndTimestamp=void 0;_this._signEndTimestamp=void 0;_this._gestureEndTimestamp=void 0;_this._numberValueEndTimestamp=void 0;_this._selected=false;_this._reportedLocation=null;_this._effectChangeTimeStamp=0;_this._newEffect=0;_this._blinkingStartTimestamp=Nitro.instance.time+_this.randomBlinkStartTimestamp();_this._blinkingEndTimestamp=0;_this._talkingEndTimestamp=0;_this._talkingPauseStartTimestamp=0;_this._talkingPauseEndTimestamp=0;_this._carryObjectStartTimestamp=0;_this._carryObjectEndTimestamp=0;_this._allowUseCarryObject=false;_this._animationEndTimestamp=0;_this._signEndTimestamp=0;_this._gestureEndTimestamp=0;_this._numberValueEndTimestamp=0;return _this;}_createClass(AvatarLogic,[{key:\"getEventTypes\",value:function getEventTypes(){var types=[RoomObjectMouseEvent.CLICK,RoomObjectMoveEvent.POSITION_CHANGED,RoomObjectMouseEvent.MOUSE_ENTER,RoomObjectMouseEvent.MOUSE_LEAVE,RoomObjectFurnitureActionEvent.MOUSE_BUTTON,RoomObjectFurnitureActionEvent.MOUSE_ARROW];return this.mergeTypes(_get(_getPrototypeOf(AvatarLogic.prototype),\"getEventTypes\",this).call(this),types);}},{key:\"dispose\",value:function dispose(){if(this._selected&&this.object){if(this.eventDispatcher)this.eventDispatcher.dispatchEvent(new RoomObjectMoveEvent(RoomObjectMoveEvent.OBJECT_REMOVED,this.object));}_get(_getPrototypeOf(AvatarLogic.prototype),\"dispose\",this).call(this);this._reportedLocation=null;}},{key:\"update\",value:function update(time){_get(_getPrototypeOf(AvatarLogic.prototype),\"update\",this).call(this,time);if(this._selected&&this.object){if(this.eventDispatcher){var location=this.object.getLocation();if(!this._reportedLocation||this._reportedLocation.x!==location.x||this._reportedLocation.y!==location.y||this._reportedLocation.z!==location.z){if(!this._reportedLocation)this._reportedLocation=new Vector3d();this._reportedLocation.assign(location);this.eventDispatcher.dispatchEvent(new RoomObjectMoveEvent(RoomObjectMoveEvent.POSITION_CHANGED,this.object));}}}var model=this.object&&this.object.model;if(model)this.updateModel(this.time,model);}},{key:\"updateModel\",value:function updateModel(time,model){if(this._talkingEndTimestamp>0){if(time>this._talkingEndTimestamp){model.setValue(RoomObjectVariable.FIGURE_TALK,0);this._talkingEndTimestamp=0;this._talkingPauseStartTimestamp=0;this._talkingPauseEndTimestamp=0;}else{if(!this._talkingPauseEndTimestamp&&!this._talkingPauseStartTimestamp){this._talkingPauseStartTimestamp=time+this.randomTalkingPauseStartTimestamp();this._talkingPauseEndTimestamp=this._talkingPauseStartTimestamp+this.randomTalkingPauseEndTimestamp();}else{if(this._talkingPauseStartTimestamp>0&&time>this._talkingPauseStartTimestamp){model.setValue(RoomObjectVariable.FIGURE_TALK,0);this._talkingPauseStartTimestamp=0;}else{if(this._talkingPauseEndTimestamp>0&&time>this._talkingPauseEndTimestamp){model.setValue(RoomObjectVariable.FIGURE_TALK,1);this._talkingPauseEndTimestamp=0;}}}}}if(this._animationEndTimestamp>0&&time>this._animationEndTimestamp){model.setValue(RoomObjectVariable.FIGURE_EXPRESSION,0);this._animationEndTimestamp=0;}if(this._gestureEndTimestamp>0&&time>this._gestureEndTimestamp){model.setValue(RoomObjectVariable.FIGURE_GESTURE,0);this._gestureEndTimestamp=0;}if(this._signEndTimestamp>0&&time>this._signEndTimestamp){model.setValue(RoomObjectVariable.FIGURE_SIGN,-1);this._signEndTimestamp=0;}if(this._carryObjectEndTimestamp>0){if(time>this._carryObjectEndTimestamp){model.setValue(RoomObjectVariable.FIGURE_CARRY_OBJECT,0);model.setValue(RoomObjectVariable.FIGURE_USE_OBJECT,0);this._carryObjectStartTimestamp=0;this._carryObjectEndTimestamp=0;this._allowUseCarryObject=false;}}if(this._allowUseCarryObject){if(time-this._carryObjectStartTimestamp>5000){if((time-this._carryObjectStartTimestamp)%10000<1000){model.setValue(RoomObjectVariable.FIGURE_USE_OBJECT,1);}else{model.setValue(RoomObjectVariable.FIGURE_USE_OBJECT,0);}}}if(this._blinkingStartTimestamp>-1&&time>this._blinkingStartTimestamp){model.setValue(RoomObjectVariable.FIGURE_BLINK,1);this._blinkingStartTimestamp=time+this.randomBlinkStartTimestamp();this._blinkingEndTimestamp=time+this.randomBlinkEndTimestamp();}if(this._blinkingEndTimestamp>0&&time>this._blinkingEndTimestamp){model.setValue(RoomObjectVariable.FIGURE_BLINK,0);this._blinkingEndTimestamp=0;}if(this._effectChangeTimeStamp>0&&time>this._effectChangeTimeStamp){model.setValue(RoomObjectVariable.FIGURE_EFFECT,this._newEffect);this._effectChangeTimeStamp=0;}if(this._numberValueEndTimestamp>0&&time>this._numberValueEndTimestamp){model.setValue(RoomObjectVariable.FIGURE_NUMBER_VALUE,0);this._numberValueEndTimestamp=0;}}},{key:\"processUpdateMessage\",value:function processUpdateMessage(message){if(!message||!this.object)return;_get(_getPrototypeOf(AvatarLogic.prototype),\"processUpdateMessage\",this).call(this,message);var model=this.object&&this.object.model;if(!model)return;if(message instanceof ObjectAvatarPostureUpdateMessage){model.setValue(RoomObjectVariable.FIGURE_POSTURE,message.postureType);model.setValue(RoomObjectVariable.FIGURE_POSTURE_PARAMETER,message.parameter);return;}if(message instanceof ObjectAvatarChatUpdateMessage){model.setValue(RoomObjectVariable.FIGURE_TALK,1);this._talkingEndTimestamp=this.time+message.numberOfWords*1000;return;}if(message instanceof ObjectAvatarTypingUpdateMessage){model.setValue(RoomObjectVariable.FIGURE_IS_TYPING,message.isTyping?1:0);return;}if(message instanceof ObjectAvatarMutedUpdateMessage){model.setValue(RoomObjectVariable.FIGURE_IS_MUTED,message.isMuted?1:0);return;}if(message instanceof ObjectAvatarPlayingGameUpdateMessage){model.setValue(RoomObjectVariable.FIGURE_IS_PLAYING_GAME,message.isPlayingGame?1:0);return;}if(message instanceof ObjectAvatarUpdateMessage){model.setValue(RoomObjectVariable.HEAD_DIRECTION,message.headDirection);model.setValue(RoomObjectVariable.FIGURE_CAN_STAND_UP,message.canStandUp);model.setValue(RoomObjectVariable.FIGURE_VERTICAL_OFFSET,message.baseY);return;}if(message instanceof ObjectAvatarGestureUpdateMessage){model.setValue(RoomObjectVariable.FIGURE_GESTURE,message.gesture);this._gestureEndTimestamp=this.time+3000;return;}if(message instanceof ObjectAvatarExpressionUpdateMessage){model.setValue(RoomObjectVariable.FIGURE_EXPRESSION,message.expressionType);this._animationEndTimestamp=AvatarAction.getExpressionTimeout(model.getValue(RoomObjectVariable.FIGURE_EXPRESSION));if(this._animationEndTimestamp>-1)this._animationEndTimestamp+=this.time;return;}if(message instanceof ObjectAvatarDanceUpdateMessage){model.setValue(RoomObjectVariable.FIGURE_DANCE,message.danceStyle);return;}if(message instanceof ObjectAvatarSleepUpdateMessage){model.setValue(RoomObjectVariable.FIGURE_SLEEP,message.isSleeping?1:0);if(message.isSleeping)this._blinkingStartTimestamp=-1;else this._blinkingStartTimestamp=this.time+this.randomBlinkStartTimestamp();return;}if(message instanceof ObjectAvatarPlayerValueUpdateMessage){model.setValue(RoomObjectVariable.FIGURE_NUMBER_VALUE,message.value);this._numberValueEndTimestamp=this.time+3000;return;}if(message instanceof ObjectAvatarEffectUpdateMessage){this.updateAvatarEffect(message.effect,message.delayMilliseconds,model);return;}if(message instanceof ObjectAvatarCarryObjectUpdateMessage){model.setValue(RoomObjectVariable.FIGURE_CARRY_OBJECT,message.itemType);model.setValue(RoomObjectVariable.FIGURE_USE_OBJECT,0);if(message.itemType===0){this._carryObjectStartTimestamp=0;this._carryObjectEndTimestamp=0;this._allowUseCarryObject=false;}else{this._carryObjectStartTimestamp=this.time;if(message.itemType<AvatarLogic.MAX_HAND_ID){this._carryObjectEndTimestamp=0;this._allowUseCarryObject=message.itemType<=AvatarLogic.MAX_HAND_USE_ID;}else{this._carryObjectEndTimestamp=this._carryObjectStartTimestamp+1500;this._allowUseCarryObject=false;}}return;}if(message instanceof ObjectAvatarUseObjectUpdateMessage){model.setValue(RoomObjectVariable.FIGURE_USE_OBJECT,message.itemType);return;}if(message instanceof ObjectAvatarSignUpdateMessage){model.setValue(RoomObjectVariable.FIGURE_SIGN,message.signType);this._signEndTimestamp=this.time+5000;return;}if(message instanceof ObjectAvatarFlatControlUpdateMessage){model.setValue(RoomObjectVariable.FIGURE_FLAT_CONTROL,message.level);return;}if(message instanceof ObjectAvatarFigureUpdateMessage){model.setValue(RoomObjectVariable.FIGURE,message.figure);model.setValue(RoomObjectVariable.GENDER,message.gender);return;}if(message instanceof ObjectAvatarSelectedMessage){this._selected=message.selected;this._reportedLocation=null;return;}if(message instanceof ObjectAvatarOwnMessage){model.setValue(RoomObjectVariable.OWN_USER,1);return;}}},{key:\"updateAvatarEffect\",value:function updateAvatarEffect(effect,delay,model){if(effect===AvatarLogic.EFFECT_TYPE_SPLASH){this._effectChangeTimeStamp=Nitro.instance.time+AvatarLogic.EFFECT_SPLASH_LENGTH;this._newEffect=AvatarLogic.EFFECT_TYPE_SWIM;}else if(effect===AvatarLogic.EFFECT_TYPE_SPLASH_DARK){this._effectChangeTimeStamp=Nitro.instance.time+AvatarLogic.EFFECT_SPLASH_LENGTH;this._newEffect=AvatarLogic.EFFECT_TYPE_SWIM_DARK;}else if(model.getValue(RoomObjectVariable.FIGURE_EFFECT)===AvatarLogic.EFFECT_TYPE_SWIM){this._effectChangeTimeStamp=Nitro.instance.time+AvatarLogic.EFFECT_SPLASH_LENGTH;this._newEffect=effect;effect=AvatarLogic.EFFECT_TYPE_SPLASH;}else if(model.getValue(RoomObjectVariable.FIGURE_EFFECT)===AvatarLogic.EFFECT_TYPE_SWIM_DARK){this._effectChangeTimeStamp=Nitro.instance.time+AvatarLogic.EFFECT_SPLASH_LENGTH;this._newEffect=effect;effect=AvatarLogic.EFFECT_TYPE_SPLASH_DARK;}else if(delay===0){this._effectChangeTimeStamp=0;}else{this._effectChangeTimeStamp=Nitro.instance.time+delay;this._newEffect=effect;return;}model.setValue(RoomObjectVariable.FIGURE_EFFECT,effect);}},{key:\"mouseEvent\",value:function mouseEvent(event,geometry){var eventType=null;switch(event.type){case MouseEventType.MOUSE_CLICK:eventType=RoomObjectMouseEvent.CLICK;break;case MouseEventType.ROLL_OVER:eventType=RoomObjectMouseEvent.MOUSE_ENTER;if(this.object.model)this.object.model.setValue(RoomObjectVariable.FIGURE_HIGHLIGHT,1);if(this.eventDispatcher)this.eventDispatcher.dispatchEvent(new RoomObjectFurnitureActionEvent(RoomObjectFurnitureActionEvent.MOUSE_BUTTON,this.object));break;case MouseEventType.ROLL_OUT:eventType=RoomObjectMouseEvent.MOUSE_LEAVE;if(this.object.model)this.object.model.setValue(RoomObjectVariable.FIGURE_HIGHLIGHT,0);if(this.eventDispatcher)this.eventDispatcher.dispatchEvent(new RoomObjectFurnitureActionEvent(RoomObjectFurnitureActionEvent.MOUSE_ARROW,this.object));break;}if(eventType&&this.eventDispatcher)this.eventDispatcher.dispatchEvent(new RoomObjectMouseEvent(eventType,this.object,event.eventId,event.altKey,event.ctrlKey,event.shiftKey,event.buttonDown));}},{key:\"randomTalkingPauseStartTimestamp\",value:function randomTalkingPauseStartTimestamp(){return 100+Math.random()*200;}},{key:\"randomTalkingPauseEndTimestamp\",value:function randomTalkingPauseEndTimestamp(){return 75+Math.random()*75;}},{key:\"randomBlinkStartTimestamp\",value:function randomBlinkStartTimestamp(){return 4500+Math.random()*1000;}},{key:\"randomBlinkEndTimestamp\",value:function randomBlinkEndTimestamp(){return 50+Math.random()*200;}}]);return AvatarLogic;}(MovingObjectLogic);AvatarLogic.MAX_HAND_ID=999999999;AvatarLogic.MAX_HAND_USE_ID=999;AvatarLogic.EFFECT_TYPE_SPLASH=28;AvatarLogic.EFFECT_SPLASH_LENGTH=500;AvatarLogic.EFFECT_TYPE_SWIM=29;AvatarLogic.EFFECT_TYPE_SPLASH_DARK=184;AvatarLogic.EFFECT_TYPE_SWIM_DARK=185;","map":null,"metadata":{},"sourceType":"module"}