{"ast":null,"code":"import _slicedToArray from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{RoomEngineTriggerWidgetEvent,RoomObjectVariable}from'@nitrots/nitro-renderer';import{useCallback,useState}from'react';import{ColorUtils,GetRoomEngine,GetRoomSession,GetSessionDataManager,RoomWidgetUpdateRoomObjectEvent}from'../../../../../api';import{DraggableWindow,DraggableWindowPosition}from'../../../../../common';import{UseEventDispatcherHook,UseRoomEngineEvent}from'../../../../../hooks';import{useRoomContext}from'../../../RoomContext';import{FurnitureStickieData}from'./FurnitureStickieData';import{getStickieColorName,STICKIE_COLORS}from'./FurnitureStickieUtils';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var FurnitureStickieView=function FurnitureStickieView(props){var _useRoomContext=useRoomContext(),_useRoomContext$event=_useRoomContext.eventDispatcher,eventDispatcher=_useRoomContext$event===void 0?null:_useRoomContext$event,_useRoomContext$widge=_useRoomContext.widgetHandler,widgetHandler=_useRoomContext$widge===void 0?null:_useRoomContext$widge;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),stickieData=_useState2[0],setStickieData=_useState2[1];var onNitroEvent=useCallback(function(event){switch(event.type){case RoomEngineTriggerWidgetEvent.REQUEST_STICKIE:{var widgetEvent=event;var roomObject=GetRoomEngine().getRoomObject(widgetEvent.roomId,widgetEvent.objectId,widgetEvent.category);if(!roomObject)return;var data=roomObject.model.getValue(RoomObjectVariable.FURNITURE_ITEMDATA);if(data.length<6)return;var color=null;var text=null;if(data.indexOf(' ')>0){color=data.slice(0,data.indexOf(' '));text=data.slice(data.indexOf(' ')+1,data.length);}else{color=data;}setStickieData(new FurnitureStickieData(widgetEvent.objectId,widgetEvent.category,color,text,GetRoomSession().isRoomOwner||GetSessionDataManager().isModerator,false));return;}case RoomWidgetUpdateRoomObjectEvent.FURNI_REMOVED:{var _widgetEvent=event;setStickieData(function(prevState){if(!prevState||_widgetEvent.id!==prevState.objectId||_widgetEvent.category!==prevState.category)return prevState;return null;});return;}}},[]);UseRoomEngineEvent(RoomEngineTriggerWidgetEvent.REQUEST_STICKIE,onNitroEvent);UseEventDispatcherHook(RoomWidgetUpdateRoomObjectEvent.FURNI_REMOVED,eventDispatcher,onNitroEvent);var processAction=useCallback(function(type){var value=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;switch(type){case'close':setStickieData(null);return;case'trash':setStickieData(function(prevState){if(!prevState)return null;GetRoomEngine().deleteRoomObject(prevState.objectId,prevState.category);return null;});return;case'changeColor':setStickieData(function(prevState){var newStickieData=new FurnitureStickieData(prevState.objectId,prevState.category,value,prevState.text,prevState.canModify);GetRoomEngine().modifyRoomObjectData(newStickieData.objectId,newStickieData.category,newStickieData.color,newStickieData.text);return newStickieData;});return;case'changeText':setStickieData(function(prevState){var newStickieData=new FurnitureStickieData(prevState.objectId,prevState.category,prevState.color,value,prevState.canModify);GetRoomEngine().modifyRoomObjectData(newStickieData.objectId,newStickieData.category,newStickieData.color,newStickieData.text);return newStickieData;});return;case'editMode':setStickieData(function(prevValue){if(!prevValue.canModify)return prevValue;return new FurnitureStickieData(prevValue.objectId,prevValue.category,prevValue.color,prevValue.text,prevValue.canModify,true);});return;}},[]);if(!stickieData)return null;return/*#__PURE__*/_jsx(DraggableWindow,{handleSelector:\".drag-handler\",windowPosition:DraggableWindowPosition.NOTHING,children:/*#__PURE__*/_jsxs(\"div\",{className:'nitro-stickie nitro-stickie-image stickie-'+getStickieColorName(stickieData.color),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center stickie-header drag-handler\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"d-flex align-items-center flex-grow-1 h-100\",children:stickieData.canModify&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"nitro-stickie-image stickie-trash header-trash\",onClick:function onClick(event){return processAction('trash');}}),STICKIE_COLORS.map(function(color){return/*#__PURE__*/_jsx(\"div\",{className:\"stickie-color ms-1\",onClick:function onClick(event){return processAction('changeColor',color);},style:{backgroundColor:ColorUtils.makeColorHex(color)}},color);})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"d-flex align-items-center nitro-stickie-image stickie-close header-close\",onClick:function onClick(event){return processAction('close');}})]}),/*#__PURE__*/_jsx(\"div\",{className:\"stickie-context\",children:!stickieData.isEditing?/*#__PURE__*/_jsx(\"div\",{className:\"context-text\",onClick:function onClick(event){return processAction('editMode');},children:stickieData.text}):/*#__PURE__*/_jsx(\"textarea\",{className:\"context-text\",defaultValue:stickieData.text||'',tabIndex:0,onBlur:function onBlur(event){return processAction('changeText',event.target.value);},autoFocus:true})})]})});};","map":null,"metadata":{},"sourceType":"module"}