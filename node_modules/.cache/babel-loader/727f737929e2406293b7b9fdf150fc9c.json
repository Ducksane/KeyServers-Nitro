{"ast":null,"code":"import _createForOfIteratorHelper from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _classCallCheck from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _get from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/get.js\";import _getPrototypeOf from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js\";import _inherits from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import{RoomObjectMouseEvent}from'../../../../../room/events/RoomObjectMouseEvent';import{RoomObjectUpdateMessage}from'../../../../../room/messages/RoomObjectUpdateMessage';import{Vector3d}from'../../../../../room/utils/Vector3d';import{Nitro}from'../../../../Nitro';import{MouseEventType}from'../../../../ui/MouseEventType';import{RoomObjectRoomAdEvent}from'../../../events';import{RoomObjectStateChangedEvent}from'../../../events/RoomObjectStateChangedEvent';import{RoomObjectWidgetRequestEvent}from'../../../events/RoomObjectWidgetRequestEvent';import{ObjectDataUpdateMessage}from'../../../messages/ObjectDataUpdateMessage';import{ObjectHeightUpdateMessage}from'../../../messages/ObjectHeightUpdateMessage';import{ObjectItemDataUpdateMessage}from'../../../messages/ObjectItemDataUpdateMessage';import{ObjectMoveUpdateMessage}from'../../../messages/ObjectMoveUpdateMessage';import{ObjectSelectedMessage}from'../../../messages/ObjectSelectedMessage';import{RoomObjectVariable}from'../../RoomObjectVariable';import{MovingObjectLogic}from'../MovingObjectLogic';export var FurnitureLogic=/*#__PURE__*/function(_MovingObjectLogic){_inherits(FurnitureLogic,_MovingObjectLogic);var _super=_createSuper(FurnitureLogic);function FurnitureLogic(){var _this;_classCallCheck(this,FurnitureLogic);_this=_super.call(this);_this._sizeX=void 0;_this._sizeY=void 0;_this._sizeZ=void 0;_this._centerX=void 0;_this._centerY=void 0;_this._centerZ=void 0;_this._directions=void 0;_this._mouseOver=void 0;_this._locationOffset=void 0;_this._bouncingStep=void 0;_this._storedRotateMessage=void 0;_this._directionInitialized=void 0;_this._sizeX=0;_this._sizeY=0;_this._sizeZ=0;_this._centerX=0;_this._centerY=0;_this._centerZ=0;_this._directions=[];_this._mouseOver=false;_this._locationOffset=new Vector3d();_this._bouncingStep=0;_this._storedRotateMessage=null;_this._directionInitialized=false;if(FurnitureLogic.BOUNCING_STEPS===-1){FurnitureLogic.BOUNCING_STEPS=Nitro.instance.getConfiguration('furni.rotation.bounce.steps',8);}if(FurnitureLogic.BOUNCING_Z===-1){FurnitureLogic.BOUNCING_Z=Nitro.instance.getConfiguration('furni.rotation.bounce.height',0.0625);}return _this;}_createClass(FurnitureLogic,[{key:\"getEventTypes\",value:function getEventTypes(){var types=[RoomObjectStateChangedEvent.STATE_CHANGE,RoomObjectMouseEvent.CLICK,RoomObjectMouseEvent.MOUSE_DOWN,RoomObjectMouseEvent.MOUSE_DOWN_LONG,RoomObjectRoomAdEvent.ROOM_AD_TOOLTIP_SHOW,RoomObjectRoomAdEvent.ROOM_AD_TOOLTIP_HIDE,RoomObjectRoomAdEvent.ROOM_AD_FURNI_DOUBLE_CLICK,RoomObjectRoomAdEvent.ROOM_AD_FURNI_CLICK];if(this.widget)types.push(RoomObjectWidgetRequestEvent.OPEN_WIDGET,RoomObjectWidgetRequestEvent.CLOSE_WIDGET);if(this.contextMenu)types.push(RoomObjectWidgetRequestEvent.OPEN_FURNI_CONTEXT_MENU,RoomObjectWidgetRequestEvent.CLOSE_FURNI_CONTEXT_MENU);return this.mergeTypes(_get(_getPrototypeOf(FurnitureLogic.prototype),\"getEventTypes\",this).call(this),types);}},{key:\"initialize\",value:function initialize(asset){if(!asset)return;var model=this.object&&this.object.model;if(!model)return;if(asset.logic){if(asset.logic.model){var dimensions=asset.logic.model.dimensions;if(dimensions){this._sizeX=dimensions.x;this._sizeY=dimensions.y;this._sizeZ=dimensions.z;this._centerX=this._sizeX/2;this._centerY=this._sizeY/2;this._centerZ=this._sizeZ/2;}var directions=asset.logic.model.directions;if(directions&&directions.length){var _iterator=_createForOfIteratorHelper(directions),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var direction=_step.value;this._directions.push(direction);}}catch(err){_iterator.e(err);}finally{_iterator.f();}this._directions.sort(function(a,b){return a-b;});}}if(asset.logic.customVars){var variables=asset.logic.customVars.variables;if(variables&&variables.length){model.setValue(RoomObjectVariable.FURNITURE_CUSTOM_VARIABLES,variables);}}}model.setValue(RoomObjectVariable.FURNITURE_SIZE_X,this._sizeX);model.setValue(RoomObjectVariable.FURNITURE_SIZE_Y,this._sizeY);model.setValue(RoomObjectVariable.FURNITURE_SIZE_Z,this._sizeZ);model.setValue(RoomObjectVariable.FURNITURE_CENTER_X,this._centerX);model.setValue(RoomObjectVariable.FURNITURE_CENTER_Y,this._centerY);model.setValue(RoomObjectVariable.FURNITURE_CENTER_Z,this._centerZ);model.setValue(RoomObjectVariable.FURNITURE_ALLOWED_DIRECTIONS,this._directions);model.setValue(RoomObjectVariable.FURNITURE_ALPHA_MULTIPLIER,1);}},{key:\"onDispose\",value:function onDispose(){this._storedRotateMessage=null;this._directions=null;_get(_getPrototypeOf(FurnitureLogic.prototype),\"onDispose\",this).call(this);}},{key:\"setObject\",value:function setObject(object){_get(_getPrototypeOf(FurnitureLogic.prototype),\"setObject\",this).call(this,object);if(object&&object.getLocation().length)this._directionInitialized=true;}},{key:\"getAdClickUrl\",value:function getAdClickUrl(model){return model.getValue(RoomObjectVariable.FURNITURE_AD_URL);}},{key:\"handleAdClick\",value:function handleAdClick(objectId,objectType,clickUrl){if(!this.eventDispatcher)return;this.eventDispatcher.dispatchEvent(new RoomObjectRoomAdEvent(RoomObjectRoomAdEvent.ROOM_AD_FURNI_CLICK,this.object));}},{key:\"update\",value:function update(time){_get(_getPrototypeOf(FurnitureLogic.prototype),\"update\",this).call(this,time);if(this._bouncingStep>0){this._bouncingStep++;if(this._bouncingStep>FurnitureLogic.BOUNCING_STEPS)this._bouncingStep=0;}}},{key:\"processUpdateMessage\",value:function processUpdateMessage(message){if(message instanceof ObjectDataUpdateMessage){this.processDataUpdateMessage(message);return;}if(message instanceof ObjectHeightUpdateMessage){this.processObjectHeightUpdateMessage(message);return;}if(message instanceof ObjectItemDataUpdateMessage){this.processItemDataUpdateMessage(message);return;}this._mouseOver=false;if(message.location&&message.direction){if(!(message instanceof ObjectMoveUpdateMessage)){var direction=this.object.getDirection();var location=this.object.getLocation();if(direction.x!==message.direction.x&&this._directionInitialized){if(location.x===message.location.x&&location.y===message.location.y&&location.z===message.location.z){this._bouncingStep=1;this._storedRotateMessage=new RoomObjectUpdateMessage(message.location,message.direction);message=null;}}}this._directionInitialized=true;}if(message instanceof ObjectSelectedMessage){if(this.contextMenu&&this.eventDispatcher&&this.object){var eventType=message.selected?RoomObjectWidgetRequestEvent.OPEN_FURNI_CONTEXT_MENU:RoomObjectWidgetRequestEvent.CLOSE_FURNI_CONTEXT_MENU;this.eventDispatcher.dispatchEvent(new RoomObjectWidgetRequestEvent(eventType,this.object));}}_get(_getPrototypeOf(FurnitureLogic.prototype),\"processUpdateMessage\",this).call(this,message);}},{key:\"processDataUpdateMessage\",value:function processDataUpdateMessage(message){if(!message)return;this.object.setState(message.state,0);if(message.data)message.data.writeRoomObjectModel(this.object.model);if(message.extra!==null)this.object.model.setValue(RoomObjectVariable.FURNITURE_EXTRAS,message.extra.toString());this.object.model.setValue(RoomObjectVariable.FURNITURE_STATE_UPDATE_TIME,this.lastUpdateTime);}},{key:\"processObjectHeightUpdateMessage\",value:function processObjectHeightUpdateMessage(message){if(!message)return;this.object.model.setValue(RoomObjectVariable.FURNITURE_SIZE_Z,message.height);}},{key:\"processItemDataUpdateMessage\",value:function processItemDataUpdateMessage(message){if(!message)return;this.object.model.setValue(RoomObjectVariable.FURNITURE_ITEMDATA,message.data);}},{key:\"mouseEvent\",value:function mouseEvent(event,geometry){var adUrl=this.getAdClickUrl(this.object.model);switch(event.type){case MouseEventType.MOUSE_MOVE:if(this.eventDispatcher){var mouseEvent=new RoomObjectMouseEvent(RoomObjectMouseEvent.MOUSE_MOVE,this.object,event.eventId,event.altKey,event.ctrlKey,event.shiftKey,event.buttonDown);mouseEvent.localX=event.localX;mouseEvent.localY=event.localY;mouseEvent.spriteOffsetX=event.spriteOffsetX;mouseEvent.spriteOffsetY=event.spriteOffsetY;this.eventDispatcher.dispatchEvent(mouseEvent);}return;case MouseEventType.ROLL_OVER:if(!this._mouseOver){if(this.eventDispatcher){if(adUrl&&adUrl.indexOf('http')===0){this.eventDispatcher.dispatchEvent(new RoomObjectRoomAdEvent(RoomObjectRoomAdEvent.ROOM_AD_TOOLTIP_SHOW,this.object));}var _mouseEvent=new RoomObjectMouseEvent(RoomObjectMouseEvent.MOUSE_ENTER,this.object,event.eventId,event.altKey,event.ctrlKey,event.shiftKey,event.buttonDown);_mouseEvent.localX=event.localX;_mouseEvent.localY=event.localY;_mouseEvent.spriteOffsetX=event.spriteOffsetX;_mouseEvent.spriteOffsetY=event.spriteOffsetY;this.eventDispatcher.dispatchEvent(_mouseEvent);}this._mouseOver=true;}return;case MouseEventType.ROLL_OUT:if(this._mouseOver){if(this.eventDispatcher){if(adUrl&&adUrl.indexOf('http')===0){this.eventDispatcher.dispatchEvent(new RoomObjectRoomAdEvent(RoomObjectRoomAdEvent.ROOM_AD_TOOLTIP_HIDE,this.object));}var _mouseEvent2=new RoomObjectMouseEvent(RoomObjectMouseEvent.MOUSE_LEAVE,this.object,event.eventId,event.altKey,event.ctrlKey,event.shiftKey,event.buttonDown);_mouseEvent2.localX=event.localX;_mouseEvent2.localY=event.localY;_mouseEvent2.spriteOffsetX=event.spriteOffsetX;_mouseEvent2.spriteOffsetY=event.spriteOffsetY;this.eventDispatcher.dispatchEvent(_mouseEvent2);}this._mouseOver=false;}return;case MouseEventType.DOUBLE_CLICK:this.useObject();return;case MouseEventType.MOUSE_CLICK:if(this.eventDispatcher){var _mouseEvent3=new RoomObjectMouseEvent(RoomObjectMouseEvent.CLICK,this.object,event.eventId,event.altKey,event.ctrlKey,event.shiftKey,event.buttonDown);_mouseEvent3.localX=event.localX;_mouseEvent3.localY=event.localY;_mouseEvent3.spriteOffsetX=event.spriteOffsetX;_mouseEvent3.spriteOffsetY=event.spriteOffsetY;this.eventDispatcher.dispatchEvent(_mouseEvent3);if(adUrl&&adUrl.indexOf('http')===0){this.eventDispatcher.dispatchEvent(new RoomObjectRoomAdEvent(RoomObjectRoomAdEvent.ROOM_AD_TOOLTIP_HIDE,this.object));}if(adUrl&&adUrl.length)this.handleAdClick(this.object.id,this.object.type,adUrl);}return;case MouseEventType.MOUSE_DOWN:if(this.eventDispatcher){var _mouseEvent4=new RoomObjectMouseEvent(RoomObjectMouseEvent.MOUSE_DOWN,this.object,event.eventId,event.altKey,event.ctrlKey,event.shiftKey,event.buttonDown);this.eventDispatcher.dispatchEvent(_mouseEvent4);}return;case MouseEventType.MOUSE_DOWN_LONG:if(this.eventDispatcher){var _mouseEvent5=new RoomObjectMouseEvent(RoomObjectMouseEvent.MOUSE_DOWN_LONG,this.object,event.eventId,event.altKey,event.ctrlKey,event.shiftKey,event.buttonDown);this.eventDispatcher.dispatchEvent(_mouseEvent5);}return;}}},{key:\"getLocationOffset\",value:function getLocationOffset(){if(this._bouncingStep<=0)return null;this._locationOffset.x=0;this._locationOffset.y=0;if(this._bouncingStep<=FurnitureLogic.BOUNCING_STEPS/2){this._locationOffset.z=FurnitureLogic.BOUNCING_Z*this._bouncingStep;}else{if(this._bouncingStep<=FurnitureLogic.BOUNCING_STEPS){if(this._storedRotateMessage){_get(_getPrototypeOf(FurnitureLogic.prototype),\"processUpdateMessage\",this).call(this,this._storedRotateMessage);this._storedRotateMessage=null;}this._locationOffset.z=FurnitureLogic.BOUNCING_Z*(FurnitureLogic.BOUNCING_STEPS-this._bouncingStep);}}return this._locationOffset;}},{key:\"useObject\",value:function useObject(){if(!this.object||!this.eventDispatcher)return;var clickUrl=this.getAdClickUrl(this.object.model);if(clickUrl&&clickUrl.length){this.eventDispatcher.dispatchEvent(new RoomObjectRoomAdEvent(RoomObjectRoomAdEvent.ROOM_AD_FURNI_DOUBLE_CLICK,this.object,null,clickUrl));}if(this.widget)this.eventDispatcher.dispatchEvent(new RoomObjectWidgetRequestEvent(RoomObjectWidgetRequestEvent.OPEN_WIDGET,this.object));this.eventDispatcher.dispatchEvent(new RoomObjectStateChangedEvent(RoomObjectStateChangedEvent.STATE_CHANGE,this.object));}},{key:\"tearDown\",value:function tearDown(){if(this.object.model.getValue(RoomObjectVariable.FURNITURE_REAL_ROOM_OBJECT)===1){if(this.widget)this.eventDispatcher.dispatchEvent(new RoomObjectWidgetRequestEvent(RoomObjectWidgetRequestEvent.CLOSE_WIDGET,this.object));if(this.contextMenu)this.eventDispatcher.dispatchEvent(new RoomObjectWidgetRequestEvent(RoomObjectWidgetRequestEvent.CLOSE_FURNI_CONTEXT_MENU,this.object));}_get(_getPrototypeOf(FurnitureLogic.prototype),\"tearDown\",this).call(this);}}]);return FurnitureLogic;}(MovingObjectLogic);FurnitureLogic.BOUNCING_STEPS=-1;FurnitureLogic.BOUNCING_Z=-1;","map":null,"metadata":{},"sourceType":"module"}