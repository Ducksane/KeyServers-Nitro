{"ast":null,"code":"import _slicedToArray from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useCallback,useEffect,useState}from'react';import{RoomWidgetPollMessage,RoomWidgetWordQuizUpdateEvent}from'../../../../api';import{UseEventDispatcherHook}from'../../../../hooks';import{useRoomContext}from'../../RoomContext';import{VALUE_KEY_DISLIKE,VALUE_KEY_LIKE}from'./common/VoteValue';import{WordQuizQuestionView}from'./WordQuizQuestionView';import{WordQuizVoteView}from'./WordQuizVoteView';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var DEFAULT_DISPLAY_DELAY=4000;var SIGN_FADE_DELAY=3;export var WordQuizWidgetView=function WordQuizWidgetView(props){var _useState=useState(-1),_useState2=_slicedToArray(_useState,2),pollId=_useState2[0],setPollId=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),question=_useState4[0],setQuestion=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),answerSent=_useState6[0],setAnswerSent=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),questionClearTimeout=_useState8[0],setQuestionClearTimeout=_useState8[1];var _useState9=useState(new Map()),_useState10=_slicedToArray(_useState9,2),answerCounts=_useState10[0],setAnswerCounts=_useState10[1];var _useState11=useState(new Map()),_useState12=_slicedToArray(_useState11,2),userAnswers=_useState12[0],setUserAnswers=_useState12[1];var _useRoomContext=useRoomContext(),_useRoomContext$event=_useRoomContext.eventDispatcher,eventDispatcher=_useRoomContext$event===void 0?null:_useRoomContext$event,_useRoomContext$widge=_useRoomContext.widgetHandler,widgetHandler=_useRoomContext$widge===void 0?null:_useRoomContext$widge,_useRoomContext$roomS=_useRoomContext.roomSession,roomSession=_useRoomContext$roomS===void 0?null:_useRoomContext$roomS;var clearQuestion=useCallback(function(){setPollId(-1);setQuestion(null);},[]);var onRoomWidgetWordQuizUpdateEvent=useCallback(function(event){switch(event.type){case RoomWidgetWordQuizUpdateEvent.NEW_QUESTION:setPollId(event.id);setQuestion(event.question);setAnswerSent(false);setAnswerCounts(new Map());setUserAnswers(new Map());setQuestionClearTimeout(function(prevValue){if(prevValue)clearTimeout(prevValue);if(event.duration>0){var delay=event.duration<1000?DEFAULT_DISPLAY_DELAY:event.duration;return setTimeout(function(){return clearQuestion();},delay);}return null;});break;case RoomWidgetWordQuizUpdateEvent.QUESTION_ANSWERED:{var userData=roomSession.userDataManager.getUserData(event.userId);if(!userData)return;setAnswerCounts(event.answerCounts);setUserAnswers(function(prevValue){if(!prevValue.has(userData.roomIndex)){var newValue=new Map(userAnswers);newValue.set(userData.roomIndex,{value:event.value,secondsLeft:SIGN_FADE_DELAY});return newValue;}return prevValue;});break;}case RoomWidgetWordQuizUpdateEvent.QUESTION_FINISHED:if(question&&question.id===event.questionId){setAnswerCounts(event.answerCounts);setAnswerSent(true);setQuestionClearTimeout(function(prevValue){if(prevValue)clearTimeout(prevValue);return setTimeout(function(){return clearQuestion();},DEFAULT_DISPLAY_DELAY);});}setUserAnswers(new Map());break;}},[question,roomSession.userDataManager,userAnswers,clearQuestion]);UseEventDispatcherHook(RoomWidgetWordQuizUpdateEvent.NEW_QUESTION,eventDispatcher,onRoomWidgetWordQuizUpdateEvent);UseEventDispatcherHook(RoomWidgetWordQuizUpdateEvent.QUESTION_ANSWERED,eventDispatcher,onRoomWidgetWordQuizUpdateEvent);UseEventDispatcherHook(RoomWidgetWordQuizUpdateEvent.QUESTION_FINISHED,eventDispatcher,onRoomWidgetWordQuizUpdateEvent);var vote=useCallback(function(vote){if(answerSent||!question)return;var updateMessage=new RoomWidgetPollMessage(RoomWidgetPollMessage.ANSWER,pollId);updateMessage.questionId=question.id;updateMessage.answers=[vote];widgetHandler.processWidgetMessage(updateMessage);setAnswerSent(true);},[answerSent,pollId,question,widgetHandler]);var checkSignFade=useCallback(function(){setUserAnswers(function(prevValue){var keysToRemove=[];prevValue.forEach(function(value,key){value.secondsLeft--;if(value.secondsLeft<=0)keysToRemove.push(key);});if(keysToRemove.length===0)return prevValue;var copy=new Map(prevValue);keysToRemove.forEach(function(key){return copy.delete(key);});return copy;});},[]);useEffect(function(){var interval=setInterval(function(){return checkSignFade();},1000);return function(){return clearInterval(interval);};},[checkSignFade]);useEffect(function(){return function(){setQuestionClearTimeout(function(prev){if(prev)clearTimeout(prev);return null;});};},[]);return/*#__PURE__*/_jsxs(_Fragment,{children:[question&&/*#__PURE__*/_jsx(WordQuizQuestionView,{question:question.content,canVote:!answerSent,vote:vote,noVotes:answerCounts.get(VALUE_KEY_DISLIKE)||0,yesVotes:answerCounts.get(VALUE_KEY_LIKE)||0}),userAnswers&&Array.from(userAnswers.entries()).map(function(_ref,index){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1];return/*#__PURE__*/_jsx(WordQuizVoteView,{userIndex:key,vote:value.value},index);})]});};","map":null,"metadata":{},"sourceType":"module"}