{"ast":null,"code":"import _createForOfIteratorHelper from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _classCallCheck from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createClass.js\";import{RenderTexture,Texture}from'@pixi/core';import{AlphaFilter}from'@pixi/filter-alpha';import{Matrix}from'@pixi/math';import{AdvancedMap,NitroPoint,NitroSprite}from'../../../../../core';import{Vector3D}from'../../../../avatar';import{Nitro}from'../../../../Nitro';import{FurnitureParticleSystemEmitter}from'./FurnitureParticleSystemEmitter';export var FurnitureParticleSystem=/*#__PURE__*/function(){function FurnitureParticleSystem(visualization){_classCallCheck(this,FurnitureParticleSystem);this._emitters=void 0;this._visualization=void 0;this._size=void 0;this._canvasId=-1;this._offsetY=void 0;this._currentEmitter=void 0;this._canvasTexture=void 0;this._roomSprite=void 0;this._hasIgnited=false;this._centerX=0;this._centerY=0;this._scaleMultiplier=1;this._blackOverlay=void 0;this._blackOverlayAlphaTransform=void 0;this._particleColorTransform=void 0;this._identityMatrix=void 0;this._translationMatrix=void 0;this._blend=1;this._bgColor=0xFF000000;this._emptySprite=void 0;this._isDone=false;this._emitters=new AdvancedMap();this._visualization=visualization;this._blackOverlayAlphaTransform=new AlphaFilter();this._blackOverlayAlphaTransform.alpha=1;this._particleColorTransform=new AlphaFilter();this._identityMatrix=new Matrix();this._translationMatrix=new Matrix();}_createClass(FurnitureParticleSystem,[{key:\"dispose\",value:function dispose(){var _iterator=_createForOfIteratorHelper(this._emitters.getValues()),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var emitter=_step.value;emitter.dispose();}}catch(err){_iterator.e(err);}finally{_iterator.f();}this._emitters=null;if(this._canvasTexture){this._canvasTexture.destroy();this._canvasTexture=null;}if(this._blackOverlay){this._blackOverlay.destroy();this._blackOverlay=null;}if(this._emptySprite){this._emptySprite.destroy();this._emptySprite=null;}this._blackOverlayAlphaTransform=null;this._particleColorTransform=null;this._identityMatrix=null;this._translationMatrix=null;}},{key:\"reset\",value:function reset(){if(this._currentEmitter)this._currentEmitter.reset();this._currentEmitter=null;this._hasIgnited=false;this._isDone=false;this.updateCanvas();}},{key:\"setAnimation\",value:function setAnimation(id){if(this._currentEmitter)this._currentEmitter.reset();this._currentEmitter=this._emitters.getValue(id);this._hasIgnited=false;this._isDone=false;this.updateCanvas();}},{key:\"updateCanvas\",value:function updateCanvas(){if(!this._currentEmitter||this._canvasId===-1)return;this._roomSprite=this._visualization.getSprite(this._canvasId);if(this._roomSprite&&this._roomSprite.texture){if(this._roomSprite.width<=1||this._roomSprite.height<=1)return;if(this._canvasTexture&&(this._canvasTexture.width!==this._roomSprite.width||this._canvasTexture.height!==this._roomSprite.height))this._canvasTexture=null;this.clearCanvas();this._centerX=-this._roomSprite.offsetX;this._centerY=-this._roomSprite.offsetY;this._roomSprite.texture=this._canvasTexture;}}},{key:\"getLayerYOffset\",value:function getLayerYOffset(scale,direction,layerId){if(this._currentEmitter&&this._currentEmitter.roomObjectSpriteId===layerId){return this._currentEmitter.y*this._scaleMultiplier;}return 0;}},{key:\"controlsSprite\",value:function controlsSprite(k){if(this._currentEmitter)return this._currentEmitter.roomObjectSpriteId==k;return false;}},{key:\"updateSprites\",value:function updateSprites(){if(!this._currentEmitter||!this._roomSprite)return;if(this._canvasTexture&&this._roomSprite.texture!==this._canvasTexture){this._roomSprite.texture=this._canvasTexture;}if(this._hasIgnited){if(this._currentEmitter.roomObjectSpriteId>=0)this._visualization.getSprite(this._currentEmitter.roomObjectSpriteId).visible=false;}}},{key:\"updateAnimation\",value:function updateAnimation(){if(!this._currentEmitter||!this._roomSprite||this._isDone)return;var k=10;if(!this._hasIgnited&&this._currentEmitter.hasIgnited)this._hasIgnited=true;var offsetY=this._offsetY*this._scaleMultiplier;this._currentEmitter.update();if(this._hasIgnited){if(this._currentEmitter.roomObjectSpriteId>=0){this._visualization.getSprite(this._currentEmitter.roomObjectSpriteId).visible=false;}if(!this._canvasTexture)this.updateCanvas();this.clearCanvas();var _iterator2=_createForOfIteratorHelper(this._currentEmitter.particles),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var particle=_step2.value;var tx=this._centerX+(particle.x-particle.z)*k/10*this._scaleMultiplier;var ty=this._centerY-offsetY+(particle.y+(particle.x+particle.z)/2)*k/10*this._scaleMultiplier;var asset=particle.getAsset();if(asset&&asset.texture){if(particle.fade&&particle.alphaMultiplier<1){this._translationMatrix.identity();this._translationMatrix.translate(tx+asset.offsetX,ty+asset.offsetY);var sprite=new NitroSprite(asset.texture);this._particleColorTransform.alpha=particle.alphaMultiplier;sprite.filters=[this._particleColorTransform];Nitro.instance.renderer.render(sprite,{renderTexture:this._canvasTexture,transform:this._translationMatrix,clear:false});}else{var point=new NitroPoint(tx+asset.offsetX,ty+asset.offsetY);var _sprite=new NitroSprite(asset.texture);_sprite.x=point.x;_sprite.y=point.y;Nitro.instance.renderer.render(_sprite,{renderTexture:this._canvasTexture,clear:false});}}else{var _sprite2=new NitroSprite(Texture.WHITE);_sprite2.tint=0xFFFFFF;_sprite2.x=tx-1;_sprite2.y=ty-1;_sprite2.width=2;_sprite2.height=2;Nitro.instance.renderer.render(_sprite2,{renderTexture:this._canvasTexture,clear:false});}}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}if(!this._currentEmitter.particles.length){this._isDone=true;return;}}}},{key:\"parseData\",value:function parseData(particleSystem){this._size=particleSystem.size;this._canvasId=particleSystem.canvasId!==undefined?particleSystem.canvasId:-1;this._offsetY=particleSystem.offsetY!==undefined?particleSystem.offsetY:10;this._scaleMultiplier=this._size/64;this._blend=particleSystem.blend!==undefined?particleSystem.blend:1;this._blend=Math.min(this._blend,1);this._blackOverlayAlphaTransform.alpha=this._blend;var bgColor=particleSystem.bgColor!==undefined?particleSystem.bgColor:'0';this._bgColor=parseInt(bgColor,16)||0x000000;if(!particleSystem.emitters||!particleSystem.emitters.length)return;var _iterator3=_createForOfIteratorHelper(particleSystem.emitters),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var emitter=_step3.value;var emitterId=emitter.id;var emitterName=emitter.name;var emitterSpriteId=emitter.spriteId;var particleEmitter=new FurnitureParticleSystemEmitter(emitterName,emitterSpriteId);this._emitters.add(emitterId,particleEmitter);var maxNumParticles=emitter.maxNumParticles;var particlesPerFrame=emitter.particlesPerFrame;var burstPulse=emitter.burstPulse!==undefined?emitter.burstPulse:1;var fuseTime=emitter.fuseTime;var simulationForce=emitter.simulation.force;var simulationDirection=emitter.simulation.direction;var simulationGravity=emitter.simulation.gravity;var simulationAirFriction=emitter.simulation.airFriction;var simulationShape=emitter.simulation.shape;var simulationEnergy=emitter.simulation.energy;var _iterator4=_createForOfIteratorHelper(emitter.particles),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var particle=_step4.value;var lifeTime=particle.lifeTime;var isEmitter=particle.isEmitter||false;var fade=particle.fade||false;var frames=[];var _iterator5=_createForOfIteratorHelper(particle.frames),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var name=_step5.value;frames.push(this._visualization.asset.getAsset(name));}}catch(err){_iterator5.e(err);}finally{_iterator5.f();}particleEmitter.configureParticle(lifeTime,isEmitter,frames,fade);}}catch(err){_iterator4.e(err);}finally{_iterator4.f();}particleEmitter.setup(maxNumParticles,particlesPerFrame,simulationForce,new Vector3D(0,simulationDirection,0),simulationGravity,simulationAirFriction,simulationShape,simulationEnergy,fuseTime,burstPulse);}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}}},{key:\"_Str_17988\",value:function _Str_17988(particleSystem){var emitterId=0;if(particleSystem._emitters&&particleSystem._currentEmitter){emitterId=particleSystem._emitters.getKey(particleSystem._emitters.getValues().indexOf(particleSystem._currentEmitter));}this.setAnimation(emitterId);if(this._currentEmitter)this._currentEmitter.copyStateFrom(particleSystem._currentEmitter,particleSystem._size/this._size);this._canvasTexture=null;}},{key:\"clearCanvas\",value:function clearCanvas(){if(!this._emptySprite){this._emptySprite=new NitroSprite(Texture.EMPTY);this._emptySprite.alpha=0;}if(!this._canvasTexture){this._canvasTexture=RenderTexture.create({width:this._roomSprite.width,height:this._roomSprite.height});}else{Nitro.instance.renderer.render(this._emptySprite,{renderTexture:this._canvasTexture,clear:true});}}}]);return FurnitureParticleSystem;}();","map":null,"metadata":{},"sourceType":"module"}