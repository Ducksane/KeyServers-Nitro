{"ast":null,"code":"import _classCallCheck from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _assertThisInitialized from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";import _inherits from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import{AdvancedMap,Nitro,NitroSettingsEvent,RoomEngineEvent,RoomEngineObjectEvent,RoomEngineSamplePlaybackEvent}from'../..';import{NitroManager}from'../../core/common/NitroManager';import{NitroSoundEvent}from'../events/NitroSoundEvent';import{MusicManager}from'./music/MusicManager';export var SoundManager=/*#__PURE__*/function(_NitroManager){_inherits(SoundManager,_NitroManager);var _super=_createSuper(SoundManager);function SoundManager(){var _this;_classCallCheck(this,SoundManager);_this=_super.call(this);_this._volumeSystem=void 0;_this._volumeFurni=void 0;_this._volumeTrax=void 0;_this._internalSamples=void 0;_this._furniSamples=void 0;_this._furnitureBeingPlayed=void 0;_this._musicManager=void 0;_this._volumeSystem=0.5;_this._volumeFurni=0.5;_this._volumeTrax=0.5;_this._internalSamples=new AdvancedMap();_this._furniSamples=new AdvancedMap();_this._furnitureBeingPlayed=new AdvancedMap();_this._musicManager=new MusicManager();_this.onEvent=_this.onEvent.bind(_assertThisInitialized(_this));return _this;}_createClass(SoundManager,[{key:\"onInit\",value:function onInit(){this._musicManager.init();Nitro.instance.roomEngine.events.addEventListener(RoomEngineSamplePlaybackEvent.PLAY_SAMPLE,this.onEvent);Nitro.instance.roomEngine.events.addEventListener(RoomEngineObjectEvent.REMOVED,this.onEvent);Nitro.instance.roomEngine.events.addEventListener(RoomEngineEvent.DISPOSED,this.onEvent);Nitro.instance.events.addEventListener(NitroSettingsEvent.SETTINGS_UPDATED,this.onEvent);Nitro.instance.events.addEventListener(NitroSoundEvent.PLAY_SOUND,this.onEvent);}},{key:\"onDispose\",value:function onDispose(){if(this._musicManager){this._musicManager.dispose();this._musicManager=null;}Nitro.instance.roomEngine.events.removeEventListener(RoomEngineSamplePlaybackEvent.PLAY_SAMPLE,this.onEvent);Nitro.instance.roomEngine.events.removeEventListener(RoomEngineObjectEvent.REMOVED,this.onEvent);Nitro.instance.roomEngine.events.removeEventListener(RoomEngineEvent.DISPOSED,this.onEvent);Nitro.instance.events.removeEventListener(NitroSettingsEvent.SETTINGS_UPDATED,this.onEvent);Nitro.instance.events.removeEventListener(NitroSoundEvent.PLAY_SOUND,this.onEvent);}},{key:\"onEvent\",value:function onEvent(event){var _this2=this;switch(event.type){case RoomEngineSamplePlaybackEvent.PLAY_SAMPLE:{var castedEvent=event;this.playFurniSample(castedEvent.objectId,castedEvent.sampleId,castedEvent.pitch);return;}case RoomEngineObjectEvent.REMOVED:{var _castedEvent=event;this.stopFurniSample(_castedEvent.objectId);return;}case RoomEngineEvent.DISPOSED:{this._furnitureBeingPlayed.getKeys().forEach(function(objectId){_this2.stopFurniSample(objectId);});return;}case NitroSettingsEvent.SETTINGS_UPDATED:{var _castedEvent2=event;var volumeFurniUpdated=_castedEvent2.volumeFurni!==this._volumeFurni;this._volumeSystem=_castedEvent2.volumeSystem/100;this._volumeFurni=_castedEvent2.volumeFurni/100;this._volumeTrax=_castedEvent2.volumeTrax/100;if(volumeFurniUpdated)this.updateFurniSamplesVolume(this._volumeFurni);return;}case NitroSoundEvent.PLAY_SOUND:{var _castedEvent3=event;this.playInternalSample(_castedEvent3.sampleCode);return;}}}},{key:\"playSample\",value:function playSample(sample,volume){var pitch=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;sample.volume=volume;sample.currentTime=0;try{sample.play();}catch(e){console.log(e);}}},{key:\"playInternalSample\",value:function playInternalSample(code){var sample=this._internalSamples.getValue(code);if(!sample){var sampleUrl=Nitro.instance.getConfiguration('sounds.url');sample=new Audio(sampleUrl.replace('%sample%',code));this._internalSamples.add(code,sample);}this.playSample(sample,this._volumeSystem);}},{key:\"playFurniSample\",value:function playFurniSample(objectId,code,pitch){var _this3=this;var sample=this._furniSamples.getValue(code);if(!sample){var sampleUrl=Nitro.instance.getConfiguration('external.samples.url');sample=new Audio(sampleUrl.replace('%sample%',code.toString()));this._furniSamples.add(code,sample);}if(!this._furnitureBeingPlayed.hasKey(objectId))this._furnitureBeingPlayed.add(objectId,code);sample.onended=function(event){_this3.stopFurniSample(objectId);};sample.onpause=function(event){_this3.stopFurniSample(objectId);};sample.onerror=function(event){_this3.stopFurniSample(objectId);};this.playSample(sample,this._volumeFurni,pitch);}},{key:\"stopInternalSample\",value:function stopInternalSample(code){var sample=this._internalSamples.getValue(code);if(!sample)return;try{sample.pause();}catch(e){console.log(e);}}},{key:\"stopFurniSample\",value:function stopFurniSample(objectId){var furnitureBeingPlayed=this._furnitureBeingPlayed.getValue(objectId);if(!furnitureBeingPlayed)return;var sample=this._furniSamples.getValue(furnitureBeingPlayed);this._furnitureBeingPlayed.remove(objectId);if(!sample)return;try{sample.pause();}catch(e){console.log(e);}}},{key:\"updateInternalSamplesVolume\",value:function updateInternalSamplesVolume(volume){this._internalSamples.getValues().forEach(function(sample){sample.volume=volume;});}},{key:\"updateFurniSamplesVolume\",value:function updateFurniSamplesVolume(volume){this._furniSamples.getValues().forEach(function(sample){sample.volume=volume;});}},{key:\"musicManager\",get:function get(){return this._musicManager;}}]);return SoundManager;}(NitroManager);","map":null,"metadata":{},"sourceType":"module"}