{"ast":null,"code":"import _classCallCheck from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _get from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/get.js\";import _getPrototypeOf from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js\";import _inherits from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import{AlphaTolerance}from'../../../../../room/object/enum/AlphaTolerance';import{RoomObjectSpriteVisualization}from'../../../../../room/object/visualization/RoomObjectSpriteVisualization';import{RoomObjectVariable}from'../../RoomObjectVariable';import{RoomObjectVisualizationType}from'../../RoomObjectVisualizationType';import{ColorData}from'../data/ColorData';import{LayerData}from'../data/LayerData';import{FurnitureVisualizationData}from'./FurnitureVisualizationData';export var FurnitureVisualization=/*#__PURE__*/function(_RoomObjectSpriteVisu){_inherits(FurnitureVisualization,_RoomObjectSpriteVisu);var _super=_createSuper(FurnitureVisualization);function FurnitureVisualization(){var _this;_classCallCheck(this,FurnitureVisualization);_this=_super.call(this);_this._data=void 0;_this._type=void 0;_this._direction=void 0;_this._lastCameraAngle=void 0;_this._selectedColor=void 0;_this._furnitureLift=void 0;_this._alphaMultiplier=void 0;_this._alphaChanged=void 0;_this._clickUrl=void 0;_this._clickHandling=void 0;_this._cacheDirection=void 0;_this._cacheScale=void 0;_this._cacheSize=void 0;_this._layerCount=void 0;_this._shadowLayerIndex=void 0;_this._updatedLayers=void 0;_this._assetNames=void 0;_this._spriteTags=void 0;_this._spriteInks=void 0;_this._spriteAlphas=void 0;_this._spriteColors=void 0;_this._spriteMouseCaptures=void 0;_this._spriteXOffsets=void 0;_this._spriteYOffsets=void 0;_this._spriteZOffsets=void 0;_this._animationNumber=void 0;_this._data=null;_this._type=null;_this._direction=0;_this._lastCameraAngle=NaN;_this._selectedColor=0;_this._furnitureLift=0;_this._alphaMultiplier=1;_this._alphaChanged=false;_this._clickUrl=null;_this._clickHandling=false;_this._cacheDirection=-1;_this._cacheScale=0;_this._cacheSize=-1;_this._layerCount=0;_this._shadowLayerIndex=-1;_this._updatedLayers=[];_this._assetNames=[];_this._spriteTags=[];_this._spriteInks=[];_this._spriteAlphas=[];_this._spriteColors=[];_this._spriteMouseCaptures=[];_this._spriteXOffsets=[];_this._spriteYOffsets=[];_this._spriteZOffsets=[];_this._animationNumber=0;return _this;}_createClass(FurnitureVisualization,[{key:\"initialize\",value:function initialize(data){this.reset();if(!(data instanceof FurnitureVisualizationData))return false;this._type=data.type;this._data=data;return true;}},{key:\"dispose\",value:function dispose(){_get(_getPrototypeOf(FurnitureVisualization.prototype),\"dispose\",this).call(this);this._data=null;this._updatedLayers=null;this._assetNames=null;this._spriteTags=null;this._spriteInks=null;this._spriteAlphas=null;this._spriteColors=null;this._spriteMouseCaptures=null;this._spriteXOffsets=null;this._spriteYOffsets=null;this._spriteZOffsets=null;}},{key:\"reset\",value:function reset(){_get(_getPrototypeOf(FurnitureVisualization.prototype),\"reset\",this).call(this);this.setDirection(-1);this._data=null;this._updatedLayers=[];this._assetNames=[];this._spriteTags=[];this._spriteInks=[];this._spriteAlphas=[];this._spriteColors=[];this._spriteMouseCaptures=[];this._spriteXOffsets=[];this._spriteYOffsets=[];this._spriteZOffsets=[];this.createSprites(0);}},{key:\"resetLayers\",value:function resetLayers(scale,direction){if(this._cacheDirection===direction&&this._cacheScale===scale)return;this._updatedLayers=[];this._assetNames=[];this._spriteTags=[];this._spriteInks=[];this._spriteAlphas=[];this._spriteColors=[];this._spriteMouseCaptures=[];this._spriteXOffsets=[];this._spriteYOffsets=[];this._spriteZOffsets=[];this._cacheDirection=direction;this._cacheScale=scale;this._cacheSize=this.getValidSize(scale);this.setLayerCount((this._data&&this._data.getLayerCount(scale)||0)+this.getAdditionalLayerCount());}},{key:\"update\",value:function update(geometry,time,_update,skipUpdate){if(!geometry)return;var scale=geometry.scale;var updateSprites=false;if(this.updateObject(scale,geometry.direction.x))updateSprites=true;if(this.updateModel(scale))updateSprites=true;var number=0;if(skipUpdate){this._animationNumber=this._animationNumber|this.updateAnimation(scale);}else{number=this.updateAnimation(scale)|this._animationNumber;this._animationNumber=0;}if(updateSprites||number!==0){this.updateSprites(scale,updateSprites,number);this._scale=scale;this.updateSpriteCounter++;}}},{key:\"updateObject\",value:function updateObject(scale,direction){if(!this.object)return false;if(this.updateObjectCounter===this.object.updateCounter&&scale===this._scale&&this._lastCameraAngle===direction)return false;var offsetDirection=this.object.getDirection().x-(direction+135);offsetDirection=(offsetDirection%360+360)%360;if(this._data){var validDirection=this._data.getValidDirection(scale,offsetDirection);this.setDirection(validDirection);}this._lastCameraAngle=direction;this._scale=scale;this.updateObjectCounter=this.object.updateCounter;this.resetLayers(scale,this._direction);return true;}},{key:\"updateModel\",value:function updateModel(scale){var model=this.object&&this.object.model;if(!model)return false;if(this.updateModelCounter===model.updateCounter)return false;this._selectedColor=model.getValue(RoomObjectVariable.FURNITURE_COLOR);this._clickUrl=model.getValue(RoomObjectVariable.FURNITURE_AD_URL);this._clickHandling=this._clickUrl&&this._clickUrl!==''&&this._clickUrl.indexOf('http')===0||false;this._furnitureLift=model.getValue(RoomObjectVariable.FURNITURE_LIFT_AMOUNT)||0;var alphaMultiplier=model.getValue(RoomObjectVariable.FURNITURE_ALPHA_MULTIPLIER);if(isNaN(alphaMultiplier))alphaMultiplier=1;if(this._alphaMultiplier!==alphaMultiplier){this._alphaMultiplier=alphaMultiplier;this._alphaChanged=true;}this.updateModelCounter=model.updateCounter;return true;}},{key:\"updateSprites\",value:function updateSprites(scale,update,animation){if(this._layerCount!==this.totalSprites)this.createSprites(this._layerCount);if(update){var layerId=this.totalSprites-1;while(layerId>=0){this.updateSprite(scale,layerId);layerId--;}}else{var _layerId=0;while(animation>0){if(animation)this.updateSprite(scale,_layerId);_layerId++;animation=animation>>1;}}this._alphaChanged=false;}},{key:\"updateSprite\",value:function updateSprite(scale,layerId){var assetName=this.getSpriteAssetName(scale,layerId);var sprite=this.getSprite(layerId);if(assetName&&sprite){var assetData=this.getAsset(assetName,layerId);if(assetData&&assetData.texture){sprite.visible=true;sprite.type=this._type;sprite.texture=assetData.texture;sprite.flipH=assetData.flipH;sprite.flipV=assetData.flipV;sprite.direction=this._direction;var relativeDepth=0;if(layerId!==this._shadowLayerIndex){sprite.tag=this.getLayerTag(scale,this._direction,layerId);sprite.alpha=this.getLayerAlpha(scale,this._direction,layerId);sprite.color=this.getLayerColor(scale,layerId,this._selectedColor);sprite.offsetX=assetData.offsetX+this.getLayerXOffset(scale,this._direction,layerId);sprite.offsetY=assetData.offsetY+this.getLayerYOffset(scale,this._direction,layerId);sprite.blendMode=this.getLayerInk(scale,this._direction,layerId);sprite.alphaTolerance=this.getLayerIgnoreMouse(scale,this._direction,layerId)?AlphaTolerance.MATCH_NOTHING:AlphaTolerance.MATCH_OPAQUE_PIXELS;relativeDepth=this.getLayerZOffset(scale,this._direction,layerId);relativeDepth=relativeDepth-layerId*0.001;}else{sprite.offsetX=assetData.offsetX;sprite.offsetY=assetData.offsetY+this.getLayerYOffset(scale,this._direction,layerId);sprite.alpha=48*this._alphaMultiplier;sprite.alphaTolerance=AlphaTolerance.MATCH_NOTHING;relativeDepth=1;}sprite.relativeDepth=relativeDepth*FurnitureVisualization.DEPTH_MULTIPLIER;sprite.name=assetName;sprite.libraryAssetName=this.getLibraryAssetNameForSprite(assetData,sprite);sprite.posture=this.getPostureForAsset(scale,assetData.source);sprite.clickHandling=this._clickHandling;}else{this.resetSprite(sprite);}}else{if(sprite)this.resetSprite(sprite);}}},{key:\"getLibraryAssetNameForSprite\",value:function getLibraryAssetNameForSprite(asset,sprite){return asset.source;}},{key:\"getPostureForAssetFile\",value:function getPostureForAssetFile(scale,_arg_2){return null;}},{key:\"resetSprite\",value:function resetSprite(sprite){if(!sprite)return;sprite.texture=null;sprite.libraryAssetName='';sprite.posture='';sprite.tag='';sprite.offsetX=0;sprite.offsetY=0;sprite.flipH=false;sprite.flipV=false;sprite.relativeDepth=0;sprite.clickHandling=false;}},{key:\"getSpriteAssetName\",value:function getSpriteAssetName(scale,layerId){if(!this._data||layerId>=FurnitureVisualizationData.LAYER_LETTERS.length)return'';var assetName=this._assetNames[layerId];var updated=this._updatedLayers[layerId];if(!assetName||!assetName.length){assetName=this.cacheSpriteAssetName(scale,layerId,true);updated=this._cacheSize!==1;}if(updated)assetName+=this.getFrameNumber(scale,layerId);return assetName;}},{key:\"cacheSpriteAssetName\",value:function cacheSpriteAssetName(scale,layerId,cache){var type=this._type;var size=cache?this._cacheSize:this.getValidSize(scale);var layerCode='';var isntIcon=size!==1;if(layerId!==this._shadowLayerIndex){layerCode=FurnitureVisualizationData.LAYER_LETTERS[layerId]||'';}else{layerCode='sd';}if(layerCode==='')return null;var assetName=this._type+(isntIcon?'_'+size+'_'+layerCode+'_'+this._direction+'_':'_icon_'+layerCode);if(cache){this._assetNames[layerId]=assetName;this._updatedLayers[layerId]=isntIcon;}return assetName;}},{key:\"getLayerTag\",value:function getLayerTag(scale,direction,layerId){var existing=this._spriteTags[layerId];if(existing!==undefined)return existing;if(!this._data)return LayerData.DEFAULT_TAG;var tag=this._data.getLayerTag(scale,direction,layerId);this._spriteTags[layerId]=tag;return tag;}},{key:\"getLayerInk\",value:function getLayerInk(scale,direction,layerId){var existing=this._spriteInks[layerId];if(existing!==undefined)return existing;if(!this._data)return LayerData.DEFAULT_INK;var ink=this._data.getLayerInk(scale,direction,layerId);this._spriteInks[layerId]=ink;return ink;}},{key:\"getLayerAlpha\",value:function getLayerAlpha(scale,direction,layerId){if(!this._alphaChanged){var existing=this._spriteAlphas[layerId];if(existing!==undefined)return existing;}if(!this._data)return LayerData.DEFAULT_ALPHA;var alpha=this._data.getLayerAlpha(scale,direction,layerId);if(this._alphaMultiplier!==null)alpha=alpha*this._alphaMultiplier;this._spriteAlphas[layerId]=alpha;return alpha;}},{key:\"getLayerColor\",value:function getLayerColor(scale,layerId,colorId){var existing=this._spriteColors[layerId];if(existing!==undefined)return existing;if(!this._data)return ColorData.DEFAULT_COLOR;var color=this._data.getLayerColor(scale,layerId,colorId);this._spriteColors[layerId]=color;return color;}},{key:\"getLayerIgnoreMouse\",value:function getLayerIgnoreMouse(scale,direction,layerId){var existing=this._spriteMouseCaptures[layerId];if(existing!==undefined)return existing;if(!this._data)return LayerData.DEFAULT_IGNORE_MOUSE;var ignoreMouse=this._data.getLayerIgnoreMouse(scale,direction,layerId);this._spriteMouseCaptures[layerId]=ignoreMouse;return ignoreMouse;}},{key:\"getLayerXOffset\",value:function getLayerXOffset(scale,direction,layerId){var existing=this._spriteXOffsets[layerId];if(existing!==undefined)return existing;if(!this._data)return LayerData.DEFAULT_XOFFSET;var xOffset=this._data.getLayerXOffset(scale,direction,layerId);this._spriteXOffsets[layerId]=xOffset;return xOffset;}},{key:\"getLayerYOffset\",value:function getLayerYOffset(scale,direction,layerId){if(layerId===this._shadowLayerIndex)return Math.ceil(this._furnitureLift*(scale/2));var existing=this._spriteYOffsets[layerId];if(existing!==undefined)return existing;if(!this._data)return LayerData.DEFAULT_YOFFSET;var yOffset=this._data.getLayerYOffset(scale,direction,layerId);this._spriteYOffsets[layerId]=yOffset;return yOffset;}},{key:\"getLayerZOffset\",value:function getLayerZOffset(scale,direction,layerId){var existing=this._spriteZOffsets[layerId];if(existing!==undefined)return existing;if(!this._data)return LayerData.DEFAULT_ZOFFSET;var zOffset=this._data.getLayerZOffset(scale,direction,layerId);this._spriteZOffsets[layerId]=zOffset;return zOffset;}},{key:\"getValidSize\",value:function getValidSize(scale){if(!this._data)return scale;return this._data.getValidSize(scale);}},{key:\"setLayerCount\",value:function setLayerCount(count){this._layerCount=count;this._shadowLayerIndex=count-this.getAdditionalLayerCount();}},{key:\"setDirection\",value:function setDirection(direction){if(this._direction===direction)return;this._direction=direction;}},{key:\"getAdditionalLayerCount\",value:function getAdditionalLayerCount(){return 1;}},{key:\"updateAnimation\",value:function updateAnimation(scale){return 0;}},{key:\"getFrameNumber\",value:function getFrameNumber(scale,layerId){return 0;}},{key:\"getPostureForAsset\",value:function getPostureForAsset(scale,name){return null;}},{key:\"getAsset\",value:function getAsset(name){var layerId=arguments.length>1&&arguments[1]!==undefined?arguments[1]:-1;if(!this.asset)return null;return this.asset.getAsset(name);}},{key:\"direction\",get:function get(){return this._direction;}}]);return FurnitureVisualization;}(RoomObjectSpriteVisualization);FurnitureVisualization.DEPTH_MULTIPLIER=Math.sqrt(0.5);FurnitureVisualization.TYPE=RoomObjectVisualizationType.FURNITURE_STATIC;","map":null,"metadata":{},"sourceType":"module"}