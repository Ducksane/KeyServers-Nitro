{"ast":null,"code":"import _classCallCheck from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _get from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/get.js\";import _getPrototypeOf from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js\";import _inherits from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import{Nitro}from'../../../../Nitro';import{RoomObjectVariable}from'../../RoomObjectVariable';import{FurnitureVisualization}from'./FurnitureVisualization';export var FurnitureBrandedImageVisualization=/*#__PURE__*/function(_FurnitureVisualizati){_inherits(FurnitureBrandedImageVisualization,_FurnitureVisualizati);var _super=_createSuper(FurnitureBrandedImageVisualization);function FurnitureBrandedImageVisualization(){var _this;_classCallCheck(this,FurnitureBrandedImageVisualization);_this=_super.call(this);_this._imageUrl=void 0;_this._shortUrl=void 0;_this._imageReady=void 0;_this._isAnimated=void 0;_this._gifCollection=void 0;_this._offsetX=void 0;_this._offsetY=void 0;_this._offsetZ=void 0;_this._currentFrame=void 0;_this._totalFrames=void 0;_this._imageUrl=null;_this._shortUrl=null;_this._imageReady=false;_this._isAnimated=false;_this._gifCollection=null;_this._offsetX=0;_this._offsetY=0;_this._offsetZ=0;_this._currentFrame=-1;_this._totalFrames=-1;return _this;}_createClass(FurnitureBrandedImageVisualization,[{key:\"dispose\",value:function dispose(){_get(_getPrototypeOf(FurnitureBrandedImageVisualization.prototype),\"dispose\",this).call(this);if(this._imageUrl){this.asset&&this.asset.disposeAsset(this._imageUrl);// dispose all\n}}},{key:\"updateObject\",value:function updateObject(scale,direction){if(!_get(_getPrototypeOf(FurnitureBrandedImageVisualization.prototype),\"updateObject\",this).call(this,scale,direction))return false;if(this._imageReady)this.checkAndCreateImageForCurrentState();return true;}},{key:\"updateModel\",value:function updateModel(scale){var flag=_get(_getPrototypeOf(FurnitureBrandedImageVisualization.prototype),\"updateModel\",this).call(this,scale);if(flag){this._offsetX=this.object.model.getValue(RoomObjectVariable.FURNITURE_BRANDING_OFFSET_X)||0;this._offsetY=this.object.model.getValue(RoomObjectVariable.FURNITURE_BRANDING_OFFSET_Y)||0;this._offsetZ=this.object.model.getValue(RoomObjectVariable.FURNITURE_BRANDING_OFFSET_Z)||0;this._isAnimated=this.object.model.getValue(RoomObjectVariable.FURNITURE_BRANDING_IS_ANIMATED)||false;}if(!this._imageReady){this._imageReady=this.checkIfImageReady();if(this._imageReady){this.checkAndCreateImageForCurrentState();return true;}}else{if(this.checkIfImageChanged()){this._imageReady=false;this._imageUrl=null;return true;}}return flag;}},{key:\"checkIfImageChanged\",value:function checkIfImageChanged(){var imageUrl=this.object.model.getValue(RoomObjectVariable.FURNITURE_BRANDING_IMAGE_URL);if(imageUrl&&imageUrl===this._imageUrl)return false;if(this._gifCollection){//\n}this.asset&&this.asset.disposeAsset(this._imageUrl);// dispose all\nreturn true;}},{key:\"checkIfImageReady\",value:function checkIfImageReady(){var model=this.object&&this.object.model;if(!model)return false;var imageUrl=this.object.model.getValue(RoomObjectVariable.FURNITURE_BRANDING_IMAGE_URL);if(!imageUrl)return false;if(this._imageUrl&&this._imageUrl===imageUrl)return false;var imageStatus=this.object.model.getValue(RoomObjectVariable.FURNITURE_BRANDING_IMAGE_STATUS);if(imageStatus===1){var texture=null;if(this._isAnimated){var gifCollection=Nitro.instance.roomEngine.roomContentLoader.getGifCollection(imageUrl);if(gifCollection){this._gifCollection=gifCollection;texture=gifCollection.textures[0];}}else{texture=Nitro.instance.core.asset.getTexture(imageUrl);}if(!texture)return false;this.imageReady(texture,imageUrl);return true;}return false;}},{key:\"imageReady\",value:function imageReady(texture,imageUrl){if(!texture){this._imageUrl=null;return;}this._imageUrl=imageUrl;}},{key:\"checkAndCreateImageForCurrentState\",value:function checkAndCreateImageForCurrentState(){if(this._isAnimated){this.buildAssetsForGif();return;}if(!this._imageUrl)return;var texture=Nitro.instance.core.asset.getTexture(this._imageUrl);if(!texture)return;var state=this.object.getState(0);this.addBackgroundAsset(texture,state,0);}},{key:\"buildAssetsForGif\",value:function buildAssetsForGif(){if(!this._gifCollection)return;var textures=this._gifCollection.textures;var durations=this._gifCollection.durations;if(!textures.length||!durations.length||textures.length!==durations.length)return;var state=this.object.getState(0);for(var i=0;i<textures.length;i++){var texture=textures[i];var duration=durations[i];if(!texture)continue;this.addBackgroundAsset(texture,state,i);}this._currentFrame=-1;this._totalFrames=textures.length;}},{key:\"addBackgroundAsset\",value:function addBackgroundAsset(texture,state,frame){var x=0;var y=0;var flipH=false;var flipV=false;switch(state){case FurnitureBrandedImageVisualization.STATE_0:x=0;y=0;flipH=false;flipV=false;break;case FurnitureBrandedImageVisualization.STATE_1:x=-texture.width;y=0;flipH=true;flipV=false;break;case FurnitureBrandedImageVisualization.STATE_2:x=-texture.width;y=-texture.height;flipH=true;flipV=true;break;case FurnitureBrandedImageVisualization.STATE_3:x=0;y=-texture.height;flipH=false;flipV=true;break;}this.asset.addAsset(\"\".concat(this._imageUrl,\"_\").concat(frame),texture,true,x,y,flipH,flipV);}},{key:\"getSpriteAssetName\",value:function getSpriteAssetName(scale,layerId){var tag=this.getLayerTag(scale,this._direction,layerId);if(tag===FurnitureBrandedImageVisualization.BRANDED_IMAGE&&this._imageUrl){return\"\".concat(this._imageUrl,\"_\").concat(this.getFrameNumber(scale,layerId));}return _get(_getPrototypeOf(FurnitureBrandedImageVisualization.prototype),\"getSpriteAssetName\",this).call(this,scale,layerId);}},{key:\"updateAnimation\",value:function updateAnimation(scale){if(!this._imageReady||!this._isAnimated||this._totalFrames<=0)return 0;return 1;}},{key:\"getFrameNumber\",value:function getFrameNumber(scale,layerId){if(!this._imageReady||!this._isAnimated||this._totalFrames<=0)return 0;var tag=this.getLayerTag(scale,this._direction,layerId);if(tag===FurnitureBrandedImageVisualization.BRANDED_IMAGE&&this._imageUrl){var newFrame=this._currentFrame;if(newFrame<0){newFrame=0;}else{newFrame+=1;}if(newFrame===this._totalFrames)newFrame=0;this._currentFrame=newFrame;return this._currentFrame;}return 0;}}]);return FurnitureBrandedImageVisualization;}(FurnitureVisualization);FurnitureBrandedImageVisualization.BRANDED_IMAGE='branded_image';FurnitureBrandedImageVisualization.STATE_0=0;FurnitureBrandedImageVisualization.STATE_1=1;FurnitureBrandedImageVisualization.STATE_2=2;FurnitureBrandedImageVisualization.STATE_3=3;","map":null,"metadata":{},"sourceType":"module"}