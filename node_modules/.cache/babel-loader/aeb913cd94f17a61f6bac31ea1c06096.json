{"ast":null,"code":"import _createForOfIteratorHelper from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _classCallCheck from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _assertThisInitialized from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";import _get from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/get.js\";import _getPrototypeOf from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js\";import _inherits from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import{Application}from'@pixi/app';import{SCALE_MODES}from'@pixi/constants';import{settings}from'@pixi/settings';import{Ticker}from'@pixi/ticker';import{ConfigurationEvent}from'../core/configuration/ConfigurationEvent';import{EventDispatcher}from'../core/events/EventDispatcher';import{NitroEvent}from'../core/events/NitroEvent';import{NitroCore}from'../core/NitroCore';import{NitroTimer}from'../core/utils/NitroTimer';import{RoomManager}from'../room/RoomManager';import{AvatarRenderManager}from'./avatar/AvatarRenderManager';import{RoomCameraWidgetManager}from'./camera/RoomCameraWidgetManager';import{NitroCommunicationManager}from'./communication/NitroCommunicationManager';import{LegacyExternalInterface}from'./externalInterface/LegacyExternalInterface';import{GameMessageHandler}from'./game/GameMessageHandler';import{NitroLocalizationManager}from'./localization/NitroLocalizationManager';import'./Plugins';import{RoomEngineEvent}from'./room/events/RoomEngineEvent';import{RoomEngine}from'./room/RoomEngine';import{RoomSessionManager}from'./session/RoomSessionManager';import{SessionDataManager}from'./session/SessionDataManager';import{SoundManager}from'./sound/SoundManager';import{HabboWebTools}from'./utils/HabboWebTools';LegacyExternalInterface.available;settings.SCALE_MODE=!(window.devicePixelRatio%1)?SCALE_MODES.NEAREST:SCALE_MODES.LINEAR;settings.ROUND_PIXELS=true;export var Nitro=/*#__PURE__*/function(_Application){_inherits(Nitro,_Application);var _super=_createSuper(Nitro);function Nitro(core,options){var _this;_classCallCheck(this,Nitro);_this=_super.call(this,options);_this._nitroTimer=void 0;_this._worker=void 0;_this._core=void 0;_this._events=void 0;_this._communication=void 0;_this._localization=void 0;_this._avatar=void 0;_this._roomEngine=void 0;_this._sessionDataManager=void 0;_this._roomSessionManager=void 0;_this._roomManager=void 0;_this._cameraManager=void 0;_this._soundManager=void 0;_this._linkTrackers=void 0;_this._workerTrackers=void 0;_this._isReady=void 0;_this._isDisposed=void 0;if(!Nitro.INSTANCE)Nitro.INSTANCE=_assertThisInitialized(_this);_this._nitroTimer=new NitroTimer();_this._worker=null;_this._core=core;_this._events=new EventDispatcher();_this._communication=new NitroCommunicationManager(core.communication);_this._localization=new NitroLocalizationManager(_this._communication);_this._avatar=new AvatarRenderManager();_this._roomEngine=new RoomEngine(_this._communication);_this._sessionDataManager=new SessionDataManager(_this._communication);_this._roomSessionManager=new RoomSessionManager(_this._communication,_this._roomEngine);_this._roomManager=new RoomManager(_this._roomEngine,_this._roomEngine.visualizationFactory,_this._roomEngine.logicFactory);_this._cameraManager=new RoomCameraWidgetManager();_this._soundManager=new SoundManager();_this._linkTrackers=[];_this._workerTrackers=[];_this._isReady=false;_this._isDisposed=false;_this._core.configuration.events.addEventListener(ConfigurationEvent.LOADED,_this.onConfigurationLoadedEvent.bind(_assertThisInitialized(_this)));_this._roomEngine.events.addEventListener(RoomEngineEvent.ENGINE_INITIALIZED,_this.onRoomEngineReady.bind(_assertThisInitialized(_this)));if(_this._worker)_this._worker.onmessage=_this.createWorkerEvent.bind(_assertThisInitialized(_this));return _this;}_createClass(Nitro,[{key:\"init\",value:function init(){if(this._isReady||this._isDisposed)return;if(this._avatar)this._avatar.init();if(this._soundManager)this._soundManager.init();if(this._roomEngine){this._roomEngine.sessionDataManager=this._sessionDataManager;this._roomEngine.roomSessionManager=this._roomSessionManager;this._roomEngine.roomManager=this._roomManager;if(this._sessionDataManager)this._sessionDataManager.init();if(this._roomSessionManager)this._roomSessionManager.init();this._roomEngine.init();}if(!this._communication.connection){throw new Error('No connection found');}new GameMessageHandler(this._communication.connection);this._isReady=true;}},{key:\"dispose\",value:function dispose(){if(this._isDisposed)return;if(this._roomManager){this._roomManager.dispose();this._roomManager=null;}if(this._roomSessionManager){this._roomSessionManager.dispose();this._roomSessionManager=null;}if(this._sessionDataManager){this._sessionDataManager.dispose();this._sessionDataManager=null;}if(this._roomEngine){this._roomEngine.dispose();this._roomEngine=null;}if(this._avatar){this._avatar.dispose();this._avatar=null;}if(this._soundManager){this._soundManager.dispose();this._soundManager=null;}if(this._communication){this._communication.dispose();this._communication=null;}_get(_getPrototypeOf(Nitro.prototype),\"destroy\",this).call(this);this._isDisposed=true;this._isReady=false;}},{key:\"onConfigurationLoadedEvent\",value:function onConfigurationLoadedEvent(event){var animationFPS=this.getConfiguration('system.animation.fps',24);var limitsFPS=this.getConfiguration('system.limits.fps',true);if(limitsFPS)Nitro.instance.ticker.maxFPS=animationFPS;}},{key:\"onRoomEngineReady\",value:function onRoomEngineReady(event){this.startSendingHeartBeat();}},{key:\"getConfiguration\",value:function getConfiguration(key){var value=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return this._core.configuration.getValue(key,value);}},{key:\"getLocalization\",value:function getLocalization(key){return this._localization.getValue(key);}},{key:\"getLocalizationWithParameter\",value:function getLocalizationWithParameter(key,parameter,replacement){return this._localization.getValueWithParameter(key,parameter,replacement);}},{key:\"getLocalizationWithParameters\",value:function getLocalizationWithParameters(key,parameters,replacements){return this._localization.getValueWithParameters(key,parameters,replacements);}},{key:\"addWorkerEventTracker\",value:function addWorkerEventTracker(tracker){if(this._workerTrackers.indexOf(tracker)>=0)return;this._workerTrackers.push(tracker);}},{key:\"removeWorkerEventTracker\",value:function removeWorkerEventTracker(tracker){var index=this._workerTrackers.indexOf(tracker);if(index===-1)return;this._workerTrackers.splice(index,1);}},{key:\"createWorkerEvent\",value:function createWorkerEvent(message){if(!message)return;var data=message.data;var _iterator=_createForOfIteratorHelper(this._workerTrackers),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var tracker=_step.value;if(!tracker)continue;tracker.workerMessageReceived(data);}}catch(err){_iterator.e(err);}finally{_iterator.f();}}},{key:\"sendWorkerEvent\",value:function sendWorkerEvent(message){if(!message||!this._worker)return;this._worker.postMessage(message);}},{key:\"addLinkEventTracker\",value:function addLinkEventTracker(tracker){if(this._linkTrackers.indexOf(tracker)>=0)return;this._linkTrackers.push(tracker);}},{key:\"removeLinkEventTracker\",value:function removeLinkEventTracker(tracker){var index=this._linkTrackers.indexOf(tracker);if(index===-1)return;this._linkTrackers.splice(index,1);}},{key:\"createLinkEvent\",value:function createLinkEvent(link){if(!link||link==='')return;var _iterator2=_createForOfIteratorHelper(this._linkTrackers),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var tracker=_step2.value;if(!tracker)continue;var prefix=tracker.eventUrlPrefix;if(prefix.length>0){if(link.substr(0,prefix.length)===prefix)tracker.linkReceived(link);}else{tracker.linkReceived(link);}}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}}},{key:\"startSendingHeartBeat\",value:function startSendingHeartBeat(){this.sendHeartBeat();setInterval(this.sendHeartBeat,10000);}},{key:\"sendHeartBeat\",value:function sendHeartBeat(){HabboWebTools.sendHeartBeat();}},{key:\"setWorker\",value:function setWorker(val){this._worker=val;this._worker.onmessage=this.createWorkerEvent.bind(this);}},{key:\"nitroTimer\",get:function get(){return this._nitroTimer;}},{key:\"core\",get:function get(){return this._core;}},{key:\"events\",get:function get(){return this._events;}},{key:\"localization\",get:function get(){return this._localization;}},{key:\"communication\",get:function get(){return this._communication;}},{key:\"avatar\",get:function get(){return this._avatar;}},{key:\"roomEngine\",get:function get(){return this._roomEngine;}},{key:\"sessionDataManager\",get:function get(){return this._sessionDataManager;}},{key:\"roomSessionManager\",get:function get(){return this._roomSessionManager;}},{key:\"roomManager\",get:function get(){return this._roomManager;}},{key:\"cameraManager\",get:function get(){return this._cameraManager;}},{key:\"soundManager\",get:function get(){return this._soundManager;}},{key:\"width\",get:function get(){return this.renderer.width;}},{key:\"height\",get:function get(){return this.renderer.height;}},{key:\"ticker\",get:function get(){return Ticker.shared;}},{key:\"time\",get:function get(){return this.ticker.lastTime;}},{key:\"isReady\",get:function get(){return this._isReady;}},{key:\"isDisposed\",get:function get(){return this._isDisposed;}}],[{key:\"bootstrap\",value:function bootstrap(){if(Nitro.INSTANCE){Nitro.INSTANCE.dispose();Nitro.INSTANCE=null;}var canvas=document.createElement('canvas');var instance=new this(new NitroCore(),{autoDensity:false,resolution:window.devicePixelRatio,width:window.innerWidth,height:window.innerHeight,view:canvas});canvas.addEventListener('webglcontextlost',function(){return instance.events.dispatchEvent(new NitroEvent(Nitro.WEBGL_CONTEXT_LOST));});}},{key:\"instance\",get:function get(){return this.INSTANCE||null;}}]);return Nitro;}(Application);Nitro.WEBGL_CONTEXT_LOST='NE_WEBGL_CONTEXT_LOST';Nitro.WEBGL_UNAVAILABLE='NE_WEBGL_UNAVAILABLE';Nitro.READY='NE_READY!';Nitro.INSTANCE=null;","map":null,"metadata":{},"sourceType":"module"}