{"ast":null,"code":"import _objectSpread from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{FloorHeightMapEvent,NitroPoint,RoomEngineEvent,RoomVisualizationSettingsEvent,UpdateFloorPropertiesMessageComposer}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useState}from'react';import{AddEventLinkTracker,LocalizeText,RemoveLinkEventTracker,SendMessageComposer}from'../../api';import{Button,ButtonGroup,Flex,NitroCardContentView,NitroCardHeaderView,NitroCardView}from'../../common';import{UseMessageEventHook,UseRoomEngineEvent}from'../../hooks';import{FloorplanEditor}from'./common/FloorplanEditor';import{convertNumbersForSaving,convertSettingToNumber}from'./common/Utils';import{FloorplanEditorContextProvider}from'./FloorplanEditorContext';import{FloorplanCanvasView}from'./views/FloorplanCanvasView';import{FloorplanImportExportView}from'./views/FloorplanImportExportView';import{FloorplanOptionsView}from'./views/FloorplanOptionsView';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var FloorplanEditorView=function FloorplanEditorView(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isVisible=_useState2[0],setIsVisible=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),importExportVisible=_useState4[0],setImportExportVisible=_useState4[1];var _useState5=useState({tilemap:'',reservedTiles:[],entryPoint:[0,0],entryPointDir:2,wallHeight:-1,thicknessWall:1,thicknessFloor:1}),_useState6=_slicedToArray(_useState5,2),originalFloorplanSettings=_useState6[0],setOriginalFloorplanSettings=_useState6[1];var _useState7=useState({entryPointDir:2,wallHeight:-1,thicknessWall:1,thicknessFloor:1}),_useState8=_slicedToArray(_useState7,2),visualizationSettings=_useState8[0],setVisualizationSettings=_useState8[1];var saveFloorChanges=function saveFloorChanges(){SendMessageComposer(new UpdateFloorPropertiesMessageComposer(FloorplanEditor.instance.getCurrentTilemapString(),FloorplanEditor.instance.doorLocation.x,FloorplanEditor.instance.doorLocation.y,visualizationSettings.entryPointDir,convertNumbersForSaving(visualizationSettings.thicknessWall),convertNumbersForSaving(visualizationSettings.thicknessFloor),visualizationSettings.wallHeight-1));};var revertChanges=function revertChanges(){setVisualizationSettings({wallHeight:originalFloorplanSettings.wallHeight,thicknessWall:originalFloorplanSettings.thicknessWall,thicknessFloor:originalFloorplanSettings.thicknessFloor,entryPointDir:originalFloorplanSettings.entryPointDir});FloorplanEditor.instance.doorLocation=new NitroPoint(originalFloorplanSettings.entryPoint[0],originalFloorplanSettings.entryPoint[1]);FloorplanEditor.instance.setTilemap(originalFloorplanSettings.tilemap,originalFloorplanSettings.reservedTiles);FloorplanEditor.instance.renderTiles();};var onRoomEngineEvent=useCallback(function(event){setIsVisible(false);},[]);UseRoomEngineEvent(RoomEngineEvent.DISPOSED,onRoomEngineEvent);var onFloorHeightMapEvent=useCallback(function(event){var parser=event.getParser();setOriginalFloorplanSettings(function(prevValue){var newValue=_objectSpread({},prevValue);newValue.tilemap=parser.model;newValue.wallHeight=parser.wallHeight+1;return newValue;});setVisualizationSettings(function(prevValue){var newValue=_objectSpread({},prevValue);newValue.wallHeight=parser.wallHeight+1;return newValue;});},[]);UseMessageEventHook(FloorHeightMapEvent,onFloorHeightMapEvent);var onRoomVisualizationSettingsEvent=useCallback(function(event){var parser=event.getParser();setOriginalFloorplanSettings(function(prevValue){var newValue=_objectSpread({},prevValue);newValue.thicknessFloor=convertSettingToNumber(parser.thicknessFloor);newValue.thicknessWall=convertSettingToNumber(parser.thicknessWall);return newValue;});setVisualizationSettings(function(prevValue){var newValue=_objectSpread({},prevValue);newValue.thicknessFloor=convertSettingToNumber(parser.thicknessFloor);newValue.thicknessWall=convertSettingToNumber(parser.thicknessWall);return newValue;});},[]);UseMessageEventHook(RoomVisualizationSettingsEvent,onRoomVisualizationSettingsEvent);useEffect(function(){var linkTracker={linkReceived:function linkReceived(url){var parts=url.split('/');if(parts.length<2)return;switch(parts[1]){case'show':setIsVisible(true);return;case'hide':setIsVisible(false);return;case'toggle':setIsVisible(function(prevValue){return!prevValue;});return;}},eventUrlPrefix:'floor-editor/'};AddEventLinkTracker(linkTracker);return function(){return RemoveLinkEventTracker(linkTracker);};},[]);useEffect(function(){FloorplanEditor.instance.initialize();},[]);return/*#__PURE__*/_jsxs(FloorplanEditorContextProvider,{value:{originalFloorplanSettings:originalFloorplanSettings,setOriginalFloorplanSettings:setOriginalFloorplanSettings,visualizationSettings:visualizationSettings,setVisualizationSettings:setVisualizationSettings},children:[isVisible&&/*#__PURE__*/_jsxs(NitroCardView,{uniqueKey:\"floorpan-editor\",className:\"nitro-floorplan-editor\",theme:\"primary-slim\",children:[/*#__PURE__*/_jsx(NitroCardHeaderView,{headerText:LocalizeText('floor.plan.editor.title'),onCloseClick:function onCloseClick(){return setIsVisible(false);}}),/*#__PURE__*/_jsxs(NitroCardContentView,{overflow:\"hidden\",children:[/*#__PURE__*/_jsx(FloorplanOptionsView,{}),/*#__PURE__*/_jsx(FloorplanCanvasView,{overflow:\"hidden\"}),/*#__PURE__*/_jsxs(Flex,{justifyContent:\"between\",children:[/*#__PURE__*/_jsx(Button,{onClick:revertChanges,children:LocalizeText('floor.plan.editor.reload')}),/*#__PURE__*/_jsxs(ButtonGroup,{children:[/*#__PURE__*/_jsx(Button,{disabled:true,children:LocalizeText('floor.plan.editor.preview')}),/*#__PURE__*/_jsx(Button,{onClick:function onClick(event){return setImportExportVisible(true);},children:LocalizeText('floor.plan.editor.import.export')}),/*#__PURE__*/_jsx(Button,{onClick:saveFloorChanges,children:LocalizeText('floor.plan.editor.save')})]})]})]})]}),importExportVisible&&/*#__PURE__*/_jsx(FloorplanImportExportView,{onCloseClick:function onCloseClick(){return setImportExportVisible(false);}})]});};","map":null,"metadata":{},"sourceType":"module"}