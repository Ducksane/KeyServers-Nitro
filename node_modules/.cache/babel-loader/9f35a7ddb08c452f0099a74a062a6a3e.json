{"ast":null,"code":"import _slicedToArray from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{FollowFriendMessageComposer}from'@nitrots/nitro-renderer';import{useEffect,useRef,useState}from'react';import{AddEventLinkTracker,GetUserProfile,LocalizeText,RemoveLinkEventTracker,SendMessageComposer}from'../../../../api';import{Base,Button,ButtonGroup,Column,Flex,Grid,LayoutAvatarImageView,LayoutBadgeImageView,LayoutGridItem,LayoutItemCountView,NitroCardContentView,NitroCardHeaderView,NitroCardView,Text}from'../../../../common';import{useMessenger}from'../../../../hooks';import{FriendsMessengerThreadView}from'./messenger-thread/FriendsMessengerThreadView';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export var FriendsMessengerView=function FriendsMessengerView(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isVisible=_useState2[0],setIsVisible=_useState2[1];var _useState3=useState(-1),_useState4=_slicedToArray(_useState3,2),lastThreadId=_useState4[0],setLastThreadId=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),messageText=_useState6[0],setMessageText=_useState6[1];var _useMessenger=useMessenger(),_useMessenger$visible=_useMessenger.visibleThreads,visibleThreads=_useMessenger$visible===void 0?[]:_useMessenger$visible,_useMessenger$activeT=_useMessenger.activeThread,activeThread=_useMessenger$activeT===void 0?null:_useMessenger$activeT,_useMessenger$getMess=_useMessenger.getMessageThread,getMessageThread=_useMessenger$getMess===void 0?null:_useMessenger$getMess,_useMessenger$sendMes=_useMessenger.sendMessage,sendMessage=_useMessenger$sendMes===void 0?null:_useMessenger$sendMes,_useMessenger$setActi=_useMessenger.setActiveThreadId,setActiveThreadId=_useMessenger$setActi===void 0?null:_useMessenger$setActi,_useMessenger$closeTh=_useMessenger.closeThread,closeThread=_useMessenger$closeTh===void 0?null:_useMessenger$closeTh;var messagesBox=useRef();var followFriend=function followFriend(){return activeThread&&activeThread.participant&&SendMessageComposer(new FollowFriendMessageComposer(activeThread.participant.id));};var openProfile=function openProfile(){return activeThread&&activeThread.participant&&GetUserProfile(activeThread.participant.id);};var send=function send(){if(!activeThread||!messageText.length)return;sendMessage(activeThread,messageText);setMessageText('');};var onKeyDown=function onKeyDown(event){if(event.key!=='Enter')return;send();};useEffect(function(){var linkTracker={linkReceived:function linkReceived(url){var parts=url.split('/');if(parts.length===2){if(parts[1]==='open'){setIsVisible(true);return;}else{var thread=getMessageThread(parseInt(parts[1]));if(!thread)return;setActiveThreadId(thread.threadId);setIsVisible(true);}}},eventUrlPrefix:'friends-messenger/'};AddEventLinkTracker(linkTracker);return function(){return RemoveLinkEventTracker(linkTracker);};},[getMessageThread,setActiveThreadId]);useEffect(function(){if(!isVisible||!activeThread)return;messagesBox.current.scrollTop=messagesBox.current.scrollHeight;},[isVisible,activeThread]);useEffect(function(){if(isVisible&&!activeThread){if(lastThreadId>0){setActiveThreadId(lastThreadId);}else{if(visibleThreads.length>0)setActiveThreadId(visibleThreads[0].threadId);}return;}if(!isVisible&&activeThread){setLastThreadId(activeThread.threadId);setActiveThreadId(-1);}},[isVisible,activeThread,lastThreadId,visibleThreads,setActiveThreadId]);if(!isVisible)return null;return/*#__PURE__*/_jsxs(NitroCardView,{className:\"nitro-friends-messenger animate__animated animate__bounceInDown\",uniqueKey:\"nitro-friends-messenger\",theme:\"primary-slim\",children:[/*#__PURE__*/_jsx(NitroCardHeaderView,{headerText:LocalizeText('messenger.window.title',['OPEN_CHAT_COUNT'],[visibleThreads.length.toString()]),onCloseClick:function onCloseClick(event){return setIsVisible(false);}}),/*#__PURE__*/_jsx(NitroCardContentView,{children:/*#__PURE__*/_jsxs(Grid,{overflow:\"hidden\",children:[/*#__PURE__*/_jsxs(Column,{size:4,children:[/*#__PURE__*/_jsx(Text,{style:{color:\"var(--test-galaxytext)\"},variant:\"none\",bold:true,children:LocalizeText('toolbar.icon.label.messenger')}),/*#__PURE__*/_jsx(Column,{fullHeight:true,overflow:\"auto\",children:visibleThreads&&visibleThreads.length>0&&visibleThreads.map(function(thread){return/*#__PURE__*/_jsxs(LayoutGridItem,{itemActive:activeThread===thread,onClick:function onClick(event){return setActiveThreadId(thread.threadId);},children:[thread.unread&&/*#__PURE__*/_jsx(LayoutItemCountView,{count:thread.unreadCount}),/*#__PURE__*/_jsxs(Flex,{fullWidth:true,alignItems:\"center\",gap:1,children:[/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",className:\"friend-head px-1\",children:[thread.participant.id>0&&/*#__PURE__*/_jsx(LayoutAvatarImageView,{figure:thread.participant.figure,headOnly:true,direction:3}),thread.participant.id<=0&&/*#__PURE__*/_jsx(LayoutBadgeImageView,{isGroup:true,badgeCode:thread.participant.figure})]}),/*#__PURE__*/_jsx(Text,{truncate:true,grow:true,children:thread.participant.name})]})]},thread.threadId);})})]}),/*#__PURE__*/_jsx(Column,{size:8,overflow:\"hidden\",children:activeThread&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Text,{style:{color:\"var(--test-galaxytext)\"},variant:\"none\",bold:true,center:true,children:LocalizeText('messenger.window.separator',['FRIEND_NAME'],[activeThread.participant.name])}),/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",justifyContent:\"between\",gap:1,children:[/*#__PURE__*/_jsxs(Flex,{gap:1,children:[/*#__PURE__*/_jsxs(ButtonGroup,{children:[/*#__PURE__*/_jsx(Button,{onClick:followFriend,children:/*#__PURE__*/_jsx(Base,{className:\"nitro-friends-spritesheet icon-follow\"})}),/*#__PURE__*/_jsx(Button,{onClick:openProfile,children:/*#__PURE__*/_jsx(Base,{className:\"nitro-friends-spritesheet icon-profile-sm\"})})]}),/*#__PURE__*/_jsx(Button,{variant:\"danger\",onClick:openProfile,children:LocalizeText('messenger.window.button.report')})]}),/*#__PURE__*/_jsx(Button,{onClick:function onClick(event){return closeThread(activeThread.threadId);},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"times\"})})]}),/*#__PURE__*/_jsx(Column,{fit:true,className:\"bg-muted p-2 rounded chat-messages\",children:/*#__PURE__*/_jsx(Column,{innerRef:messagesBox,overflow:\"auto\",children:/*#__PURE__*/_jsx(FriendsMessengerThreadView,{thread:activeThread})})}),/*#__PURE__*/_jsxs(Flex,{gap:1,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control form-control-sm\",maxLength:255,placeholder:LocalizeText('messenger.window.input.default',['FRIEND_NAME'],[activeThread.participant.name]),value:messageText,onChange:function onChange(event){return setMessageText(event.target.value);},onKeyDown:onKeyDown}),/*#__PURE__*/_jsx(Button,{variant:\"success\",onClick:send,children:LocalizeText('widgets.chatinput.say')})]})]})})]})})]});};","map":null,"metadata":{},"sourceType":"module"}