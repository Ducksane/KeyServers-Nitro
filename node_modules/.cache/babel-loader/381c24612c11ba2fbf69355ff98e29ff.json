{"ast":null,"code":"import _createForOfIteratorHelper from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _classCallCheck from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _assertThisInitialized from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";import _get from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/get.js\";import _getPrototypeOf from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js\";import _inherits from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import{NitroManager}from'../../core/common/NitroManager';import{FigureUpdateEvent,MysteryBoxKeysEvent}from'../communication';import{AvailabilityStatusMessageEvent}from'../communication/messages/incoming/availability/AvailabilityStatusMessageEvent';import{ChangeUserNameResultMessageEvent}from'../communication/messages/incoming/avatar/ChangeUserNameResultMessageEvent';import{NoobnessLevelMessageEvent}from'../communication/messages/incoming/handshake/NoobnessLevelMessageEvent';import{RoomReadyMessageEvent}from'../communication/messages/incoming/room/mapping/RoomReadyMessageEvent';import{UserPermissionsEvent}from'../communication/messages/incoming/user/access/UserPermissionsEvent';import{UserInfoEvent}from'../communication/messages/incoming/user/data/UserInfoEvent';import{UserNameChangeMessageEvent}from'../communication/messages/incoming/user/data/UserNameChangeMessageEvent';import{InClientLinkEvent}from'../communication/messages/incoming/user/InClientLinkEvent';import{PetRespectComposer}from'../communication/messages/outgoing/pet/PetRespectComposer';import{RoomUnitChatComposer}from'../communication/messages/outgoing/room/unit/chat/RoomUnitChatComposer';import{RoomUnitChatStyleComposer}from'../communication/messages/outgoing/room/unit/chat/RoomUnitChatStyleComposer';import{UserRespectComposer}from'../communication/messages/outgoing/user/UserRespectComposer';import{NitroSettingsEvent}from'../events/NitroSettingsEvent';import{Nitro}from'../Nitro';import{HabboWebTools}from'../utils/HabboWebTools';import{BadgeImageManager}from'./badge/BadgeImageManager';import{NoobnessLevelEnum}from'./enum/NoobnessLevelEnum';import{SecurityLevel}from'./enum/SecurityLevel';import{MysteryBoxKeysUpdateEvent}from'./events';import{SessionDataPreferencesEvent}from'./events/SessionDataPreferencesEvent';import{UserNameUpdateEvent}from'./events/UserNameUpdateEvent';import{FurnitureDataLoader}from'./furniture/FurnitureDataLoader';import{GroupInformationManager}from'./GroupInformationManager';import{IgnoredUsersManager}from'./IgnoredUsersManager';import{ProductDataLoader}from'./product/ProductDataLoader';export var SessionDataManager=/*#__PURE__*/function(_NitroManager){_inherits(SessionDataManager,_NitroManager);var _super=_createSuper(SessionDataManager);function SessionDataManager(communication){var _this;_classCallCheck(this,SessionDataManager);_this=_super.call(this);_this._communication=void 0;_this._userId=void 0;_this._name=void 0;_this._figure=void 0;_this._gender=void 0;_this._realName=void 0;_this._respectsReceived=void 0;_this._respectsLeft=void 0;_this._respectsPetLeft=void 0;_this._canChangeName=void 0;_this._ignoredUsersManager=void 0;_this._groupInformationManager=void 0;_this._clubLevel=void 0;_this._securityLevel=void 0;_this._isAmbassador=void 0;_this._noobnessLevel=void 0;_this._systemOpen=void 0;_this._systemShutdown=void 0;_this._isAuthenticHabbo=void 0;_this._isRoomCameraFollowDisabled=void 0;_this._chatStyle=void 0;_this._uiFlags=void 0;_this._floorItems=void 0;_this._wallItems=void 0;_this._products=void 0;_this._furnitureData=void 0;_this._productData=void 0;_this._furnitureReady=void 0;_this._productsReady=void 0;_this._furnitureListenersNotified=void 0;_this._pendingFurnitureListeners=void 0;_this._pendingProductListeners=void 0;_this._badgeImageManager=void 0;_this._communication=communication;_this.resetUserInfo();_this._ignoredUsersManager=new IgnoredUsersManager(_assertThisInitialized(_this));_this._groupInformationManager=new GroupInformationManager(_assertThisInitialized(_this));_this._clubLevel=0;_this._securityLevel=0;_this._isAmbassador=false;_this._noobnessLevel=-1;_this._systemOpen=false;_this._systemShutdown=false;_this._isAuthenticHabbo=false;_this._isRoomCameraFollowDisabled=false;_this._chatStyle=0;_this._uiFlags=0;_this._floorItems=new Map();_this._wallItems=new Map();_this._products=new Map();_this._furnitureData=null;_this._furnitureReady=false;_this._productsReady=false;_this._furnitureListenersNotified=false;_this._pendingFurnitureListeners=[];_this._pendingProductListeners=[];_this._badgeImageManager=null;_this.onFurnitureDataReadyEvent=_this.onFurnitureDataReadyEvent.bind(_assertThisInitialized(_this));_this.onProductDataReadyEvent=_this.onProductDataReadyEvent.bind(_assertThisInitialized(_this));_this.onNitroSettingsEvent=_this.onNitroSettingsEvent.bind(_assertThisInitialized(_this));return _this;}_createClass(SessionDataManager,[{key:\"onInit\",value:function onInit(){this.loadFurnitureData();this.loadProductData();this.loadBadgeImageManager();this._ignoredUsersManager&&this._ignoredUsersManager.init();this._groupInformationManager&&this._groupInformationManager.init();this._communication.registerMessageEvent(new FigureUpdateEvent(this.onUserFigureEvent.bind(this)));this._communication.registerMessageEvent(new UserInfoEvent(this.onUserInfoEvent.bind(this)));this._communication.registerMessageEvent(new UserPermissionsEvent(this.onUserPermissionsEvent.bind(this)));this._communication.registerMessageEvent(new AvailabilityStatusMessageEvent(this.onAvailabilityStatusMessageEvent.bind(this)));this._communication.registerMessageEvent(new ChangeUserNameResultMessageEvent(this.onChangeNameUpdateEvent.bind(this)));this._communication.registerMessageEvent(new UserNameChangeMessageEvent(this.onUserNameChangeMessageEvent.bind(this)));this._communication.registerMessageEvent(new RoomReadyMessageEvent(this.onRoomModelNameEvent.bind(this)));this._communication.registerMessageEvent(new InClientLinkEvent(this.onInClientLinkEvent.bind(this)));this._communication.registerMessageEvent(new MysteryBoxKeysEvent(this.onMysteryBoxKeysEvent.bind(this)));this._communication.registerMessageEvent(new NoobnessLevelMessageEvent(this.onNoobnessLevelMessageEvent.bind(this)));Nitro.instance.events.addEventListener(NitroSettingsEvent.SETTINGS_UPDATED,this.onNitroSettingsEvent);}},{key:\"onDispose\",value:function onDispose(){this.destroyFurnitureData();if(this._ignoredUsersManager){this._ignoredUsersManager.dispose();this._ignoredUsersManager=null;}if(this._groupInformationManager){this._groupInformationManager.dispose();this._groupInformationManager=null;}Nitro.instance.events.removeEventListener(NitroSettingsEvent.SETTINGS_UPDATED,this.onNitroSettingsEvent);_get(_getPrototypeOf(SessionDataManager.prototype),\"onDispose\",this).call(this);}},{key:\"resetUserInfo\",value:function resetUserInfo(){this._userId=0;this._name=null;this._figure=null;this._gender=null;this._realName=null;this._canChangeName=false;}},{key:\"loadFurnitureData\",value:function loadFurnitureData(){this.destroyFurnitureData();this._furnitureData=new FurnitureDataLoader(this._floorItems,this._wallItems,Nitro.instance.localization);this._furnitureData.addEventListener(FurnitureDataLoader.FURNITURE_DATA_READY,this.onFurnitureDataReadyEvent);this._furnitureData.loadFurnitureData(Nitro.instance.getConfiguration('furnidata.url'));}},{key:\"loadProductData\",value:function loadProductData(){this.destroyProductData();this._productData=new ProductDataLoader(this._products);this._productData.addEventListener(ProductDataLoader.PDP_PRODUCT_DATA_READY,this.onProductDataReadyEvent);this._productData.loadProductData(Nitro.instance.getConfiguration('productdata.url'));}},{key:\"loadBadgeImageManager\",value:function loadBadgeImageManager(){if(this._badgeImageManager)return;this._badgeImageManager=new BadgeImageManager(Nitro.instance.core.asset,this);this._badgeImageManager.init();}},{key:\"hasProductData\",value:function hasProductData(listener){if(this._productsReady)return true;if(listener&&this._pendingProductListeners.indexOf(listener)===-1)this._pendingProductListeners.push(listener);return false;}},{key:\"getAllFurnitureData\",value:function getAllFurnitureData(listener){if(!this._furnitureReady){if(this._pendingFurnitureListeners.indexOf(listener)===-1)this._pendingFurnitureListeners.push(listener);return null;}var furnitureData=[];var _iterator=_createForOfIteratorHelper(this._floorItems.values()),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var data=_step.value;if(!data)continue;furnitureData.push(data);}}catch(err){_iterator.e(err);}finally{_iterator.f();}var _iterator2=_createForOfIteratorHelper(this._wallItems.values()),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _data=_step2.value;if(!_data)continue;furnitureData.push(_data);}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}return furnitureData;}},{key:\"removePendingFurniDataListener\",value:function removePendingFurniDataListener(listener){if(!this._pendingFurnitureListeners)return;var index=this._pendingFurnitureListeners.indexOf(listener);if(index===-1)return;this._pendingFurnitureListeners.splice(index,1);}},{key:\"onUserFigureEvent\",value:function onUserFigureEvent(event){if(!event||!event.connection)return;this._figure=event.getParser().figure;this._gender=event.getParser().gender;HabboWebTools.updateFigure(this._figure);}},{key:\"onUserInfoEvent\",value:function onUserInfoEvent(event){if(!event||!event.connection)return;this.resetUserInfo();var userInfo=event.getParser().userInfo;if(!userInfo)return;this._userId=userInfo.userId;this._name=userInfo.username;this._figure=userInfo.figure;this._gender=userInfo.gender;this._realName=userInfo.realName;this._respectsReceived=userInfo.respectsReceived;this._respectsLeft=userInfo.respectsRemaining;this._respectsPetLeft=userInfo.respectsPetRemaining;this._canChangeName=userInfo.canChangeName;this._ignoredUsersManager&&this._ignoredUsersManager.requestIgnoredUsers();}},{key:\"onUserPermissionsEvent\",value:function onUserPermissionsEvent(event){if(!event||!event.connection)return;this._clubLevel=event.getParser().clubLevel;this._securityLevel=event.getParser().securityLevel;this._isAmbassador=event.getParser().isAmbassador;}},{key:\"onAvailabilityStatusMessageEvent\",value:function onAvailabilityStatusMessageEvent(event){if(!event||!event.connection)return;var parser=event.getParser();if(!parser)return;this._systemOpen=parser.isOpen;this._systemShutdown=parser.onShutdown;this._isAuthenticHabbo=parser.isAuthenticUser;}},{key:\"onChangeNameUpdateEvent\",value:function onChangeNameUpdateEvent(event){if(!event||!event.connection)return;var parser=event.getParser();if(!parser)return;if(parser.resultCode!==ChangeUserNameResultMessageEvent.NAME_OK)return;this._canChangeName=false;this.events.dispatchEvent(new UserNameUpdateEvent(parser.name));}},{key:\"onUserNameChangeMessageEvent\",value:function onUserNameChangeMessageEvent(event){if(!event||!event.connection)return;var parser=event.getParser();if(!parser)return;if(parser.webId!==this.userId)return;this._name=parser.newName;this._canChangeName=false;this.events.dispatchEvent(new UserNameUpdateEvent(this._name));}},{key:\"onRoomModelNameEvent\",value:function onRoomModelNameEvent(event){if(!event)return;var parser=event.getParser();if(!parser)return;HabboWebTools.roomVisited(parser.roomId);}},{key:\"onFurnitureDataReadyEvent\",value:function onFurnitureDataReadyEvent(event){this._furnitureData.removeEventListener(FurnitureDataLoader.FURNITURE_DATA_READY,this.onFurnitureDataReadyEvent);this._furnitureReady=true;if(!this._furnitureListenersNotified){this._furnitureListenersNotified=true;if(this._pendingFurnitureListeners&&this._pendingFurnitureListeners.length){var _iterator3=_createForOfIteratorHelper(this._pendingFurnitureListeners),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var listener=_step3.value;listener&&listener.loadFurnitureData();}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}}}this._pendingProductListeners=[];}},{key:\"onProductDataReadyEvent\",value:function onProductDataReadyEvent(event){this._productData.removeEventListener(ProductDataLoader.PDP_PRODUCT_DATA_READY,this.onProductDataReadyEvent);this._productsReady=true;var _iterator4=_createForOfIteratorHelper(this._pendingProductListeners),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var listener=_step4.value;listener&&listener.loadProductData();}}catch(err){_iterator4.e(err);}finally{_iterator4.f();}this._pendingProductListeners=[];}},{key:\"onInClientLinkEvent\",value:function onInClientLinkEvent(event){if(!event)return;var parser=event.getParser();if(!parser)return;Nitro.instance.createLinkEvent(parser.link);}},{key:\"onMysteryBoxKeysEvent\",value:function onMysteryBoxKeysEvent(event){if(!event)return;var parser=event.getParser();if(!parser)return;this.events.dispatchEvent(new MysteryBoxKeysUpdateEvent(parser.boxColor,parser.keyColor));}},{key:\"onNoobnessLevelMessageEvent\",value:function onNoobnessLevelMessageEvent(event){this._noobnessLevel=event.getParser().noobnessLevel;if(this._noobnessLevel!==NoobnessLevelEnum.OLD_IDENTITY){Nitro.instance.core.configuration.setValue('new.identity',1);}}},{key:\"onNitroSettingsEvent\",value:function onNitroSettingsEvent(event){this._isRoomCameraFollowDisabled=event.cameraFollow;this._chatStyle=event.chatType;this._uiFlags=event.flags;this.events.dispatchEvent(new SessionDataPreferencesEvent(this._uiFlags));}},{key:\"destroyFurnitureData\",value:function destroyFurnitureData(){if(!this._furnitureData)return;this._furnitureData.dispose();this._furnitureData=null;}},{key:\"destroyProductData\",value:function destroyProductData(){if(!this._productData)return;this._productData.dispose();this._productData=null;}},{key:\"getFloorItemData\",value:function getFloorItemData(id){var existing=this._floorItems.get(id);if(!existing)return null;return existing;}},{key:\"getFloorItemDataByName\",value:function getFloorItemDataByName(name){if(!name||!this._floorItems||!this._floorItems.size)return null;var _iterator5=_createForOfIteratorHelper(this._floorItems.values()),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var item=_step5.value;if(!item||item.className!==name)continue;return item;}}catch(err){_iterator5.e(err);}finally{_iterator5.f();}}},{key:\"getWallItemData\",value:function getWallItemData(id){var existing=this._wallItems.get(id);if(!existing)return null;return existing;}},{key:\"getWallItemDataByName\",value:function getWallItemDataByName(name){if(!name||!this._wallItems||!this._wallItems.size)return null;var _iterator6=_createForOfIteratorHelper(this._wallItems.values()),_step6;try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var item=_step6.value;if(!item||item.className!==name)continue;return item;}}catch(err){_iterator6.e(err);}finally{_iterator6.f();}}},{key:\"getProductData\",value:function getProductData(type){if(!this._productsReady)this.loadProductData();return this._products.get(type);}},{key:\"getBadgeUrl\",value:function getBadgeUrl(name){return this._badgeImageManager.getBadgeUrl(name);}},{key:\"getGroupBadgeUrl\",value:function getGroupBadgeUrl(name){return this._badgeImageManager.getBadgeUrl(name,BadgeImageManager.GROUP_BADGE);}},{key:\"getBadgeImage\",value:function getBadgeImage(name){return this._badgeImageManager.getBadgeImage(name);}},{key:\"getGroupBadgeImage\",value:function getGroupBadgeImage(name){return this._badgeImageManager.getBadgeImage(name,BadgeImageManager.GROUP_BADGE);}},{key:\"loadBadgeImage\",value:function loadBadgeImage(name){return this._badgeImageManager.loadBadgeImage(name);}},{key:\"loadGroupBadgeImage\",value:function loadGroupBadgeImage(name){return this._badgeImageManager.loadBadgeImage(name,BadgeImageManager.GROUP_BADGE);}},{key:\"hasSecurity\",value:function hasSecurity(level){return this._securityLevel>=level;}},{key:\"giveRespect\",value:function giveRespect(userId){if(userId<0||this._respectsLeft<=0)return;this.send(new UserRespectComposer(userId));this._respectsLeft--;}},{key:\"givePetRespect\",value:function givePetRespect(petId){if(petId<0||this._respectsPetLeft<=0)return;this.send(new PetRespectComposer(petId));this._respectsPetLeft--;}},{key:\"sendSpecialCommandMessage\",value:function sendSpecialCommandMessage(text){var styleId=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;this.send(new RoomUnitChatComposer(text));}},{key:\"sendChatStyleUpdate\",value:function sendChatStyleUpdate(styleId){this._chatStyle=styleId;this.send(new RoomUnitChatStyleComposer(styleId));}},{key:\"ignoreUser\",value:function ignoreUser(name){this._ignoredUsersManager&&this._ignoredUsersManager.ignoreUser(name);}},{key:\"unignoreUser\",value:function unignoreUser(name){this._ignoredUsersManager&&this._ignoredUsersManager.unignoreUser(name);}},{key:\"isUserIgnored\",value:function isUserIgnored(name){return this._ignoredUsersManager&&this._ignoredUsersManager.isIgnored(name);}},{key:\"getGroupBadge\",value:function getGroupBadge(groupId){return this._groupInformationManager&&this._groupInformationManager.getGroupBadge(groupId);}},{key:\"send\",value:function send(composer){this._communication.connection.send(composer);}},{key:\"communication\",get:function get(){return this._communication;}},{key:\"userId\",get:function get(){return this._userId;}},{key:\"userName\",get:function get(){return this._name;}},{key:\"figure\",get:function get(){return this._figure;}},{key:\"gender\",get:function get(){return this._gender;}},{key:\"realName\",get:function get(){return this._realName;}},{key:\"ignoredUsersManager\",get:function get(){return this._ignoredUsersManager;}},{key:\"groupInformationManager\",get:function get(){return this._groupInformationManager;}},{key:\"respectsReceived\",get:function get(){return this._respectsReceived;}},{key:\"respectsLeft\",get:function get(){return this._respectsLeft;}},{key:\"respectsPetLeft\",get:function get(){return this._respectsPetLeft;}},{key:\"canChangeName\",get:function get(){return this._canChangeName;}},{key:\"clubLevel\",get:function get(){return this._clubLevel;}},{key:\"securityLevel\",get:function get(){return this._securityLevel;}},{key:\"isAmbassador\",get:function get(){return this._isAmbassador;}},{key:\"isNoob\",get:function get(){return this._noobnessLevel!==NoobnessLevelEnum.OLD_IDENTITY;}},{key:\"isRealNoob\",get:function get(){return this._noobnessLevel===NoobnessLevelEnum.REAL_NOOB;}},{key:\"isSystemOpen\",get:function get(){return this._systemOpen;}},{key:\"isSystemShutdown\",get:function get(){return this._systemShutdown;}},{key:\"isAuthenticHabbo\",get:function get(){return this._isAuthenticHabbo;}},{key:\"isModerator\",get:function get(){return this._securityLevel>=SecurityLevel.MODERATOR;}},{key:\"isCameraFollowDisabled\",get:function get(){return this._isRoomCameraFollowDisabled;}},{key:\"chatStyle\",get:function get(){return this._chatStyle;}},{key:\"uiFlags\",get:function get(){return this._uiFlags;}}]);return SessionDataManager;}(NitroManager);","map":null,"metadata":{},"sourceType":"module"}