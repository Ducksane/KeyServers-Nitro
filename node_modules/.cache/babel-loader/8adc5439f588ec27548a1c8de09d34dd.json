{"ast":null,"code":"import _classCallCheck from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _get from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/get.js\";import _getPrototypeOf from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js\";import _inherits from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import{BaseTexture,Texture}from'@pixi/core';import{decompressFrames,parseGIF}from'gifuct-js';import{Nitro}from'../../../../Nitro';import{MouseEventType}from'../../../../ui';import{RoomWidgetEnumItemExtradataParameter}from'../../../../ui/widget/enums/RoomWidgetEnumItemExtradataParameter';import{RoomObjectRoomAdEvent}from'../../../events';import{ObjectAdUpdateMessage}from'../../../messages/ObjectAdUpdateMessage';import{ObjectDataUpdateMessage}from'../../../messages/ObjectDataUpdateMessage';import{MapDataType}from'../../data/type/MapDataType';import{RoomObjectVariable}from'../../RoomObjectVariable';import{FurnitureLogic}from'./FurnitureLogic';export var FurnitureRoomBrandingLogic=/*#__PURE__*/function(_FurnitureLogic){_inherits(FurnitureRoomBrandingLogic,_FurnitureLogic);var _super=_createSuper(FurnitureRoomBrandingLogic);function FurnitureRoomBrandingLogic(){var _this;_classCallCheck(this,FurnitureRoomBrandingLogic);_this=_super.call(this);_this._disableFurnitureSelection=void 0;_this._hasClickUrl=void 0;_this._disableFurnitureSelection=true;_this._hasClickUrl=false;return _this;}_createClass(FurnitureRoomBrandingLogic,[{key:\"getEventTypes\",value:function getEventTypes(){var types=[RoomObjectRoomAdEvent.ROOM_AD_LOAD_IMAGE];return this.mergeTypes(_get(_getPrototypeOf(FurnitureRoomBrandingLogic.prototype),\"getEventTypes\",this).call(this),types);}},{key:\"initialize\",value:function initialize(asset){_get(_getPrototypeOf(FurnitureRoomBrandingLogic.prototype),\"initialize\",this).call(this,asset);if(this._disableFurnitureSelection){this.object.model.setValue(RoomObjectVariable.FURNITURE_SELECTION_DISABLED,1);}}},{key:\"processUpdateMessage\",value:function processUpdateMessage(message){_get(_getPrototypeOf(FurnitureRoomBrandingLogic.prototype),\"processUpdateMessage\",this).call(this,message);if(message instanceof ObjectDataUpdateMessage)this.processAdDataUpdateMessage(message);if(message instanceof ObjectAdUpdateMessage)this.processAdUpdate(message);}},{key:\"processAdDataUpdateMessage\",value:function processAdDataUpdateMessage(message){if(!message)return;var objectData=new MapDataType();objectData.initializeFromRoomObjectModel(this.object.model);var state=parseInt(objectData.getValue(FurnitureRoomBrandingLogic.STATE));if(!isNaN(state)&&this.object.getState(0)!==state)this.object.setState(state,0);var imageUrl=objectData.getValue(FurnitureRoomBrandingLogic.IMAGEURL_KEY);var existingUrl=this.object.model.getValue(RoomObjectVariable.FURNITURE_BRANDING_IMAGE_URL);if(!existingUrl||existingUrl!==imageUrl){this.object.model.setValue(RoomObjectVariable.FURNITURE_BRANDING_IMAGE_URL,imageUrl);this.object.model.setValue(RoomObjectVariable.FURNITURE_BRANDING_IMAGE_STATUS,0);this.downloadBackground();}var clickUrl=objectData.getValue(FurnitureRoomBrandingLogic.CLICKURL_KEY);if(clickUrl){var _existingUrl=this.object.model.getValue(RoomObjectVariable.FURNITURE_BRANDING_URL);if(!_existingUrl||_existingUrl!==clickUrl){if(this.object.model)this.object.model.setValue(RoomObjectVariable.FURNITURE_BRANDING_URL,clickUrl);}}var offsetX=parseInt(objectData.getValue(FurnitureRoomBrandingLogic.OFFSETX_KEY));var offsetY=parseInt(objectData.getValue(FurnitureRoomBrandingLogic.OFFSETY_KEY));var offsetZ=parseInt(objectData.getValue(FurnitureRoomBrandingLogic.OFFSETZ_KEY));if(!isNaN(offsetX))this.object.model.setValue(RoomObjectVariable.FURNITURE_BRANDING_OFFSET_X,offsetX);if(!isNaN(offsetY))this.object.model.setValue(RoomObjectVariable.FURNITURE_BRANDING_OFFSET_Y,offsetY);if(!isNaN(offsetZ))this.object.model.setValue(RoomObjectVariable.FURNITURE_BRANDING_OFFSET_Z,offsetZ);var options=FurnitureRoomBrandingLogic.IMAGEURL_KEY+'='+(imageUrl!==null?imageUrl:'')+'\\t';if(this._hasClickUrl){options=options+(FurnitureRoomBrandingLogic.CLICKURL_KEY+'='+(clickUrl!==null?clickUrl:'')+'\\t');}options=options+(FurnitureRoomBrandingLogic.OFFSETX_KEY+'='+offsetX+'\\t');options=options+(FurnitureRoomBrandingLogic.OFFSETY_KEY+'='+offsetY+'\\t');options=options+(FurnitureRoomBrandingLogic.OFFSETZ_KEY+'='+offsetZ+'\\t');this.object.model.setValue(RoomWidgetEnumItemExtradataParameter.INFOSTAND_EXTRA_PARAM,RoomWidgetEnumItemExtradataParameter.BRANDING_OPTIONS+options);}},{key:\"processAdUpdate\",value:function processAdUpdate(message){if(!message||!this.object)return;switch(message.type){case ObjectAdUpdateMessage.IMAGE_LOADED:this.object.model.setValue(RoomObjectVariable.FURNITURE_BRANDING_IMAGE_STATUS,1);break;case ObjectAdUpdateMessage.IMAGE_LOADING_FAILED:this.object.model.setValue(RoomObjectVariable.FURNITURE_BRANDING_IMAGE_STATUS,-1);break;}}},{key:\"mouseEvent\",value:function mouseEvent(event,geometry){if(!event||!geometry)return;if(event.type===MouseEventType.MOUSE_MOVE||event.type===MouseEventType.DOUBLE_CLICK)return;_get(_getPrototypeOf(FurnitureRoomBrandingLogic.prototype),\"mouseEvent\",this).call(this,event,geometry);}},{key:\"downloadBackground\",value:function downloadBackground(){var _this2=this;var model=this.object&&this.object.model;if(!model)return;var imageUrl=model.getValue(RoomObjectVariable.FURNITURE_BRANDING_IMAGE_URL);var imageStatus=model.getValue(RoomObjectVariable.FURNITURE_BRANDING_IMAGE_STATUS);if(!imageUrl||imageUrl===''||imageStatus===1)return;if(imageUrl.endsWith('.gif')){this.object.model.setValue(RoomObjectVariable.FURNITURE_BRANDING_IS_ANIMATED,true);fetch(imageUrl).then(function(resp){return resp.arrayBuffer();}).then(function(buff){return parseGIF(buff);}).then(function(gif){var width=gif.lsd.width;var height=gif.lsd.height;var wh=width*height;var frames=decompressFrames(gif,false);var textures=[];var durations=[];var frame=new Uint8Array(wh*4);for(var ind=0;ind<frames.length;ind++){if(ind>0)frame=frame.slice(0);var pixels=frames[ind].pixels;var colorTable=frames[ind].colorTable;var trans=frames[ind].transparentIndex;var dims=frames[ind].dims;for(var j=0;j<dims.height;j++){for(var i=0;i<dims.width;i++){var pixel=pixels[j*dims.width+i];var coord=(j+dims.top)*width+(i+dims.left);if(trans!==pixel){var c=colorTable[pixel];frame[4*coord]=c[0];frame[4*coord+1]=c[1];frame[4*coord+2]=c[2];frame[4*coord+3]=255;}}}var baseTexture=BaseTexture.fromBuffer(frame,width,height);textures.push(new Texture(baseTexture));durations.push(frames[ind].delay);}Nitro.instance.roomEngine.roomContentLoader.createGifCollection(imageUrl,textures,durations);_this2.processUpdateMessage(new ObjectAdUpdateMessage(ObjectAdUpdateMessage.IMAGE_LOADED));}).catch(function(error){_this2.processUpdateMessage(new ObjectAdUpdateMessage(ObjectAdUpdateMessage.IMAGE_LOADING_FAILED));});}else{var asset=Nitro.instance.core&&Nitro.instance.core.asset;if(!asset)return;var texture=asset.getTexture(imageUrl);if(!texture){asset.downloadAsset(imageUrl,function(flag){if(flag){_this2.processUpdateMessage(new ObjectAdUpdateMessage(ObjectAdUpdateMessage.IMAGE_LOADED));}else{_this2.processUpdateMessage(new ObjectAdUpdateMessage(ObjectAdUpdateMessage.IMAGE_LOADING_FAILED));}});return;}this.processUpdateMessage(new ObjectAdUpdateMessage(ObjectAdUpdateMessage.IMAGE_LOADED));}}}]);return FurnitureRoomBrandingLogic;}(FurnitureLogic);FurnitureRoomBrandingLogic.STATE='state';FurnitureRoomBrandingLogic.IMAGEURL_KEY='imageUrl';FurnitureRoomBrandingLogic.CLICKURL_KEY='clickUrl';FurnitureRoomBrandingLogic.OFFSETX_KEY='offsetX';FurnitureRoomBrandingLogic.OFFSETY_KEY='offsetY';FurnitureRoomBrandingLogic.OFFSETZ_KEY='offsetZ';","map":null,"metadata":{},"sourceType":"module"}