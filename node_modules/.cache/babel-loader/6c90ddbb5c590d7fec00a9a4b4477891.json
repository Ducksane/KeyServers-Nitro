{"ast":null,"code":"import _objectSpread from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _createForOfIteratorHelper from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _toConsumableArray from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{RoomCameraWidgetSelectedEffect}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useMemo,useState}from'react';import ReactSlider from'react-slider';import{GetRoomCameraWidgetManager,LocalizeText}from'../../../../api';import{Button,ButtonGroup,Column,Flex,Grid,LayoutImage,NitroCardContentView,NitroCardHeaderView,NitroCardTabsItemView,NitroCardTabsView,NitroCardView,Text}from'../../../../common';import{CameraEditorTabs}from'../../common/CameraEditorTabs';import{CameraPictureThumbnail}from'../../common/CameraPictureThumbnail';import{CameraWidgetEffectListView}from'./effect-list/CameraWidgetEffectListView';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var TABS=[CameraEditorTabs.COLORMATRIX,CameraEditorTabs.COMPOSITE];export var CameraWidgetEditorView=function CameraWidgetEditorView(props){var _props$picture=props.picture,picture=_props$picture===void 0?null:_props$picture,_props$availableEffec=props.availableEffects,availableEffects=_props$availableEffec===void 0?null:_props$availableEffec,_props$myLevel=props.myLevel,myLevel=_props$myLevel===void 0?1:_props$myLevel,_props$onClose=props.onClose,onClose=_props$onClose===void 0?null:_props$onClose,_props$onCancel=props.onCancel,onCancel=_props$onCancel===void 0?null:_props$onCancel,_props$onCheckout=props.onCheckout,onCheckout=_props$onCheckout===void 0?null:_props$onCheckout;var _useState=useState(TABS[0]),_useState2=_slicedToArray(_useState,2),currentTab=_useState2[0],setCurrentTab=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),selectedEffectName=_useState4[0],setSelectedEffectName=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),selectedEffects=_useState6[0],setSelectedEffects=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),effectsThumbnails=_useState8[0],setEffectsThumbnails=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isZoomed=_useState10[0],setIsZoomed=_useState10[1];var getColorMatrixEffects=useMemo(function(){return availableEffects.filter(function(effect){return effect.colorMatrix;});},[availableEffects]);var getCompositeEffects=useMemo(function(){return availableEffects.filter(function(effect){return effect.texture;});},[availableEffects]);var getEffectList=useCallback(function(){if(currentTab===CameraEditorTabs.COLORMATRIX){return getColorMatrixEffects;}return getCompositeEffects;},[currentTab,getColorMatrixEffects,getCompositeEffects]);var getSelectedEffectIndex=useCallback(function(name){if(!name||!name.length||!selectedEffects||!selectedEffects.length)return-1;return selectedEffects.findIndex(function(effect){return effect.effect.name===name;});},[selectedEffects]);var getCurrentEffectIndex=useMemo(function(){return getSelectedEffectIndex(selectedEffectName);},[selectedEffectName,getSelectedEffectIndex]);var getCurrentEffect=useMemo(function(){if(!selectedEffectName)return null;return selectedEffects[getCurrentEffectIndex]||null;},[selectedEffectName,getCurrentEffectIndex,selectedEffects]);var setSelectedEffectAlpha=useCallback(function(alpha){var index=getCurrentEffectIndex;if(index===-1)return;setSelectedEffects(function(prevValue){var clone=_toConsumableArray(prevValue);var currentEffect=clone[index];clone[getCurrentEffectIndex]=new RoomCameraWidgetSelectedEffect(currentEffect.effect,alpha);return clone;});},[getCurrentEffectIndex,setSelectedEffects]);var getCurrentPictureUrl=useMemo(function(){return GetRoomCameraWidgetManager().applyEffects(picture.texture,selectedEffects,isZoomed).src;},[picture,selectedEffects,isZoomed]);var processAction=useCallback(function(type){var effectName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;switch(type){case'close':onClose();return;case'cancel':onCancel();return;case'checkout':onCheckout(getCurrentPictureUrl);return;case'change_tab':setCurrentTab(String(effectName));return;case'select_effect':{var existingIndex=getSelectedEffectIndex(effectName);if(existingIndex>=0)return;var effect=availableEffects.find(function(effect){return effect.name===effectName;});if(!effect)return;setSelectedEffects(function(prevValue){return[].concat(_toConsumableArray(prevValue),[new RoomCameraWidgetSelectedEffect(effect,1)]);});setSelectedEffectName(effect.name);return;}case'remove_effect':{var _existingIndex=getSelectedEffectIndex(effectName);if(_existingIndex===-1)return;setSelectedEffects(function(prevValue){var clone=_toConsumableArray(prevValue);clone.splice(_existingIndex,1);return clone;});if(selectedEffectName===effectName)setSelectedEffectName(null);return;}case'clear_effects':setSelectedEffectName(null);setSelectedEffects([]);return;case'download':{var image=new Image();image.src=getCurrentPictureUrl;var newWindow=window.open('');newWindow.document.write(image.outerHTML);return;}case'zoom':setIsZoomed(!isZoomed);return;}},[isZoomed,availableEffects,selectedEffectName,getCurrentPictureUrl,getSelectedEffectIndex,onCancel,onCheckout,onClose,setIsZoomed,setSelectedEffects]);useEffect(function(){var thumbnails=[];var _iterator=_createForOfIteratorHelper(availableEffects),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var effect=_step.value;thumbnails.push(new CameraPictureThumbnail(effect.name,GetRoomCameraWidgetManager().applyEffects(picture.texture,[new RoomCameraWidgetSelectedEffect(effect,1)],false).src));}}catch(err){_iterator.e(err);}finally{_iterator.f();}setEffectsThumbnails(thumbnails);},[picture,availableEffects]);return/*#__PURE__*/_jsxs(NitroCardView,{className:\"nitro-camera-editor\",children:[/*#__PURE__*/_jsx(NitroCardHeaderView,{headerText:LocalizeText('camera.editor.button.text'),onCloseClick:function onCloseClick(event){return processAction('close');}}),/*#__PURE__*/_jsx(NitroCardTabsView,{children:TABS.map(function(tab){return/*#__PURE__*/_jsx(NitroCardTabsItemView,{isActive:currentTab===tab,onClick:function onClick(event){return processAction('change_tab',tab);},children:/*#__PURE__*/_jsx(\"i\",{className:'icon icon-camera-'+tab})},tab);})}),/*#__PURE__*/_jsx(NitroCardContentView,{children:/*#__PURE__*/_jsxs(Grid,{children:[/*#__PURE__*/_jsx(Column,{size:5,overflow:\"hidden\",children:/*#__PURE__*/_jsx(CameraWidgetEffectListView,{myLevel:myLevel,selectedEffects:selectedEffects,effects:getEffectList(),thumbnails:effectsThumbnails,processAction:processAction})}),/*#__PURE__*/_jsxs(Column,{size:7,justifyContent:\"between\",overflow:\"hidden\",children:[/*#__PURE__*/_jsxs(Column,{center:true,children:[/*#__PURE__*/_jsx(LayoutImage,{imageUrl:getCurrentPictureUrl,className:\"picture-preview\"}),selectedEffectName&&/*#__PURE__*/_jsxs(Column,{center:true,fullWidth:true,gap:1,children:[/*#__PURE__*/_jsx(Text,{style:{color:\"var(--test-galaxytext)\"},variant:\"none\",children:LocalizeText('camera.effect.name.'+selectedEffectName)}),/*#__PURE__*/_jsx(ReactSlider,{className:'nitro-slider',min:0,max:1,step:0.01,value:getCurrentEffect.alpha,onChange:function onChange(event){return setSelectedEffectAlpha(event);},renderThumb:function renderThumb(props,state){return/*#__PURE__*/_jsx(\"div\",_objectSpread(_objectSpread({},props),{},{children:state.valueNow}));}})]})]}),/*#__PURE__*/_jsxs(Flex,{justifyContent:\"between\",children:[/*#__PURE__*/_jsxs(ButtonGroup,{children:[/*#__PURE__*/_jsx(Button,{onClick:function onClick(event){return processAction('clear_effects');},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"trash\"})}),/*#__PURE__*/_jsx(Button,{onClick:function onClick(event){return processAction('download');},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"save\"})}),/*#__PURE__*/_jsx(Button,{onClick:function onClick(event){return processAction('zoom');},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:isZoomed?'search-minus':'search-plus'})})]}),/*#__PURE__*/_jsxs(Flex,{gap:1,children:[/*#__PURE__*/_jsx(Button,{onClick:function onClick(event){return processAction('cancel');},children:LocalizeText('generic.cancel')}),/*#__PURE__*/_jsx(Button,{onClick:function onClick(event){return processAction('checkout');},children:LocalizeText('camera.preview.button.text')})]})]})]})]})})]});};","map":null,"metadata":{},"sourceType":"module"}