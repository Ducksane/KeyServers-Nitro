{"ast":null,"code":"import _classCallCheck from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _get from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/get.js\";import _getPrototypeOf from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js\";import _inherits from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import{RoomObjectVariable}from'../../RoomObjectVariable';import{RoomObjectVisualizationType}from'../../RoomObjectVisualizationType';import{AnimationData}from'../data/AnimationData';import{AnimationFrame}from'../data/AnimationFrame';import{AnimationStateData}from'../data/AnimationStateData';import{FurnitureAnimatedVisualizationData}from'./FurnitureAnimatedVisualizationData';import{FurnitureVisualization}from'./FurnitureVisualization';export var FurnitureAnimatedVisualization=/*#__PURE__*/function(_FurnitureVisualizati){_inherits(FurnitureAnimatedVisualization,_FurnitureVisualizati);var _super=_createSuper(FurnitureAnimatedVisualization);function FurnitureAnimatedVisualization(){var _this;_classCallCheck(this,FurnitureAnimatedVisualization);_this=_super.call(this);_this._data=void 0;_this._state=void 0;_this._frameIncrease=void 0;_this._animationData=void 0;_this._animationScale=void 0;_this._animationChangeTime=void 0;_this._animatedLayerCount=void 0;_this._directionChanged=void 0;_this._state=-1;_this._frameIncrease=1;_this._animationData=new AnimationStateData();_this._animationScale=0;_this._animationChangeTime=0;_this._animatedLayerCount=0;_this._directionChanged=false;return _this;}_createClass(FurnitureAnimatedVisualization,[{key:\"initialize\",value:function initialize(data){if(!(data instanceof FurnitureAnimatedVisualizationData))return false;return _get(_getPrototypeOf(FurnitureAnimatedVisualization.prototype),\"initialize\",this).call(this,data);}},{key:\"dispose\",value:function dispose(){_get(_getPrototypeOf(FurnitureAnimatedVisualization.prototype),\"dispose\",this).call(this);if(this._animationData){this._animationData.dispose();this._animationData=null;}}},{key:\"animatedLayerCount\",get:function get(){return this._animatedLayerCount;}},{key:\"animationId\",get:function get(){return this._animationData.animationId;}},{key:\"getAnimationId\",value:function getAnimationId(animationData){if(this.animationId!==FurnitureAnimatedVisualization.DEFAULT_ANIMATION_ID&&this._data.hasAnimation(this._animationScale,this.animationId))return this.animationId;return FurnitureAnimatedVisualization.DEFAULT_ANIMATION_ID;}},{key:\"updateObject\",value:function updateObject(scale,direction){if(_get(_getPrototypeOf(FurnitureAnimatedVisualization.prototype),\"updateObject\",this).call(this,scale,direction)){var state=this.object.getState(0);if(state!==this._state){this.setAnimation(state);this._state=state;this._animationChangeTime=this.object.model.getValue(RoomObjectVariable.FURNITURE_STATE_UPDATE_TIME)||0;}return true;}return false;}},{key:\"updateModel\",value:function updateModel(scale){if(_get(_getPrototypeOf(FurnitureAnimatedVisualization.prototype),\"updateModel\",this).call(this,scale)){if(this.usesAnimationResetting()){var updateTime=this.object.model.getValue(RoomObjectVariable.FURNITURE_STATE_UPDATE_TIME);if(updateTime>this._animationChangeTime){this._animationChangeTime=updateTime;this.setAnimation(this._state);}}var state=this.object.model.getValue(RoomObjectVariable.FURNITURE_AUTOMATIC_STATE_INDEX);if(!isNaN(state)){var animationId=this._data.getAnimationId(this._animationScale,state);this.setAnimation(animationId);}return true;}return false;}},{key:\"isPlayingTransition\",value:function isPlayingTransition(animationData,animationId){if(!AnimationData.isTransitionFromAnimation(animationData.animationId)&&!AnimationData.isTransitionToAnimation(animationData.animationId))return false;if(animationId!==animationData.animationAfterTransitionId)return false;if(animationData.animationOver)return false;return true;}},{key:\"getCurrentState\",value:function getCurrentState(animationData){var animationId=animationData.animationId;if(!AnimationData.isTransitionFromAnimation(animationId)&&!AnimationData.isTransitionToAnimation(animationId))return animationId;return animationData.animationAfterTransitionId;}},{key:\"setAnimation\",value:function setAnimation(animationId){if(!this._data)return;this.setSubAnimation(this._animationData,animationId,this._state>=0);}},{key:\"setSubAnimation\",value:function setSubAnimation(animationData,animationId){var _arg_3=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var currentAnimation=animationData.animationId;if(_arg_3){if(this.isPlayingTransition(animationData,animationId))return false;var state=this.getCurrentState(animationData);if(animationId!==state){if(!this._data.isImmediateChange(this._animationScale,animationId,state)){var transition=AnimationData.getTransitionFromAnimationId(state);if(this._data.hasAnimation(this._animationScale,transition)){animationData.animationAfterTransitionId=animationId;animationId=transition;}else{transition=AnimationData.getTransitionToAnimationId(animationId);if(this._data.hasAnimation(this._animationScale,transition)){animationData.animationAfterTransitionId=animationId;animationId=transition;}}}}else{if(AnimationData.isTransitionFromAnimation(animationData.animationId)){var _transition=AnimationData.getTransitionToAnimationId(animationId);if(this._data.hasAnimation(this._animationScale,_transition)){animationData.animationAfterTransitionId=animationId;animationId=_transition;}}else if(!AnimationData.isTransitionToAnimation(animationData.animationId)){if(this.usesAnimationResetting()){var _transition2=AnimationData.getTransitionFromAnimationId(state);if(this._data.hasAnimation(this._animationScale,_transition2)){animationData.animationAfterTransitionId=animationId;animationId=_transition2;}else{var _transition3=AnimationData.getTransitionToAnimationId(animationId);if(this._data.hasAnimation(this._animationScale,_transition3)){animationData.animationAfterTransitionId=animationId;animationId=_transition3;}}}}}}if(currentAnimation!==animationId){animationData.animationId=animationId;return true;}return false;}},{key:\"getLastFramePlayed\",value:function getLastFramePlayed(layerId){return this._animationData.getLastFramePlayed(layerId);}},{key:\"resetAllAnimationFrames\",value:function resetAllAnimationFrames(){if(!this._animationData)return;this._animationData.setLayerCount(this._animatedLayerCount);}},{key:\"updateAnimation\",value:function updateAnimation(scale){if(!this._data)return 0;if(scale!==this._animationScale){this._animationScale=scale;this._animatedLayerCount=this._data.getLayerCount(scale);this.resetAllAnimationFrames();}var update=this.updateAnimations(scale);this._directionChanged=false;return update;}},{key:\"updateAnimations\",value:function updateAnimations(scale){if(this._animationData.animationOver&&!this._directionChanged)return 0;var update=this.updateFramesForAnimation(this._animationData,scale);if(this._animationData.animationOver){if(AnimationData.isTransitionFromAnimation(this._animationData.animationId)||AnimationData.isTransitionToAnimation(this._animationData.animationId)){this.setAnimation(this._animationData.animationAfterTransitionId);this._animationData.animationOver=false;}}return update;}},{key:\"updateFramesForAnimation\",value:function updateFramesForAnimation(animationData,scale){if(animationData.animationOver&&!this._directionChanged)return 0;var animationId=this.getAnimationId(animationData);var frameCount=animationData.frameCounter;if(!frameCount)frameCount=this._data.getStartFrame(scale,animationId,this._direction);frameCount+=this.frameIncrease;animationData.frameCounter=frameCount;animationData.animationOver=true;var animationPlayed=false;var layerId=this._animatedLayerCount-1;var update=0;var layerUpdate=1<<this._animatedLayerCount-1;while(layerId>=0){var sequenceId=0;animationPlayed=animationData.getAnimationPlayed(layerId);if(!animationPlayed||this._directionChanged){var lastFramePlayed=animationData.getLastFramePlayed(layerId);var frame=animationData.getFrame(layerId);if(frame){if(frame.isLastFrame&&frame.remainingFrameRepeats<=this.frameIncrease){lastFramePlayed=true;}}if(this._directionChanged||!frame||frame.remainingFrameRepeats>=0&&(frame.remainingFrameRepeats=frame.remainingFrameRepeats-this.frameIncrease)<=0){sequenceId=AnimationFrame.SEQUENCE_NOT_DEFINED;if(frame)sequenceId=frame.activeSequence;if(sequenceId===AnimationFrame.SEQUENCE_NOT_DEFINED){frame=this._data.getFrame(scale,animationId,this._direction,layerId,frameCount);}else{frame=this._data.getFrameFromSequence(scale,animationId,this._direction,layerId,sequenceId,frame.activeSequenceOffset+frame.repeats,frameCount);}animationData.setFrame(layerId,frame);update=update|layerUpdate;}if(!frame||frame.remainingFrameRepeats==AnimationFrame.FRAME_REPEAT_FOREVER){lastFramePlayed=true;animationPlayed=true;}else{animationData.animationOver=false;}animationData.setLastFramePlayed(layerId,lastFramePlayed);animationData.setAnimationPlayed(layerId,animationPlayed);}layerUpdate=layerUpdate>>1;layerId--;}return update;}},{key:\"getFrameNumber\",value:function getFrameNumber(scale,layerId){var currentFrame=this._animationData.getFrame(layerId);if(!currentFrame)return _get(_getPrototypeOf(FurnitureAnimatedVisualization.prototype),\"getFrameNumber\",this).call(this,scale,layerId);return currentFrame.id;}},{key:\"getLayerXOffset\",value:function getLayerXOffset(scale,direction,layerId){var offset=_get(_getPrototypeOf(FurnitureAnimatedVisualization.prototype),\"getLayerXOffset\",this).call(this,scale,direction,layerId);var currentFrame=this._animationData.getFrame(layerId);if(!currentFrame)return offset;return offset+currentFrame.x;}},{key:\"getLayerYOffset\",value:function getLayerYOffset(scale,direction,layerId){var offset=_get(_getPrototypeOf(FurnitureAnimatedVisualization.prototype),\"getLayerYOffset\",this).call(this,scale,direction,layerId);var currentFrame=this._animationData.getFrame(layerId);if(!currentFrame)return offset;return offset+currentFrame.y;}},{key:\"usesAnimationResetting\",value:function usesAnimationResetting(){return false;}},{key:\"setDirection\",value:function setDirection(direction){if(this._direction===direction)return;_get(_getPrototypeOf(FurnitureAnimatedVisualization.prototype),\"setDirection\",this).call(this,direction);this._directionChanged=true;}},{key:\"frameIncrease\",get:function get(){return this._frameIncrease;}}]);return FurnitureAnimatedVisualization;}(FurnitureVisualization);FurnitureAnimatedVisualization.TYPE=RoomObjectVisualizationType.FURNITURE_ANIMATED;FurnitureAnimatedVisualization.DEFAULT_ANIMATION_ID=0;","map":null,"metadata":{},"sourceType":"module"}