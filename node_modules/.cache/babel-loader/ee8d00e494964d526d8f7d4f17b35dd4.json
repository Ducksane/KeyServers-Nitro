{"ast":null,"code":"import _createForOfIteratorHelper from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _classCallCheck from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createClass.js\";import{Texture}from'@pixi/core';import{ColorMatrixFilter}from'@pixi/filter-color-matrix';import{Rectangle}from'@pixi/math';import{Sprite}from'@pixi/sprite';import{NitroContainer,NitroSprite}from'../../core';import{AdvancedMap}from'../../core/utils/AdvancedMap';import{PaletteMapFilter}from'../../core/utils/PaletteMapFilter';import{TextureUtils}from'../../room/utils/TextureUtils';import{Nitro}from'../Nitro';import{ActiveActionData}from'./actions/ActiveActionData';import{AvatarFigureContainer}from'./AvatarFigureContainer';import{AvatarImageCache}from'./cache/AvatarImageCache';import{AvatarAction}from'./enum/AvatarAction';import{AvatarDirectionAngle}from'./enum/AvatarDirectionAngle';import{AvatarScaleType}from'./enum/AvatarScaleType';import{AvatarSetType}from'./enum/AvatarSetType';export var AvatarImage=/*#__PURE__*/function(){function AvatarImage(k,_arg_2,_arg_3,_arg_4,_arg_5){var _arg_6=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;_classCallCheck(this,AvatarImage);this._structure=void 0;this._scale=void 0;this._mainDirection=void 0;this._headDirection=void 0;this._mainAction=void 0;this._disposed=void 0;this._canvasOffsets=void 0;this._assets=void 0;this._cache=void 0;this._figure=void 0;this._avatarSpriteData=void 0;this._actions=void 0;this._image=void 0;this._reusableTexture=void 0;this._defaultAction=void 0;this._frameCounter=0;this._directionOffset=0;this._changes=void 0;this._sprites=void 0;this._isAnimating=false;this._animationHasResetOnToggle=false;this._actionsSorted=false;this._sortedActions=void 0;this._lastActionsString=void 0;this._currentActionsString=void 0;this._fullImageCache=void 0;this._fullImageCacheSize=5;this._isCachedImage=false;this._useFullImageCache=false;this._effectIdInUse=-1;this._animationFrameCount=void 0;this._cachedBodyParts=void 0;this._cachedBodyPartsDirection=-1;this._cachedBodyPartsGeometryType=null;this._cachedBodyPartsAvatarSet=null;this._effectManager=void 0;this._effectListener=void 0;this._canvasOffsets=[];this._actions=[];this._cachedBodyParts=[];this._changes=true;this._disposed=false;this._effectManager=_arg_5;this._structure=k;this._assets=_arg_2;this._scale=_arg_4;this._effectListener=_arg_6;if(this._scale==null){this._scale=AvatarScaleType.LARGE;}if(_arg_3==null){_arg_3=new AvatarFigureContainer('hr-893-45.hd-180-2.ch-210-66.lg-270-82.sh-300-91.wa-2007-.ri-1-');}this._figure=_arg_3;this._cache=new AvatarImageCache(this._structure,this,this._assets,this._scale);this.setDirection(AvatarImage.DEFAULT_AVATAR_SET,AvatarImage.DEFAULT_DIRECTION);this._actions=[];this._defaultAction=new ActiveActionData(AvatarAction.POSTURE_STAND);this._defaultAction.definition=this._structure.getActionDefinition(AvatarImage.DEFAULT_ACTION);this.resetActions();this._fullImageCache=new AdvancedMap();this._animationFrameCount=0;}_createClass(AvatarImage,[{key:\"getServerRenderData\",value:function getServerRenderData(){this.getAvatarPartsForCamera(AvatarSetType.FULL);return this._cache.getServerRenderData();}},{key:\"dispose\",value:function dispose(){if(this._disposed)return;this._structure=null;this._assets=null;this._mainAction=null;this._figure=null;this._avatarSpriteData=null;this._actions=null;if(this._image){this._image.destroy();this._image=null;}if(this._cache){this._cache.dispose();this._cache=null;}if(this._fullImageCache){var _iterator=_createForOfIteratorHelper(this._fullImageCache.getValues()),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var k=_step.value;k&&k.destroy();}}catch(err){_iterator.e(err);}finally{_iterator.f();}this._fullImageCache=null;}this._image=null;this._canvasOffsets=null;this._disposed=true;}},{key:\"disposed\",get:function get(){return this._disposed;}},{key:\"getFigure\",value:function getFigure(){return this._figure;}},{key:\"getScale\",value:function getScale(){return this._scale;}},{key:\"getPartColor\",value:function getPartColor(k){return this._structure.getPartColor(this._figure,k);}},{key:\"setDirection\",value:function setDirection(k,_arg_2){_arg_2=_arg_2+this._directionOffset;if(_arg_2<AvatarDirectionAngle.MIN_DIRECTION){_arg_2=AvatarDirectionAngle.MAX_DIRECTION+(_arg_2+1);}if(_arg_2>AvatarDirectionAngle.MAX_DIRECTION){_arg_2=_arg_2-(AvatarDirectionAngle.MAX_DIRECTION+1);}if(this._structure.isMainAvatarSet(k)){this._mainDirection=_arg_2;}if(k===AvatarSetType.HEAD||k===AvatarSetType.FULL){if(k===AvatarSetType.HEAD&&this.isHeadTurnPreventedByAction()){_arg_2=this._mainDirection;}this._headDirection=_arg_2;}this._cache.setDirection(k,_arg_2);this._changes=true;}},{key:\"setDirectionAngle\",value:function setDirectionAngle(k,_arg_2){this.setDirection(k,Math.floor(_arg_2/45));}},{key:\"getSprites\",value:function getSprites(){return this._sprites;}},{key:\"getCanvasOffsets\",value:function getCanvasOffsets(){return this._canvasOffsets;}},{key:\"getLayerData\",value:function getLayerData(k){return this._structure.getBodyPartData(k.animation.id,this._frameCounter,k.id);}},{key:\"updateAnimationByFrames\",value:function updateAnimationByFrames(){var k=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;this._frameCounter+=k;this._changes=true;}},{key:\"resetAnimationFrameCounter\",value:function resetAnimationFrameCounter(){this._frameCounter=0;this._changes=true;}},{key:\"getFullImageCacheKey\",value:function getFullImageCacheKey(){if(!this._useFullImageCache)return null;if(this._sortedActions.length==1&&this._mainDirection==this._headDirection){return this._mainDirection+this._currentActionsString+this._frameCounter%4;}if(this._sortedActions.length==2){var _iterator2=_createForOfIteratorHelper(this._sortedActions),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var k=_step2.value;if(k.actionType=='fx'&&(k.actionParameter=='33'||k.actionParameter=='34'||k.actionParameter=='35'||k.actionParameter=='36')){return this._mainDirection+this._currentActionsString+0;}if(k.actionType=='fx'&&(k.actionParameter=='38'||k.actionParameter=='39')){return this._mainDirection+'_'+this._headDirection+this._currentActionsString+this._frameCounter%11;}if(k.actionType==='dance'&&(k.actionParameter==='1'||k.actionParameter==='2'||k.actionParameter==='3'||k.actionParameter==='4')){var frame=this._frameCounter%8;if(k.actionParameter==='3')frame=this._frameCounter%10;if(k.actionParameter==='4')frame=this._frameCounter%16;return this._mainDirection+k.actionType+k.actionParameter+frame;}}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}}return null;}},{key:\"getBodyParts\",value:function getBodyParts(k,_arg_2,_arg_3){if(!(_arg_3==this._cachedBodyPartsDirection)||!(_arg_2==this._cachedBodyPartsGeometryType)||!(k==this._cachedBodyPartsAvatarSet)){this._cachedBodyPartsDirection=_arg_3;this._cachedBodyPartsGeometryType=_arg_2;this._cachedBodyPartsAvatarSet=k;this._cachedBodyParts=this._structure.getBodyParts(k,_arg_2,_arg_3);}return this._cachedBodyParts;}},{key:\"getAvatarPartsForCamera\",value:function getAvatarPartsForCamera(k){var _local_4;if(this._mainAction==null){return;}var _local_2=this._structure.getCanvas(this._scale,this._mainAction.definition.geometryType);if(_local_2==null){return;}var _local_3=this.getBodyParts(k,this._mainAction.definition.geometryType,this._mainDirection);var _local_6=_local_3.length-1;while(_local_6>=0){_local_4=_local_3[_local_6];var _local_5=this._cache.getImageContainer(_local_4,this._frameCounter,true);_local_6--;}}},{key:\"getImage\",value:function getImage(setType,hightlight){var scale=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var cache=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;if(!this._changes)return this._image;if(!this._mainAction)return null;if(!this._actionsSorted)this.endActionAppends();var avatarCanvas=this._structure.getCanvas(this._scale,this._mainAction.definition.geometryType);if(!avatarCanvas)return null;if(this._image&&(this._image.width!==avatarCanvas.width||this._image.height!==avatarCanvas.height)){if(this._reusableTexture){this._reusableTexture.destroy(true);this._reusableTexture=null;}this._image=null;this._isCachedImage=false;}var _local_6=this.getBodyParts(setType,this._mainAction.definition.geometryType,this._mainDirection);this._image=null;var container=new NitroContainer();var isCachable=true;var partCount=_local_6.length-1;while(partCount>=0){var set=_local_6[partCount];var part=this._cache.getImageContainer(set,this._frameCounter);if(part){var partCacheContainer=part.image;if(!partCacheContainer){container.destroy({children:true});return null;}isCachable=isCachable&&part.isCacheable;var point=part.regPoint.clone();if(point){point.x+=avatarCanvas.offset.x;point.y+=avatarCanvas.offset.y;point.x+=avatarCanvas.regPoint.x;point.y+=avatarCanvas.regPoint.y;var partContainer=new NitroContainer();partContainer.addChild(partCacheContainer);if(partContainer){partContainer.position.set(point.x,point.y);container.addChild(partContainer);}}}partCount--;}if(this._avatarSpriteData){if(!container.filters)container.filters=[];if(this._avatarSpriteData.colorTransform)container.filters.push(this._avatarSpriteData.colorTransform);if(this._avatarSpriteData.paletteIsGrayscale){this.convertToGrayscale(container);container.filters.push(new PaletteMapFilter(this._avatarSpriteData.reds,PaletteMapFilter.CHANNEL_RED));}}if(!cache){return TextureUtils.generateTexture(container,new Rectangle(0,0,avatarCanvas.width,avatarCanvas.height));}if(this._reusableTexture){Nitro.instance.renderer.render(container,{renderTexture:this._reusableTexture,clear:true});}else{this._reusableTexture=TextureUtils.generateTexture(container,new Rectangle(0,0,avatarCanvas.width,avatarCanvas.height));}if(!this._reusableTexture)return null;/*\n        if(this._avatarSpriteData)\n        {\n            if(this._avatarSpriteData.paletteIsGrayscale)\n            {\n                this._reusableTexture = this.applyPalette(this._reusableTexture, this._avatarSpriteData.reds, [], []);\n            }\n        }\n        */this._image=this._reusableTexture;this._changes=false;return this._image;}},{key:\"applyPalette\",value:function applyPalette(texture){var reds=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var greens=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var blues=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];var textureCanvas=TextureUtils.generateCanvas(texture);var textureCtx=textureCanvas.getContext('2d');var textureImageData=textureCtx.getImageData(0,0,textureCanvas.width,textureCanvas.height);var data=textureImageData.data;for(var i=0;i<data.length;i+=4){if(reds.length==256){var paletteColor=reds[data[i]];if(paletteColor===undefined)paletteColor=0;data[i]=paletteColor>>16&0xFF;data[i+1]=paletteColor>>8&0xFF;data[i+2]=paletteColor&0xFF;}if(greens.length==256){var _paletteColor=greens[data[i+1]];if(_paletteColor===undefined)_paletteColor=0;data[i]=_paletteColor>>16&0xFF;data[i+1]=_paletteColor>>8&0xFF;data[i+2]=_paletteColor&0xFF;}if(blues.length==256){var _paletteColor2=greens[data[i+2]];if(_paletteColor2===undefined)_paletteColor2=0;data[i]=_paletteColor2>>16&0xFF;data[i+1]=_paletteColor2>>8&0xFF;data[i+2]=_paletteColor2&0xFF;}}textureCtx.putImageData(textureImageData,0,0);var newTexture=new Sprite(Texture.from(textureCanvas));Nitro.instance.renderer.render(newTexture,{renderTexture:texture,clear:true});return texture;}},{key:\"getImageAsSprite\",value:function getImageAsSprite(setType){var scale=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;if(!this._mainAction)return null;if(!this._actionsSorted)this.endActionAppends();var avatarCanvas=this._structure.getCanvas(this._scale,this._mainAction.definition.geometryType);if(!avatarCanvas)return null;var setTypes=this.getBodyParts(setType,this._mainAction.definition.geometryType,this._mainDirection);var container=new NitroSprite();var sprite=new NitroSprite(Texture.EMPTY);sprite.width=avatarCanvas.width;sprite.height=avatarCanvas.height;container.addChild(sprite);var partCount=setTypes.length-1;while(partCount>=0){var set=setTypes[partCount];var part=this._cache.getImageContainer(set,this._frameCounter);if(part){var partCacheContainer=part.image;if(!partCacheContainer){container.destroy({children:true});return null;}var point=part.regPoint.clone();if(point){point.x+=avatarCanvas.offset.x;point.y+=avatarCanvas.offset.y;point.x+=avatarCanvas.regPoint.x;point.y+=avatarCanvas.regPoint.y;var partContainer=new NitroContainer();partContainer.addChild(partCacheContainer);partContainer.position.set(point.x,point.y);container.addChild(partContainer);}}partCount--;}return container;}},{key:\"getCroppedImage\",value:function getCroppedImage(setType){var scale=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;if(!this._mainAction)return null;if(!this._actionsSorted)this.endActionAppends();var avatarCanvas=this._structure.getCanvas(this._scale,this._mainAction.definition.geometryType);if(!avatarCanvas)return null;var setTypes=this.getBodyParts(setType,this._mainAction.definition.geometryType,this._mainDirection);var container=new NitroContainer();var partCount=setTypes.length-1;while(partCount>=0){var set=setTypes[partCount];var part=this._cache.getImageContainer(set,this._frameCounter);if(part){var partCacheContainer=part.image;if(!partCacheContainer){container.destroy({children:true});return null;}var point=part.regPoint.clone();if(point){point.x+=avatarCanvas.offset.x;point.y+=avatarCanvas.offset.y;point.x+=avatarCanvas.regPoint.x;point.y+=avatarCanvas.regPoint.y;var partContainer=new NitroContainer();partContainer.addChild(partCacheContainer);if(partContainer){partContainer.position.set(point.x,point.y);container.addChild(partContainer);}}}partCount--;}var texture=TextureUtils.generateTexture(container,new Rectangle(0,0,avatarCanvas.width,avatarCanvas.height));var image=TextureUtils.generateImage(texture);if(!image)return null;return image;}},{key:\"getFullImage\",value:function getFullImage(k){var existing=this._fullImageCache.getValue(k);if(existing){if(!existing.valid){this._fullImageCache.remove(k);existing.destroy(true);}return existing;}return null;}},{key:\"cacheFullImage\",value:function cacheFullImage(k,_arg_2){var existing=this._fullImageCache.getValue(k);if(existing){this._fullImageCache.remove(k);existing.destroy(true);}if(this._fullImageCache.length===this._fullImageCacheSize){var oldestKey=this._fullImageCache.getKey(0);if(oldestKey){var removed=this._fullImageCache.remove(oldestKey);removed.destroy(true);}}this._fullImageCache.add(k,_arg_2);}},{key:\"getAsset\",value:function getAsset(k){return this._assets.getAsset(k);}},{key:\"getDirection\",value:function getDirection(){return this._mainDirection;}},{key:\"initActionAppends\",value:function initActionAppends(){this._actions=[];this._actionsSorted=false;this._currentActionsString='';this._useFullImageCache=false;}},{key:\"endActionAppends\",value:function endActionAppends(){var k;if(!this.sortActions())return;var _iterator3=_createForOfIteratorHelper(this._sortedActions),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var _k=_step3.value;if(_k.actionType===AvatarAction.EFFECT){if(!this._effectManager.isAvatarEffectReady(parseInt(_k.actionParameter)))this._effectManager.downloadAvatarEffect(parseInt(_k.actionParameter),this);}}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}this.resetActions();this.setActionsToParts();}},{key:\"appendAction\",value:function appendAction(k){var _args$;var _local_3='';this._actionsSorted=false;for(var _len=arguments.length,_args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){_args[_key-1]=arguments[_key];}if(_args&&_args.length>0)_local_3=(_args$=_args[0])===null||_args$===void 0?void 0:_args$.toString();switch(k){case AvatarAction.POSTURE:switch(_local_3){case AvatarAction.POSTURE_LAY:if(this._mainDirection==0){this.setDirection(AvatarSetType.FULL,4);}else{this.setDirection(AvatarSetType.FULL,2);}// eslint-disable-next-line no-fallthrough\ncase AvatarAction.POSTURE_WALK:this._useFullImageCache=true;// eslint-disable-next-line no-fallthrough\ncase AvatarAction.POSTURE_STAND:this._useFullImageCache=true;// eslint-disable-next-line no-fallthrough\ncase AvatarAction.POSTURE_SWIM:case AvatarAction.POSTURE_FLOAT:case AvatarAction.POSTURE_SIT:case AvatarAction.SNOWWAR_RUN:case AvatarAction.SNOWWAR_DIE_FRONT:case AvatarAction.SNOWWAR_DIE_BACK:case AvatarAction.SNOWWAR_PICK:case AvatarAction.SNOWWAR_THROW:this.addActionData(_local_3);break;}break;case AvatarAction.GESTURE:switch(_local_3){case AvatarAction.GESTURE_AGGRAVATED:case AvatarAction.GESTURE_SAD:case AvatarAction.GESTURE_SMILE:case AvatarAction.GESTURE_SURPRISED:this.addActionData(_local_3);break;}break;case AvatarAction.EFFECT:if(_local_3==='33'||_local_3==='34'||_local_3==='35'||_local_3==='36'||_local_3==='38'||_local_3==='39'){this._useFullImageCache=true;}// eslint-disable-next-line no-fallthrough\ncase AvatarAction.DANCE:case AvatarAction.TALK:case AvatarAction.EXPRESSION_WAVE:case AvatarAction.SLEEP:case AvatarAction.SIGN:case AvatarAction.EXPRESSION_RESPECT:case AvatarAction.EXPRESSION_BLOW_A_KISS:case AvatarAction.EXPRESSION_LAUGH:case AvatarAction.EXPRESSION_CRY:case AvatarAction.EXPRESSION_IDLE:case AvatarAction.EXPRESSION_SNOWBOARD_OLLIE:case AvatarAction.EXPRESSION_SNOWBORD_360:case AvatarAction.EXPRESSION_RIDE_JUMP:this.addActionData(k,_local_3);break;case AvatarAction.CARRY_OBJECT:case AvatarAction.USE_OBJECT:{var _local_4=this._structure.getActionDefinitionWithState(k);if(_local_4)_local_3=_local_4.getParameterValue(_local_3);this.addActionData(k,_local_3);break;}}return true;}},{key:\"addActionData\",value:function addActionData(k){var _arg_2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'';var _local_3;if(!this._actions)this._actions=[];var _local_4=0;while(_local_4<this._actions.length){_local_3=this._actions[_local_4];if(_local_3.actionType==k&&_local_3.actionParameter==_arg_2){return;}_local_4++;}this._actions.push(new ActiveActionData(k,_arg_2,this._frameCounter));}},{key:\"isAnimating\",value:function isAnimating(){return this._isAnimating||this._animationFrameCount>1;}},{key:\"resetActions\",value:function resetActions(){this._animationHasResetOnToggle=false;this._isAnimating=false;this._sprites=[];this._avatarSpriteData=null;this._directionOffset=0;this._structure.removeDynamicItems(this);this._mainAction=this._defaultAction;this._mainAction.definition=this._defaultAction.definition;this.resetBodyPartCache(this._defaultAction);return true;}},{key:\"isHeadTurnPreventedByAction\",value:function isHeadTurnPreventedByAction(){var _local_2;var _local_3;var k;if(this._sortedActions==null){return false;}var _iterator4=_createForOfIteratorHelper(this._sortedActions),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var _local_=_step4.value;_local_2=this._structure.getActionDefinitionWithState(_local_.actionType);if(!(_local_2==null)&&_local_2.getPreventHeadTurn(_local_.actionParameter)){k=true;}}}catch(err){_iterator4.e(err);}finally{_iterator4.f();}return k;}},{key:\"sortActions\",value:function sortActions(){var _local_2;var _local_3;var _local_4;var _local_5;var k;this._currentActionsString='';this._sortedActions=this._structure.sortActions(this._actions);this._animationFrameCount=this._structure.maxFrames(this._sortedActions);if(!this._sortedActions){this._canvasOffsets=[0,0,0];if(this._lastActionsString!==''){k=true;this._lastActionsString='';}}else{this._canvasOffsets=this._structure.getCanvasOffsets(this._sortedActions,this._scale,this._mainDirection);var _iterator5=_createForOfIteratorHelper(this._sortedActions),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var _local_7=_step5.value;this._currentActionsString=this._currentActionsString+(_local_7.actionType+_local_7.actionParameter);if(_local_7.actionType===AvatarAction.EFFECT){var _local_8=parseInt(_local_7.actionParameter);if(this._effectIdInUse!==_local_8)_local_2=true;this._effectIdInUse=_local_8;_local_3=true;}}}catch(err){_iterator5.e(err);}finally{_iterator5.f();}if(!_local_3){if(this._effectIdInUse>-1)_local_2=true;this._effectIdInUse=-1;}if(_local_2)this._cache.disposeInactiveActions(0);if(this._lastActionsString!=this._currentActionsString){k=true;this._lastActionsString=this._currentActionsString;}}this._actionsSorted=true;return k;}},{key:\"setActionsToParts\",value:function setActionsToParts(){if(!this._sortedActions==null)return;var _local_3=Nitro.instance.time;var _local_4=[];var _iterator6=_createForOfIteratorHelper(this._sortedActions),_step6;try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var k=_step6.value;_local_4.push(k.actionType);}}catch(err){_iterator6.e(err);}finally{_iterator6.f();}var _iterator7=_createForOfIteratorHelper(this._sortedActions),_step7;try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var _k2=_step7.value;if(_k2&&_k2.definition&&_k2.definition.isAnimation){var _local_2=this._structure.getAnimation(_k2.definition.state+'.'+_k2.actionParameter);if(_local_2&&_local_2.hasOverriddenActions()){var _local_5=_local_2.overriddenActionNames();if(_local_5){var _iterator9=_createForOfIteratorHelper(_local_5),_step9;try{for(_iterator9.s();!(_step9=_iterator9.n()).done;){var _local_6=_step9.value;if(_local_4.indexOf(_local_6)>=0)_k2.overridingAction=_local_2.overridingAction(_local_6);}}catch(err){_iterator9.e(err);}finally{_iterator9.f();}}}if(_local_2&&_local_2.resetOnToggle){this._animationHasResetOnToggle=true;}}}}catch(err){_iterator7.e(err);}finally{_iterator7.f();}var _iterator8=_createForOfIteratorHelper(this._sortedActions),_step8;try{for(_iterator8.s();!(_step8=_iterator8.n()).done;){var _k3=_step8.value;if(!(!_k3||!_k3.definition)){if(_k3.definition.isAnimation&&_k3.actionParameter==='')_k3.actionParameter='1';this.setActionToParts(_k3,_local_3);if(_k3.definition.isAnimation){this._isAnimating=_k3.definition.isAnimated(_k3.actionParameter);var _local_9=this._structure.getAnimation(_k3.definition.state+'.'+_k3.actionParameter);if(_local_9){this._sprites=this._sprites.concat(_local_9.spriteData);if(_local_9.hasDirectionData())this._directionOffset=_local_9.directionData.offset;if(_local_9.hasAvatarData())this._avatarSpriteData=_local_9.avatarData;}}}}}catch(err){_iterator8.e(err);}finally{_iterator8.f();}}},{key:\"setActionToParts\",value:function setActionToParts(k,_arg_2){if(k==null||k.definition==null){return;}if(k.definition.assetPartDefinition==''){return;}if(k.definition.isMain){this._mainAction=k;this._cache.setGeometryType(k.definition.geometryType);}this._cache.setAction(k,_arg_2);this._changes=true;}},{key:\"resetBodyPartCache\",value:function resetBodyPartCache(k){if(!k)return;if(k.definition.assetPartDefinition==='')return;if(k.definition.isMain){this._mainAction=k;this._cache.setGeometryType(k.definition.geometryType);}this._cache.resetBodyPartCache(k);this._changes=true;}},{key:\"avatarSpriteData\",get:function get(){return this._avatarSpriteData;}},{key:\"convertToGrayscale\",value:function convertToGrayscale(container){var channel=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'CHANNELS_EQUAL';var _local_3=0.33;var _local_4=0.33;var _local_5=0.33;var _local_6=1;switch(channel){case AvatarImage.CHANNELS_UNIQUE:_local_3=0.3;_local_4=0.59;_local_5=0.11;break;case AvatarImage.CHANNELS_RED:_local_3=1;_local_4=0;_local_5=0;break;case AvatarImage.CHANNELS_GREEN:_local_3=0;_local_4=1;_local_5=0;break;case AvatarImage.CHANNELS_BLUE:_local_3=0;_local_4=0;_local_5=1;break;case AvatarImage.CHANNELS_DESATURATED:_local_3=0.3086;_local_4=0.6094;_local_5=0.082;break;}var colorFilter=new ColorMatrixFilter();colorFilter.matrix=[_local_3,_local_4,_local_5,0,0,_local_3,_local_4,_local_5,0,0,_local_3,_local_4,_local_5,0,0,0,0,0,1,0];container.filters.push(colorFilter);return container;}},{key:\"errorThis\",value:function errorThis(k){}},{key:\"logThis\",value:function logThis(k){}},{key:\"isPlaceholder\",value:function isPlaceholder(){return false;}},{key:\"forceActionUpdate\",value:function forceActionUpdate(){this._lastActionsString='';}},{key:\"animationHasResetOnToggle\",get:function get(){return this._animationHasResetOnToggle;}},{key:\"mainAction\",get:function get(){return this._mainAction.actionType;}},{key:\"resetEffect\",value:function resetEffect(effect){if(effect===this._effectIdInUse){this.resetActions();this.setActionsToParts();this._animationHasResetOnToggle=true;this._changes=true;if(this._effectListener)this._effectListener.resetEffect(effect);}}}]);return AvatarImage;}();AvatarImage.CHANNELS_EQUAL='CHANNELS_EQUAL';AvatarImage.CHANNELS_UNIQUE='CHANNELS_UNIQUE';AvatarImage.CHANNELS_RED='CHANNELS_RED';AvatarImage.CHANNELS_GREEN='CHANNELS_GREEN';AvatarImage.CHANNELS_BLUE='CHANNELS_BLUE';AvatarImage.CHANNELS_DESATURATED='CHANNELS_DESATURATED';AvatarImage.DEFAULT_ACTION='Default';AvatarImage.DEFAULT_DIRECTION=2;AvatarImage.DEFAULT_AVATAR_SET=AvatarSetType.FULL;","map":null,"metadata":{},"sourceType":"module"}