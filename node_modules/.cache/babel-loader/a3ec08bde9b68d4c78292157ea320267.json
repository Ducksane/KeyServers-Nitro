{"ast":null,"code":"import _createForOfIteratorHelper from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _slicedToArray from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{MouseEventType,TouchEventType}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useRef,useState}from'react';import{createPortal}from'react-dom';import{Base}from'..';import{DraggableWindowPosition}from'./DraggableWindowPosition';import{jsx as _jsx}from\"react/jsx-runtime\";var CURRENT_WINDOWS=[];var POS_MEMORY=new Map();var BOUNDS_THRESHOLD_TOP=0;var BOUNDS_THRESHOLD_LEFT=0;export var DraggableWindow=function DraggableWindow(props){var _props$uniqueKey=props.uniqueKey,uniqueKey=_props$uniqueKey===void 0?null:_props$uniqueKey,_props$handleSelector=props.handleSelector,handleSelector=_props$handleSelector===void 0?'.drag-handler':_props$handleSelector,_props$windowPosition=props.windowPosition,windowPosition=_props$windowPosition===void 0?DraggableWindowPosition.CENTER:_props$windowPosition,_props$disableDrag=props.disableDrag,disableDrag=_props$disableDrag===void 0?false:_props$disableDrag,_props$dragStyle=props.dragStyle,dragStyle=_props$dragStyle===void 0?{}:_props$dragStyle,_props$children=props.children,children=_props$children===void 0?null:_props$children,_props$offsetLeft=props.offsetLeft,offsetLeft=_props$offsetLeft===void 0?0:_props$offsetLeft,_props$offsetTop=props.offsetTop,offsetTop=_props$offsetTop===void 0?0:_props$offsetTop;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),delta=_useState2[0],setDelta=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),offset=_useState4[0],setOffset=_useState4[1];var _useState5=useState({x:0,y:0}),_useState6=_slicedToArray(_useState5,2),start=_useState6[0],setStart=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isDragging=_useState8[0],setIsDragging=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),dragHandler=_useState10[0],setDragHandler=_useState10[1];var elementRef=useRef();var bringToTop=useCallback(function(){var zIndex=400;var _iterator=_createForOfIteratorHelper(CURRENT_WINDOWS),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var existingWindow=_step.value;zIndex+=1;existingWindow.style.zIndex=zIndex.toString();}}catch(err){_iterator.e(err);}finally{_iterator.f();}},[]);var moveCurrentWindow=useCallback(function(){var index=CURRENT_WINDOWS.indexOf(elementRef.current);if(index===-1){CURRENT_WINDOWS.push(elementRef.current);}else if(index===CURRENT_WINDOWS.length-1)return;else if(index>=0){CURRENT_WINDOWS.splice(index,1);CURRENT_WINDOWS.push(elementRef.current);}bringToTop();},[bringToTop]);var onMouseDown=useCallback(function(event){moveCurrentWindow();},[moveCurrentWindow]);var onTouchStart=useCallback(function(event){moveCurrentWindow();},[moveCurrentWindow]);var startDragging=useCallback(function(startX,startY){setStart({x:startX,y:startY});setIsDragging(true);},[]);var onDragMouseDown=useCallback(function(event){startDragging(event.clientX,event.clientY);},[startDragging]);var onTouchDown=useCallback(function(event){var touch=event.touches[0];startDragging(touch.clientX,touch.clientY);},[startDragging]);var onDragMouseMove=useCallback(function(event){setDelta({x:event.clientX-start.x,y:event.clientY-start.y});},[start]);var onDragTouchMove=useCallback(function(event){var touch=event.touches[0];setDelta({x:touch.clientX-start.x,y:touch.clientY-start.y});},[start]);var completeDrag=useCallback(function(){if(!elementRef.current||!dragHandler)return;var offsetX=offset.x+delta.x;var offsetY=offset.y+delta.y;var left=elementRef.current.offsetLeft+offsetX;var top=elementRef.current.offsetTop+offsetY;if(top<BOUNDS_THRESHOLD_TOP){offsetY=-elementRef.current.offsetTop;}else if(top+dragHandler.offsetHeight>=document.body.offsetHeight-BOUNDS_THRESHOLD_TOP){offsetY=document.body.offsetHeight-elementRef.current.offsetHeight-elementRef.current.offsetTop;}if(left+elementRef.current.offsetWidth<BOUNDS_THRESHOLD_LEFT){offsetX=-elementRef.current.offsetLeft;}else if(left>=document.body.offsetWidth-BOUNDS_THRESHOLD_LEFT){offsetX=document.body.offsetWidth-elementRef.current.offsetWidth-elementRef.current.offsetLeft;}setDelta({x:0,y:0});setOffset({x:offsetX,y:offsetY});setIsDragging(false);if(uniqueKey!==null)POS_MEMORY.set(uniqueKey,{x:offsetX,y:offsetY});},[dragHandler,delta,offset,uniqueKey]);var onDragMouseUp=useCallback(function(event){completeDrag();},[completeDrag]);var onDragTouchUp=useCallback(function(event){completeDrag();},[completeDrag]);useEffect(function(){var element=elementRef.current;if(!element)return;CURRENT_WINDOWS.push(element);bringToTop();if(!disableDrag){var handle=element.querySelector(handleSelector);if(handle)setDragHandler(handle);}var offsetX=0;var offsetY=0;switch(windowPosition){case DraggableWindowPosition.TOP_CENTER:element.style.top=50+offsetTop+'px';element.style.left=\"calc(50vw - \".concat(element.offsetWidth/2+offsetLeft,\"px)\");break;case DraggableWindowPosition.CENTER:element.style.top=\"calc(50vh - \".concat(element.offsetHeight/2+offsetTop,\"px)\");element.style.left=\"calc(50vw - \".concat(element.offsetWidth/2+offsetLeft,\"px)\");break;case DraggableWindowPosition.TOP_LEFT:element.style.top=50+offsetTop+'px';element.style.left=50+offsetLeft+'px';break;}if(uniqueKey!==null){var memory=POS_MEMORY.get(uniqueKey);if(memory){offsetX=memory.x;offsetY=memory.y;}}setDelta({x:0,y:0});setOffset({x:offsetX,y:offsetY});return function(){var index=CURRENT_WINDOWS.indexOf(element);if(index>=0)CURRENT_WINDOWS.splice(index,1);};},[handleSelector,windowPosition,uniqueKey,disableDrag,offsetLeft,offsetTop,bringToTop]);useEffect(function(){if(!offset&&!delta)return;var element=elementRef.current;if(!element)return;element.style.transform=\"translate(\".concat(offset.x+delta.x,\"px, \").concat(offset.y+delta.y,\"px)\");element.style.visibility='visible';},[offset,delta]);useEffect(function(){if(!dragHandler)return;dragHandler.addEventListener(MouseEventType.MOUSE_DOWN,onDragMouseDown);dragHandler.addEventListener(TouchEventType.TOUCH_START,onTouchDown);return function(){dragHandler.removeEventListener(MouseEventType.MOUSE_DOWN,onDragMouseDown);dragHandler.removeEventListener(TouchEventType.TOUCH_START,onTouchDown);};},[dragHandler,onDragMouseDown,onTouchDown]);useEffect(function(){if(!isDragging)return;document.addEventListener(MouseEventType.MOUSE_UP,onDragMouseUp);document.addEventListener(TouchEventType.TOUCH_END,onDragTouchUp);document.addEventListener(MouseEventType.MOUSE_MOVE,onDragMouseMove);document.addEventListener(TouchEventType.TOUCH_MOVE,onDragTouchMove);return function(){document.removeEventListener(MouseEventType.MOUSE_UP,onDragMouseUp);document.removeEventListener(TouchEventType.TOUCH_END,onDragTouchUp);document.removeEventListener(MouseEventType.MOUSE_MOVE,onDragMouseMove);document.removeEventListener(TouchEventType.TOUCH_MOVE,onDragTouchMove);};},[isDragging,onDragMouseUp,onDragMouseMove,onDragTouchUp,onDragTouchMove]);return/*#__PURE__*/createPortal(/*#__PURE__*/_jsx(Base,{position:\"absolute\",innerRef:elementRef,className:\"draggable-window animate__animated animate__fadeIn\",onMouseDownCapture:onMouseDown,onTouchStartCapture:onTouchStart,style:dragStyle,children:children}),document.getElementById('draggable-windows-container'));};","map":null,"metadata":{},"sourceType":"module"}