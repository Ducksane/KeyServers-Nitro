{"ast":null,"code":"import _createForOfIteratorHelper from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _toConsumableArray from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{BotAddedToInventoryEvent,BotInventoryMessageEvent,BotRemovedFromInventoryEvent,GetBotInventoryComposer}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useState}from'react';import{useBetween}from'use-between';import{useInventoryUnseenTracker}from'.';import{UseMessageEventHook}from'..';import{cancelRoomObjectPlacement,CreateLinkEvent,getPlacingItemId,SendMessageComposer,UnseenItemCategory}from'../../api';import{useSharedVisibility}from'../useSharedVisibility';var useInventoryBotsState=function useInventoryBotsState(){var _useState=useState(true),_useState2=_slicedToArray(_useState,2),needsUpdate=_useState2[0],setNeedsUpdate=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),botItems=_useState4[0],setBotItems=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),selectedBot=_useState6[0],setSelectedBot=_useState6[1];var _useSharedVisibility=useSharedVisibility(),_useSharedVisibility$=_useSharedVisibility.isVisible,isVisible=_useSharedVisibility$===void 0?false:_useSharedVisibility$,_useSharedVisibility$2=_useSharedVisibility.activate,activate=_useSharedVisibility$2===void 0?null:_useSharedVisibility$2,_useSharedVisibility$3=_useSharedVisibility.deactivate,deactivate=_useSharedVisibility$3===void 0?null:_useSharedVisibility$3;var _useInventoryUnseenTr=useInventoryUnseenTracker(),_useInventoryUnseenTr2=_useInventoryUnseenTr.isUnseen,isUnseen=_useInventoryUnseenTr2===void 0?null:_useInventoryUnseenTr2,_useInventoryUnseenTr3=_useInventoryUnseenTr.resetCategory,resetCategory=_useInventoryUnseenTr3===void 0?null:_useInventoryUnseenTr3;var onBotInventoryMessageEvent=useCallback(function(event){var parser=event.getParser();setBotItems(function(prevValue){var newValue=_toConsumableArray(prevValue);var existingIds=newValue.map(function(item){return item.botData.id;});var addedDatas=[];var _iterator=_createForOfIteratorHelper(parser.items.values()),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var _botData=_step.value;existingIds.indexOf(_botData.id)===-1&&addedDatas.push(_botData);}}catch(err){_iterator.e(err);}finally{_iterator.f();}var _iterator2=_createForOfIteratorHelper(existingIds),_step2;try{var _loop=function _loop(){var existingId=_step2.value;var remove=true;var _iterator3=_createForOfIteratorHelper(parser.items.values()),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var _botData2=_step3.value;if(_botData2.id===existingId){remove=false;break;}}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}if(!remove)return\"continue\";var index=newValue.findIndex(function(item){return item.botData.id===existingId;});var botItem=newValue[index];if(index===-1||!botItem)return\"continue\";if(getPlacingItemId()===botItem.botData.id){cancelRoomObjectPlacement();CreateLinkEvent('inventory/open');}newValue.splice(index,1);};for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _ret=_loop();if(_ret===\"continue\")continue;}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}for(var _i=0,_addedDatas=addedDatas;_i<_addedDatas.length;_i++){var botData=_addedDatas[_i];var botItem={botData:botData};var unseen=isUnseen(UnseenItemCategory.BOT,botData.id);if(unseen)newValue.unshift(botItem);else newValue.push(botItem);}return newValue;});},[isUnseen]);UseMessageEventHook(BotInventoryMessageEvent,onBotInventoryMessageEvent);var onBotAddedToInventoryEvent=useCallback(function(event){var parser=event.getParser();setBotItems(function(prevValue){var newValue=_toConsumableArray(prevValue);var index=newValue.findIndex(function(item){return item.botData.id===parser.item.id;});if(index>=0)return prevValue;var botItem={botData:parser.item};var unseen=isUnseen(UnseenItemCategory.BOT,botItem.botData.id);if(unseen)newValue.unshift(botItem);else newValue.push(botItem);return newValue;});},[isUnseen]);UseMessageEventHook(BotAddedToInventoryEvent,onBotAddedToInventoryEvent);var onBotRemovedFromInventoryEvent=useCallback(function(event){var parser=event.getParser();setBotItems(function(prevValue){var newValue=_toConsumableArray(prevValue);var index=newValue.findIndex(function(item){return item.botData.id===parser.itemId;});if(index===-1)return prevValue;newValue.splice(index,1);if(getPlacingItemId()===parser.itemId){cancelRoomObjectPlacement();CreateLinkEvent('inventory/show');}return newValue;});},[]);UseMessageEventHook(BotRemovedFromInventoryEvent,onBotRemovedFromInventoryEvent);useEffect(function(){if(!botItems||!botItems.length)return;setSelectedBot(function(prevValue){var newValue=prevValue;if(newValue&&botItems.indexOf(newValue)===-1)newValue=null;if(!newValue)newValue=botItems[0];return newValue;});},[botItems]);useEffect(function(){if(!isVisible)return;return function(){resetCategory(UnseenItemCategory.BOT);};},[isVisible,resetCategory]);useEffect(function(){if(!isVisible||!needsUpdate)return;SendMessageComposer(new GetBotInventoryComposer());setNeedsUpdate(false);},[isVisible,needsUpdate]);return{botItems:botItems,selectedBot:selectedBot,setSelectedBot:setSelectedBot,activate:activate,deactivate:deactivate};};export var useInventoryBots=function useInventoryBots(){return useBetween(useInventoryBotsState);};","map":null,"metadata":{},"sourceType":"module"}