{"ast":null,"code":"import _createForOfIteratorHelper from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _toConsumableArray from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{FurnitureListAddOrUpdateEvent,FurnitureListComposer,FurnitureListEvent,FurnitureListInvalidateEvent,FurnitureListRemovedEvent,FurniturePostItPlacedEvent}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useState}from'react';import{useBetween}from'use-between';import{useInventoryUnseenTracker}from'.';import{UseMessageEventHook}from'..';import{addFurnitureItem,attemptItemPlacement,cancelRoomObjectPlacement,CloneObject,CreateLinkEvent,FurnitureItem,getAllItemIds,getPlacingItemId,mergeFurniFragments,SendMessageComposer,UnseenItemCategory}from'../../api';import{InventoryFurniAddedEvent}from'../../events';import{DispatchUiEvent}from'../events';import{useSharedVisibility}from'../useSharedVisibility';var furniMsgFragments=null;var useInventoryFurniState=function useInventoryFurniState(){var _useState=useState(true),_useState2=_slicedToArray(_useState,2),needsUpdate=_useState2[0],setNeedsUpdate=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),groupItems=_useState4[0],setGroupItems=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),selectedItem=_useState6[0],setSelectedItem=_useState6[1];var _useSharedVisibility=useSharedVisibility(),_useSharedVisibility$=_useSharedVisibility.isVisible,isVisible=_useSharedVisibility$===void 0?false:_useSharedVisibility$,_useSharedVisibility$2=_useSharedVisibility.activate,activate=_useSharedVisibility$2===void 0?null:_useSharedVisibility$2,_useSharedVisibility$3=_useSharedVisibility.deactivate,deactivate=_useSharedVisibility$3===void 0?null:_useSharedVisibility$3;var _useInventoryUnseenTr=useInventoryUnseenTracker(),_useInventoryUnseenTr2=_useInventoryUnseenTr.isUnseen,isUnseen=_useInventoryUnseenTr2===void 0?null:_useInventoryUnseenTr2,_useInventoryUnseenTr3=_useInventoryUnseenTr.resetCategory,resetCategory=_useInventoryUnseenTr3===void 0?null:_useInventoryUnseenTr3;var onFurnitureListAddOrUpdateEvent=useCallback(function(event){var parser=event.getParser();setGroupItems(function(prevValue){var newValue=_toConsumableArray(prevValue);var _iterator=_createForOfIteratorHelper(parser.items),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var item=_step.value;var i=0;var groupItem=null;while(i<newValue.length){var group=newValue[i];var j=0;while(j<group.items.length){var furniture=group.items[j];if(furniture.id===item.itemId){furniture.update(item);var newFurniture=_toConsumableArray(group.items);newFurniture[j]=furniture;group.items=newFurniture;groupItem=group;break;}j++;}if(groupItem)break;i++;}if(groupItem){groupItem.hasUnseenItems=true;newValue[i]=CloneObject(groupItem);}else{var _furniture=new FurnitureItem(item);addFurnitureItem(newValue,_furniture,isUnseen(UnseenItemCategory.FURNI,item.itemId));DispatchUiEvent(new InventoryFurniAddedEvent(_furniture.id,_furniture.type,_furniture.category));}}}catch(err){_iterator.e(err);}finally{_iterator.f();}return newValue;});},[isUnseen]);UseMessageEventHook(FurnitureListAddOrUpdateEvent,onFurnitureListAddOrUpdateEvent);var onFurnitureListEvent=useCallback(function(event){var parser=event.getParser();if(!furniMsgFragments)furniMsgFragments=new Array(parser.totalFragments);var fragment=mergeFurniFragments(parser.fragment,parser.totalFragments,parser.fragmentNumber,furniMsgFragments);if(!fragment)return;setGroupItems(function(prevValue){var newValue=_toConsumableArray(prevValue);var existingIds=getAllItemIds(newValue);var _iterator2=_createForOfIteratorHelper(existingIds),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var existingId=_step2.value;if(fragment.get(existingId))continue;var index=0;while(index<newValue.length){var group=newValue[index];var item=group.remove(existingId);if(!item){index++;continue;}if(getPlacingItemId()===item.ref){cancelRoomObjectPlacement();if(!attemptItemPlacement(group)){CreateLinkEvent('inventory/show');}}if(group.getTotalCount()<=0){newValue.splice(index,1);group.dispose();}break;}}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}var _iterator3=_createForOfIteratorHelper(fragment.keys()),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var itemId=_step3.value;if(existingIds.indexOf(itemId)>=0)continue;var _parser=fragment.get(itemId);if(!_parser)continue;var _item=new FurnitureItem(_parser);addFurnitureItem(newValue,_item,isUnseen(UnseenItemCategory.FURNI,itemId));DispatchUiEvent(new InventoryFurniAddedEvent(_item.id,_item.type,_item.category));}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}return newValue;});furniMsgFragments=null;},[isUnseen]);UseMessageEventHook(FurnitureListEvent,onFurnitureListEvent);var onFurnitureListInvalidateEvent=useCallback(function(event){setNeedsUpdate(true);},[]);UseMessageEventHook(FurnitureListInvalidateEvent,onFurnitureListInvalidateEvent);var onFurnitureListRemovedEvent=useCallback(function(event){var parser=event.getParser();setGroupItems(function(prevValue){var newValue=_toConsumableArray(prevValue);var index=0;while(index<newValue.length){var group=newValue[index];var item=group.remove(parser.itemId);if(!item){index++;continue;}if(getPlacingItemId()===item.ref){cancelRoomObjectPlacement();if(!attemptItemPlacement(group))CreateLinkEvent('inventory/show');}if(group.getTotalCount()<=0){newValue.splice(index,1);group.dispose();}break;}return newValue;});},[]);UseMessageEventHook(FurnitureListRemovedEvent,onFurnitureListRemovedEvent);var onFurniturePostItPlacedEvent=useCallback(function(event){},[]);UseMessageEventHook(FurniturePostItPlacedEvent,onFurniturePostItPlacedEvent);useEffect(function(){if(!groupItems||!groupItems.length)return;setSelectedItem(function(prevValue){var newValue=prevValue;if(newValue&&groupItems.indexOf(newValue)===-1)newValue=null;if(!newValue)newValue=groupItems[0];return newValue;});},[groupItems]);useEffect(function(){if(!isVisible)return;return function(){if(resetCategory(UnseenItemCategory.FURNI)){setGroupItems(function(prevValue){var newValue=_toConsumableArray(prevValue);var _iterator4=_createForOfIteratorHelper(newValue),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var newGroup=_step4.value;newGroup.hasUnseenItems=false;}}catch(err){_iterator4.e(err);}finally{_iterator4.f();}return newValue;});}};},[isVisible,resetCategory]);useEffect(function(){if(!isVisible||!needsUpdate)return;SendMessageComposer(new FurnitureListComposer());setNeedsUpdate(false);},[isVisible,needsUpdate]);return{isVisible:isVisible,groupItems:groupItems,setGroupItems:setGroupItems,selectedItem:selectedItem,setSelectedItem:setSelectedItem,activate:activate,deactivate:deactivate};};export var useInventoryFurni=function useInventoryFurni(){return useBetween(useInventoryFurniState);};","map":null,"metadata":{},"sourceType":"module"}