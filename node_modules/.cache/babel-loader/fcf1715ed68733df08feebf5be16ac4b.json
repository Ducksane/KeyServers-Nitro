{"ast":null,"code":"import _construct from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/construct.js\";import _createForOfIteratorHelper from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _slicedToArray from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{TradingListAddItemComposer,TradingListAddItemsComposer}from'@nitrots/nitro-renderer';import{useEffect,useState}from'react';import{FurniCategory,getGuildFurniType,LocalizeText,NotificationAlertType,NotificationUtilities,SendMessageComposer,TradeState}from'../../../../api';import{AutoGrid,Base,Button,Column,Flex,Grid,LayoutGridItem,Text}from'../../../../common';import{useInventoryTrade}from'../../../../hooks';import{InventoryFurnitureSearchView}from'./InventoryFurnitureSearchView';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var MAX_ITEMS_TO_TRADE=9;export var InventoryTradeView=function InventoryTradeView(props){var _props$cancelTrade=props.cancelTrade,cancelTrade=_props$cancelTrade===void 0?null:_props$cancelTrade;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),groupItem=_useState2[0],setGroupItem=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),ownGroupItem=_useState4[0],setOwnGroupItem=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),otherGroupItem=_useState6[0],setOtherGroupItem=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),filteredGroupItems=_useState8[0],setFilteredGroupItems=_useState8[1];var _useState9=useState(3),_useState10=_slicedToArray(_useState9,2),countdownTick=_useState10[0],setCountdownTick=_useState10[1];var _useInventoryTrade=useInventoryTrade(),_useInventoryTrade$ow=_useInventoryTrade.ownUser,ownUser=_useInventoryTrade$ow===void 0?null:_useInventoryTrade$ow,_useInventoryTrade$ot=_useInventoryTrade.otherUser,otherUser=_useInventoryTrade$ot===void 0?null:_useInventoryTrade$ot,_useInventoryTrade$gr=_useInventoryTrade.groupItems,groupItems=_useInventoryTrade$gr===void 0?[]:_useInventoryTrade$gr,_useInventoryTrade$tr=_useInventoryTrade.tradeState,tradeState=_useInventoryTrade$tr===void 0?TradeState.TRADING_STATE_READY:_useInventoryTrade$tr,_useInventoryTrade$pr=_useInventoryTrade.progressTrade,progressTrade=_useInventoryTrade$pr===void 0?null:_useInventoryTrade$pr,_useInventoryTrade$re=_useInventoryTrade.removeItem,removeItem=_useInventoryTrade$re===void 0?null:_useInventoryTrade$re,_useInventoryTrade$se=_useInventoryTrade.setTradeState,setTradeState=_useInventoryTrade$se===void 0?null:_useInventoryTrade$se;var canTradeItem=function canTradeItem(isWallItem,spriteId,category,groupable,stuffData){if(!ownUser||ownUser.accepts||!ownUser.userItems)return false;if(ownUser.userItems.length<MAX_ITEMS_TO_TRADE)return true;if(!groupable)return false;var type=spriteId.toString();if(category===FurniCategory.POSTER){type=type+'poster'+stuffData.getLegacyString();}else{if(category===FurniCategory.GUILD_FURNI){type=getGuildFurniType(spriteId,stuffData);}else{type=(isWallItem?'I':'S')+type;}}return!!ownUser.userItems.getValue(type);};var attemptItemOffer=function attemptItemOffer(count){if(!groupItem)return;var tradeItems=groupItem.getTradeItems(count);if(!tradeItems||!tradeItems.length)return;var coreItem=null;var itemIds=[];var _iterator=_createForOfIteratorHelper(tradeItems),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var item=_step.value;itemIds.push(item.id);if(!coreItem)coreItem=item;}}catch(err){_iterator.e(err);}finally{_iterator.f();}var ownItemCount=ownUser.userItems.length;if(ownItemCount+itemIds.length<=1500){if(!coreItem.isGroupable&&itemIds.length){SendMessageComposer(new TradingListAddItemComposer(itemIds.pop()));}else{var tradeIds=[];var _iterator2=_createForOfIteratorHelper(itemIds),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var itemId=_step2.value;if(canTradeItem(coreItem.isWallItem,coreItem.type,coreItem.category,coreItem.isGroupable,coreItem.stuffData)){tradeIds.push(itemId);}}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}if(tradeIds.length){if(tradeIds.length===1){SendMessageComposer(new TradingListAddItemComposer(tradeIds.pop()));}else{SendMessageComposer(_construct(TradingListAddItemsComposer,tradeIds));}}}}else{NotificationUtilities.simpleAlert(LocalizeText('trading.items.too_many_items.desc'),NotificationAlertType.DEFAULT,null,null,LocalizeText('trading.items.too_many_items.title'));}};var getLockIcon=function getLockIcon(accepts){var iconName=accepts?'lock':'unlock';var textColor=accepts?'success':'danger';return/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:iconName,className:'text-'+textColor});};useEffect(function(){if(tradeState!==TradeState.TRADING_STATE_COUNTDOWN)return;setCountdownTick(3);var interval=setInterval(function(){setCountdownTick(function(prevValue){var newValue=prevValue-1;if(newValue===0)clearInterval(interval);return newValue;});},1000);return function(){return clearInterval(interval);};},[tradeState,setTradeState]);useEffect(function(){if(countdownTick!==0)return;setTradeState(TradeState.TRADING_STATE_CONFIRMING);},[countdownTick,setTradeState]);if(tradeState===TradeState.TRADING_STATE_READY||!ownUser||!otherUser)return null;return/*#__PURE__*/_jsxs(Grid,{children:[/*#__PURE__*/_jsxs(Column,{size:4,overflow:\"hidden\",children:[/*#__PURE__*/_jsx(InventoryFurnitureSearchView,{groupItems:groupItems,setGroupItems:setFilteredGroupItems}),/*#__PURE__*/_jsxs(Flex,{column:true,fullHeight:true,justifyContent:\"between\",overflow:\"hidden\",gap:2,children:[/*#__PURE__*/_jsx(AutoGrid,{columnCount:3,children:filteredGroupItems&&filteredGroupItems.length>0&&filteredGroupItems.map(function(item,index){var count=item.getUnlockedCount();return/*#__PURE__*/_jsx(LayoutGridItem,{className:!count?'opacity-0-5 ':'',itemImage:item.iconUrl,itemCount:count,itemActive:groupItem===item,itemUniqueNumber:item.stuffData.uniqueNumber,onClick:function onClick(event){return count&&setGroupItem(item);},children:count>0&&groupItem===item&&/*#__PURE__*/_jsx(Button,{position:\"absolute\",variant:\"success\",className:\"trade-button bottom-1 end-1\",onClick:function onClick(event){return attemptItemOffer(1);},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-right\"})})},index);})}),/*#__PURE__*/_jsx(Base,{fullWidth:true,className:\"badge bg-muted\",children:groupItem?groupItem.name:LocalizeText('catalog_selectproduct')})]})]}),/*#__PURE__*/_jsxs(Column,{size:8,overflow:\"hidden\",children:[/*#__PURE__*/_jsxs(Grid,{overflow:\"hidden\",children:[/*#__PURE__*/_jsxs(Column,{size:6,overflow:\"hidden\",children:[/*#__PURE__*/_jsxs(Flex,{justifyContent:\"between\",alignItems:\"center\",children:[/*#__PURE__*/_jsxs(Text,{style:{color:\"var(--test-galaxytext)\"},variant:\"none\",children:[LocalizeText('inventory.trading.you'),\" \",LocalizeText('inventory.trading.areoffering'),\":\"]}),getLockIcon(ownUser.accepts)]}),/*#__PURE__*/_jsx(AutoGrid,{columnCount:3,children:Array.from(Array(MAX_ITEMS_TO_TRADE),function(e,i){var item=ownUser.userItems.getWithIndex(i)||null;if(!item)return/*#__PURE__*/_jsx(LayoutGridItem,{},i);return/*#__PURE__*/_jsx(LayoutGridItem,{itemActive:ownGroupItem===item,itemImage:item.iconUrl,itemCount:item.getTotalCount(),itemUniqueNumber:item.stuffData.uniqueNumber,onClick:function onClick(event){return setOwnGroupItem(item);},children:ownGroupItem===item&&/*#__PURE__*/_jsx(Button,{position:\"absolute\",variant:\"danger\",className:\"trade-button bottom-1 start-1\",onClick:function onClick(event){return removeItem(item);},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-left\"})})},i);})}),/*#__PURE__*/_jsx(Base,{fullWidth:true,className:\"badge bg-muted\",children:ownGroupItem?ownGroupItem.name:LocalizeText('catalog_selectproduct')})]}),/*#__PURE__*/_jsxs(Column,{size:6,overflow:\"hidden\",children:[/*#__PURE__*/_jsxs(Flex,{justifyContent:\"between\",alignItems:\"center\",children:[/*#__PURE__*/_jsxs(Text,{style:{color:\"var(--test-galaxytext)\"},variant:\"none\",children:[otherUser.userName,\" \",LocalizeText('inventory.trading.isoffering'),\":\"]}),getLockIcon(otherUser.accepts)]}),/*#__PURE__*/_jsx(AutoGrid,{columnCount:3,children:Array.from(Array(MAX_ITEMS_TO_TRADE),function(e,i){var item=otherUser.userItems.getWithIndex(i)||null;if(!item)return/*#__PURE__*/_jsx(LayoutGridItem,{},i);return/*#__PURE__*/_jsx(LayoutGridItem,{itemActive:otherGroupItem===item,itemImage:item.iconUrl,itemCount:item.getTotalCount(),itemUniqueNumber:item.stuffData.uniqueNumber,onClick:function onClick(event){return setOtherGroupItem(item);}},i);})}),/*#__PURE__*/_jsx(Base,{fullWidth:true,className:\"badge bg-muted w-100\",children:otherGroupItem?otherGroupItem.name:LocalizeText('catalog_selectproduct')})]})]}),/*#__PURE__*/_jsxs(Flex,{grow:true,justifyContent:\"between\",children:[/*#__PURE__*/_jsx(Button,{variant:\"danger\",onClick:cancelTrade,children:LocalizeText('generic.cancel')}),tradeState===TradeState.TRADING_STATE_READY&&/*#__PURE__*/_jsx(Button,{variant:\"secondary\",disabled:!ownUser.itemCount&&!otherUser.itemCount,onClick:progressTrade,children:LocalizeText('inventory.trading.accept')}),tradeState===TradeState.TRADING_STATE_RUNNING&&/*#__PURE__*/_jsx(Button,{variant:\"secondary\",disabled:!ownUser.itemCount&&!otherUser.itemCount,onClick:progressTrade,children:LocalizeText(ownUser.accepts?'inventory.trading.modify':'inventory.trading.accept')}),tradeState===TradeState.TRADING_STATE_COUNTDOWN&&/*#__PURE__*/_jsx(Button,{variant:\"secondary\",disabled:true,children:LocalizeText('inventory.trading.countdown',['counter'],[countdownTick.toString()])}),tradeState===TradeState.TRADING_STATE_CONFIRMING&&/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:progressTrade,children:LocalizeText('inventory.trading.button.restore')}),tradeState===TradeState.TRADING_STATE_CONFIRMED&&/*#__PURE__*/_jsx(Button,{variant:\"secondary\",children:LocalizeText('inventory.trading.info.waiting')})]})]})]});};","map":null,"metadata":{},"sourceType":"module"}