{"ast":null,"code":"import _construct from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/construct.js\";import _toConsumableArray from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _createForOfIteratorHelper from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _classCallCheck from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _assertThisInitialized from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";import _inherits from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import{NitroManager}from'../../../core/common/NitroManager';import{JukeboxPlayListFullMessageEvent}from'../../communication/messages/incoming/sound/JukeboxPlayListFullMessageEvent';import{JukeboxSongDisksMessageEvent}from'../../communication/messages/incoming/sound/JukeboxSongDisksMessageEvent';import{NowPlayingMessageEvent}from'../../communication/messages/incoming/sound/NowPlayingMessageEvent';import{TraxSongInfoMessageEvent}from'../../communication/messages/incoming/sound/TraxSongInfoMessageEvent';import{UserSongDisksInventoryMessageEvent}from'../../communication/messages/incoming/sound/UserSongDisksInventoryMessageEvent';import{GetSongInfoMessageComposer}from'../../communication/messages/outgoing/sound/GetSongInfoMessageComposer';import{Nitro}from'../../Nitro';import{RoomObjectSoundMachineEvent}from'../../room/events/RoomObjectSoundMachineEvent';import{SoundManagerEvent}from'../events/SoundManagerEvent';import{SongInfoEntry}from'./../../communication/messages/incoming/sound/SongInfoEntry';import{MusicPriorities}from'./MusicPriorities';export var MusicManager=/*#__PURE__*/function(_NitroManager){_inherits(MusicManager,_NitroManager);var _super=_createSuper(MusicManager);function MusicManager(){var _this;_classCallCheck(this,MusicManager);_this=_super.call(this);_this._timerInstance=void 0;_this._songRequestList=void 0;_this._requestedSongs=void 0;_this._availableSongs=void 0;_this._songRequestsPerPriority=void 0;_this._currentEntryId=void 0;_this._playPosition=void 0;_this._isPlaying=void 0;_this._timerInstance=null;_this._songRequestList=[];_this._requestedSongs=new Map();_this._availableSongs=new Map();_this._songRequestsPerPriority=[];_this._currentEntryId=-1;_this._playPosition=-1;_this._isPlaying=false;_this.onEvent=_this.onEvent.bind(_assertThisInitialized(_this));_this._timerInstance=setInterval(_this.onTick.bind(_assertThisInitialized(_this)),1000);return _this;}_createClass(MusicManager,[{key:\"onInit\",value:function onInit(){Nitro.instance.communication.connection.addMessageEvent(new TraxSongInfoMessageEvent(this.onEvent));Nitro.instance.communication.connection.addMessageEvent(new UserSongDisksInventoryMessageEvent(this.onEvent));Nitro.instance.communication.connection.addMessageEvent(new NowPlayingMessageEvent(this.onNowPlayingMessageEvent.bind(this)));Nitro.instance.communication.connection.addMessageEvent(new JukeboxSongDisksMessageEvent(this.onEvent));Nitro.instance.communication.connection.addMessageEvent(new JukeboxPlayListFullMessageEvent(this.onEvent));Nitro.instance.roomEngine.events.addEventListener(RoomObjectSoundMachineEvent.JUKEBOX_INIT,this.onEvent);Nitro.instance.roomEngine.events.addEventListener(RoomObjectSoundMachineEvent.JUKEBOX_DISPOSE,this.onEvent);Nitro.instance.roomEngine.events.addEventListener(RoomObjectSoundMachineEvent.SOUND_MACHINE_INIT,this.onEvent);Nitro.instance.roomEngine.events.addEventListener(RoomObjectSoundMachineEvent.SOUND_MACHINE_DISPOSE,this.onEvent);this.events.addEventListener(SoundManagerEvent.TRAX_SONG_COMPLETE,this.onEvent);}},{key:\"onDispose\",value:function onDispose(){if(this._timerInstance){clearInterval(this._timerInstance);this._timerInstance=null;}Nitro.instance.communication.connection.removeMessageEvent(new TraxSongInfoMessageEvent(this.onEvent));Nitro.instance.communication.connection.removeMessageEvent(new UserSongDisksInventoryMessageEvent(this.onEvent));Nitro.instance.communication.connection.removeMessageEvent(new NowPlayingMessageEvent(this.onNowPlayingMessageEvent.bind(this)));Nitro.instance.communication.connection.removeMessageEvent(new JukeboxSongDisksMessageEvent(this.onEvent));Nitro.instance.communication.connection.removeMessageEvent(new JukeboxPlayListFullMessageEvent(this.onEvent));Nitro.instance.roomEngine.events.removeEventListener(RoomObjectSoundMachineEvent.JUKEBOX_INIT,this.onEvent);Nitro.instance.roomEngine.events.removeEventListener(RoomObjectSoundMachineEvent.JUKEBOX_DISPOSE,this.onEvent);Nitro.instance.roomEngine.events.removeEventListener(RoomObjectSoundMachineEvent.SOUND_MACHINE_INIT,this.onEvent);Nitro.instance.roomEngine.events.removeEventListener(RoomObjectSoundMachineEvent.SOUND_MACHINE_DISPOSE,this.onEvent);this.events.removeEventListener(SoundManagerEvent.TRAX_SONG_COMPLETE,this.onEvent);}},{key:\"onEvent\",value:function onEvent(event){}},{key:\"onTraxSongInfoMessageEvent\",value:function onTraxSongInfoMessageEvent(event){var parser=event.getParser();var _iterator=_createForOfIteratorHelper(parser.songs),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var song=_step.value;var songAvailable=this._availableSongs.get(song.id)!==null;var areSamplesRequested=this._requestedSongs.get(song.id)!==null;if(!songAvailable){if(areSamplesRequested){//LoadTraxSong\n}var songInfoEntry=new SongInfoEntry(song.id,song.length,song.name,song.creator,song.data);this._availableSongs.set(song.id,songInfoEntry);var topRequestPriotityIndex=this.getTopRequestPriority();var songId=this.getSongIdRequestedAtPriority(topRequestPriotityIndex);}}}catch(err){_iterator.e(err);}finally{_iterator.f();}}},{key:\"onNowPlayingMessageEvent\",value:function onNowPlayingMessageEvent(event){var parser=event.getParser();this._isPlaying=parser.currentSongId!==-1;if(parser.currentSongId>=0){this.playSong(parser.currentSongId,MusicPriorities.PRIORITY_ROOM_PLAYLIST,parser.syncCount/1000,0,1,1);}else{this.stopPlaying();}if(parser.nextSongId>=0)this.requestSong(parser.nextSongId,true);this._playPosition=parser.currentPosition;//Dispatch local event NowPlayingEvent\n}},{key:\"onTick\",value:function onTick(){if(this._songRequestList.length===0)return;Nitro.instance.communication.connection.send(_construct(GetSongInfoMessageComposer,_toConsumableArray(this._songRequestList)));this._songRequestList=[];}},{key:\"requestSong\",value:function requestSong(songId,arg2){if(this._requestedSongs.get(songId)===null){this._requestedSongs.set(songId,arg2);this._songRequestList.push(songId);}}},{key:\"playSong\",value:function playSong(songId,priority){var startPos=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var playLength=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var fadeInSeconds=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0.5;var fadeOutSeconds=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0.5;}},{key:\"stopPlaying\",value:function stopPlaying(){this._currentEntryId=-1;this._playPosition=-1;this._isPlaying=false;}},{key:\"getTopRequestPriority\",value:function getTopRequestPriority(){return this._songRequestsPerPriority.length-1;}},{key:\"getSongIdRequestedAtPriority\",value:function getSongIdRequestedAtPriority(priorityIndex){if(priorityIndex<0||priorityIndex>=MusicPriorities.PRIORITY_COUNT)return-1;if(!this._songRequestsPerPriority[priorityIndex])return-1;return this._songRequestsPerPriority[priorityIndex].songId;}},{key:\"playPosition\",get:function get(){return this._playPosition;},set:function set(value){this._playPosition=value;}}]);return MusicManager;}(NitroManager);MusicManager.SKIP_POSITION_SET=-1;MusicManager.MAXIMUM_NOTIFY_PRIORITY=MusicPriorities.PRIORITY_ROOM_PLAYLIST;","map":null,"metadata":{},"sourceType":"module"}