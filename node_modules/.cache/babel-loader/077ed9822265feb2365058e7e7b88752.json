{"ast":null,"code":"import _createForOfIteratorHelper from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _slicedToArray from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{PetCustomPart,PetFigureData,RoomObjectCategory,RoomObjectVariable}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useMemo,useState}from'react';import{FurniCategory,GetFurnitureDataForRoomObject,GetRoomEngine,LocalizeText,RoomWidgetUseProductMessage}from'../../../../api';import{Base,Button,Column,Flex,LayoutPetImageView,NitroCardContentView,NitroCardHeaderView,NitroCardView,Text}from'../../../../common';import{useRoomContext}from'../../RoomContext';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var _Str_5091=-1;var _Str_11906=0;var _Str_11214=1;var _Str_11733=2;var _Str_11369=3;var _Str_8759=4;var _Str_8432=5;var _Str_9653=6;export var AvatarInfoUseProductConfirmView=function AvatarInfoUseProductConfirmView(props){var _props$item=props.item,item=_props$item===void 0?null:_props$item,_props$close=props.close,close=_props$close===void 0?null:_props$close;var _useState=useState(_Str_5091),_useState2=_slicedToArray(_useState,2),mode=_useState2[0],setMode=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),petData=_useState4[0],setPetData=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),furniData=_useState6[0],setFurniData=_useState6[1];var _useRoomContext=useRoomContext(),_useRoomContext$roomS=_useRoomContext.roomSession,roomSession=_useRoomContext$roomS===void 0?null:_useRoomContext$roomS,_useRoomContext$widge=_useRoomContext.widgetHandler,widgetHandler=_useRoomContext$widge===void 0?null:_useRoomContext$widge;var selectRoomObject=useCallback(function(){if(!petData)return;GetRoomEngine().selectRoomObject(roomSession.roomId,petData.roomIndex,RoomObjectCategory.UNIT);},[roomSession,petData]);var useProduct=useCallback(function(){widgetHandler.processWidgetMessage(new RoomWidgetUseProductMessage(RoomWidgetUseProductMessage.PET_PRODUCT,item.requestRoomObjectId,petData.webID));close();},[widgetHandler,item,petData,close]);var getPetImage=useMemo(function(){if(!petData||!furniData)return null;var petFigureData=new PetFigureData(petData.figure);var customParts=furniData.customParams.split(' ');var petIndex=parseInt(customParts[0]);switch(furniData.specialType){case FurniCategory.PET_SHAMPOO:{if(customParts.length<2)return null;var currentPalette=GetRoomEngine().getPetColorResult(petIndex,petFigureData.paletteId);var possiblePalettes=GetRoomEngine().getPetColorResultsForTag(petIndex,customParts[1]);var paletteId=-1;var _iterator=_createForOfIteratorHelper(possiblePalettes),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var result=_step.value;if(result.breed===currentPalette.breed){paletteId=parseInt(result.id);break;}}}catch(err){_iterator.e(err);}finally{_iterator.f();}return/*#__PURE__*/_jsx(LayoutPetImageView,{typeId:petFigureData.typeId,paletteId:paletteId,petColor:petFigureData.color,customParts:petFigureData.customParts,direction:2});}case FurniCategory.PET_CUSTOM_PART:{if(customParts.length<4)return null;var newCustomParts=[];var _local_6=customParts[1].split(',').map(function(piece){return parseInt(piece);});var _local_7=customParts[2].split(',').map(function(piece){return parseInt(piece);});var _local_8=customParts[3].split(',').map(function(piece){return parseInt(piece);});var _local_10=0;while(_local_10<_local_6.length){var _local_13=_local_6[_local_10];var _local_15=petFigureData.getCustomPart(_local_13);var _local_12=_local_8[_local_10];if(_local_15!=null)_local_12=_local_15.paletteId;newCustomParts.push(new PetCustomPart(_local_13,_local_7[_local_10],_local_12));_local_10++;}return/*#__PURE__*/_jsx(LayoutPetImageView,{typeId:petFigureData.typeId,paletteId:petFigureData.paletteId,petColor:petFigureData.color,customParts:newCustomParts,direction:2});}case FurniCategory.PET_CUSTOM_PART_SHAMPOO:{if(customParts.length<3)return null;var _newCustomParts=[];var _local_=customParts[1].split(',').map(function(piece){return parseInt(piece);});var _local_2=customParts[2].split(',').map(function(piece){return parseInt(piece);});var _local_3=0;while(_local_3<_local_.length){var _local_4=_local_[_local_3];var _local_5=petFigureData.getCustomPart(_local_4);var _local_14=-1;if(_local_5!=null)_local_14=_local_5.partId;_newCustomParts.push(new PetCustomPart(_local_[_local_3],_local_14,_local_2[_local_3]));_local_3++;}return/*#__PURE__*/_jsx(LayoutPetImageView,{typeId:petFigureData.typeId,paletteId:petFigureData.paletteId,petColor:petFigureData.color,customParts:_newCustomParts,direction:2});}case FurniCategory.PET_SADDLE:{if(customParts.length<4)return null;var _newCustomParts2=[];var _local_9=customParts[1].split(',').map(function(piece){return parseInt(piece);});var _local_11=customParts[2].split(',').map(function(piece){return parseInt(piece);});var _local_16=customParts[3].split(',').map(function(piece){return parseInt(piece);});var _local_17=0;while(_local_17<_local_9.length){_newCustomParts2.push(new PetCustomPart(_local_9[_local_17],_local_11[_local_17],_local_16[_local_17]));_local_17++;}var _iterator2=_createForOfIteratorHelper(petFigureData.customParts),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _local_21=_step2.value;if(_local_9.indexOf(_local_21.layerId)===-1){_newCustomParts2.push(_local_21);}}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}return/*#__PURE__*/_jsx(LayoutPetImageView,{typeId:petFigureData.typeId,paletteId:petFigureData.paletteId,petColor:petFigureData.color,customParts:_newCustomParts2,direction:2});}case FurniCategory.MONSTERPLANT_REBREED:case FurniCategory.MONSTERPLANT_REVIVAL:case FurniCategory.MONSTERPLANT_FERTILIZE:{var posture='rip';var roomObject=GetRoomEngine().getRoomObject(roomSession.roomId,petData.roomIndex,RoomObjectCategory.UNIT);if(roomObject){posture=roomObject.model.getValue(RoomObjectVariable.FIGURE_POSTURE);if(posture==='rip'){var level=petData.petLevel;if(level<7)posture=\"grw\".concat(level);else posture='std';}}return/*#__PURE__*/_jsx(LayoutPetImageView,{typeId:petFigureData.typeId,paletteId:petFigureData.paletteId,petColor:petFigureData.color,customParts:petFigureData.customParts,posture:posture,direction:2});}}},[petData,furniData,roomSession]);useEffect(function(){var userData=roomSession.userDataManager.getUserDataByIndex(item.id);setPetData(userData);var furniData=GetFurnitureDataForRoomObject(roomSession.roomId,item.requestRoomObjectId,RoomObjectCategory.FLOOR);if(!furniData)return;setFurniData(furniData);var mode=_Str_5091;switch(furniData.specialType){case FurniCategory.PET_SHAMPOO:mode=_Str_11906;break;case FurniCategory.PET_CUSTOM_PART:mode=_Str_11214;break;case FurniCategory.PET_CUSTOM_PART_SHAMPOO:mode=_Str_11733;break;case FurniCategory.PET_SADDLE:mode=_Str_11369;break;case FurniCategory.MONSTERPLANT_REVIVAL:mode=_Str_8759;break;case FurniCategory.MONSTERPLANT_REBREED:mode=_Str_8432;break;case FurniCategory.MONSTERPLANT_FERTILIZE:mode=_Str_9653;break;}setMode(mode);},[roomSession,item]);if(!petData)return null;return/*#__PURE__*/_jsxs(NitroCardView,{className:\"nitro-use-product-confirmation\",children:[/*#__PURE__*/_jsx(NitroCardHeaderView,{headerText:LocalizeText('useproduct.widget.title',['name'],[petData.name]),onCloseClick:close}),/*#__PURE__*/_jsx(NitroCardContentView,{center:true,children:/*#__PURE__*/_jsxs(Flex,{gap:2,overflow:\"hidden\",children:[/*#__PURE__*/_jsx(Column,{children:/*#__PURE__*/_jsx(Base,{pointer:true,className:\"product-preview\",onClick:selectRoomObject,children:getPetImage})}),/*#__PURE__*/_jsxs(Column,{justifyContent:\"between\",overflow:\"auto\",children:[/*#__PURE__*/_jsxs(Column,{gap:2,children:[mode===_Str_11906&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Text,{children:LocalizeText('useproduct.widget.text.shampoo',['productName'],[furniData.name])}),/*#__PURE__*/_jsx(Text,{children:LocalizeText('useproduct.widget.info.shampoo')})]}),mode===_Str_11214&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Text,{children:LocalizeText('useproduct.widget.text.custompart',['productName'],[furniData.name])}),/*#__PURE__*/_jsx(Text,{children:LocalizeText('useproduct.widget.info.custompart')})]}),mode===_Str_11733&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Text,{children:LocalizeText('useproduct.widget.text.custompartshampoo',['productName'],[furniData.name])}),/*#__PURE__*/_jsx(Text,{children:LocalizeText('useproduct.widget.info.custompartshampoo')})]}),mode===_Str_11369&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Text,{children:LocalizeText('useproduct.widget.text.saddle',['productName'],[furniData.name])}),/*#__PURE__*/_jsx(Text,{children:LocalizeText('useproduct.widget.info.saddle')})]}),mode===_Str_8759&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Text,{children:LocalizeText('useproduct.widget.text.revive_monsterplant',['productName'],[furniData.name])}),/*#__PURE__*/_jsx(Text,{children:LocalizeText('useproduct.widget.info.revive_monsterplant')})]}),mode===_Str_8432&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Text,{children:LocalizeText('useproduct.widget.text.rebreed_monsterplant',['productName'],[furniData.name])}),/*#__PURE__*/_jsx(Text,{children:LocalizeText('useproduct.widget.info.rebreed_monsterplant')})]}),mode===_Str_9653&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Text,{children:LocalizeText('useproduct.widget.text.fertilize_monsterplant',['productName'],[furniData.name])}),/*#__PURE__*/_jsx(Text,{children:LocalizeText('useproduct.widget.info.fertilize_monsterplant')})]})]}),/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",justifyContent:\"between\",children:[/*#__PURE__*/_jsx(Button,{variant:\"danger\",onClick:close,children:LocalizeText('useproduct.widget.cancel')}),/*#__PURE__*/_jsx(Button,{variant:\"success\",onClick:useProduct,children:LocalizeText('useproduct.widget.use')})]})]})]})})]});};","map":null,"metadata":{},"sourceType":"module"}