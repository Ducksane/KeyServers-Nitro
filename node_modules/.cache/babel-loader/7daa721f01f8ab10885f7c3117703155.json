{"ast":null,"code":"import _createForOfIteratorHelper from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _classCallCheck from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _assertThisInitialized from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";import _inherits from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import{NitroManager}from'../common/NitroManager';import{ConfigurationEvent}from'./ConfigurationEvent';export var ConfigurationManager=/*#__PURE__*/function(_NitroManager){_inherits(ConfigurationManager,_NitroManager);var _super=_createSuper(ConfigurationManager);function ConfigurationManager(){var _this;_classCallCheck(this,ConfigurationManager);_this=_super.call(this);_this._definitions=void 0;_this._pendingUrls=void 0;_this._missingKeys=void 0;_this._definitions=new Map();_this._pendingUrls=[];_this._missingKeys=[];_this.onConfigurationLoaded=_this.onConfigurationLoaded.bind(_assertThisInitialized(_this));return _this;}_createClass(ConfigurationManager,[{key:\"onInit\",value:function onInit(){this.parseConfiguration(this.getDefaultConfig(),true);this._pendingUrls=this.getValue('config.urls').slice();this.loadNextConfiguration();}},{key:\"loadNextConfiguration\",value:function loadNextConfiguration(){if(!this._pendingUrls.length){this.dispatchConfigurationEvent(ConfigurationEvent.LOADED);return;}this.loadConfigurationFromUrl(this._pendingUrls[0]);}},{key:\"loadConfigurationFromUrl\",value:function loadConfigurationFromUrl(url){var _this2=this;if(!url||url===''){this.dispatchConfigurationEvent(ConfigurationEvent.FAILED);return;}fetch(url).then(function(response){return response.json();}).then(function(data){return _this2.onConfigurationLoaded(data,url);}).catch(function(err){return _this2.onConfigurationFailed(err);});}},{key:\"onConfigurationLoaded\",value:function onConfigurationLoaded(data,url){if(!data)return;if(this.parseConfiguration(data)){var _index=this._pendingUrls.indexOf(url);if(_index>=0)this._pendingUrls.splice(_index,1);this.loadNextConfiguration();return;}this.dispatchConfigurationEvent(ConfigurationEvent.FAILED);}},{key:\"onConfigurationFailed\",value:function onConfigurationFailed(error){this.dispatchConfigurationEvent(ConfigurationEvent.FAILED);}},{key:\"dispatchConfigurationEvent\",value:function dispatchConfigurationEvent(type){this.events&&this.events.dispatchEvent(new ConfigurationEvent(type));}},{key:\"parseConfiguration\",value:function parseConfiguration(data){var overrides=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!data)return false;try{var regex=new RegExp(/\\${(.*?)}/g);for(var key in data){var value=data[key];if(typeof value==='string')value=this.interpolate(value,regex);if(this._definitions.has(key)){if(overrides)this.setValue(key,value);}else{this.setValue(key,value);}}return true;}catch(e){this.logger.error(e.stack);return false;}}},{key:\"interpolate\",value:function interpolate(value){var regex=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!regex)regex=new RegExp(/\\${(.*?)}/g);var pieces=value.match(regex);if(pieces&&pieces.length){var _iterator=_createForOfIteratorHelper(pieces),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var piece=_step.value;var existing=this._definitions.get(this.removeInterpolateKey(piece));if(existing)value=value.replace(piece,existing);}}catch(err){_iterator.e(err);}finally{_iterator.f();}}return value;}},{key:\"removeInterpolateKey\",value:function removeInterpolateKey(value){return value.replace('${','').replace('}','');}},{key:\"getValue\",value:function getValue(key){var value=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var existing=this._definitions.get(key);if(existing===undefined){if(this._missingKeys.indexOf(key)>=0)return value;this._missingKeys.push(key);this.logger.warn(\"Missing configuration key: \".concat(key));existing=value;}return existing;}},{key:\"setValue\",value:function setValue(key,value){this._definitions.set(key,value);}},{key:\"getDefaultConfig\",value:function getDefaultConfig(){//@ts-ignore\nreturn NitroConfig;}},{key:\"definitions\",get:function get(){return this._definitions;}}]);return ConfigurationManager;}(NitroManager);","map":null,"metadata":{},"sourceType":"module"}