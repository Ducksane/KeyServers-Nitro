{"ast":null,"code":"import _classCallCheck from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import{AvatarFigurePartType,AvatarScaleType,AvatarSetType,PetFigureData,RoomObjectCategory,RoomObjectType,RoomObjectVariable,RoomSessionChatEvent,RoomUserData,RoomWidgetEnum,SystemChatStyleEnum,TextureUtils,Vector3d}from'@nitrots/nitro-renderer';import{GetAvatarRenderManager,GetConfigurationManager,GetRoomEngine,PlaySound}from'../../../..';import{LocalizeText}from'../../../../utils/LocalizeText';import{GetRoomObjectScreenLocation}from'../../GetRoomObjectScreenLocation';import{RoomWidgetUpdateChatEvent}from'../events';import{RoomWidgetHandler}from'./RoomWidgetHandler';export var RoomWidgetChatHandler=/*#__PURE__*/function(_RoomWidgetHandler){_inherits(RoomWidgetChatHandler,_RoomWidgetHandler);var _super=_createSuper(RoomWidgetChatHandler);function RoomWidgetChatHandler(){var _this;_classCallCheck(this,RoomWidgetChatHandler);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this._avatarColorCache=new Map();_this._avatarImageCache=new Map();_this._petImageCache=new Map();return _this;}_createClass(RoomWidgetChatHandler,[{key:\"processEvent\",value:function processEvent(event){switch(event.type){case RoomSessionChatEvent.CHAT_EVENT:{var chatEvent=event;var roomObject=GetRoomEngine().getRoomObject(chatEvent.session.roomId,chatEvent.objectId,RoomObjectCategory.UNIT);var objectLocation=roomObject?roomObject.getLocation():new Vector3d();var bubbleLocation=GetRoomObjectScreenLocation(chatEvent.session.roomId,roomObject===null||roomObject===void 0?void 0:roomObject.id,RoomObjectCategory.UNIT);var userData=roomObject?this.container.roomSession.userDataManager.getUserDataByIndex(chatEvent.objectId):new RoomUserData(-1);var username='';var avatarColor=0;var imageUrl=null;var chatType=chatEvent.chatType;var styleId=chatEvent.style;var userType=0;var petType=-1;var text=chatEvent.message;if(userData){userType=userData.type;var figure=userData.figure;switch(userType){case RoomObjectType.PET:imageUrl=this.getPetImage(figure,2,true,64,roomObject.model.getValue(RoomObjectVariable.FIGURE_POSTURE));petType=new PetFigureData(figure).typeId;break;case RoomObjectType.USER:imageUrl=this.getUserImage(figure);break;case RoomObjectType.RENTABLE_BOT:case RoomObjectType.BOT:styleId=SystemChatStyleEnum.BOT;break;}avatarColor=this._avatarColorCache.get(figure);username=userData.name;}switch(chatType){case RoomSessionChatEvent.CHAT_TYPE_RESPECT:text=LocalizeText('widgets.chatbubble.respect',['username'],[username]);if(GetConfigurationManager().getValue('respect.options')['enabled'])PlaySound(GetConfigurationManager().getValue('respect.options')['sound']);break;case RoomSessionChatEvent.CHAT_TYPE_PETREVIVE:case RoomSessionChatEvent.CHAT_TYPE_PET_REBREED_FERTILIZE:case RoomSessionChatEvent.CHAT_TYPE_PET_SPEED_FERTILIZE:{var textKey='widget.chatbubble.petrevived';if(chatType===RoomSessionChatEvent.CHAT_TYPE_PET_REBREED_FERTILIZE){textKey='widget.chatbubble.petrefertilized;';}else if(chatType===RoomSessionChatEvent.CHAT_TYPE_PET_SPEED_FERTILIZE){textKey='widget.chatbubble.petspeedfertilized';}var targetUserName=null;var newRoomObject=GetRoomEngine().getRoomObject(chatEvent.session.roomId,chatEvent.extraParam,RoomObjectCategory.UNIT);if(newRoomObject){var newUserData=this.container.roomSession.userDataManager.getUserDataByIndex(roomObject.id);if(newUserData)targetUserName=newUserData.name;}text=LocalizeText(textKey,['petName','userName'],[username,targetUserName]);break;}case RoomSessionChatEvent.CHAT_TYPE_PETRESPECT:text=LocalizeText('widget.chatbubble.petrespect',['petname'],[username]);break;case RoomSessionChatEvent.CHAT_TYPE_PETTREAT:text=LocalizeText('widget.chatbubble.pettreat',['petname'],[username]);break;case RoomSessionChatEvent.CHAT_TYPE_HAND_ITEM_RECEIVED:text=LocalizeText('widget.chatbubble.handitem',['username','handitem'],[username,LocalizeText('handitem'+chatEvent.extraParam)]);break;case RoomSessionChatEvent.CHAT_TYPE_MUTE_REMAINING:{var hours=(chatEvent.extraParam>0?Math.floor(chatEvent.extraParam/3600):0).toString();var minutes=(chatEvent.extraParam>0?Math.floor(chatEvent.extraParam%3600/60):0).toString();var seconds=(chatEvent.extraParam%60).toString();text=LocalizeText('widget.chatbubble.mutetime',['hours','minutes','seconds'],[hours,minutes,seconds]);break;}}this.container.eventDispatcher.dispatchEvent(new RoomWidgetUpdateChatEvent(RoomWidgetUpdateChatEvent.CHAT_EVENT,userData.roomIndex,text,username,RoomObjectCategory.UNIT,userType,petType,bubbleLocation.x,bubbleLocation.y,imageUrl,avatarColor,chatEvent.session.roomId,chatType,styleId,[]));return;}}}},{key:\"processWidgetMessage\",value:function processWidgetMessage(message){return null;}},{key:\"getUserImage\",value:function getUserImage(figure){var existing=this._avatarImageCache.get(figure);if(!existing){existing=this.setFigureImage(figure);}return existing;}},{key:\"setFigureImage\",value:function setFigureImage(figure){var avatarImage=GetAvatarRenderManager().createAvatarImage(figure,AvatarScaleType.LARGE,null,this);if(!avatarImage)return;var image=avatarImage.getCroppedImage(AvatarSetType.HEAD);var color=avatarImage.getPartColor(AvatarFigurePartType.CHEST);this._avatarColorCache.set(figure,color&&color.rgb||16777215);avatarImage.dispose();this._avatarImageCache.set(figure,image.src);return image.src;}},{key:\"getPetImage\",value:function getPetImage(figure,direction,_arg_3){var scale=arguments.length>3&&arguments[3]!==undefined?arguments[3]:64;var posture=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var existing=this._petImageCache.get(figure+posture);if(existing)return existing;var figureData=new PetFigureData(figure);var typeId=figureData.typeId;var image=GetRoomEngine().getRoomObjectPetImage(typeId,figureData.paletteId,figureData.color,new Vector3d(direction*45),scale,null,false,0,figureData.customParts,posture);if(image){existing=TextureUtils.generateImageUrl(image.data);this._petImageCache.set(figure+posture,existing);}return existing;}},{key:\"resetFigure\",value:function resetFigure(figure){this.setFigureImage(figure);}},{key:\"dispose\",value:function dispose(){}},{key:\"disposed\",get:function get(){return false;}},{key:\"type\",get:function get(){return RoomWidgetEnum.CHAT_WIDGET;}},{key:\"eventTypes\",get:function get(){return[RoomSessionChatEvent.CHAT_EVENT];}},{key:\"messageTypes\",get:function get(){return[];}}]);return RoomWidgetChatHandler;}(RoomWidgetHandler);","map":null,"metadata":{},"sourceType":"module"}