{"ast":null,"code":"import _createForOfIteratorHelper from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _classCallCheck from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/createClass.js\";import{ActionDefinition}from'./ActionDefinition';export var AvatarActionManager=/*#__PURE__*/function(){function AvatarActionManager(k,data){_classCallCheck(this,AvatarActionManager);this._assets=void 0;this._actions=void 0;this._defaultAction=void 0;this._assets=k;this._actions=new Map();this._defaultAction=null;this.updateActions(data);}_createClass(AvatarActionManager,[{key:\"updateActions\",value:function updateActions(data){if(!data)return;var _iterator=_createForOfIteratorHelper(data.actions),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var action=_step.value;if(!action||!action.state)continue;var definition=new ActionDefinition(action);this._actions.set(definition.state,definition);}}catch(err){_iterator.e(err);}finally{_iterator.f();}if(data.actionOffsets)this.parseActionOffsets(data.actionOffsets);}},{key:\"parseActionOffsets\",value:function parseActionOffsets(offsets){if(!offsets||!offsets.length)return;var _iterator2=_createForOfIteratorHelper(offsets),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var offset=_step2.value;var action=this._actions.get(offset.action);if(!action)continue;var _iterator3=_createForOfIteratorHelper(offset.offsets),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var canvasOffset=_step3.value;var size=canvasOffset.size||'';var direction=canvasOffset.direction;if(size===''||direction===undefined)continue;var x=canvasOffset.x||0;var y=canvasOffset.y||0;var z=canvasOffset.z||0;action.setOffsets(size,direction,[x,y,z]);}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}}},{key:\"getActionDefinition\",value:function getActionDefinition(id){if(!id)return null;var _iterator4=_createForOfIteratorHelper(this._actions.values()),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var action=_step4.value;if(!action||action.id!==id)continue;return action;}}catch(err){_iterator4.e(err);}finally{_iterator4.f();}return null;}},{key:\"getActionDefinitionWithState\",value:function getActionDefinitionWithState(state){var existing=this._actions.get(state);if(!existing)return null;return existing;}},{key:\"getDefaultAction\",value:function getDefaultAction(){if(this._defaultAction)return this._defaultAction;var _iterator5=_createForOfIteratorHelper(this._actions.values()),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var action=_step5.value;if(!action||!action.isDefault)continue;this._defaultAction=action;return action;}}catch(err){_iterator5.e(err);}finally{_iterator5.f();}return null;}},{key:\"getCanvasOffsets\",value:function getCanvasOffsets(k,_arg_2,_arg_3){var canvasOffsets=[];var _iterator6=_createForOfIteratorHelper(k),_step6;try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var activeAction=_step6.value;if(!activeAction)continue;var action=this._actions.get(activeAction.actionType);var offsets=action&&action.getOffsets(_arg_2,_arg_3);if(offsets)canvasOffsets=offsets;}}catch(err){_iterator6.e(err);}finally{_iterator6.f();}return canvasOffsets;}},{key:\"sortActions\",value:function sortActions(actions){if(!actions)return null;actions=this.filterActions(actions);var validatedActions=[];var _iterator7=_createForOfIteratorHelper(actions),_step7;try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var action=_step7.value;if(!action)continue;var definition=this._actions.get(action.actionType);if(!definition)continue;action.definition=definition;validatedActions.push(action);}}catch(err){_iterator7.e(err);}finally{_iterator7.f();}validatedActions.sort(this.sortByPrecedence);return validatedActions;}},{key:\"filterActions\",value:function filterActions(actions){var preventions=[];var activeActions=[];var _iterator8=_createForOfIteratorHelper(actions),_step8;try{for(_iterator8.s();!(_step8=_iterator8.n()).done;){var action=_step8.value;if(!action)continue;var localAction=this._actions.get(action.actionType);if(localAction)preventions=preventions.concat(localAction.getPrevents(action.actionParameter));}}catch(err){_iterator8.e(err);}finally{_iterator8.f();}var _iterator9=_createForOfIteratorHelper(actions),_step9;try{for(_iterator9.s();!(_step9=_iterator9.n()).done;){var _action=_step9.value;if(!_action)continue;var actionType=_action.actionType;if(_action.actionType==='fx')actionType=actionType+('.'+_action.actionParameter);if(preventions.indexOf(actionType)>=0)continue;activeActions.push(_action);}}catch(err){_iterator9.e(err);}finally{_iterator9.f();}return activeActions;}},{key:\"sortByPrecedence\",value:function sortByPrecedence(actionOne,actionTwo){if(!actionOne||!actionTwo)return 0;var precedenceOne=actionOne.definition.precedence;var precedenceTwo=actionTwo.definition.precedence;if(precedenceOne<precedenceTwo)return 1;if(precedenceOne>precedenceTwo)return-1;return 0;}}]);return AvatarActionManager;}();","map":null,"metadata":{},"sourceType":"module"}