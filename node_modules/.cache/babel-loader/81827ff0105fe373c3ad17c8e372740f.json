{"ast":null,"code":"import _slicedToArray from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{BuyMarketplaceOfferMessageComposer,GetMarketplaceOffersMessageComposer,MarketplaceBuyOfferResultEvent,MarketPlaceOffersEvent}from'@nitrots/nitro-renderer';import{useCallback,useMemo,useState}from'react';import{LocalizeText,NotificationAlertType,NotificationUtilities,SendMessageComposer}from'../../../../../../api';import{Button,ButtonGroup,Column,Text}from'../../../../../../common';import{UseMessageEventHook,usePurse}from'../../../../../../hooks';import{CatalogLayoutMarketplaceItemView,PUBLIC_OFFER}from'./CatalogLayoutMarketplaceItemView';import{SearchFormView}from'./CatalogLayoutMarketplaceSearchFormView';import{MarketplaceOfferData}from'./common/MarketplaceOfferData';import{MarketplaceSearchType}from'./common/MarketplaceSearchType';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var SORT_TYPES_VALUE=[1,2];var SORT_TYPES_ACTIVITY=[3,4,5,6];var SORT_TYPES_ADVANCED=[1,2,3,4,5,6];export var CatalogLayoutMarketplacePublicItemsView=function CatalogLayoutMarketplacePublicItemsView(props){var _useState=useState(MarketplaceSearchType.BY_ACTIVITY),_useState2=_slicedToArray(_useState,2),searchType=_useState2[0],setSearchType=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),totalItemsFound=_useState4[0],setTotalItemsFound=_useState4[1];var _useState5=useState(new Map()),_useState6=_slicedToArray(_useState5,2),offers=_useState6[0],setOffers=_useState6[1];var _useState7=useState({minPrice:-1,maxPrice:-1,query:'',type:3}),_useState8=_slicedToArray(_useState7,2),lastSearch=_useState8[0],setLastSearch=_useState8[1];var _usePurse=usePurse(),_usePurse$getCurrency=_usePurse.getCurrencyAmount,getCurrencyAmount=_usePurse$getCurrency===void 0?null:_usePurse$getCurrency;var requestOffers=useCallback(function(options){setLastSearch(options);SendMessageComposer(new GetMarketplaceOffersMessageComposer(options.minPrice,options.maxPrice,options.query,options.type));},[]);var getSortTypes=useMemo(function(){switch(searchType){case MarketplaceSearchType.BY_ACTIVITY:return SORT_TYPES_ACTIVITY;case MarketplaceSearchType.BY_VALUE:return SORT_TYPES_VALUE;case MarketplaceSearchType.ADVANCED:return SORT_TYPES_ADVANCED;}return[];},[searchType]);var purchaseItem=useCallback(function(offerData){if(offerData.price>getCurrencyAmount(-1)){NotificationUtilities.simpleAlert(LocalizeText('catalog.alert.notenough.credits.description'),NotificationAlertType.DEFAULT,null,null,LocalizeText('catalog.alert.notenough.title'));return;}var offerId=offerData.offerId;NotificationUtilities.confirm(LocalizeText('catalog.marketplace.confirm_header'),function(){SendMessageComposer(new BuyMarketplaceOfferMessageComposer(offerId));},null,null,null,LocalizeText('catalog.marketplace.confirm_title'));},[getCurrencyAmount]);var onMarketPlaceOffersEvent=useCallback(function(event){var parser=event.getParser();if(!parser)return;var latestOffers=new Map();parser.offers.forEach(function(entry){var offerEntry=new MarketplaceOfferData(entry.offerId,entry.furniId,entry.furniType,entry.extraData,entry.stuffData,entry.price,entry.status,entry.averagePrice,entry.offerCount);offerEntry.timeLeftMinutes=entry.timeLeftMinutes;latestOffers.set(entry.offerId,offerEntry);});setTotalItemsFound(parser.totalItemsFound);setOffers(latestOffers);},[]);var onMarketplaceBuyOfferResultEvent=useCallback(function(event){var parser=event.getParser();if(!parser)return;switch(parser.result){case 1:requestOffers(lastSearch);break;case 2:setOffers(function(prev){var newVal=new Map(prev);newVal.delete(parser.requestedOfferId);return newVal;});NotificationUtilities.simpleAlert(LocalizeText('catalog.marketplace.not_available_header'),NotificationAlertType.DEFAULT,null,null,LocalizeText('catalog.marketplace.not_available_title'));break;case 3:// our shit was updated\n// todo: some dialogue modal \nsetOffers(function(prev){var newVal=new Map(prev);var item=newVal.get(parser.requestedOfferId);if(item){item.offerId=parser.offerId;item.price=parser.newPrice;item.offerCount--;newVal.set(item.offerId,item);}newVal.delete(parser.requestedOfferId);return newVal;});NotificationUtilities.confirm(LocalizeText('catalog.marketplace.confirm_higher_header')+'\\n'+LocalizeText('catalog.marketplace.confirm_price',['price'],[parser.newPrice.toString()]),function(){SendMessageComposer(new BuyMarketplaceOfferMessageComposer(parser.offerId));},null,null,null,LocalizeText('catalog.marketplace.confirm_higher_title'));break;case 4:NotificationUtilities.simpleAlert(LocalizeText('catalog.alert.notenough.credits.description'),NotificationAlertType.DEFAULT,null,null,LocalizeText('catalog.alert.notenough.title'));break;}},[lastSearch,requestOffers]);UseMessageEventHook(MarketPlaceOffersEvent,onMarketPlaceOffersEvent);UseMessageEventHook(MarketplaceBuyOfferResultEvent,onMarketplaceBuyOfferResultEvent);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(ButtonGroup,{children:[/*#__PURE__*/_jsx(Button,{active:searchType===MarketplaceSearchType.BY_ACTIVITY,onClick:function onClick(){return setSearchType(MarketplaceSearchType.BY_ACTIVITY);},children:LocalizeText('catalog.marketplace.search_by_activity')}),/*#__PURE__*/_jsx(Button,{active:searchType===MarketplaceSearchType.BY_VALUE,onClick:function onClick(){return setSearchType(MarketplaceSearchType.BY_VALUE);},children:LocalizeText('catalog.marketplace.search_by_value')}),/*#__PURE__*/_jsx(Button,{active:searchType===MarketplaceSearchType.ADVANCED,onClick:function onClick(){return setSearchType(MarketplaceSearchType.ADVANCED);},children:LocalizeText('catalog.marketplace.search_advanced')})]}),/*#__PURE__*/_jsx(SearchFormView,{sortTypes:getSortTypes,searchType:searchType,onSearch:requestOffers}),/*#__PURE__*/_jsxs(Column,{gap:1,overflow:\"hidden\",children:[/*#__PURE__*/_jsx(Text,{truncate:true,shrink:true,fontWeight:\"bold\",children:LocalizeText('catalog.marketplace.items_found',['count'],[offers.size.toString()])}),/*#__PURE__*/_jsx(Column,{className:\"nitro-catalog-layout-marketplace-grid\",overflow:\"auto\",children:Array.from(offers.values()).map(function(entry,index){return/*#__PURE__*/_jsx(CatalogLayoutMarketplaceItemView,{offerData:entry,type:PUBLIC_OFFER,onClick:purchaseItem},index);})})]})]});};","map":null,"metadata":{},"sourceType":"module"}