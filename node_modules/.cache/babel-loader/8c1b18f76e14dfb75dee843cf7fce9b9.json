{"ast":null,"code":"import _classCallCheck from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _assertThisInitialized from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";import _inherits from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import{Disposable}from'../../core/common/disposable/Disposable';import{NitroLogger}from'../../core/common/logger/NitroLogger';import{RoomObjectMouseEvent}from'../../room/events/RoomObjectMouseEvent';import{RoomObjectUpdateMessage}from'../../room/messages/RoomObjectUpdateMessage';import{RoomEnterEffect}from'../../room/utils/RoomEnterEffect';import{Vector3d}from'../../room/utils/Vector3d';import{FurnitureGroupInfoComposer,SetObjectDataMessageComposer}from'../communication';import{GetResolutionAchievementsMessageComposer}from'../communication/messages/outgoing/game/GetResolutionAchievementsMessageComposer';import{BotPlaceComposer}from'../communication/messages/outgoing/room/engine/BotPlaceComposer';import{GetItemDataComposer}from'../communication/messages/outgoing/room/engine/GetItemDataComposer';import{PetMoveComposer}from'../communication/messages/outgoing/room/engine/PetMoveComposer';import{PetPlaceComposer}from'../communication/messages/outgoing/room/engine/PetPlaceComposer';import{RemoveWallItemComposer}from'../communication/messages/outgoing/room/engine/RemoveWallItemComposer';import{SetItemDataMessageComposer}from'../communication/messages/outgoing/room/engine/SetItemDataMessageComposer';import{FurnitureFloorUpdateComposer}from'../communication/messages/outgoing/room/furniture/floor/FurnitureFloorUpdateComposer';import{FurniturePickupComposer}from'../communication/messages/outgoing/room/furniture/FurniturePickupComposer';import{FurniturePlaceComposer}from'../communication/messages/outgoing/room/furniture/FurniturePlaceComposer';import{FurniturePostItPlaceComposer}from'../communication/messages/outgoing/room/furniture/FurniturePostItPlaceComposer';import{FurnitureColorWheelComposer}from'../communication/messages/outgoing/room/furniture/logic/FurnitureColorWheelComposer';import{FurnitureDiceActivateComposer}from'../communication/messages/outgoing/room/furniture/logic/FurnitureDiceActivateComposer';import{FurnitureDiceDeactivateComposer}from'../communication/messages/outgoing/room/furniture/logic/FurnitureDiceDeactivateComposer';import{FurnitureMultiStateComposer}from'../communication/messages/outgoing/room/furniture/logic/FurnitureMultiStateComposer';import{FurnitureOneWayDoorComposer}from'../communication/messages/outgoing/room/furniture/logic/FurnitureOneWayDoorComposer';import{FurnitureRandomStateComposer}from'../communication/messages/outgoing/room/furniture/logic/FurnitureRandomStateComposer';import{FurnitureWallMultiStateComposer}from'../communication/messages/outgoing/room/furniture/logic/FurnitureWallMultiStateComposer';import{FurnitureWallUpdateComposer}from'../communication/messages/outgoing/room/furniture/wall/FurnitureWallUpdateComposer';import{RoomUnitLookComposer}from'../communication/messages/outgoing/room/unit/RoomUnitLookComposer';import{RoomUnitWalkComposer}from'../communication/messages/outgoing/room/unit/RoomUnitWalkComposer';import{Nitro}from'../Nitro';import{MouseEventType}from'../ui/MouseEventType';import{RoomObjectPlacementSource}from'./enums/RoomObjectPlacementSource';import{RoomEngineObjectPlaySoundEvent,RoomEngineRoomAdEvent,RoomEngineUseProductEvent,RoomObjectPlaySoundIdEvent,RoomObjectRoomAdEvent,RoomObjectSoundMachineEvent}from'./events';import{RoomEngineDimmerStateEvent}from'./events/RoomEngineDimmerStateEvent';import{RoomEngineObjectEvent}from'./events/RoomEngineObjectEvent';import{RoomEngineObjectPlacedEvent}from'./events/RoomEngineObjectPlacedEvent';import{RoomEngineObjectPlacedOnUserEvent}from'./events/RoomEngineObjectPlacedOnUserEvent';import{RoomEngineSamplePlaybackEvent}from'./events/RoomEngineSamplePlaybackEvent';import{RoomEngineTriggerWidgetEvent}from'./events/RoomEngineTriggerWidgetEvent';import{RoomObjectBadgeAssetEvent}from'./events/RoomObjectBadgeAssetEvent';import{RoomObjectDataRequestEvent}from'./events/RoomObjectDataRequestEvent';import{RoomObjectDimmerStateUpdateEvent}from'./events/RoomObjectDimmerStateUpdateEvent';import{RoomObjectFloorHoleEvent}from'./events/RoomObjectFloorHoleEvent';import{RoomObjectFurnitureActionEvent}from'./events/RoomObjectFurnitureActionEvent';import{RoomObjectHSLColorEnabledEvent}from'./events/RoomObjectHSLColorEnabledEvent';import{RoomObjectHSLColorEnableEvent}from'./events/RoomObjectHSLColorEnableEvent';import{RoomObjectMoveEvent}from'./events/RoomObjectMoveEvent';import{RoomObjectSamplePlaybackEvent}from'./events/RoomObjectSamplePlaybackEvent';import{RoomObjectStateChangedEvent}from'./events/RoomObjectStateChangedEvent';import{RoomObjectTileMouseEvent}from'./events/RoomObjectTileMouseEvent';import{RoomObjectWallMouseEvent}from'./events/RoomObjectWallMouseEvent';import{RoomObjectWidgetRequestEvent}from'./events/RoomObjectWidgetRequestEvent';import{ObjectAvatarSelectedMessage}from'./messages/ObjectAvatarSelectedMessage';import{ObjectDataUpdateMessage}from'./messages/ObjectDataUpdateMessage';import{ObjectSelectedMessage}from'./messages/ObjectSelectedMessage';import{ObjectTileCursorUpdateMessage}from'./messages/ObjectTileCursorUpdateMessage';import{ObjectVisibilityUpdateMessage}from'./messages/ObjectVisibilityUpdateMessage';import{RoomObjectCategory}from'./object/RoomObjectCategory';import{RoomObjectOperationType}from'./object/RoomObjectOperationType';import{RoomObjectType}from'./object/RoomObjectType';import{RoomObjectUserType}from'./object/RoomObjectUserType';import{RoomObjectVariable}from'./object/RoomObjectVariable';import{SelectedRoomObjectData}from'./utils/SelectedRoomObjectData';export var RoomObjectEventHandler=/*#__PURE__*/function(_Disposable){_inherits(RoomObjectEventHandler,_Disposable);var _super=_createSuper(RoomObjectEventHandler);function RoomObjectEventHandler(roomEngine){var _this;_classCallCheck(this,RoomObjectEventHandler);_this=_super.call(this);_this._roomEngine=void 0;_this._eventIds=void 0;_this._selectedAvatarId=void 0;_this._selectedObjectId=void 0;_this._selectedObjectCategory=void 0;_this._whereYouClickIsWhereYouGo=void 0;_this._objectPlacementSource=void 0;_this._roomEngine=roomEngine;_this._eventIds=new Map();_this._selectedAvatarId=-1;_this._selectedObjectId=-1;_this._selectedObjectCategory=-2;_this._whereYouClickIsWhereYouGo=true;_this._objectPlacementSource=null;_this.onRoomEngineObjectEvent=_this.onRoomEngineObjectEvent.bind(_assertThisInitialized(_this));_this._roomEngine.events.addEventListener(RoomEngineObjectEvent.ADDED,_this.onRoomEngineObjectEvent);return _this;}_createClass(RoomObjectEventHandler,[{key:\"dispose\",value:function dispose(){if(this._eventIds){this._eventIds=null;}this._roomEngine.events.removeEventListener(RoomEngineObjectEvent.ADDED,this.onRoomEngineObjectEvent);this._roomEngine=null;}},{key:\"onRoomEngineObjectEvent\",value:function onRoomEngineObjectEvent(event){var selectedData=this.getSelectedRoomObjectData(event.roomId);if(!selectedData)return;if(selectedData.operation===RoomObjectOperationType.OBJECT_PLACE&&selectedData.id===event.objectId){var roomObject=this._roomEngine.getRoomObject(event.roomId,selectedData.id,selectedData.category);if(roomObject&&roomObject.model){if(selectedData.category===RoomObjectCategory.FLOOR){var allowedDirections=roomObject.model.getValue(RoomObjectVariable.FURNITURE_ALLOWED_DIRECTIONS);if(allowedDirections&&allowedDirections.length){var direction=new Vector3d(allowedDirections[0]);roomObject.setDirection(direction);this.updateSelectedObjectData(event.roomId,selectedData.id,selectedData.category,selectedData.loc,direction,selectedData.operation,selectedData.typeId,selectedData.instanceData,selectedData.stuffData,selectedData.state,selectedData.animFrame,selectedData.posture);selectedData=this.getSelectedRoomObjectData(event.roomId);if(!selectedData)return;}}}this.setFurnitureAlphaMultiplier(roomObject,0.5);}}},{key:\"processRoomCanvasMouseEvent\",value:function processRoomCanvasMouseEvent(event,object,geometry){if(!event||!object)return;if(RoomEnterEffect.isRunning())return;var type=object.type;var category=this._roomEngine.getRoomObjectCategoryForType(type);if(category!==RoomObjectCategory.ROOM&&(!this._roomEngine.isPlayingGame()||category!==RoomObjectCategory.UNIT))category=RoomObjectCategory.MINIMUM;var _local_7=this.getMouseEventId(category,event.type);if(_local_7===event.eventId){if(event.type===MouseEventType.MOUSE_CLICK||event.type===MouseEventType.DOUBLE_CLICK||event.type===MouseEventType.MOUSE_DOWN||event.type===MouseEventType.MOUSE_UP||event.type===MouseEventType.MOUSE_MOVE)return;}else{if(event.eventId){this.setMouseEventId(category,event.type,event.eventId);}}if(object.mouseHandler)object.mouseHandler.mouseEvent(event,geometry);}},{key:\"processRoomObjectPlacement\",value:function processRoomObjectPlacement(placementSource,roomId,id,category,typeId){var extra=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var stuffData=arguments.length>6&&arguments[6]!==undefined?arguments[6]:null;var state=arguments.length>7&&arguments[7]!==undefined?arguments[7]:-1;var frameNumber=arguments.length>8&&arguments[8]!==undefined?arguments[8]:-1;var posture=arguments.length>9&&arguments[9]!==undefined?arguments[9]:null;this._objectPlacementSource=placementSource;var location=new Vector3d(-100,-100);var direction=new Vector3d(0);this.setSelectedRoomObjectData(roomId,id,category,location,direction,RoomObjectOperationType.OBJECT_PLACE,typeId,extra,stuffData,state,frameNumber,posture);if(this._roomEngine){this._roomEngine.setObjectMoverIconSprite(typeId,category,false,extra,stuffData,state,frameNumber,posture);this._roomEngine.setObjectMoverIconSpriteVisible(false);}return true;}},{key:\"cancelRoomObjectInsert\",value:function cancelRoomObjectInsert(k){this.resetSelectedObjectData(k);return true;}},{key:\"getMouseEventId\",value:function getMouseEventId(k,_arg_2){var existing=this._eventIds.get(k);if(!existing)return null;return existing.get(_arg_2)||null;}},{key:\"setMouseEventId\",value:function setMouseEventId(k,_arg_2,_arg_3){var existing=this._eventIds.get(k);if(!existing){existing=new Map();this._eventIds.set(k,existing);}existing.delete(_arg_2);existing.set(_arg_2,_arg_3);}},{key:\"handleRoomObjectEvent\",value:function handleRoomObjectEvent(event,roomId){if(!event)return;if(event instanceof RoomObjectMouseEvent){this.handleRoomObjectMouseEvent(event,roomId);return;}switch(event.type){case RoomObjectStateChangedEvent.STATE_CHANGE:case RoomObjectStateChangedEvent.STATE_RANDOM:this.onRoomObjectStateChangedEvent(event,roomId);return;case RoomObjectDimmerStateUpdateEvent.DIMMER_STATE:this.onRoomObjectDimmerStateUpdateEvent(event,roomId);return;case RoomObjectMoveEvent.POSITION_CHANGED:case RoomObjectMoveEvent.OBJECT_REMOVED:this.handleSelectedObjectRemove(event,roomId);return;case RoomObjectWidgetRequestEvent.OPEN_WIDGET:case RoomObjectWidgetRequestEvent.CLOSE_WIDGET:case RoomObjectWidgetRequestEvent.OPEN_FURNI_CONTEXT_MENU:case RoomObjectWidgetRequestEvent.CLOSE_FURNI_CONTEXT_MENU:case RoomObjectWidgetRequestEvent.PLACEHOLDER:case RoomObjectWidgetRequestEvent.CREDITFURNI:case RoomObjectWidgetRequestEvent.STICKIE:case RoomObjectWidgetRequestEvent.PRESENT:case RoomObjectWidgetRequestEvent.TROPHY:case RoomObjectWidgetRequestEvent.TEASER:case RoomObjectWidgetRequestEvent.ECOTRONBOX:case RoomObjectWidgetRequestEvent.DIMMER:case RoomObjectWidgetRequestEvent.WIDGET_REMOVE_DIMMER:case RoomObjectWidgetRequestEvent.CLOTHING_CHANGE:case RoomObjectWidgetRequestEvent.JUKEBOX_PLAYLIST_EDITOR:case RoomObjectWidgetRequestEvent.MANNEQUIN:case RoomObjectWidgetRequestEvent.PET_PRODUCT_MENU:case RoomObjectWidgetRequestEvent.GUILD_FURNI_CONTEXT_MENU:case RoomObjectWidgetRequestEvent.MONSTERPLANT_SEED_PLANT_CONFIRMATION_DIALOG:case RoomObjectWidgetRequestEvent.PURCHASABLE_CLOTHING_CONFIRMATION_DIALOG:case RoomObjectWidgetRequestEvent.BACKGROUND_COLOR:case RoomObjectWidgetRequestEvent.MYSTERYBOX_OPEN_DIALOG:case RoomObjectWidgetRequestEvent.EFFECTBOX_OPEN_DIALOG:case RoomObjectWidgetRequestEvent.MYSTERYTROPHY_OPEN_DIALOG:case RoomObjectWidgetRequestEvent.ACHIEVEMENT_RESOLUTION_OPEN:case RoomObjectWidgetRequestEvent.ACHIEVEMENT_RESOLUTION_ENGRAVING:case RoomObjectWidgetRequestEvent.ACHIEVEMENT_RESOLUTION_FAILED:case RoomObjectWidgetRequestEvent.FRIEND_FURNITURE_CONFIRM:case RoomObjectWidgetRequestEvent.FRIEND_FURNITURE_ENGRAVING:case RoomObjectWidgetRequestEvent.BADGE_DISPLAY_ENGRAVING:case RoomObjectWidgetRequestEvent.HIGH_SCORE_DISPLAY:case RoomObjectWidgetRequestEvent.HIDE_HIGH_SCORE_DISPLAY:case RoomObjectWidgetRequestEvent.INERNAL_LINK:case RoomObjectWidgetRequestEvent.ROOM_LINK:this.onRoomObjectWidgetRequestEvent(event,roomId);return;case RoomObjectFurnitureActionEvent.DICE_ACTIVATE:case RoomObjectFurnitureActionEvent.DICE_OFF:case RoomObjectFurnitureActionEvent.USE_HABBOWHEEL:case RoomObjectFurnitureActionEvent.STICKIE:case RoomObjectFurnitureActionEvent.ENTER_ONEWAYDOOR:this.onRoomObjectFurnitureActionEvent(event,roomId);return;case RoomObjectFurnitureActionEvent.SOUND_MACHINE_INIT:case RoomObjectFurnitureActionEvent.SOUND_MACHINE_START:case RoomObjectFurnitureActionEvent.SOUND_MACHINE_STOP:case RoomObjectFurnitureActionEvent.SOUND_MACHINE_DISPOSE:this.handleObjectSoundMachineEvent(event,roomId);return;case RoomObjectFurnitureActionEvent.JUKEBOX_INIT:case RoomObjectFurnitureActionEvent.JUKEBOX_START:case RoomObjectFurnitureActionEvent.JUKEBOX_MACHINE_STOP:case RoomObjectFurnitureActionEvent.JUKEBOX_DISPOSE:this.handleObjectJukeboxEvent(event,roomId);return;case RoomObjectFloorHoleEvent.ADD_HOLE:case RoomObjectFloorHoleEvent.REMOVE_HOLE:this.onRoomObjectFloorHoleEvent(event,roomId);return;case RoomObjectRoomAdEvent.ROOM_AD_FURNI_CLICK:case RoomObjectRoomAdEvent.ROOM_AD_FURNI_DOUBLE_CLICK:case RoomObjectRoomAdEvent.ROOM_AD_TOOLTIP_SHOW:case RoomObjectRoomAdEvent.ROOM_AD_TOOLTIP_HIDE:case RoomObjectRoomAdEvent.ROOM_AD_LOAD_IMAGE:this.onRoomObjectRoomAdEvent(event,roomId);return;case RoomObjectBadgeAssetEvent.LOAD_BADGE:this.onRoomObjectBadgeAssetEvent(event,roomId);return;case RoomObjectFurnitureActionEvent.MOUSE_ARROW:case RoomObjectFurnitureActionEvent.MOUSE_BUTTON:this.handleMousePointer(event,roomId);return;case RoomObjectPlaySoundIdEvent.PLAY_SOUND:case RoomObjectPlaySoundIdEvent.PLAY_SOUND_AT_PITCH:this.handleRoomObjectPlaySoundEvent(event,roomId);return;case RoomObjectSamplePlaybackEvent.ROOM_OBJECT_INITIALIZED:case RoomObjectSamplePlaybackEvent.ROOM_OBJECT_DISPOSED:case RoomObjectSamplePlaybackEvent.PLAY_SAMPLE:case RoomObjectSamplePlaybackEvent.CHANGE_PITCH:this.handleRoomObjectSamplePlaybackEvent(event,roomId);return;case RoomObjectHSLColorEnableEvent.ROOM_BACKGROUND_COLOR:this.onHSLColorEnableEvent(event,roomId);return;case RoomObjectDataRequestEvent.RODRE_CURRENT_USER_ID:case RoomObjectDataRequestEvent.RODRE_URL_PREFIX:this.onRoomObjectDataRequestEvent(event,roomId);return;default:NitroLogger.log(\"Unhandled Event: \".concat(event.constructor.name),\"Object ID: \".concat(event.object.id));return;}}},{key:\"handleRoomObjectMouseEvent\",value:function handleRoomObjectMouseEvent(event,roomId){if(!event||!event.type)return;switch(event.type){case RoomObjectMouseEvent.CLICK:this.handleRoomObjectMouseClickEvent(event,roomId);return;case RoomObjectMouseEvent.MOUSE_MOVE:this.handleRoomObjectMouseMoveEvent(event,roomId);return;case RoomObjectMouseEvent.MOUSE_DOWN:this.handleRoomObjectMouseDownEvent(event,roomId);return;case RoomObjectMouseEvent.MOUSE_DOWN_LONG:this.handleRoomObjectMouseDownLongEvent(event,roomId);return;case RoomObjectMouseEvent.MOUSE_ENTER:this.handleRoomObjectMouseEnterEvent(event,roomId);return;case RoomObjectMouseEvent.MOUSE_LEAVE:this.handleRoomObjectMouseLeaveEvent(event,roomId);return;}}},{key:\"handleRoomObjectMouseClickEvent\",value:function handleRoomObjectMouseClickEvent(event,roomId){if(!event)return;var operation=RoomObjectOperationType.OBJECT_UNDEFINED;var selectedData=this.getSelectedRoomObjectData(roomId);if(selectedData)operation=selectedData.operation;var didWalk=false;var didMove=false;if(this._whereYouClickIsWhereYouGo){if(!operation||operation===RoomObjectOperationType.OBJECT_UNDEFINED){didWalk=this.handleMoveTargetFurni(roomId,event);}}var category=this._roomEngine.getRoomObjectCategoryForType(event.objectType);switch(operation){case RoomObjectOperationType.OBJECT_MOVE:if(category===RoomObjectCategory.ROOM){if(selectedData){this.modifyRoomObject(roomId,selectedData.id,selectedData.category,RoomObjectOperationType.OBJECT_MOVE_TO);}}else if(category===RoomObjectCategory.UNIT){if(selectedData&&event.objectType===RoomObjectUserType.MONSTER_PLANT){this.modifyRoomObject(roomId,selectedData.id,selectedData.category,RoomObjectOperationType.OBJECT_MOVE_TO);}if(event.eventId)this.setMouseEventId(RoomObjectCategory.ROOM,MouseEventType.MOUSE_CLICK,event.eventId);this.placeObjectOnUser(roomId,event.objectId,category);}didMove=true;if(event.objectId!==-1)this.setSelectedObject(roomId,event.objectId,category);break;case RoomObjectOperationType.OBJECT_PLACE:if(category===RoomObjectCategory.ROOM){this.placeObject(roomId,event instanceof RoomObjectTileMouseEvent,event instanceof RoomObjectWallMouseEvent);}else if(category===RoomObjectCategory.UNIT){switch(event.objectType){case RoomObjectUserType.MONSTER_PLANT:case RoomObjectUserType.RENTABLE_BOT:this.placeObject(roomId,event instanceof RoomObjectTileMouseEvent,event instanceof RoomObjectWallMouseEvent);break;default:if(event.eventId){this.setMouseEventId(RoomObjectCategory.ROOM,MouseEventType.MOUSE_CLICK,event.eventId);}this.placeObjectOnUser(roomId,event.objectId,category);break;}}break;case RoomObjectOperationType.OBJECT_UNDEFINED:if(category===RoomObjectCategory.ROOM){if(!didWalk&&event instanceof RoomObjectTileMouseEvent)this.onRoomObjectTileMouseEvent(roomId,event);}else{this.setSelectedObject(roomId,event.objectId,category);didMove=false;if(category===RoomObjectCategory.UNIT){if(event.ctrlKey&&!event.altKey&&!event.shiftKey&&event.objectType===RoomObjectUserType.RENTABLE_BOT){this.modifyRoomObject(roomId,event.objectId,category,RoomObjectOperationType.OBJECT_PICKUP_BOT);}else if(event.ctrlKey&&!event.altKey&&!event.shiftKey&&event.objectType===RoomObjectUserType.MONSTER_PLANT){this.modifyRoomObject(roomId,event.objectId,category,RoomObjectOperationType.OBJECT_PICKUP_PET);}else if(!event.ctrlKey&&!event.altKey&&event.shiftKey&&event.objectType===RoomObjectUserType.MONSTER_PLANT){this.modifyRoomObject(roomId,event.objectId,category,RoomObjectOperationType.OBJECT_ROTATE_POSITIVE);}if(!this._roomEngine.isPlayingGame()){didWalk=true;}else{didMove=true;}}else if(category===RoomObjectCategory.FLOOR||category===RoomObjectCategory.WALL){if(event.altKey||event.ctrlKey||event.shiftKey){if(!event.ctrlKey&&!event.altKey&&event.shiftKey){if(category===RoomObjectCategory.FLOOR){if(this._roomEngine.events){this._roomEngine.events.dispatchEvent(new RoomEngineObjectEvent(RoomEngineObjectEvent.REQUEST_ROTATE,roomId,event.objectId,category));}}}else if(event.ctrlKey&&!event.altKey&&!event.shiftKey){this.modifyRoomObject(roomId,event.objectId,category,RoomObjectOperationType.OBJECT_PICKUP);}if(!this._roomEngine.isPlayingGame()){didWalk=true;}else{didMove=true;}}}if(event.eventId){if(didWalk){this.setMouseEventId(RoomObjectCategory.ROOM,MouseEventType.MOUSE_CLICK,event.eventId);}if(didMove){this.setMouseEventId(RoomObjectCategory.MINIMUM,MouseEventType.MOUSE_CLICK,event.eventId);}}}break;}if(category===RoomObjectCategory.ROOM){var _local_15=this.getMouseEventId(RoomObjectCategory.MINIMUM,MouseEventType.MOUSE_CLICK);var _local_16=this.getMouseEventId(RoomObjectCategory.UNIT,MouseEventType.MOUSE_CLICK);if(_local_15!==event.eventId&&_local_16!==event.eventId&&!didMove){this.deselectObject(roomId);if(this._roomEngine.events)this._roomEngine.events.dispatchEvent(new RoomEngineObjectEvent(RoomEngineObjectEvent.DESELECTED,roomId,-1,RoomObjectCategory.MINIMUM));this.setSelectedAvatar(roomId,0,false);}}}},{key:\"handleRoomObjectMouseMoveEvent\",value:function handleRoomObjectMouseMoveEvent(event,roomId){if(!event)return;var operation=RoomObjectOperationType.OBJECT_UNDEFINED;var selectedData=this.getSelectedRoomObjectData(roomId);if(selectedData)operation=selectedData.operation;var category=this._roomEngine.getRoomObjectCategoryForType(event.objectType);if(this._roomEngine){var roomCursor=this._roomEngine.getRoomObjectCursor(roomId);if(roomCursor&&roomCursor.logic){var newEvent=null;if(event instanceof RoomObjectTileMouseEvent){newEvent=this.handleMouseOverTile(event,roomId);}else if(event.object&&event.object.id!==-1){if(this._whereYouClickIsWhereYouGo){newEvent=this.handleMouseOverObject(category,roomId,event);}}else{newEvent=new ObjectTileCursorUpdateMessage(null,0,false,event.eventId);}roomCursor.processUpdateMessage(newEvent);}}switch(operation){case RoomObjectOperationType.OBJECT_MOVE:if(category===RoomObjectCategory.ROOM)this.handleObjectMove(event,roomId);return;case RoomObjectOperationType.OBJECT_PLACE:if(category===RoomObjectCategory.ROOM)this.handleObjectPlace(event,roomId);return;}}},{key:\"handleRoomObjectMouseDownEvent\",value:function handleRoomObjectMouseDownEvent(event,roomId){if(!event)return;var operation=RoomObjectOperationType.OBJECT_UNDEFINED;var selectedData=this.getSelectedRoomObjectData(roomId);if(selectedData)operation=selectedData.operation;var category=this._roomEngine.getRoomObjectCategoryForType(event.objectType);switch(operation){case RoomObjectOperationType.OBJECT_UNDEFINED:if(category===RoomObjectCategory.FLOOR||category===RoomObjectCategory.WALL||event.objectType===RoomObjectUserType.MONSTER_PLANT){if(event.altKey&&!event.ctrlKey&&!event.shiftKey||this.decorateModeMove(event)){if(this._roomEngine.events)this._roomEngine.events.dispatchEvent(new RoomEngineObjectEvent(RoomEngineObjectEvent.REQUEST_MOVE,roomId,event.objectId,category));}}return;}}},{key:\"handleRoomObjectMouseDownLongEvent\",value:function handleRoomObjectMouseDownLongEvent(event,roomId){if(!event)return;var operation=RoomObjectOperationType.OBJECT_UNDEFINED;var selectedData=this.getSelectedRoomObjectData(roomId);if(selectedData)operation=selectedData.operation;var category=this._roomEngine.getRoomObjectCategoryForType(event.objectType);switch(operation){case RoomObjectOperationType.OBJECT_UNDEFINED:if(category===RoomObjectCategory.FLOOR||category===RoomObjectCategory.WALL||event.objectType===RoomObjectUserType.MONSTER_PLANT){if(!event.ctrlKey&&!event.shiftKey||this.decorateModeMove(event)){if(this._roomEngine.events)this._roomEngine.events.dispatchEvent(new RoomEngineObjectEvent(RoomEngineObjectEvent.REQUEST_MANIPULATION,roomId,event.objectId,category));}}return;}}},{key:\"handleRoomObjectMouseEnterEvent\",value:function handleRoomObjectMouseEnterEvent(event,roomId){var id=event.objectId;var type=event.objectType;var category=this._roomEngine.getRoomObjectCategoryForType(type);if(this._roomEngine.events){this._roomEngine.events.dispatchEvent(new RoomEngineObjectEvent(RoomEngineObjectEvent.MOUSE_ENTER,roomId,id,category));}}},{key:\"handleRoomObjectMouseLeaveEvent\",value:function handleRoomObjectMouseLeaveEvent(event,roomId){var id=event.objectId;var type=event.objectType;var category=this._roomEngine.getRoomObjectCategoryForType(type);if(category!==RoomObjectCategory.ROOM){if(category===RoomObjectCategory.UNIT){var cursor=this._roomEngine.getRoomObjectCursor(roomId);if(cursor)cursor.processUpdateMessage(new ObjectDataUpdateMessage(0,null));}}if(this._roomEngine.events){this._roomEngine.events.dispatchEvent(new RoomEngineObjectEvent(RoomEngineObjectEvent.MOUSE_LEAVE,roomId,id,category));}return;}},{key:\"onRoomObjectStateChangedEvent\",value:function onRoomObjectStateChangedEvent(event,roomId){if(!event)return;switch(event.type){case RoomObjectStateChangedEvent.STATE_CHANGE:this.changeObjectState(roomId,event.object.id,event.object.type,event.state,false);return;case RoomObjectStateChangedEvent.STATE_RANDOM:this.changeObjectState(roomId,event.object.id,event.object.type,event.state,true);return;}}},{key:\"onRoomObjectDimmerStateUpdateEvent\",value:function onRoomObjectDimmerStateUpdateEvent(event,roomId){if(!event)return;switch(event.type){case RoomObjectDimmerStateUpdateEvent.DIMMER_STATE:this._roomEngine.events.dispatchEvent(new RoomEngineDimmerStateEvent(roomId,event.state,event.presetId,event.effectId,event.color,event.brightness));return;}}},{key:\"handleSelectedObjectRemove\",value:function handleSelectedObjectRemove(event,roomId){if(!event||!this._roomEngine)return;switch(event.type){case RoomObjectMoveEvent.POSITION_CHANGED:{var objectId=event.objectId;var objectType=event.objectType;var objectCategory=this._roomEngine.getRoomObjectCategoryForType(objectType);var object=this._roomEngine.getRoomObject(roomId,objectId,objectCategory);var selectionArrow=this._roomEngine.getRoomObjectSelectionArrow(roomId);if(object&&selectionArrow&&selectionArrow.logic){var location=object.getLocation();selectionArrow.logic.processUpdateMessage(new RoomObjectUpdateMessage(location,null));}return;}case RoomObjectMoveEvent.OBJECT_REMOVED:this.setSelectedAvatar(roomId,0,false);return;}}},{key:\"onRoomObjectWidgetRequestEvent\",value:function onRoomObjectWidgetRequestEvent(event,roomId){if(!event||!this._roomEngine)return;var objectId=event.objectId;var objectType=event.objectType;var objectCategory=this._roomEngine.getRoomObjectCategoryForType(objectType);var eventDispatcher=this._roomEngine.events;if(!eventDispatcher)return;switch(event.type){case RoomObjectWidgetRequestEvent.OPEN_WIDGET:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.OPEN_WIDGET,roomId,objectId,objectCategory,event.object.logic.widget));return;case RoomObjectWidgetRequestEvent.CLOSE_WIDGET:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.CLOSE_WIDGET,roomId,objectId,objectCategory,event.object.logic.widget));return;case RoomObjectWidgetRequestEvent.OPEN_FURNI_CONTEXT_MENU:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.OPEN_FURNI_CONTEXT_MENU,roomId,objectId,objectCategory,event.object.logic.contextMenu));return;case RoomObjectWidgetRequestEvent.CLOSE_FURNI_CONTEXT_MENU:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.CLOSE_FURNI_CONTEXT_MENU,roomId,objectId,objectCategory));return;case RoomObjectWidgetRequestEvent.PLACEHOLDER:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.REQUEST_PLACEHOLDER,roomId,objectId,objectCategory));return;case RoomObjectWidgetRequestEvent.CREDITFURNI:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.REQUEST_CREDITFURNI,roomId,objectId,objectCategory));return;case RoomObjectWidgetRequestEvent.STICKIE:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.REQUEST_STICKIE,roomId,objectId,objectCategory));return;case RoomObjectWidgetRequestEvent.PRESENT:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.REQUEST_PRESENT,roomId,objectId,objectCategory));return;case RoomObjectWidgetRequestEvent.TROPHY:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.REQUEST_TROPHY,roomId,objectId,objectCategory));return;case RoomObjectWidgetRequestEvent.TEASER:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.REQUEST_TEASER,roomId,objectId,objectCategory));return;case RoomObjectWidgetRequestEvent.ECOTRONBOX:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.REQUEST_ECOTRONBOX,roomId,objectId,objectCategory));return;case RoomObjectWidgetRequestEvent.DIMMER:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.REQUEST_DIMMER,roomId,objectId,objectCategory));return;case RoomObjectWidgetRequestEvent.WIDGET_REMOVE_DIMMER:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.REMOVE_DIMMER,roomId,objectId,objectCategory));return;case RoomObjectWidgetRequestEvent.CLOTHING_CHANGE:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.REQUEST_CLOTHING_CHANGE,roomId,objectId,objectCategory));return;case RoomObjectWidgetRequestEvent.JUKEBOX_PLAYLIST_EDITOR:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.REQUEST_PLAYLIST_EDITOR,roomId,objectId,objectCategory));return;case RoomObjectWidgetRequestEvent.MANNEQUIN:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.REQUEST_MANNEQUIN,roomId,objectId,objectCategory));return;case RoomObjectWidgetRequestEvent.PET_PRODUCT_MENU:eventDispatcher.dispatchEvent(new RoomEngineUseProductEvent(RoomEngineUseProductEvent.USE_PRODUCT_FROM_ROOM,roomId,objectId,objectCategory));return;case RoomObjectWidgetRequestEvent.GUILD_FURNI_CONTEXT_MENU:this._roomEngine.connection.send(new FurnitureGroupInfoComposer(event.objectId,event.object.model.getValue(RoomObjectVariable.FURNITURE_GUILD_CUSTOMIZED_GUILD_ID)));return;case RoomObjectWidgetRequestEvent.MONSTERPLANT_SEED_PLANT_CONFIRMATION_DIALOG:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.REQUEST_MONSTERPLANT_SEED_PLANT_CONFIRMATION_DIALOG,roomId,objectId,objectCategory));return;case RoomObjectWidgetRequestEvent.PURCHASABLE_CLOTHING_CONFIRMATION_DIALOG:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.REQUEST_PURCHASABLE_CLOTHING_CONFIRMATION_DIALOG,roomId,objectId,objectCategory));return;case RoomObjectWidgetRequestEvent.BACKGROUND_COLOR:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.REQUEST_BACKGROUND_COLOR,roomId,objectId,objectCategory));return;case RoomObjectWidgetRequestEvent.MYSTERYBOX_OPEN_DIALOG:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.REQUEST_MYSTERYBOX_OPEN_DIALOG,roomId,objectId,objectCategory));return;case RoomObjectWidgetRequestEvent.EFFECTBOX_OPEN_DIALOG:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.REQUEST_EFFECTBOX_OPEN_DIALOG,roomId,objectId,objectCategory));return;case RoomObjectWidgetRequestEvent.MYSTERYTROPHY_OPEN_DIALOG:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.REQUEST_MYSTERYTROPHY_OPEN_DIALOG,roomId,objectId,objectCategory));return;case RoomObjectWidgetRequestEvent.ACHIEVEMENT_RESOLUTION_OPEN:this._roomEngine.connection.send(new GetResolutionAchievementsMessageComposer(event.objectId,0));return;case RoomObjectWidgetRequestEvent.ACHIEVEMENT_RESOLUTION_ENGRAVING:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.REQUEST_ACHIEVEMENT_RESOLUTION_ENGRAVING,roomId,objectId,objectCategory));return;case RoomObjectWidgetRequestEvent.ACHIEVEMENT_RESOLUTION_FAILED:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.REQUEST_ACHIEVEMENT_RESOLUTION_FAILED,roomId,objectId,objectCategory));return;case RoomObjectWidgetRequestEvent.FRIEND_FURNITURE_CONFIRM:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.REQUEST_FRIEND_FURNITURE_CONFIRM,roomId,objectId,objectCategory));return;case RoomObjectWidgetRequestEvent.FRIEND_FURNITURE_ENGRAVING:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.REQUEST_FRIEND_FURNITURE_ENGRAVING,roomId,objectId,objectCategory));return;case RoomObjectWidgetRequestEvent.BADGE_DISPLAY_ENGRAVING:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.REQUEST_BADGE_DISPLAY_ENGRAVING,roomId,objectId,objectCategory));return;case RoomObjectWidgetRequestEvent.HIGH_SCORE_DISPLAY:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.REQUEST_HIGH_SCORE_DISPLAY,roomId,objectId,objectCategory));return;case RoomObjectWidgetRequestEvent.HIDE_HIGH_SCORE_DISPLAY:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.REQUEST_HIDE_HIGH_SCORE_DISPLAY,roomId,objectId,objectCategory));return;case RoomObjectWidgetRequestEvent.INERNAL_LINK:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.REQUEST_INTERNAL_LINK,roomId,objectId,objectCategory));return;case RoomObjectWidgetRequestEvent.ROOM_LINK:eventDispatcher.dispatchEvent(new RoomEngineTriggerWidgetEvent(RoomEngineTriggerWidgetEvent.REQUEST_ROOM_LINK,roomId,objectId,objectCategory));return;}}},{key:\"onRoomObjectFurnitureActionEvent\",value:function onRoomObjectFurnitureActionEvent(event,roomId){if(!event)return;this.useObject(roomId,event.object.id,event.object.type,event.type);}},{key:\"handleObjectSoundMachineEvent\",value:function handleObjectSoundMachineEvent(event,roomId){if(!event)return;var objectCategory=this._roomEngine.getRoomObjectCategoryForType(event.objectType);var selectedData=this.getSelectedRoomObjectData(roomId);if(selectedData){if(selectedData.category===objectCategory&&selectedData.id===event.objectId){if(selectedData.operation===RoomObjectOperationType.OBJECT_PLACE)return;}}switch(event.type){case RoomObjectFurnitureActionEvent.SOUND_MACHINE_INIT:this._roomEngine.events.dispatchEvent(new RoomObjectSoundMachineEvent(RoomObjectSoundMachineEvent.SOUND_MACHINE_INIT,roomId,event.objectId,objectCategory));return;case RoomObjectFurnitureActionEvent.SOUND_MACHINE_START:this._roomEngine.events.dispatchEvent(new RoomObjectSoundMachineEvent(RoomObjectSoundMachineEvent.SOUND_MACHINE_SWITCHED_ON,roomId,event.objectId,objectCategory));return;case RoomObjectFurnitureActionEvent.SOUND_MACHINE_STOP:this._roomEngine.events.dispatchEvent(new RoomObjectSoundMachineEvent(RoomObjectSoundMachineEvent.SOUND_MACHINE_SWITCHED_OFF,roomId,event.objectId,objectCategory));return;case RoomObjectFurnitureActionEvent.SOUND_MACHINE_DISPOSE:this._roomEngine.events.dispatchEvent(new RoomObjectSoundMachineEvent(RoomObjectSoundMachineEvent.SOUND_MACHINE_DISPOSE,roomId,event.objectId,objectCategory));return;}}},{key:\"handleObjectJukeboxEvent\",value:function handleObjectJukeboxEvent(event,roomId){if(!event)return;var objectCategory=this._roomEngine.getRoomObjectCategoryForType(event.objectType);var selectedData=this.getSelectedRoomObjectData(roomId);if(selectedData){if(selectedData.category===objectCategory&&selectedData.id===event.objectId){if(selectedData.operation===RoomObjectOperationType.OBJECT_PLACE)return;}}switch(event.type){case RoomObjectFurnitureActionEvent.JUKEBOX_INIT:this._roomEngine.events.dispatchEvent(new RoomObjectSoundMachineEvent(RoomObjectSoundMachineEvent.JUKEBOX_INIT,roomId,event.objectId,objectCategory));return;case RoomObjectFurnitureActionEvent.JUKEBOX_START:this._roomEngine.events.dispatchEvent(new RoomObjectSoundMachineEvent(RoomObjectSoundMachineEvent.JUKEBOX_SWITCHED_ON,roomId,event.objectId,objectCategory));return;case RoomObjectFurnitureActionEvent.JUKEBOX_MACHINE_STOP:this._roomEngine.events.dispatchEvent(new RoomObjectSoundMachineEvent(RoomObjectSoundMachineEvent.JUKEBOX_SWITCHED_OFF,roomId,event.objectId,objectCategory));return;case RoomObjectFurnitureActionEvent.JUKEBOX_DISPOSE:this._roomEngine.events.dispatchEvent(new RoomObjectSoundMachineEvent(RoomObjectSoundMachineEvent.JUKEBOX_DISPOSE,roomId,event.objectId,objectCategory));return;}}},{key:\"onRoomObjectFloorHoleEvent\",value:function onRoomObjectFloorHoleEvent(event,roomId){if(!event)return;switch(event.type){case RoomObjectFloorHoleEvent.ADD_HOLE:this._roomEngine.addRoomInstanceFloorHole(roomId,event.objectId);return;case RoomObjectFloorHoleEvent.REMOVE_HOLE:this._roomEngine.removeRoomInstanceFloorHole(roomId,event.objectId);return;}}},{key:\"onRoomObjectRoomAdEvent\",value:function onRoomObjectRoomAdEvent(event,roomId){if(!event)return;var eventType=null;switch(event.type){case RoomObjectRoomAdEvent.ROOM_AD_FURNI_CLICK:this._roomEngine.events.dispatchEvent(event);if(event.clickUrl&&event.clickUrl.length>0){Nitro.instance.createLinkEvent(event.clickUrl);}eventType=RoomEngineRoomAdEvent.FURNI_CLICK;break;case RoomObjectRoomAdEvent.ROOM_AD_FURNI_DOUBLE_CLICK:if(event.clickUrl&&event.clickUrl.length>0){var catalogPage='CATALOG_PAGE';if(event.clickUrl.indexOf(catalogPage)===0){Nitro.instance.createLinkEvent(event.clickUrl.substr(catalogPage.length));}}eventType=RoomEngineRoomAdEvent.FURNI_DOUBLE_CLICK;break;case RoomObjectRoomAdEvent.ROOM_AD_TOOLTIP_SHOW:eventType=RoomEngineRoomAdEvent.TOOLTIP_SHOW;break;case RoomObjectRoomAdEvent.ROOM_AD_TOOLTIP_HIDE:eventType=RoomEngineRoomAdEvent.TOOLTIP_HIDE;break;}if(eventType)this._roomEngine.events.dispatchEvent(new RoomEngineObjectEvent(eventType,roomId,event.objectId,this._roomEngine.getRoomObjectCategoryForType(event.objectType)));}},{key:\"onRoomObjectBadgeAssetEvent\",value:function onRoomObjectBadgeAssetEvent(event,roomId){if(!event||!this._roomEngine)return;switch(event.type){case RoomObjectBadgeAssetEvent.LOAD_BADGE:{var objectId=event.objectId;var objectType=event.objectType;var objectCategory=this._roomEngine.getRoomObjectCategoryForType(objectType);this._roomEngine.loadRoomObjectBadgeImage(roomId,objectId,objectCategory,event.badgeId,event.groupBadge);return;}}}},{key:\"handleMousePointer\",value:function handleMousePointer(event,roomId){if(!event)return;this._roomEngine.updateMousePointer(event.type,event.objectId,event.objectType);}},{key:\"handleRoomObjectPlaySoundEvent\",value:function handleRoomObjectPlaySoundEvent(event,roomId){var objectCategory=this._roomEngine.getRoomObjectCategoryForType(event.objectType);switch(event.type){case RoomObjectPlaySoundIdEvent.PLAY_SOUND:this._roomEngine.events.dispatchEvent(new RoomEngineObjectPlaySoundEvent(RoomEngineObjectPlaySoundEvent.PLAY_SOUND,roomId,event.objectId,objectCategory,event.soundId,event.pitch));return;case RoomObjectPlaySoundIdEvent.PLAY_SOUND_AT_PITCH:this._roomEngine.events.dispatchEvent(new RoomEngineObjectPlaySoundEvent(RoomEngineObjectPlaySoundEvent.PLAY_SOUND_AT_PITCH,roomId,event.objectId,objectCategory,event.soundId,event.pitch));return;}}},{key:\"handleRoomObjectSamplePlaybackEvent\",value:function handleRoomObjectSamplePlaybackEvent(event,roomId){if(!event)return;var objectCategory=this._roomEngine.getRoomObjectCategoryForType(event.objectType);switch(event.type){case RoomObjectSamplePlaybackEvent.ROOM_OBJECT_INITIALIZED:this._roomEngine.events.dispatchEvent(new RoomEngineSamplePlaybackEvent(RoomEngineSamplePlaybackEvent.ROOM_OBJECT_INITIALIZED,roomId,event.objectId,objectCategory,event.sampleId,event.pitch));break;case RoomObjectSamplePlaybackEvent.ROOM_OBJECT_DISPOSED:this._roomEngine.events.dispatchEvent(new RoomEngineSamplePlaybackEvent(RoomEngineSamplePlaybackEvent.ROOM_OBJECT_DISPOSED,roomId,event.objectId,objectCategory,event.sampleId,event.pitch));break;case RoomObjectSamplePlaybackEvent.PLAY_SAMPLE:this._roomEngine.events.dispatchEvent(new RoomEngineSamplePlaybackEvent(RoomEngineSamplePlaybackEvent.PLAY_SAMPLE,roomId,event.objectId,objectCategory,event.sampleId,event.pitch));break;case RoomObjectSamplePlaybackEvent.CHANGE_PITCH:this._roomEngine.events.dispatchEvent(new RoomEngineSamplePlaybackEvent(RoomEngineSamplePlaybackEvent.CHANGE_PITCH,roomId,event.objectId,objectCategory,event.sampleId,event.pitch));break;}}},{key:\"onHSLColorEnableEvent\",value:function onHSLColorEnableEvent(event,roomId){if(!event||!this._roomEngine)return;switch(event.type){case RoomObjectHSLColorEnableEvent.ROOM_BACKGROUND_COLOR:this._roomEngine.events.dispatchEvent(new RoomObjectHSLColorEnabledEvent(RoomObjectHSLColorEnabledEvent.ROOM_BACKGROUND_COLOR,roomId,event.enable,event.hue,event.saturation,event.lightness));return;}}},{key:\"onRoomObjectDataRequestEvent\",value:function onRoomObjectDataRequestEvent(event,roomId){if(!event||!this._roomEngine||!event.object)return;switch(event.type){case RoomObjectDataRequestEvent.RODRE_CURRENT_USER_ID:event.object.model.setValue(RoomObjectVariable.SESSION_CURRENT_USER_ID,this._roomEngine.sessionDataManager.userId);return;case RoomObjectDataRequestEvent.RODRE_URL_PREFIX:event.object.model.setValue(RoomObjectVariable.SESSION_URL_PREFIX,Nitro.instance.getConfiguration('url.prefix'));return;}}},{key:\"onRoomObjectTileMouseEvent\",value:function onRoomObjectTileMouseEvent(roomId,event){if(!this._roomEngine||this._roomEngine.isDecorating||!this._roomEngine.roomSessionManager)return;var session=this._roomEngine.roomSessionManager.getSession(roomId);if(!session||session.isSpectator)return;this.sendWalkUpdate(event.tileXAsInt,event.tileYAsInt);}},{key:\"handleObjectMove\",value:function handleObjectMove(event,roomId){if(!event||!this._roomEngine)return;var eventDispatcher=this._roomEngine.events;if(!eventDispatcher)return;var selectedData=this.getSelectedRoomObjectData(roomId);if(!selectedData)return;var roomObject=this._roomEngine.getRoomObject(roomId,selectedData.id,selectedData.category);if(!roomObject)return;var _local_6=true;if(selectedData.category===RoomObjectCategory.FLOOR||selectedData.category===RoomObjectCategory.UNIT){var stackingHeightMap=this._roomEngine.getFurnitureStackingHeightMap(roomId);if(!(event instanceof RoomObjectTileMouseEvent&&this.handleFurnitureMove(roomObject,selectedData,Math.trunc(event.tileX+0.5),Math.trunc(event.tileY+0.5),stackingHeightMap))){this.handleFurnitureMove(roomObject,selectedData,selectedData.loc.x,selectedData.loc.y,stackingHeightMap);_local_6=false;}}else if(selectedData.category===RoomObjectCategory.WALL){_local_6=false;if(event instanceof RoomObjectWallMouseEvent){var _local_10=event.wallLocation;var _local_11=event.wallWidth;var _local_12=event.wallHeight;var _local_13=event.x;var _local_14=event.y;var _local_15=event.direction;if(this.handleWallItemMove(roomObject,selectedData,_local_10,_local_11,_local_12,_local_13,_local_14,_local_15)){_local_6=true;}}if(!_local_6){roomObject.setLocation(selectedData.loc);roomObject.setDirection(selectedData.dir);}this._roomEngine.updateRoomObjectMask(roomId,selectedData.id,_local_6);}if(_local_6){this.setFurnitureAlphaMultiplier(roomObject,0.5);this._roomEngine.setObjectMoverIconSpriteVisible(false);}else{this.setFurnitureAlphaMultiplier(roomObject,0);this._roomEngine.setObjectMoverIconSpriteVisible(true);}}},{key:\"handleObjectPlace\",value:function handleObjectPlace(event,roomId){if(!event||!this._roomEngine)return;var eventDispatcher=this._roomEngine.events;if(!eventDispatcher)return;var selectedData=this.getSelectedRoomObjectData(roomId);if(!selectedData)return;var roomObject=this._roomEngine.getRoomObject(roomId,selectedData.id,selectedData.category);if(!roomObject){if(event instanceof RoomObjectTileMouseEvent){if(selectedData.category===RoomObjectCategory.FLOOR){this._roomEngine.addFurnitureFloor(roomId,selectedData.id,selectedData.typeId,selectedData.loc,selectedData.dir,0,selectedData.stuffData,parseFloat(selectedData.instanceData),-1,0,0,'',false);}else if(selectedData.category===RoomObjectCategory.UNIT){this._roomEngine.addRoomObjectUser(roomId,selectedData.id,new Vector3d(),new Vector3d(180),180,selectedData.typeId,selectedData.instanceData);var _roomObject=this._roomEngine.getRoomObject(roomId,selectedData.id,selectedData.category);_roomObject&&selectedData.posture&&_roomObject.model.setValue(RoomObjectVariable.FIGURE_POSTURE,selectedData.posture);}}else if(event instanceof RoomObjectWallMouseEvent){if(selectedData.category===RoomObjectCategory.WALL){this._roomEngine.addFurnitureWall(roomId,selectedData.id,selectedData.typeId,selectedData.loc,selectedData.dir,0,selectedData.instanceData,0);}}roomObject=this._roomEngine.getRoomObject(roomId,selectedData.id,selectedData.category);if(roomObject){if(selectedData.category===RoomObjectCategory.FLOOR){var allowedDirections=roomObject.model.getValue(RoomObjectVariable.FURNITURE_ALLOWED_DIRECTIONS);if(allowedDirections&&allowedDirections.length){var direction=new Vector3d(allowedDirections[0]);roomObject.setDirection(direction);this.updateSelectedObjectData(roomId,selectedData.id,selectedData.category,selectedData.loc,direction,selectedData.operation,selectedData.typeId,selectedData.instanceData,selectedData.stuffData,selectedData.state,selectedData.animFrame,selectedData.posture);selectedData=this.getSelectedRoomObjectData(roomId);if(!selectedData)return;}}}this.setFurnitureAlphaMultiplier(roomObject,0.5);this._roomEngine.setObjectMoverIconSpriteVisible(true);}if(roomObject){var _local_12=true;var stackingHeightMap=this._roomEngine.getFurnitureStackingHeightMap(roomId);if(selectedData.category===RoomObjectCategory.FLOOR){if(!(event instanceof RoomObjectTileMouseEvent&&this.handleFurnitureMove(roomObject,selectedData,Math.trunc(event.tileX+0.5),Math.trunc(event.tileY+0.5),stackingHeightMap))){this._roomEngine.removeRoomObjectFloor(roomId,selectedData.id);_local_12=false;}}else if(selectedData.category===RoomObjectCategory.WALL){_local_12=false;if(event instanceof RoomObjectWallMouseEvent){var _local_14=event.wallLocation;var _local_15=event.wallWidth;var _local_16=event.wallHeight;var _local_17=event.x;var _local_18=event.y;var _local_19=event.direction;if(this.handleWallItemMove(roomObject,selectedData,_local_14,_local_15,_local_16,_local_17,_local_18,_local_19)){_local_12=true;}}if(!_local_12){this._roomEngine.removeRoomObjectWall(roomId,selectedData.id);}this._roomEngine.updateRoomObjectMask(roomId,selectedData.id,_local_12);}else if(selectedData.category===RoomObjectCategory.UNIT){if(!(event instanceof RoomObjectTileMouseEvent&&this.handleUserPlace(roomObject,Math.trunc(event.tileX+0.5),Math.trunc(event.tileY+0.5),this._roomEngine.getLegacyWallGeometry(roomId)))){this._roomEngine.removeRoomObjectUser(roomId,selectedData.id);_local_12=false;}}this._roomEngine.setObjectMoverIconSpriteVisible(!_local_12);}}},{key:\"handleFurnitureMove\",value:function handleFurnitureMove(roomObject,selectedObjectData,x,y,stackingHeightMap){if(!roomObject||!selectedObjectData)return false;var _local_6=new Vector3d();_local_6.assign(roomObject.getDirection());roomObject.setDirection(selectedObjectData.dir);var _local_7=new Vector3d(x,y,0);var _local_8=new Vector3d();_local_8.assign(roomObject.getDirection());var _local_9=this.validateFurnitureLocation(roomObject,_local_7,selectedObjectData.loc,selectedObjectData.dir,stackingHeightMap);if(!_local_9){_local_8.x=this.getValidRoomObjectDirection(roomObject,true);roomObject.setDirection(_local_8);_local_9=this.validateFurnitureLocation(roomObject,_local_7,selectedObjectData.loc,selectedObjectData.dir,stackingHeightMap);}if(!_local_9){roomObject.setDirection(_local_6);return false;}roomObject.setLocation(_local_9);if(_local_8)roomObject.setDirection(_local_8);return true;}},{key:\"handleWallItemMove\",value:function handleWallItemMove(k,_arg_2,_arg_3,_arg_4,_arg_5,_arg_6,_arg_7,_arg_8){if(!k||!_arg_2)return false;var _local_9=new Vector3d(_arg_8);var _local_10=this.validateWallItemLocation(k,_arg_3,_arg_4,_arg_5,_arg_6,_arg_7,_arg_2);if(!_local_10)return false;k.setLocation(_local_10);k.setDirection(_local_9);return true;}},{key:\"validateFurnitureLocation\",value:function validateFurnitureLocation(k,_arg_2,_arg_3,_arg_4,_arg_5){if(!k||!k.model||!_arg_2)return null;var _local_15=null;var _local_6=k.getDirection();if(!_local_6)return null;if(!_arg_3||!_arg_4)return null;if(_arg_2.x===_arg_3.x&&_arg_2.y===_arg_3.y){if(_local_6.x===_arg_4.x){_local_15=new Vector3d();_local_15.assign(_arg_3);return _local_15;}}var sizeX=k.model.getValue(RoomObjectVariable.FURNITURE_SIZE_X);var sizeY=k.model.getValue(RoomObjectVariable.FURNITURE_SIZE_Y);if(sizeX<1)sizeX=1;if(sizeY<1)sizeY=1;var _local_9=_arg_3.x;var _local_10=_arg_3.y;var _local_11=sizeX;var _local_12=sizeY;var _local_13=0;var _local_14=Math.trunc(Math.trunc(_local_6.x+45)%360/90);if(_local_14===1||_local_14===3){_local_13=sizeX;sizeX=sizeY;sizeY=_local_13;}_local_14=Math.trunc(Math.trunc(_arg_4.x+45)%360/90);if(_local_14===1||_local_14===3){_local_13=_local_11;_local_11=_local_12;_local_12=_local_13;}if(_arg_5&&_arg_2){var stackable=k.model.getValue(RoomObjectVariable.FURNITURE_ALWAYS_STACKABLE)===1;if(_arg_5.validateLocation(_arg_2.x,_arg_2.y,sizeX,sizeY,_local_9,_local_10,_local_11,_local_12,stackable)){return new Vector3d(_arg_2.x,_arg_2.y,_arg_5.getTileHeight(_arg_2.x,_arg_2.y));}return null;}return null;}},{key:\"validateWallItemLocation\",value:function validateWallItemLocation(k,_arg_2,_arg_3,_arg_4,_arg_5,_arg_6,_arg_7){if(k==null||k.model==null||_arg_2==null||_arg_3==null||_arg_4==null||_arg_7==null)return null;var _local_8=k.model.getValue(RoomObjectVariable.FURNITURE_SIZE_X);var _local_9=k.model.getValue(RoomObjectVariable.FURNITURE_SIZE_Z);var _local_10=k.model.getValue(RoomObjectVariable.FURNITURE_CENTER_Z);if(_arg_5<_local_8/2||_arg_5>_arg_3.length-_local_8/2||_arg_6<_local_10||_arg_6>_arg_4.length-(_local_9-_local_10)){if(_arg_5<_local_8/2&&_arg_5<=_arg_3.length-_local_8/2){_arg_5=_local_8/2;}else{if(_arg_5>=_local_8/2&&_arg_5>_arg_3.length-_local_8/2){_arg_5=_arg_3.length-_local_8/2;}}if(_arg_6<_local_10&&_arg_6<=_arg_4.length-(_local_9-_local_10)){_arg_6=_local_10;}else{if(_arg_6>=_local_10&&_arg_6>_arg_4.length-(_local_9-_local_10)){_arg_6=_arg_4.length-(_local_9-_local_10);}}}if(_arg_5<_local_8/2||_arg_5>_arg_3.length-_local_8/2||_arg_6<_local_10||_arg_6>_arg_4.length-(_local_9-_local_10)){return null;}var _local_11=Vector3d.sum(Vector3d.product(_arg_3,_arg_5/_arg_3.length),Vector3d.product(_arg_4,_arg_6/_arg_4.length));_local_11=Vector3d.sum(_arg_2,_local_11);return _local_11;}},{key:\"changeObjectState\",value:function changeObjectState(roomId,objectId,type,state,isRandom){var category=this._roomEngine.getRoomObjectCategoryForType(type);this.changeRoomObjectState(roomId,objectId,category,state,isRandom);}},{key:\"useObject\",value:function useObject(roomId,objectId,type,action){if(!this._roomEngine||!this._roomEngine.connection)return;switch(action){case RoomObjectFurnitureActionEvent.DICE_ACTIVATE:this._roomEngine.connection.send(new FurnitureDiceActivateComposer(objectId));return;case RoomObjectFurnitureActionEvent.DICE_OFF:this._roomEngine.connection.send(new FurnitureDiceDeactivateComposer(objectId));return;case RoomObjectFurnitureActionEvent.USE_HABBOWHEEL:this._roomEngine.connection.send(new FurnitureColorWheelComposer(objectId));return;case RoomObjectFurnitureActionEvent.STICKIE:this._roomEngine.connection.send(new GetItemDataComposer(objectId));return;case RoomObjectFurnitureActionEvent.ENTER_ONEWAYDOOR:this._roomEngine.connection.send(new FurnitureOneWayDoorComposer(objectId));return;}}},{key:\"changeRoomObjectState\",value:function changeRoomObjectState(roomId,objectId,category,state,isRandom){if(!this._roomEngine||!this._roomEngine.connection)return true;if(category===RoomObjectCategory.FLOOR){if(!isRandom){this._roomEngine.connection.send(new FurnitureMultiStateComposer(objectId,state));}else{this._roomEngine.connection.send(new FurnitureRandomStateComposer(objectId,state));}}else if(category===RoomObjectCategory.WALL){this._roomEngine.connection.send(new FurnitureWallMultiStateComposer(objectId,state));}return true;}},{key:\"sendWalkUpdate\",value:function sendWalkUpdate(x,y){if(!this._roomEngine||!this._roomEngine.connection)return;this._roomEngine.connection.send(new RoomUnitWalkComposer(x,y));}},{key:\"handleMouseOverObject\",value:function handleMouseOverObject(category,roomId,event){if(category!==RoomObjectCategory.FLOOR)return null;var roomObject=this._roomEngine.getRoomObject(roomId,event.objectId,RoomObjectCategory.FLOOR);if(!roomObject)return null;var location=this.getActiveSurfaceLocation(roomObject,event);if(!location)return null;var furnitureHeightMap=this._roomEngine.getFurnitureStackingHeightMap(roomId);if(!furnitureHeightMap)return null;var x=location.x;var y=location.y;var z=location.z;return new ObjectTileCursorUpdateMessage(new Vector3d(x,y,roomObject.getLocation().z),z,true,event.eventId);}},{key:\"handleMoveTargetFurni\",value:function handleMoveTargetFurni(k,_arg_2){if(_arg_2.objectType===RoomObjectUserType.USER||_arg_2.objectType===RoomObjectUserType.PET||_arg_2.objectType===RoomObjectUserType.BOT||_arg_2.objectType===RoomObjectUserType.RENTABLE_BOT||_arg_2.objectType===RoomObjectUserType.MONSTER_PLANT)return;var _local_3=this._roomEngine.getRoomObject(k,_arg_2.objectId,RoomObjectCategory.FLOOR);var _local_4=this.getActiveSurfaceLocation(_local_3,_arg_2);if(_local_4){this.sendWalkUpdate(_local_4.x,_local_4.y);return true;}return false;}},{key:\"getActiveSurfaceLocation\",value:function getActiveSurfaceLocation(k,_arg_2){if(!k||!_arg_2)return null;var furniData=this._roomEngine.sessionDataManager.getFloorItemDataByName(k.type);if(!furniData)return null;if(!furniData.canStandOn&&!furniData.canSitOn&&!furniData.canLayOn)return null;var model=k.model;if(!model)return null;var location=k.getLocation();var direction=k.getDirection();var sizeX=model.getValue(RoomObjectVariable.FURNITURE_SIZE_X);var sizeY=model.getValue(RoomObjectVariable.FURNITURE_SIZE_Y);var sizeZ=model.getValue(RoomObjectVariable.FURNITURE_SIZE_Z);if(direction.x===90||direction.x===270){var _ref=[sizeY,sizeX];sizeX=_ref[0];sizeY=_ref[1];}if(sizeX<1)sizeX=1;if(sizeY<1)sizeY=1;var renderingCanvas=this._roomEngine.getActiveRoomInstanceRenderingCanvas();if(!renderingCanvas)return null;var scale=renderingCanvas.geometry.scale;var _local_13=furniData.canSitOn?0.5:0;var _local_14=(scale/2+_arg_2.spriteOffsetX+_arg_2.localX)/(scale/4);var _local_15=(_arg_2.spriteOffsetY+_arg_2.localY+(sizeZ-_local_13)*scale/2)/(scale/4);var _local_16=(_local_14+2*_local_15)/4;var _local_17=(_local_14-2*_local_15)/4;var _local_18=Math.floor(location.x+_local_16);var _local_19=Math.floor(location.y-_local_17+1);var _local_20=false;if(_local_18<location.x||_local_18>=location.x+sizeX)_local_20=true;else if(_local_19<location.y||_local_19>=location.y+sizeY)_local_20=true;var _local_21=furniData.canSitOn?sizeZ-0.5:sizeZ;if(!_local_20)return new Vector3d(_local_18,_local_19,_local_21);return null;}},{key:\"handleMouseOverTile\",value:function handleMouseOverTile(k,roomId){if(this._whereYouClickIsWhereYouGo){return new ObjectTileCursorUpdateMessage(new Vector3d(k.tileXAsInt,k.tileYAsInt,k.tileZAsInt),0,true,k.eventId);}var roomObject=this._roomEngine.getRoomObjectCursor(roomId);if(roomObject&&roomObject.visualization){var _local_4=k.tileXAsInt;var _local_5=k.tileYAsInt;var _local_6=k.tileZAsInt;var _local_7=this._roomEngine.getRoomInstance(roomId);if(_local_7){var _local_8=this._roomEngine.getRoomTileObjectMap(roomId);if(_local_8){var _local_9=_local_8.getObjectIntTile(_local_4,_local_5);var _local_10=this._roomEngine.getFurnitureStackingHeightMap(roomId);if(_local_10){if(_local_9&&_local_9.model&&_local_9.model.getValue(RoomObjectVariable.FURNITURE_IS_VARIABLE_HEIGHT)>0){var _local_11=_local_10.getTileHeight(_local_4,_local_5);var _local_12=this._roomEngine.getLegacyWallGeometry(roomId).getHeight(_local_4,_local_5);return new ObjectTileCursorUpdateMessage(new Vector3d(_local_4,_local_5,_local_6),_local_11-_local_12,true,k.eventId);}return new ObjectTileCursorUpdateMessage(new Vector3d(_local_4,_local_5,_local_6),0,true,k.eventId);}}}}return null;}},{key:\"placeObject\",value:function placeObject(roomId,isTileEvent,isWallEvent){var selectedData=this.getSelectedRoomObjectData(roomId);if(!selectedData)return;var roomObject=null;var objectId=selectedData.id;var category=selectedData.category;var x=0;var y=0;var z=0;var direction=0;var wallLocation='';if(this._roomEngine&&this._roomEngine.connection){roomObject=this._roomEngine.getRoomObject(roomId,objectId,category);if(roomObject){var location=roomObject.getLocation();direction=roomObject.getDirection().x;if(category===RoomObjectCategory.FLOOR||category===RoomObjectCategory.UNIT){x=location.x;y=location.y;z=location.z;}else if(category===RoomObjectCategory.WALL){x=location.x;y=location.y;z=location.z;var wallGeometry=this._roomEngine.getLegacyWallGeometry(roomId);if(wallGeometry)wallLocation=wallGeometry.getOldLocationString(location,direction);}direction=(direction/45%8+8)%8;if(objectId<0&&category===RoomObjectCategory.UNIT)objectId=objectId*-1;if(this._objectPlacementSource!==RoomObjectPlacementSource.CATALOG){if(category===RoomObjectCategory.UNIT){if(selectedData.typeId===RoomObjectType.PET){this._roomEngine.connection.send(new PetPlaceComposer(objectId,Math.trunc(x),Math.trunc(y)));}else if(selectedData.typeId===RoomObjectType.RENTABLE_BOT){this._roomEngine.connection.send(new BotPlaceComposer(objectId,Math.trunc(x),Math.trunc(y)));}}else if(roomObject.model.getValue(RoomObjectVariable.FURNITURE_IS_STICKIE)!==undefined){this._roomEngine.connection.send(new FurniturePostItPlaceComposer(objectId,wallLocation));}else{this._roomEngine.connection.send(new FurniturePlaceComposer(objectId,category,wallLocation,Math.trunc(x),Math.trunc(y),direction));}}}}this._roomEngine.setPlacedRoomObjectData(roomId,new SelectedRoomObjectData(selectedData.id,selectedData.category,null,selectedData.dir,null));this.resetSelectedObjectData(roomId);if(this._roomEngine&&this._roomEngine.events){var placedInRoom=roomObject&&roomObject.id===selectedData.id;this._roomEngine.events.dispatchEvent(new RoomEngineObjectPlacedEvent(RoomEngineObjectEvent.PLACED,roomId,objectId,category,wallLocation,x,y,z,direction,placedInRoom,isTileEvent,isWallEvent,selectedData.instanceData));}}},{key:\"modifyRoomObject\",value:function modifyRoomObject(roomId,objectId,category,operation){if(!this._roomEngine)return false;var roomObject=this._roomEngine.getRoomObject(roomId,objectId,category);if(!roomObject)return false;var _local_9=true;switch(operation){case RoomObjectOperationType.OBJECT_ROTATE_POSITIVE:case RoomObjectOperationType.OBJECT_ROTATE_NEGATIVE:if(this._roomEngine.connection){var direction=0;if(operation==RoomObjectOperationType.OBJECT_ROTATE_NEGATIVE){direction=this.getValidRoomObjectDirection(roomObject,false);}else{direction=this.getValidRoomObjectDirection(roomObject,true);}var x=roomObject.getLocation().x;var y=roomObject.getLocation().y;if(this.isValidLocation(roomObject,new Vector3d(direction),this._roomEngine.getFurnitureStackingHeightMap(roomId))){direction=Math.trunc(direction/45);if(roomObject.type===RoomObjectUserType.MONSTER_PLANT){var roomSession=this._roomEngine.roomSessionManager.getSession(roomId);if(roomSession){var userData=roomSession.userDataManager.getUserDataByIndex(objectId);if(userData){this._roomEngine.connection.send(new PetMoveComposer(userData.webID,Math.trunc(x),Math.trunc(y),direction));}}}else{this._roomEngine.connection.send(new FurnitureFloorUpdateComposer(objectId,x,y,direction));}}}break;case RoomObjectOperationType.OBJECT_EJECT:case RoomObjectOperationType.OBJECT_PICKUP:if(this._roomEngine.connection)this._roomEngine.connection.send(new FurniturePickupComposer(category,objectId));break;case RoomObjectOperationType.OBJECT_PICKUP_PET:if(this._roomEngine.connection){var session=this._roomEngine.roomSessionManager.getSession(roomId);if(session){var _userData=session.userDataManager.getUserDataByIndex(objectId);session.pickupPet(_userData.webID);}}break;case RoomObjectOperationType.OBJECT_PICKUP_BOT:if(this._roomEngine.connection){var _session=this._roomEngine.roomSessionManager.getSession(roomId);if(_session){var _userData2=_session.userDataManager.getUserDataByIndex(objectId);_session.pickupBot(_userData2.webID);}}break;case RoomObjectOperationType.OBJECT_MOVE:_local_9=false;this.setFurnitureAlphaMultiplier(roomObject,0.5);this.setSelectedRoomObjectData(roomId,roomObject.id,category,roomObject.getLocation(),roomObject.getDirection(),operation);this._roomEngine.setObjectMoverIconSprite(roomObject.id,category,true);this._roomEngine.setObjectMoverIconSpriteVisible(false);break;case RoomObjectOperationType.OBJECT_MOVE_TO:{var selectedData=this.getSelectedRoomObjectData(roomId);this.updateSelectedObjectData(roomId,selectedData.id,selectedData.category,selectedData.loc,selectedData.dir,RoomObjectOperationType.OBJECT_MOVE_TO,selectedData.typeId,selectedData.instanceData,selectedData.stuffData,selectedData.state,selectedData.animFrame,selectedData.posture);this.setFurnitureAlphaMultiplier(roomObject,1);this._roomEngine.removeObjectMoverIconSprite();if(this._roomEngine.connection){if(category===RoomObjectCategory.FLOOR){var angle=roomObject.getDirection().x%360;var location=roomObject.getLocation();var _direction=angle/45;this._roomEngine.connection.send(new FurnitureFloorUpdateComposer(objectId,location.x,location.y,_direction));}else if(category===RoomObjectCategory.WALL){var _angle=roomObject.getDirection().x%360;var wallGeometry=this._roomEngine.getLegacyWallGeometry(roomId);if(wallGeometry){var _location=wallGeometry.getOldLocationString(roomObject.getLocation(),_angle);if(_location)this._roomEngine.connection.send(new FurnitureWallUpdateComposer(objectId,_location));}}else if(category===RoomObjectCategory.UNIT){var _angle2=roomObject.getDirection().x%360;var _location2=roomObject.getLocation();var _direction2=_angle2/45;var race=parseInt(roomObject.model.getValue(RoomObjectVariable.RACE));var _roomSession=this._roomEngine.roomSessionManager.getSession(roomId);if(_roomSession){var _userData3=_roomSession.userDataManager.getUserDataByIndex(objectId);if(_userData3)this._roomEngine.connection.send(new PetMoveComposer(_userData3.webID,_location2.x,_location2.y,_direction2));}}}break;}}if(_local_9)this.resetSelectedObjectData(roomId);return true;}},{key:\"modifyRoomObjectDataWithMap\",value:function modifyRoomObjectDataWithMap(roomId,objectId,category,operation,data){if(!this._roomEngine)return false;var roomObject=this._roomEngine.getRoomObject(roomId,objectId,category);if(!roomObject)return false;switch(operation){case RoomObjectOperationType.OBJECT_SAVE_STUFF_DATA:if(this._roomEngine.connection){this._roomEngine.connection.send(new SetObjectDataMessageComposer(objectId,data));}break;}return true;}},{key:\"modifyWallItemData\",value:function modifyWallItemData(roomId,objectId,colorHex,text){if(!this._roomEngine||!this._roomEngine.connection)return false;this._roomEngine.connection.send(new SetItemDataMessageComposer(objectId,colorHex,text));return true;}},{key:\"deleteWallItem\",value:function deleteWallItem(roomId,itemId){if(!this._roomEngine||!this._roomEngine.connection)return false;this._roomEngine.connection.send(new RemoveWallItemComposer(itemId));return true;}},{key:\"getValidRoomObjectDirection\",value:function getValidRoomObjectDirection(k,_arg_2){if(!k||!k.model)return 0;var _local_6=0;var _local_7=0;var allowedDirections=[];if(k.type===RoomObjectUserType.MONSTER_PLANT){allowedDirections=k.model.getValue(RoomObjectVariable.PET_ALLOWED_DIRECTIONS);}else{allowedDirections=k.model.getValue(RoomObjectVariable.FURNITURE_ALLOWED_DIRECTIONS);}var direction=k.getDirection().x;if(allowedDirections&&allowedDirections.length){_local_6=allowedDirections.indexOf(direction);if(_local_6<0){_local_6=0;_local_7=0;while(_local_7<allowedDirections.length){if(direction<=allowedDirections[_local_7])break;_local_6++;_local_7++;}_local_6=_local_6%allowedDirections.length;}if(_arg_2)_local_6=(_local_6+1)%allowedDirections.length;else _local_6=(_local_6-1+allowedDirections.length)%allowedDirections.length;direction=allowedDirections[_local_6];}return direction;}},{key:\"isValidLocation\",value:function isValidLocation(object,goalDirection,stackingHeightMap){if(!object||!object.model||!goalDirection)return false;var direction=object.getDirection();var location=object.getLocation();if(!direction||!location)return false;if(direction.x%180===goalDirection.x%180)return true;var sizeX=object.model.getValue(RoomObjectVariable.FURNITURE_SIZE_X);var sizeY=object.model.getValue(RoomObjectVariable.FURNITURE_SIZE_Y);if(sizeX<1)sizeX=1;if(sizeY<1)sizeY=1;var _local_8=sizeX;var _local_9=sizeY;var _local_11=Math.trunc(Math.trunc(goalDirection.x+45)%360/90);if(_local_11===1||_local_11===3){var _ref2=[sizeY,sizeX];sizeX=_ref2[0];sizeY=_ref2[1];}_local_11=Math.trunc(Math.trunc(direction.x+45)%360/90);if(_local_11===1||_local_11===3){var _ref3=[_local_9,_local_8];_local_8=_ref3[0];_local_9=_ref3[1];}if(stackingHeightMap&&location){var alwaysStackable=object.model.getValue(RoomObjectVariable.FURNITURE_ALWAYS_STACKABLE)===1;if(stackingHeightMap.validateLocation(location.x,location.y,sizeX,sizeY,location.x,location.y,_local_8,_local_9,alwaysStackable,location.z))return true;}return false;}},{key:\"placeObjectOnUser\",value:function placeObjectOnUser(roomId,objectId,category){var _local_4=this.getSelectedRoomObjectData(roomId);if(!_local_4)return;var _local_5=this._roomEngine.getRoomObject(roomId,objectId,category);if(!_local_5)return;if(!this._roomEngine||!this._roomEngine.events)return;this._roomEngine.events.dispatchEvent(new RoomEngineObjectPlacedOnUserEvent(RoomEngineObjectEvent.PLACED_ON_USER,roomId,objectId,category,_local_4.id,_local_4.category));}},{key:\"setSelectedObject\",value:function setSelectedObject(roomId,objectId,category){if(!this._roomEngine)return;var eventDispatcher=this._roomEngine.events;if(!eventDispatcher)return;switch(category){case RoomObjectCategory.UNIT:case RoomObjectCategory.FLOOR:case RoomObjectCategory.WALL:if(category===RoomObjectCategory.UNIT){this.deselectObject(roomId);this.setSelectedAvatar(roomId,objectId,true);}else{this.setSelectedAvatar(roomId,0,false);if(objectId!==this._selectedObjectId){this.deselectObject(roomId);var roomObject=this._roomEngine.getRoomObject(roomId,objectId,category);if(roomObject&&roomObject.logic){roomObject.logic.processUpdateMessage(new ObjectSelectedMessage(true));this._selectedObjectId=objectId;this._selectedObjectCategory=category;}}}eventDispatcher.dispatchEvent(new RoomEngineObjectEvent(RoomEngineObjectEvent.SELECTED,roomId,objectId,category));return;}}},{key:\"deselectObject\",value:function deselectObject(roomId){if(this._selectedObjectId===-1)return;var object=this._roomEngine.getRoomObject(roomId,this._selectedObjectId,this._selectedObjectCategory);if(object&&object.logic){object.logic.processUpdateMessage(new ObjectSelectedMessage(false));this._selectedObjectId=-1;this._selectedObjectCategory=RoomObjectCategory.MINIMUM;}}},{key:\"setSelectedAvatar\",value:function setSelectedAvatar(k,_arg_2,_arg_3){if(!this._roomEngine)return;var _local_4=RoomObjectCategory.UNIT;var _local_5=this._roomEngine.getRoomObject(k,this._selectedAvatarId,_local_4);if(_local_5&&_local_5.logic){_local_5.logic.processUpdateMessage(new ObjectAvatarSelectedMessage(false));this._selectedAvatarId=-1;}var _local_6=false;if(_arg_3){var _local_=this._roomEngine.getRoomObject(k,_arg_2,_local_4);if(_local_&&_local_.logic){_local_.logic.processUpdateMessage(new ObjectAvatarSelectedMessage(true));_local_6=true;this._selectedAvatarId=_arg_2;var location=_local_.getLocation();if(location)this._roomEngine.connection.send(new RoomUnitLookComposer(~~location.x,~~location.y));}}var selectionArrow=this._roomEngine.getRoomObjectSelectionArrow(k);if(selectionArrow&&selectionArrow.logic){if(_local_6&&!this._roomEngine.isPlayingGame())selectionArrow.logic.processUpdateMessage(new ObjectVisibilityUpdateMessage(ObjectVisibilityUpdateMessage.ENABLED));else selectionArrow.logic.processUpdateMessage(new ObjectVisibilityUpdateMessage(ObjectVisibilityUpdateMessage.DISABLED));}}},{key:\"resetSelectedObjectData\",value:function resetSelectedObjectData(roomId){if(!this._roomEngine)return;this._roomEngine.removeObjectMoverIconSprite();var selectedData=this.getSelectedRoomObjectData(roomId);if(selectedData){if(selectedData.operation===RoomObjectOperationType.OBJECT_MOVE||selectedData.operation===RoomObjectOperationType.OBJECT_MOVE_TO){var roomObject=this._roomEngine.getRoomObject(roomId,selectedData.id,selectedData.category);if(roomObject&&selectedData.operation!==RoomObjectOperationType.OBJECT_MOVE_TO){roomObject.setLocation(selectedData.loc);roomObject.setDirection(selectedData.dir);}this.setFurnitureAlphaMultiplier(roomObject,1);if(selectedData.category===RoomObjectCategory.WALL){this._roomEngine.updateRoomObjectMask(roomId,selectedData.id,true);}this.updateSelectedObjectData(roomId,selectedData.id,selectedData.category,selectedData.loc,selectedData.dir,RoomObjectOperationType.OBJECT_MOVE,selectedData.typeId,selectedData.instanceData,selectedData.stuffData,selectedData.state,selectedData.animFrame,selectedData.posture);}else if(selectedData.operation===RoomObjectOperationType.OBJECT_PLACE){var objectId=selectedData.id;var category=selectedData.category;switch(category){case RoomObjectCategory.FLOOR:this._roomEngine.removeRoomObjectFloor(roomId,objectId);break;case RoomObjectCategory.WALL:this._roomEngine.removeRoomObjectWall(roomId,objectId);break;case RoomObjectCategory.UNIT:this._roomEngine.removeRoomObjectUser(roomId,objectId);break;}}this._roomEngine.setSelectedRoomObjectData(roomId,null);}}},{key:\"getSelectedRoomObjectData\",value:function getSelectedRoomObjectData(roomId){if(!this._roomEngine)return null;return this._roomEngine.getSelectedRoomObjectData(roomId);}},{key:\"setFurnitureAlphaMultiplier\",value:function setFurnitureAlphaMultiplier(object,multiplier){if(!object||!object.model)return;object.model.setValue(RoomObjectVariable.FURNITURE_ALPHA_MULTIPLIER,multiplier);}},{key:\"decorateModeMove\",value:function decorateModeMove(event){return this._roomEngine.isDecorating&&!(event.ctrlKey||event.shiftKey);}},{key:\"cancelRoomObjectPlacement\",value:function cancelRoomObjectPlacement(roomId){this.resetSelectedObjectData(roomId);return true;}},{key:\"setSelectedRoomObjectData\",value:function setSelectedRoomObjectData(roomId,id,category,location,direction,operation){var typeId=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var instanceData=arguments.length>7&&arguments[7]!==undefined?arguments[7]:null;var stuffData=arguments.length>8&&arguments[8]!==undefined?arguments[8]:null;var state=arguments.length>9&&arguments[9]!==undefined?arguments[9]:-1;var frameNumber=arguments.length>10&&arguments[10]!==undefined?arguments[10]:-1;var posture=arguments.length>11&&arguments[11]!==undefined?arguments[11]:null;this.resetSelectedObjectData(roomId);if(!this._roomEngine)return;var selectedData=new SelectedRoomObjectData(id,category,operation,location,direction,typeId,instanceData,stuffData,state,frameNumber,posture);this._roomEngine.setSelectedRoomObjectData(roomId,selectedData);}},{key:\"updateSelectedObjectData\",value:function updateSelectedObjectData(roomId,id,category,location,direction,operation){var typeId=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var instanceData=arguments.length>7&&arguments[7]!==undefined?arguments[7]:null;var stuffData=arguments.length>8&&arguments[8]!==undefined?arguments[8]:null;var state=arguments.length>9&&arguments[9]!==undefined?arguments[9]:-1;var frameNumber=arguments.length>10&&arguments[10]!==undefined?arguments[10]:-1;var posture=arguments.length>11&&arguments[11]!==undefined?arguments[11]:null;if(!this._roomEngine)return null;var selectedData=new SelectedRoomObjectData(id,category,operation,location,direction,typeId,instanceData,stuffData,state,frameNumber,posture);this._roomEngine.setSelectedRoomObjectData(roomId,selectedData);}},{key:\"handleUserPlace\",value:function handleUserPlace(roomObject,x,y,wallGeometry){if(!wallGeometry.isRoomTile(x,y))return false;roomObject.setLocation(new Vector3d(x,y,wallGeometry.getHeight(x,y)));return true;}},{key:\"engine\",get:function get(){return this._roomEngine;}},{key:\"selectedAvatarId\",get:function get(){return this._selectedAvatarId;}}]);return RoomObjectEventHandler;}(Disposable);","map":null,"metadata":{},"sourceType":"module"}