{"ast":null,"code":"import _createForOfIteratorHelper from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _slicedToArray from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{ApproveNameMessageComposer,ApproveNameMessageEvent,ColorConverter,GetSellablePetPalettesComposer,PurchaseFromCatalogComposer}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useMemo,useState}from'react';import{GetPetAvailableColors,GetPetIndexFromLocalization,LocalizeText,SendMessageComposer}from'../../../../../../api';import{AutoGrid,Base,Button,Column,Flex,Grid,LayoutGridItem,LayoutPetImageView,Text}from'../../../../../../common';import{CatalogPurchaseFailureEvent}from'../../../../../../events';import{DispatchUiEvent,useCatalog,UseMessageEventHook}from'../../../../../../hooks';import{CatalogAddOnBadgeWidgetView}from'../../widgets/CatalogAddOnBadgeWidgetView';import{CatalogPurchaseWidgetView}from'../../widgets/CatalogPurchaseWidgetView';import{CatalogTotalPriceWidget}from'../../widgets/CatalogTotalPriceWidget';import{CatalogViewProductWidgetView}from'../../widgets/CatalogViewProductWidgetView';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export var CatalogLayoutPetView=function CatalogLayoutPetView(props){var _props$page=props.page,page=_props$page===void 0?null:_props$page;var _useState=useState(-1),_useState2=_slicedToArray(_useState,2),petIndex=_useState2[0],setPetIndex=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),sellablePalettes=_useState4[0],setSellablePalettes=_useState4[1];var _useState5=useState(-1),_useState6=_slicedToArray(_useState5,2),selectedPaletteIndex=_useState6[0],setSelectedPaletteIndex=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),sellableColors=_useState8[0],setSellableColors=_useState8[1];var _useState9=useState(-1),_useState10=_slicedToArray(_useState9,2),selectedColorIndex=_useState10[0],setSelectedColorIndex=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),colorsShowing=_useState12[0],setColorsShowing=_useState12[1];var _useState13=useState(''),_useState14=_slicedToArray(_useState13,2),petName=_useState14[0],setPetName=_useState14[1];var _useState15=useState(true),_useState16=_slicedToArray(_useState15,2),approvalPending=_useState16[0],setApprovalPending=_useState16[1];var _useState17=useState(-1),_useState18=_slicedToArray(_useState17,2),approvalResult=_useState18[0],setApprovalResult=_useState18[1];var _useCatalog=useCatalog(),_useCatalog$currentOf=_useCatalog.currentOffer,currentOffer=_useCatalog$currentOf===void 0?null:_useCatalog$currentOf,_useCatalog$setCurren=_useCatalog.setCurrentOffer,setCurrentOffer=_useCatalog$setCurren===void 0?null:_useCatalog$setCurren,_useCatalog$setPurcha=_useCatalog.setPurchaseOptions,setPurchaseOptions=_useCatalog$setPurcha===void 0?null:_useCatalog$setPurcha,_useCatalog$catalogOp=_useCatalog.catalogOptions,catalogOptions=_useCatalog$catalogOp===void 0?null:_useCatalog$catalogOp,_useCatalog$roomPrevi=_useCatalog.roomPreviewer,roomPreviewer=_useCatalog$roomPrevi===void 0?null:_useCatalog$roomPrevi;var _catalogOptions$petPa=catalogOptions.petPalettes,petPalettes=_catalogOptions$petPa===void 0?null:_catalogOptions$petPa;var getColor=useMemo(function(){if(!sellableColors.length||selectedColorIndex===-1)return 0xFFFFFF;return sellableColors[selectedColorIndex][0];},[sellableColors,selectedColorIndex]);var petBreedName=useMemo(function(){if(petIndex===-1||!sellablePalettes.length||selectedPaletteIndex===-1)return'';return LocalizeText(\"pet.breed.\".concat(petIndex,\".\").concat(sellablePalettes[selectedPaletteIndex].breedId));},[petIndex,sellablePalettes,selectedPaletteIndex]);var petPurchaseString=useMemo(function(){if(!sellablePalettes.length||selectedPaletteIndex===-1)return'';var paletteId=sellablePalettes[selectedPaletteIndex].paletteId;var color=0xFFFFFF;if(petIndex<=7){if(selectedColorIndex===-1)return'';color=sellableColors[selectedColorIndex][0];}var colorString=color.toString(16).toUpperCase();while(colorString.length<6){colorString='0'+colorString;}return\"\".concat(paletteId,\"\\n\").concat(colorString);},[sellablePalettes,selectedPaletteIndex,petIndex,sellableColors,selectedColorIndex]);var validationErrorMessage=useMemo(function(){var key='';switch(approvalResult){case 1:key='catalog.alert.petname.long';break;case 2:key='catalog.alert.petname.short';break;case 3:key='catalog.alert.petname.chars';break;case 4:key='catalog.alert.petname.bobba';break;}if(!key||!key.length)return'';return LocalizeText(key);},[approvalResult]);var purchasePet=useCallback(function(){if(approvalResult===-1){SendMessageComposer(new ApproveNameMessageComposer(petName,1));return;}if(approvalResult===0){SendMessageComposer(new PurchaseFromCatalogComposer(page.pageId,currentOffer.offerId,\"\".concat(petName,\"\\n\").concat(petPurchaseString),1));return;}},[page,currentOffer,petName,petPurchaseString,approvalResult]);var onApproveNameMessageEvent=useCallback(function(event){var parser=event.getParser();setApprovalResult(parser.result);if(parser.result===0)purchasePet();else DispatchUiEvent(new CatalogPurchaseFailureEvent(-1));},[purchasePet]);UseMessageEventHook(ApproveNameMessageEvent,onApproveNameMessageEvent);useEffect(function(){if(!page||!page.offers.length)return;var offer=page.offers[0];setCurrentOffer(offer);setPetIndex(GetPetIndexFromLocalization(offer.localizationId));setColorsShowing(false);},[page,setCurrentOffer]);useEffect(function(){if(!currentOffer)return;var productData=currentOffer.product.productData;if(!productData)return;if(petPalettes){var _iterator=_createForOfIteratorHelper(petPalettes),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var paletteData=_step.value;if(paletteData.breed!==productData.type)continue;var palettes=[];var _iterator2=_createForOfIteratorHelper(paletteData.palettes),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var palette=_step2.value;if(!palette.sellable)continue;palettes.push(palette);}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}setSelectedPaletteIndex(palettes.length?0:-1);setSellablePalettes(palettes);return;}}catch(err){_iterator.e(err);}finally{_iterator.f();}}setSelectedPaletteIndex(-1);setSellablePalettes([]);SendMessageComposer(new GetSellablePetPalettesComposer(productData.type));},[currentOffer,petPalettes]);useEffect(function(){if(petIndex===-1)return;var colors=GetPetAvailableColors(petIndex,sellablePalettes);setSelectedColorIndex(colors.length?0:-1);setSellableColors(colors);},[petIndex,sellablePalettes]);useEffect(function(){if(!roomPreviewer)return;roomPreviewer.reset(false);if(petIndex===-1||!sellablePalettes.length||selectedPaletteIndex===-1)return;var petFigureString=\"\".concat(petIndex,\" \").concat(sellablePalettes[selectedPaletteIndex].paletteId);if(petIndex<=7)petFigureString+=\" \".concat(getColor.toString(16));roomPreviewer.addPetIntoRoom(petFigureString);},[roomPreviewer,petIndex,sellablePalettes,selectedPaletteIndex,getColor]);useEffect(function(){setApprovalResult(-1);},[petName]);if(!currentOffer)return null;return/*#__PURE__*/_jsxs(Grid,{children:[/*#__PURE__*/_jsx(Column,{size:7,overflow:\"hidden\",children:/*#__PURE__*/_jsxs(AutoGrid,{columnCount:5,children:[!colorsShowing&&sellablePalettes.length>0&&sellablePalettes.map(function(palette,index){return/*#__PURE__*/_jsx(LayoutGridItem,{itemActive:selectedPaletteIndex===index,onClick:function onClick(event){return setSelectedPaletteIndex(index);},children:/*#__PURE__*/_jsx(LayoutPetImageView,{typeId:petIndex,paletteId:palette.paletteId,direction:2,headOnly:true})},index);}),colorsShowing&&sellableColors.length>0&&sellableColors.map(function(colorSet,index){return/*#__PURE__*/_jsx(LayoutGridItem,{itemHighlight:true,itemActive:selectedColorIndex===index,itemColor:ColorConverter.int2rgb(colorSet[0]),className:\"clear-bg\",onClick:function onClick(event){return setSelectedColorIndex(index);}},index);})]})}),/*#__PURE__*/_jsxs(Column,{center:!currentOffer,size:5,overflow:\"hidden\",children:[!currentOffer&&/*#__PURE__*/_jsxs(_Fragment,{children:[!!page.localization.getImage(1)&&/*#__PURE__*/_jsx(\"img\",{alt:\"\",src:page.localization.getImage(1)}),/*#__PURE__*/_jsx(Text,{center:true,dangerouslySetInnerHTML:{__html:page.localization.getText(0)}})]}),currentOffer&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Base,{position:\"relative\",overflow:\"hidden\",children:[/*#__PURE__*/_jsx(CatalogViewProductWidgetView,{}),/*#__PURE__*/_jsx(CatalogAddOnBadgeWidgetView,{position:\"absolute\",className:\"bg-muted rounded bottom-1 end-1\"}),petIndex>-1&&petIndex<=7&&/*#__PURE__*/_jsx(Button,{position:\"absolute\",className:\"bottom-1 start-1\",onClick:function onClick(event){return setColorsShowing(!colorsShowing);},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"fill-drip\"})})]}),/*#__PURE__*/_jsxs(Column,{grow:true,gap:1,children:[/*#__PURE__*/_jsx(Text,{truncate:true,children:petBreedName}),/*#__PURE__*/_jsxs(Column,{grow:true,gap:1,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control form-control-sm w-100\",placeholder:LocalizeText('widgets.petpackage.name.title'),value:petName,onChange:function onChange(event){return setPetName(event.target.value);}}),approvalResult>0&&/*#__PURE__*/_jsx(Base,{className:\"invalid-feedback d-block m-0\",children:validationErrorMessage})]}),/*#__PURE__*/_jsx(Flex,{justifyContent:\"end\",children:/*#__PURE__*/_jsx(CatalogTotalPriceWidget,{justifyContent:\"end\",alignItems:\"end\"})}),/*#__PURE__*/_jsx(CatalogPurchaseWidgetView,{purchaseCallback:purchasePet})]})]})]})]});};","map":null,"metadata":{},"sourceType":"module"}