{"ast":null,"code":"import _createForOfIteratorHelper from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _classCallCheck from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createClass.js\";import{Point}from'@pixi/math';import{Vector3d}from'../../../room/utils/Vector3d';import{Nitro}from'../../Nitro';import{RoomObjectCategory}from'../object/RoomObjectCategory';import{PlaneDrawingData}from'../object/visualization/room/PlaneDrawingData';import{RoomEngine}from'../RoomEngine';export var SpriteDataCollector=/*#__PURE__*/function(){function SpriteDataCollector(){_classCallCheck(this,SpriteDataCollector);this.maxZ=void 0;this.spriteCount=0;this.externalImageCount=0;}_createClass(SpriteDataCollector,[{key:\"getFurniData\",value:function getFurniData(k,_arg_2,_arg_3,_arg_4){var _local_5=[];var _local_6=_arg_2.getSortableSpriteList();var _local_7=_arg_3.getRoomObjects(_arg_3.activeRoomId,RoomObjectCategory.UNIT);var _iterator=_createForOfIteratorHelper(_local_7),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var _local_8=_step.value;if(_local_8.id!==_arg_4){var _local_11=_local_8.visualization.getSpriteList();if(_local_11){var _local_12=0;var _local_13=0;var _iterator3=_createForOfIteratorHelper(_local_6),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var _local_14=_step3.value;if(_local_14.name==='avatar_'+_local_8.id){_local_12=_local_14.z;_local_13=_local_14.y+_local_14.height-_arg_2.geometry.scale/4;break;}}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}var _local_15=_arg_3.getRoomObjectScreenLocation(_arg_3.activeRoomId,_local_8.id,RoomObjectCategory.UNIT,_arg_2.id);if(_local_15){if(_local_13===0)_local_13=_local_15.y;var _iterator4=_createForOfIteratorHelper(_local_11),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var _local_16=_step4.value;_local_16.x=_local_16.x+(_local_15.x-_arg_2.screenOffsetX);_local_16.y=_local_16.y+_local_13;_local_16.z=_local_16.z+_local_12;if(_local_16.name.indexOf('h_std_fx29_')===0||_local_16.name.indexOf('h_std_fx185_')===0){_local_16.y=_local_16.y+SpriteDataCollector.AVATAR_WATER_EFFECT_MAGIC_Y_OFFSET;}_local_6.push(_local_16);}}catch(err){_iterator4.e(err);}finally{_iterator4.f();}}}}}}catch(err){_iterator.e(err);}finally{_iterator.f();}_local_6=SpriteDataCollector.addMannequinSprites(_local_6,_arg_3);_local_6.sort(SpriteDataCollector.sortSpriteDataObjects);var _iterator2=_createForOfIteratorHelper(_local_6),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _local_9=_step2.value;if(!(_local_9.name===null)&&_local_9.name.length>0&&!(_local_9.name.indexOf('tile_cursor_')===0)&&SpriteDataCollector.isSpriteInViewPort(_local_9,k,_arg_2)&&(_arg_4<0||!(_local_9.objectId==_arg_4))){_local_5.push(this.getSpriteDataObject(_local_9,k,_arg_2,_arg_3));if(!this.maxZ)this.maxZ=_local_9.z;this.spriteCount++;}}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}return JSON.stringify(_local_5);}},{key:\"getRoomRenderingModifiers\",value:function getRoomRenderingModifiers(k){return JSON.stringify(new Object());}},{key:\"getSpriteDataObject\",value:function getSpriteDataObject(k,_arg_2,_arg_3,_arg_4){var _local_7=null;var _local_9=[];var _local_5={};var _local_6=k.name;if(k.name.indexOf('@')!==-1){_local_9=k.name.split('@');_local_6=_local_9[0];_local_7=_local_9[1];}// if(((_local_7) && (k.type)))\n// {\n//     const _local_10 = _arg_4.roomContentLoader.getCollection(k.type);\n//     if(_local_10)\n//     {\n//         const _local_11 = _local_10.getPalette(_local_7);\n//         if (((!(_local_11 == null)) && (!(_local_11.@source == null))))\n//         {\n//             _local_5.paletteSourceName = (_local_11.@source + '');\n//         }\n//     }\n// }\n// var _local_8: string = _arg_4.configuration.getProperty('image.library.url');\n// _local_6 = _local_6.replace('%image.library.url%', _local_8);\n// if (_local_6.indexOf('%group.badge.url%') != -1)\n// {\n//     _local_12 = _arg_4.configuration.getProperty('group.badge.url');\n//     _local_6 = _local_6.replace('%group.badge.url%', '');\n//     _local_13 = _local_12.replace('%imagerdata%', _local_6);\n//     _local_6 = _local_13;\n// }\n_local_5.name=_local_6;_local_5.x=k.x-_arg_2.x;_local_5.y=k.y-_arg_2.y;_local_5.x=_local_5.x+_arg_3.screenOffsetX;_local_5.y=_local_5.y+_arg_3.screenOffsetY;_local_5.z=k.z;if(k.alpha&&k.alpha.toString()!=='255')_local_5.alpha=k.alpha;if(k.flipH)_local_5.flipH=k.flipH;if(k.skew)_local_5.skew=k.skew;if(k.frame)_local_5.frame=k.frame;if(k.color&&k.color.length>0)_local_5.color=parseInt(k.color);if(k.blendMode&&k.blendMode!=='normal')_local_5.blendMode=k.blendMode;if(_local_6.indexOf('http')===0){_local_5.width=k.width;_local_5.height=k.height;this.externalImageCount++;if(this.externalImageCount>SpriteDataCollector.MAX_EXTERNAL_IMAGE_COUNT)_local_5.name='box';}if(k.posture)_local_5.posture=k.posture;return _local_5;}},{key:\"makeBackgroundPlane\",value:function makeBackgroundPlane(k,_arg_2,_arg_3){var _local_4=new Point(0,0);var _local_5=new Point(k.width,0);var _local_6=new Point(0,k.height);var _local_7=new Point(k.width,k.height);var _local_8=SpriteDataCollector.sortQuadPoints(_local_4,_local_5,_local_6,_local_7);var _local_9=0;if(_arg_3.length>0){_local_9=_arg_3[0].z;if(this.maxZ)_local_9=Math.max(this.maxZ,_local_9);}else{_local_9=this.maxZ?this.maxZ:0;}_local_9=_local_9+(this.spriteCount*1.776104+_arg_3.length*2.31743);var _local_10=new PlaneDrawingData(null,_arg_2);_local_10.cornerPoints=_local_8;_local_10.z=_local_9;return _local_10;}},{key:\"sortRoomPlanes\",value:function sortRoomPlanes(k,_arg_2,_arg_3){var _local_4=new Map();var _local_5=1;if(this.maxZ){_local_5=_local_5+this.maxZ;}var _iterator5=_createForOfIteratorHelper(k),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var _local_6=_step5.value;var _local_10={plane:_local_6,z:_local_5};_local_4.set(_local_6.uniqueId,_local_10);}}catch(err){_iterator5.e(err);}finally{_iterator5.f();}var sprites=_arg_2.getPlaneSortableSprites();sprites.sort(function(a,b){return b.z-a.z;});sprites.reverse();var _local_8=[];var _iterator6=_createForOfIteratorHelper(sprites),_step6;try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var sprite=_step6.value;var objectSprite=sprite.sprite;if(objectSprite){var _local_=_local_4.get(objectSprite.id);if(_local_){_local_4.delete(objectSprite.id);_local_.z=sprite.z;_local_8.push(_local_);}}}}catch(err){_iterator6.e(err);}finally{_iterator6.f();}_local_8=_local_8.concat(Array.from(_local_4.values()));return _local_8;}},{key:\"getRoomPlanes\",value:function getRoomPlanes(k,_arg_2,_arg_3,_arg_4){var _local_5=[];var roomObject=_arg_3.getRoomObject(_arg_3.activeRoomId,RoomEngine.ROOM_OBJECT_ID,RoomObjectCategory.ROOM);var visualization=roomObject.visualization;if(visualization){var _local_8=_arg_2.geometry;var _local_9=this.sortRoomPlanes(visualization.planes,_arg_2,_arg_3);var _local_10=Nitro.instance.stage;var _iterator7=_createForOfIteratorHelper(_local_9),_step7;try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var _local_11=_step7.value;var _local_12=_local_11.plane;var _local_13=[];var _local_14=Vector3d.sum(_local_12.location,_local_12.leftSide);var _local_15=_local_8.getScreenPoint(_local_12.location);var _local_16=_local_8.getScreenPoint(_local_14);var _local_17=_local_8.getScreenPoint(Vector3d.sum(_local_12.location,_local_12.rightSide));var _local_18=_local_8.getScreenPoint(Vector3d.sum(_local_14,_local_12.rightSide));_local_13.push(_local_15,_local_16,_local_17,_local_18);var _local_19=0;var _local_20=0;for(var _i=0,_local_2=_local_13;_i<_local_2.length;_i++){var _local_21=_local_2[_i];_local_21.x+=_local_10.width/2;_local_21.y+=_local_10.height/2;_local_21.x+=_arg_2.screenOffsetX;_local_21.y+=_arg_2.screenOffsetY;_local_21.x+=-k.x;_local_21.y+=-k.y;if(_local_21.x<0)_local_19--;else if(_local_21.x>=k.width)_local_19++;if(_local_21.y<0)_local_20--;else if(_local_21.y>=k.height)_local_20++;}if(Math.abs(_local_19)===4||Math.abs(_local_20)===4){//\n}else{var _local_22=SpriteDataCollector.sortQuadPoints(_local_15,_local_16,_local_17,_local_18);var _iterator8=_createForOfIteratorHelper(_local_12.getDrawingDatas(_local_8)),_step8;try{for(_iterator8.s();!(_step8=_iterator8.n()).done;){var _local_23=_step8.value;_local_23.cornerPoints=_local_22;_local_23.z=_local_11.z;_local_5.push(_local_23);}}catch(err){_iterator8.e(err);}finally{_iterator8.f();}}}}catch(err){_iterator7.e(err);}finally{_iterator7.f();}_local_5.unshift(this.makeBackgroundPlane(k,_arg_4,_local_5));}return _local_5;}}],[{key:\"addMannequinSprites\",value:function addMannequinSprites(k,_arg_2){var datas=[];var _iterator9=_createForOfIteratorHelper(k),_step9;try{for(_iterator9.s();!(_step9=_iterator9.n()).done;){var data=_step9.value;if(!data)continue;if(data.type==='boutique_mannequin1'&&data.name.indexOf('mannequin_')===0){var roomObject=_arg_2.getRoomObject(_arg_2.activeRoomId,data.objectId,RoomObjectCategory.FLOOR);if(roomObject){var spriteList=roomObject.visualization.getSpriteList();if(spriteList){var _iterator10=_createForOfIteratorHelper(spriteList),_step10;try{for(_iterator10.s();!(_step10=_iterator10.n()).done;){var sprite=_step10.value;sprite.x=sprite.x+(data.x+data.width/2+SpriteDataCollector.MANNEQUIN_MAGIC_X_OFFSET);sprite.y=sprite.y+(data.y+data.height+SpriteDataCollector.MANNEQUIN_MAGIC_Y_OFFSET);sprite.z=sprite.z+data.z;datas.push(sprite);}}catch(err){_iterator10.e(err);}finally{_iterator10.f();}}}}else{datas.push(data);}}}catch(err){_iterator9.e(err);}finally{_iterator9.f();}return datas;}},{key:\"sortSpriteDataObjects\",value:function sortSpriteDataObjects(k,_arg_2){if(k.z<_arg_2.z)return 1;if(k.z>_arg_2.z)return-1;return-1;}},{key:\"isSpriteInViewPort\",value:function isSpriteInViewPort(k,_arg_2,_arg_3){return true;// var _local_4 = new Rectangle((k.x + _arg_3.screenOffsetX), (k.y + _arg_3.screenOffsetY), k.width, k.height);\n// // intersects\n// return _local_4.contains(_arg_2.x, _arg_2.y);\n}},{key:\"sortQuadPoints\",value:function sortQuadPoints(k,_arg_2,_arg_3,_arg_4){var points=[];if(k.x==_arg_2.x){points.push(k,_arg_3,_arg_2,_arg_4);}else{if(k.x==_arg_3.x){points.push(k,_arg_2,_arg_3,_arg_4);}else{if(_arg_2.x<k.x&&_arg_2.y>k.y||_arg_2.x>k.x&&_arg_2.y<k.y){points.push(k,_arg_3,_arg_2,_arg_4);}else{points.push(k,_arg_2,_arg_3,_arg_4);}}}if(points[0].x<points[1].x){var _local_6=points[0];points[0]=points[1];points[1]=_local_6;_local_6=points[2];points[2]=points[3];points[3]=_local_6;}if(points[0].y<points[2].y){var _local_3=points[0];points[0]=points[2];points[2]=_local_3;_local_3=points[1];points[1]=points[3];points[3]=_local_3;}return points;}}]);return SpriteDataCollector;}();SpriteDataCollector.MANNEQUIN_MAGIC_X_OFFSET=1;SpriteDataCollector.MANNEQUIN_MAGIC_Y_OFFSET=-16;SpriteDataCollector.AVATAR_WATER_EFFECT_MAGIC_Y_OFFSET=-52;SpriteDataCollector.MAX_EXTERNAL_IMAGE_COUNT=30;","map":null,"metadata":{},"sourceType":"module"}