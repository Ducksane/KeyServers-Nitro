{"ast":null,"code":"import _createForOfIteratorHelper from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _slicedToArray from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{AvatarEditorFigureCategory,FigureSetIdsMessageEvent,GetWardrobeMessageComposer,UserFigureComposer,UserWardrobePageEvent}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useMemo,useState}from'react';import{AddEventLinkTracker,GetAvatarRenderManager,GetClubMemberLevel,GetConfiguration,GetSessionDataManager,LocalizeText,RemoveLinkEventTracker,SendMessageComposer}from'../../api';import{NitroCardContentView,NitroCardHeaderView,NitroCardTabsItemView,NitroCardTabsView,NitroCardView}from'../../common';import{Button}from'../../common/Button';import{ButtonGroup}from'../../common/ButtonGroup';import{Column}from'../../common/Column';import{Grid}from'../../common/Grid';import{UseMessageEventHook}from'../../hooks';import{AvatarEditorAction}from'./common/AvatarEditorAction';import{AvatarEditorUtilities}from'./common/AvatarEditorUtilities';import{BodyModel}from'./common/BodyModel';import{FigureData}from'./common/FigureData';import{generateRandomFigure}from'./common/FigureGenerator';import{HeadModel}from'./common/HeadModel';import{LegModel}from'./common/LegModel';import{TorsoModel}from'./common/TorsoModel';import{AvatarEditorFigurePreviewView}from'./views/figure-preview/AvatarEditorFigurePreviewView';import{AvatarEditorModelView}from'./views/model/AvatarEditorModelView';import{AvatarEditorWardrobeView}from'./views/wardrobe/AvatarEditorWardrobeView';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var DEFAULT_MALE_FIGURE='hr-100.hd-180-7.ch-215-66.lg-270-79.sh-305-62.ha-1002-70.wa-2007';var DEFAULT_FEMALE_FIGURE='hr-515-33.hd-600-1.ch-635-70.lg-716-66-62.sh-735-68';export var AvatarEditorView=function AvatarEditorView(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isVisible=_useState2[0],setIsVisible=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),figures=_useState4[0],setFigures=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),figureData=_useState6[0],setFigureData=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),categories=_useState8[0],setCategories=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),activeCategory=_useState10[0],setActiveCategory=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),figureSetIds=_useState12[0],setFigureSetIds=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),boundFurnitureNames=_useState14[0],setBoundFurnitureNames=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),savedFigures=_useState16[0],setSavedFigures=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),isWardrobeVisible=_useState18[0],setIsWardrobeVisible=_useState18[1];var _useState19=useState(null),_useState20=_slicedToArray(_useState19,2),lastFigure=_useState20[0],setLastFigure=_useState20[1];var _useState21=useState(null),_useState22=_slicedToArray(_useState21,2),lastGender=_useState22[0],setLastGender=_useState22[1];var _useState23=useState(true),_useState24=_slicedToArray(_useState23,2),needsReset=_useState24[0],setNeedsReset=_useState24[1];var _useState25=useState(false),_useState26=_slicedToArray(_useState25,2),isInitalized=_useState26[0],setIsInitalized=_useState26[1];var maxWardrobeSlots=useMemo(function(){return GetConfiguration('avatar.wardrobe.max.slots',10);},[]);var onFigureSetIdsMessageEvent=useCallback(function(event){var parser=event.getParser();setFigureSetIds(parser.figureSetIds);setBoundFurnitureNames(parser.boundsFurnitureNames);},[]);UseMessageEventHook(FigureSetIdsMessageEvent,onFigureSetIdsMessageEvent);var onUserWardrobePageEvent=useCallback(function(event){var parser=event.getParser();var savedFigures=[];var i=0;while(i<maxWardrobeSlots){savedFigures.push([null,null]);i++;}var _iterator=_createForOfIteratorHelper(parser.looks.entries()),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var _step$value=_slicedToArray(_step.value,2),index=_step$value[0],_step$value$=_slicedToArray(_step$value[1],2),look=_step$value$[0],gender=_step$value$[1];var container=GetAvatarRenderManager().createFigureContainer(look);savedFigures[index-1]=[container,gender];}}catch(err){_iterator.e(err);}finally{_iterator.f();}setSavedFigures(savedFigures);},[maxWardrobeSlots]);UseMessageEventHook(UserWardrobePageEvent,onUserWardrobePageEvent);var selectCategory=useCallback(function(name){if(!categories)return;setActiveCategory(categories.get(name));},[categories]);var resetCategories=useCallback(function(){var categories=new Map();categories.set(AvatarEditorFigureCategory.GENERIC,new BodyModel());categories.set(AvatarEditorFigureCategory.HEAD,new HeadModel());categories.set(AvatarEditorFigureCategory.TORSO,new TorsoModel());categories.set(AvatarEditorFigureCategory.LEGS,new LegModel());setCategories(categories);},[]);var setupFigures=useCallback(function(){var figures=new Map();var maleFigure=new FigureData();var femaleFigure=new FigureData();maleFigure.loadAvatarData(DEFAULT_MALE_FIGURE,FigureData.MALE);femaleFigure.loadAvatarData(DEFAULT_FEMALE_FIGURE,FigureData.FEMALE);figures.set(FigureData.MALE,maleFigure);figures.set(FigureData.FEMALE,femaleFigure);setFigures(figures);setFigureData(figures.get(FigureData.MALE));},[]);var loadAvatarInEditor=useCallback(function(figure,gender){var reset=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;gender=AvatarEditorUtilities.getGender(gender);var newFigureData=figureData;if(gender!==newFigureData.gender)newFigureData=figures.get(gender);if(figure!==newFigureData.getFigureString())newFigureData.loadAvatarData(figure,gender);if(newFigureData!==figureData)setFigureData(newFigureData);if(reset){setLastFigure(figureData.getFigureString());setLastGender(figureData.gender);}},[figures,figureData]);var processAction=useCallback(function(action){switch(action){case AvatarEditorAction.ACTION_CLEAR:loadAvatarInEditor(figureData.getFigureStringWithFace(0,false),figureData.gender,false);resetCategories();return;case AvatarEditorAction.ACTION_RESET:loadAvatarInEditor(lastFigure,lastGender);resetCategories();return;case AvatarEditorAction.ACTION_RANDOMIZE:var figure=generateRandomFigure(figureData,figureData.gender,GetClubMemberLevel(),figureSetIds,[FigureData.FACE]);loadAvatarInEditor(figure,figureData.gender,false);resetCategories();return;case AvatarEditorAction.ACTION_SAVE:SendMessageComposer(new UserFigureComposer(figureData.gender,figureData.getFigureString()));setIsVisible(false);return;}},[figureData,lastFigure,lastGender,figureSetIds,loadAvatarInEditor,resetCategories]);var setGender=useCallback(function(gender){gender=AvatarEditorUtilities.getGender(gender);setFigureData(figures.get(gender));},[figures]);var linkReceived=useCallback(function(url){var parts=url.split('/');if(parts.length<2)return;switch(parts[1]){case'show':setIsVisible(true);return;case'hide':setIsVisible(false);return;case'toggle':setIsVisible(function(prevValue){return!prevValue;});return;}},[]);useEffect(function(){var linkTracker={linkReceived:linkReceived,eventUrlPrefix:'avatar-editor/'};AddEventLinkTracker(linkTracker);return function(){return RemoveLinkEventTracker(linkTracker);};},[linkReceived]);useEffect(function(){setSavedFigures(new Array(maxWardrobeSlots));},[maxWardrobeSlots]);useEffect(function(){if(!isWardrobeVisible)return;setActiveCategory(null);SendMessageComposer(new GetWardrobeMessageComposer());},[isWardrobeVisible]);useEffect(function(){if(!activeCategory)return;setIsWardrobeVisible(false);},[activeCategory]);useEffect(function(){if(!categories)return;selectCategory(AvatarEditorFigureCategory.GENERIC);},[categories,selectCategory]);useEffect(function(){if(!figureData)return;AvatarEditorUtilities.CURRENT_FIGURE=figureData;resetCategories();return function(){return AvatarEditorUtilities.CURRENT_FIGURE=null;};},[figureData,resetCategories]);useEffect(function(){AvatarEditorUtilities.FIGURE_SET_IDS=figureSetIds;AvatarEditorUtilities.BOUND_FURNITURE_NAMES=boundFurnitureNames;resetCategories();return function(){AvatarEditorUtilities.FIGURE_SET_IDS=null;AvatarEditorUtilities.BOUND_FURNITURE_NAMES=null;};},[figureSetIds,boundFurnitureNames,resetCategories]);useEffect(function(){if(!isVisible)return;if(!figures){setupFigures();setIsInitalized(true);return;}},[isVisible,figures,setupFigures]);useEffect(function(){if(!isVisible||!isInitalized||!needsReset)return;loadAvatarInEditor(GetSessionDataManager().figure,GetSessionDataManager().gender);setNeedsReset(false);},[isVisible,isInitalized,needsReset,loadAvatarInEditor]);useEffect(function(){if(isVisible)return;return function(){setNeedsReset(true);};},[isVisible]);if(!isVisible||!figureData)return null;return/*#__PURE__*/_jsxs(NitroCardView,{uniqueKey:\"avatar-editor\",className:\"nitro-avatar-editor\",children:[/*#__PURE__*/_jsx(NitroCardHeaderView,{headerText:LocalizeText('avatareditor.title'),onCloseClick:function onCloseClick(event){return setIsVisible(false);}}),/*#__PURE__*/_jsxs(NitroCardTabsView,{children:[categories&&categories.size>0&&Array.from(categories.keys()).map(function(category){var isActive=activeCategory&&activeCategory.name===category;return/*#__PURE__*/_jsx(NitroCardTabsItemView,{isActive:isActive,onClick:function onClick(event){return selectCategory(category);},children:LocalizeText(\"avatareditor.category.\".concat(category))},category);}),/*#__PURE__*/_jsx(NitroCardTabsItemView,{isActive:isWardrobeVisible,onClick:function onClick(event){return setIsWardrobeVisible(true);},children:LocalizeText('avatareditor.category.wardrobe')})]}),/*#__PURE__*/_jsx(NitroCardContentView,{children:/*#__PURE__*/_jsxs(Grid,{children:[/*#__PURE__*/_jsxs(Column,{size:9,overflow:\"hidden\",children:[activeCategory&&!isWardrobeVisible&&/*#__PURE__*/_jsx(AvatarEditorModelView,{model:activeCategory,gender:figureData.gender,setGender:setGender}),isWardrobeVisible&&/*#__PURE__*/_jsx(AvatarEditorWardrobeView,{figureData:figureData,savedFigures:savedFigures,setSavedFigures:setSavedFigures,loadAvatarInEditor:loadAvatarInEditor})]}),/*#__PURE__*/_jsxs(Column,{size:3,overflow:\"hidden\",children:[/*#__PURE__*/_jsx(AvatarEditorFigurePreviewView,{figureData:figureData}),/*#__PURE__*/_jsxs(Column,{grow:true,gap:1,children:[/*#__PURE__*/_jsxs(ButtonGroup,{children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:function onClick(event){return processAction(AvatarEditorAction.ACTION_RESET);},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"undo\"})}),/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:function onClick(event){return processAction(AvatarEditorAction.ACTION_CLEAR);},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"trash\"})}),/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:function onClick(event){return processAction(AvatarEditorAction.ACTION_RANDOMIZE);},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"dice\"})})]}),/*#__PURE__*/_jsx(Button,{className:\"w-100\",variant:\"success\",onClick:function onClick(event){return processAction(AvatarEditorAction.ACTION_SAVE);},children:LocalizeText('avatareditor.save')})]})]})]})})]});};","map":null,"metadata":{},"sourceType":"module"}