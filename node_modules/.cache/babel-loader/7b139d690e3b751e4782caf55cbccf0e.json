{"ast":null,"code":"import _slicedToArray from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _createForOfIteratorHelper from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _classCallCheck from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\Administrator\\\\Desktop\\\\nitro\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";var __classPrivateFieldSet=this&&this.__classPrivateFieldSet||function(receiver,state,value,kind,f){if(kind===\"m\")throw new TypeError(\"Private method is not writable\");if(kind===\"a\"&&!f)throw new TypeError(\"Private accessor was defined without a setter\");if(typeof state===\"function\"?receiver!==state||!f:!state.has(receiver))throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");return kind===\"a\"?f.call(receiver,value):f?f.value=value:state.set(receiver,value),value;};var __classPrivateFieldGet=this&&this.__classPrivateFieldGet||function(receiver,state,kind,f){if(kind===\"a\"&&!f)throw new TypeError(\"Private accessor was defined without a getter\");if(typeof state===\"function\"?receiver!==state||!f:!state.has(receiver))throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");return kind===\"m\"?f:kind===\"a\"?f.call(receiver):f?f.value:state.get(receiver);};var _Particles_engine;import{calcPositionFromSize,getRangeMax,getRangeMin,getValue,randomInRange,setRangeValue}from\"../Utils/NumberUtils\";import{InteractionManager}from\"./Utils/InteractionManager\";import{Particle}from\"./Particle\";import{Point}from\"./Utils/Point\";import{QuadTree}from\"./Utils/QuadTree\";import{Rectangle}from\"./Utils/Rectangle\";import{loadParticlesOptions}from\"../Utils/OptionsUtils\";export var Particles=/*#__PURE__*/function(){function Particles(engine,container){_classCallCheck(this,Particles);this.container=container;_Particles_engine.set(this,void 0);__classPrivateFieldSet(this,_Particles_engine,engine,\"f\");this.nextId=0;this.array=[];this.zArray=[];this.limit=0;this.needsSort=false;this.lastZIndex=0;this.freqs={links:new Map(),triangles:new Map()};this.interactionManager=new InteractionManager(__classPrivateFieldGet(this,_Particles_engine,\"f\"),container);var canvasSize=this.container.canvas.size;this.quadTree=new QuadTree(new Rectangle(-canvasSize.width/4,-canvasSize.height/4,canvasSize.width*3/2,canvasSize.height*3/2),4);this.movers=__classPrivateFieldGet(this,_Particles_engine,\"f\").plugins.getMovers(container,true);this.updaters=__classPrivateFieldGet(this,_Particles_engine,\"f\").plugins.getUpdaters(container,true);}_createClass(Particles,[{key:\"count\",get:function get(){return this.array.length;}},{key:\"addManualParticles\",value:function addManualParticles(){var container=this.container,options=container.actualOptions;var _iterator=_createForOfIteratorHelper(options.manualParticles),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var particle=_step.value;this.addParticle(calcPositionFromSize({size:container.canvas.size,position:particle.position}),particle.options);}}catch(err){_iterator.e(err);}finally{_iterator.f();}}},{key:\"addParticle\",value:function addParticle(position,overrideOptions,group){var container=this.container,options=container.actualOptions,limit=options.particles.number.limit*container.density;if(limit>0){var countToRemove=this.count+1-limit;if(countToRemove>0){this.removeQuantity(countToRemove);}}return this.pushParticle(position,overrideOptions,group);}},{key:\"addSplitParticle\",value:function addSplitParticle(parent,splitParticlesOptions){var splitOptions=parent.options.destroy.split,options=loadParticlesOptions(__classPrivateFieldGet(this,_Particles_engine,\"f\"),this.container,parent.options),factor=getValue(splitOptions.factor);options.color.load({value:{hsl:parent.getFillColor()}});if(typeof options.size.value===\"number\"){options.size.value/=factor;}else{options.size.value.min/=factor;options.size.value.max/=factor;}options.load(splitParticlesOptions);var offset=splitOptions.sizeOffset?setRangeValue(-parent.size.value,parent.size.value):0,position={x:parent.position.x+randomInRange(offset),y:parent.position.y+randomInRange(offset)};return this.pushParticle(position,options,parent.group,function(particle){if(particle.size.value<0.5){return false;}particle.velocity.length=randomInRange(setRangeValue(parent.velocity.length,particle.velocity.length));particle.splitCount=parent.splitCount+1;particle.unbreakable=true;setTimeout(function(){particle.unbreakable=false;},500);return true;});}},{key:\"clear\",value:function clear(){this.array=[];this.zArray=[];}},{key:\"destroy\",value:function destroy(){this.array=[];this.zArray=[];this.movers=[];this.updaters=[];}},{key:\"draw\",value:function(){var _draw=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(delta){var container,canvasSize,_iterator2,_step2,_step2$value,plugin,_iterator3,_step3,p;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:container=this.container,canvasSize=this.container.canvas.size;this.quadTree=new QuadTree(new Rectangle(-canvasSize.width/4,-canvasSize.height/4,canvasSize.width*3/2,canvasSize.height*3/2),4);container.canvas.clear();_context.next=5;return this.update(delta);case 5:if(this.needsSort){this.zArray.sort(function(a,b){return b.position.z-a.position.z||a.id-b.id;});this.lastZIndex=this.zArray[this.zArray.length-1].position.z;this.needsSort=false;}_iterator2=_createForOfIteratorHelper(container.plugins);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){_step2$value=_slicedToArray(_step2.value,2),plugin=_step2$value[1];container.canvas.drawPlugin(plugin,delta);}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}_iterator3=_createForOfIteratorHelper(this.zArray);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){p=_step3.value;p.draw(delta);}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}case 10:case\"end\":return _context.stop();}}},_callee,this);}));function draw(_x){return _draw.apply(this,arguments);}return draw;}()},{key:\"getLinkFrequency\",value:function getLinkFrequency(p1,p2){var range=setRangeValue(p1.id,p2.id),key=\"\".concat(getRangeMin(range),\"_\").concat(getRangeMax(range));var res=this.freqs.links.get(key);if(res===undefined){res=Math.random();this.freqs.links.set(key,res);}return res;}},{key:\"getTriangleFrequency\",value:function getTriangleFrequency(p1,p2,p3){var _ref=[p1.id,p2.id,p3.id],id1=_ref[0],id2=_ref[1],id3=_ref[2];if(id1>id2){var _ref2=[id1,id2];id2=_ref2[0];id1=_ref2[1];}if(id2>id3){var _ref3=[id2,id3];id3=_ref3[0];id2=_ref3[1];}if(id1>id3){var _ref4=[id1,id3];id3=_ref4[0];id1=_ref4[1];}var key=\"\".concat(id1,\"_\").concat(id2,\"_\").concat(id3);var res=this.freqs.triangles.get(key);if(res===undefined){res=Math.random();this.freqs.triangles.set(key,res);}return res;}},{key:\"handleClickMode\",value:function handleClickMode(mode){this.interactionManager.handleClickMode(mode);}},{key:\"init\",value:function init(){var _a;var container=this.container,options=container.actualOptions;this.lastZIndex=0;this.needsSort=false;this.freqs.links=new Map();this.freqs.triangles=new Map();var handled=false;this.updaters=__classPrivateFieldGet(this,_Particles_engine,\"f\").plugins.getUpdaters(container,true);this.interactionManager.init();var _iterator4=_createForOfIteratorHelper(container.plugins),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var _step4$value=_slicedToArray(_step4.value,2),plugin=_step4$value[1];if(plugin.particlesInitialization!==undefined){handled=plugin.particlesInitialization();}if(handled){break;}}}catch(err){_iterator4.e(err);}finally{_iterator4.f();}this.addManualParticles();if(!handled){for(var group in options.particles.groups){var groupOptions=options.particles.groups[group];for(var i=this.count,j=0;j<((_a=groupOptions.number)===null||_a===void 0?void 0:_a.value)&&i<options.particles.number.value;i++,j++){this.addParticle(undefined,groupOptions,group);}}for(var _i=this.count;_i<options.particles.number.value;_i++){this.addParticle();}}this.interactionManager.init();container.pathGenerator.init(container);}},{key:\"push\",value:function push(nb,mouse,overrideOptions,group){this.pushing=true;for(var i=0;i<nb;i++){this.addParticle(mouse===null||mouse===void 0?void 0:mouse.position,overrideOptions,group);}this.pushing=false;}},{key:\"redraw\",value:function(){var _redraw=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:this.clear();this.init();_context2.next=4;return this.draw({value:0,factor:0});case 4:case\"end\":return _context2.stop();}}},_callee2,this);}));function redraw(){return _redraw.apply(this,arguments);}return redraw;}()},{key:\"remove\",value:function remove(particle,group,override){this.removeAt(this.array.indexOf(particle),undefined,group,override);}},{key:\"removeAt\",value:function removeAt(index){var quantity=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var group=arguments.length>2?arguments[2]:undefined;var override=arguments.length>3?arguments[3]:undefined;if(!(index>=0&&index<=this.count)){return;}var deleted=0;for(var i=index;deleted<quantity&&i<this.count;i++){var particle=this.array[i];if(!particle||particle.group!==group){continue;}particle.destroy(override);this.array.splice(i--,1);var zIdx=this.zArray.indexOf(particle);this.zArray.splice(zIdx,1);deleted++;__classPrivateFieldGet(this,_Particles_engine,\"f\").dispatchEvent(\"particleRemoved\",{container:this.container,data:{particle:particle}});}}},{key:\"removeQuantity\",value:function removeQuantity(quantity,group){this.removeAt(0,quantity,group);}},{key:\"setDensity\",value:function setDensity(){var options=this.container.actualOptions;for(var group in options.particles.groups){this.applyDensity(options.particles.groups[group],0,group);}this.applyDensity(options.particles,options.manualParticles.length);}},{key:\"update\",value:function(){var _update=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(delta){var container,particlesToDelete,_iterator5,_step5,_step5$value,plugin,_iterator6,_step6,_particle,resizeFactor,_iterator8,_step8,_step8$value,_plugin,_iterator9,_step9,mover,_i2,_particlesToDelete,particle,_iterator7,_step7,_particle2,_iterator10,_step10,updater;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:container=this.container,particlesToDelete=[];container.pathGenerator.update();_iterator5=_createForOfIteratorHelper(container.plugins);try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){_step5$value=_slicedToArray(_step5.value,2),plugin=_step5$value[1];if(plugin.update){plugin.update(delta);}}}catch(err){_iterator5.e(err);}finally{_iterator5.f();}_iterator6=_createForOfIteratorHelper(this.array);_context3.prev=5;_iterator6.s();case 7:if((_step6=_iterator6.n()).done){_context3.next=40;break;}_particle=_step6.value;resizeFactor=container.canvas.resizeFactor;if(resizeFactor&&!_particle.ignoresResizeRatio){_particle.position.x*=resizeFactor.width;_particle.position.y*=resizeFactor.height;}_particle.ignoresResizeRatio=false;_context3.next=14;return this.interactionManager.reset(_particle);case 14:_iterator8=_createForOfIteratorHelper(this.container.plugins);_context3.prev=15;_iterator8.s();case 17:if((_step8=_iterator8.n()).done){_context3.next=24;break;}_step8$value=_slicedToArray(_step8.value,2),_plugin=_step8$value[1];if(!_particle.destroyed){_context3.next=21;break;}return _context3.abrupt(\"break\",24);case 21:if(_plugin.particleUpdate){_plugin.particleUpdate(_particle,delta);}case 22:_context3.next=17;break;case 24:_context3.next=29;break;case 26:_context3.prev=26;_context3.t0=_context3[\"catch\"](15);_iterator8.e(_context3.t0);case 29:_context3.prev=29;_iterator8.f();return _context3.finish(29);case 32:_iterator9=_createForOfIteratorHelper(this.movers);try{for(_iterator9.s();!(_step9=_iterator9.n()).done;){mover=_step9.value;if(mover.isEnabled(_particle)){mover.move(_particle,delta);}}}catch(err){_iterator9.e(err);}finally{_iterator9.f();}if(!_particle.destroyed){_context3.next=37;break;}particlesToDelete.push(_particle);return _context3.abrupt(\"continue\",38);case 37:this.quadTree.insert(new Point(_particle.getPosition(),_particle));case 38:_context3.next=7;break;case 40:_context3.next=45;break;case 42:_context3.prev=42;_context3.t1=_context3[\"catch\"](5);_iterator6.e(_context3.t1);case 45:_context3.prev=45;_iterator6.f();return _context3.finish(45);case 48:for(_i2=0,_particlesToDelete=particlesToDelete;_i2<_particlesToDelete.length;_i2++){particle=_particlesToDelete[_i2];this.remove(particle);}_context3.next=51;return this.interactionManager.externalInteract(delta);case 51:_iterator7=_createForOfIteratorHelper(container.particles.array);_context3.prev=52;_iterator7.s();case 54:if((_step7=_iterator7.n()).done){_context3.next=63;break;}_particle2=_step7.value;_iterator10=_createForOfIteratorHelper(this.updaters);try{for(_iterator10.s();!(_step10=_iterator10.n()).done;){updater=_step10.value;updater.update(_particle2,delta);}}catch(err){_iterator10.e(err);}finally{_iterator10.f();}if(!(!_particle2.destroyed&&!_particle2.spawning)){_context3.next=61;break;}_context3.next=61;return this.interactionManager.particlesInteract(_particle2,delta);case 61:_context3.next=54;break;case 63:_context3.next=68;break;case 65:_context3.prev=65;_context3.t2=_context3[\"catch\"](52);_iterator7.e(_context3.t2);case 68:_context3.prev=68;_iterator7.f();return _context3.finish(68);case 71:delete container.canvas.resizeFactor;case 72:case\"end\":return _context3.stop();}}},_callee3,this,[[5,42,45,48],[15,26,29,32],[52,65,68,71]]);}));function update(_x2){return _update.apply(this,arguments);}return update;}()},{key:\"applyDensity\",value:function applyDensity(options,manualCount,group){var _a;if(!((_a=options.number.density)===null||_a===void 0?void 0:_a.enable)){return;}var numberOptions=options.number,densityFactor=this.initDensityFactor(numberOptions.density),optParticlesNumber=numberOptions.value,optParticlesLimit=numberOptions.limit>0?numberOptions.limit:optParticlesNumber,particlesNumber=Math.min(optParticlesNumber,optParticlesLimit)*densityFactor+manualCount,particlesCount=Math.min(this.count,this.array.filter(function(t){return t.group===group;}).length);this.limit=numberOptions.limit*densityFactor;if(particlesCount<particlesNumber){this.push(Math.abs(particlesNumber-particlesCount),undefined,options,group);}else if(particlesCount>particlesNumber){this.removeQuantity(particlesCount-particlesNumber,group);}}},{key:\"initDensityFactor\",value:function initDensityFactor(densityOptions){var container=this.container;if(!container.canvas.element||!densityOptions.enable){return 1;}var canvas=container.canvas.element,pxRatio=container.retina.pixelRatio;return canvas.width*canvas.height/(densityOptions.factor*Math.pow(pxRatio,2)*densityOptions.area);}},{key:\"pushParticle\",value:function pushParticle(position,overrideOptions,group,initializer){try{var particle=new Particle(__classPrivateFieldGet(this,_Particles_engine,\"f\"),this.nextId,this.container,position,overrideOptions,group);var canAdd=true;if(initializer){canAdd=initializer(particle);}if(!canAdd){return;}this.array.push(particle);this.zArray.push(particle);this.nextId++;__classPrivateFieldGet(this,_Particles_engine,\"f\").dispatchEvent(\"particleAdded\",{container:this.container,data:{particle:particle}});return particle;}catch(e){console.warn(\"error adding particle: \".concat(e));return;}}}]);return Particles;}();_Particles_engine=new WeakMap();","map":null,"metadata":{},"sourceType":"module"}