{"ast":null,"code":"import _toConsumableArray from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _createForOfIteratorHelper from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _slicedToArray from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{AdvancedMap,TradingAcceptComposer,TradingAcceptEvent,TradingCancelComposer,TradingCloseComposer,TradingCloseEvent,TradingCloseParser,TradingCompletedEvent,TradingConfirmationComposer,TradingConfirmationEvent,TradingListItemEvent,TradingListItemRemoveComposer,TradingNotOpenEvent,TradingOpenEvent,TradingOpenFailedEvent,TradingOtherNotAllowedEvent,TradingUnacceptComposer,TradingYouAreNotAllowedEvent}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useState}from'react';import{useBetween}from'use-between';import{useInventoryFurni}from'.';import{UseMessageEventHook}from'..';import{CloneObject,GetRoomSession,GetSessionDataManager,LocalizeText,NotificationUtilities,parseTradeItems,SendMessageComposer,TradeState,TradeUserData,TradingNotificationMessage,TradingNotificationType}from'../../api';var useInventoryTradeState=function useInventoryTradeState(){var _useState=useState(null),_useState2=_slicedToArray(_useState,2),ownUser=_useState2[0],setOwnUser=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),otherUser=_useState4[0],setOtherUser=_useState4[1];var _useState5=useState(TradeState.TRADING_STATE_READY),_useState6=_slicedToArray(_useState5,2),tradeState=_useState6[0],setTradeState=_useState6[1];var _useInventoryFurni=useInventoryFurni(),_useInventoryFurni$gr=_useInventoryFurni.groupItems,groupItems=_useInventoryFurni$gr===void 0?[]:_useInventoryFurni$gr,_useInventoryFurni$se=_useInventoryFurni.setGroupItems,setGroupItems=_useInventoryFurni$se===void 0?null:_useInventoryFurni$se,_useInventoryFurni$ac=_useInventoryFurni.activate,activate=_useInventoryFurni$ac===void 0?null:_useInventoryFurni$ac,_useInventoryFurni$de=_useInventoryFurni.deactivate,deactivate=_useInventoryFurni$de===void 0?null:_useInventoryFurni$de;var isTrading=tradeState>=TradeState.TRADING_STATE_RUNNING;var progressTrade=function progressTrade(){switch(tradeState){case TradeState.TRADING_STATE_RUNNING:if(!otherUser.itemCount&&!ownUser.accepts){NotificationUtilities.simpleAlert(LocalizeText('inventory.trading.warning.other_not_offering'),null,null,null);}if(ownUser.accepts){SendMessageComposer(new TradingUnacceptComposer());}else{SendMessageComposer(new TradingAcceptComposer());}return;case TradeState.TRADING_STATE_CONFIRMING:SendMessageComposer(new TradingConfirmationComposer());setTradeState(TradeState.TRADING_STATE_CONFIRMED);return;}};var removeItem=function removeItem(group){var item=group.getLastItem();if(!item)return;SendMessageComposer(new TradingListItemRemoveComposer(item.id));};var stopTrading=function stopTrading(){if(!isTrading)return;switch(tradeState){case TradeState.TRADING_STATE_RUNNING:SendMessageComposer(new TradingCloseComposer());return;default:SendMessageComposer(new TradingCancelComposer());return;}};var onTradingAcceptEvent=useCallback(function(event){var parser=event.getParser();if(!ownUser||!otherUser)return;if(ownUser.userId===parser.userID){setOwnUser(function(prevValue){var newValue=CloneObject(prevValue);newValue.accepts=parser.userAccepts;return newValue;});}else if(otherUser.userId===parser.userID){setOtherUser(function(prevValue){var newValue=CloneObject(prevValue);newValue.accepts=parser.userAccepts;return newValue;});}},[ownUser,otherUser]);UseMessageEventHook(TradingAcceptEvent,onTradingAcceptEvent);var onTradingCloseEvent=useCallback(function(event){var parser=event.getParser();if(parser.reason===TradingCloseParser.ERROR_WHILE_COMMIT){TradingNotificationMessage(TradingNotificationType.ERROR_WHILE_COMMIT);}else{if(ownUser&&parser.userID!==ownUser.userId){TradingNotificationMessage(TradingNotificationType.THEY_CANCELLED);}}setOwnUser(null);setOtherUser(null);setTradeState(TradeState.TRADING_STATE_READY);},[ownUser]);UseMessageEventHook(TradingCloseEvent,onTradingCloseEvent);var onTradingCompletedEvent=useCallback(function(event){var parser=event.getParser();setOwnUser(null);setOtherUser(null);setTradeState(TradeState.TRADING_STATE_READY);},[]);UseMessageEventHook(TradingCompletedEvent,onTradingCompletedEvent);var onTradingConfirmationEvent=useCallback(function(event){var parser=event.getParser();setTradeState(TradeState.TRADING_STATE_COUNTDOWN);},[]);UseMessageEventHook(TradingConfirmationEvent,onTradingConfirmationEvent);var onTradingListItemEvent=useCallback(function(event){var parser=event.getParser();var firstUserItems=parseTradeItems(parser.firstUserItemArray);var secondUserItems=parseTradeItems(parser.secondUserItemArray);setOwnUser(function(prevValue){var newValue=CloneObject(prevValue);if(newValue.userId===parser.firstUserID){newValue.creditsCount=parser.firstUserNumCredits;newValue.itemCount=parser.firstUserNumItems;newValue.userItems=firstUserItems;}else{newValue.creditsCount=parser.secondUserNumCredits;newValue.itemCount=parser.secondUserNumItems;newValue.userItems=secondUserItems;}var tradeIds=[];var _iterator=_createForOfIteratorHelper(newValue.userItems.getValues()),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var groupItem=_step.value;var i=0;while(i<groupItem.getTotalCount()){var item=groupItem.getItemByIndex(i);if(item)tradeIds.push(item.ref);i++;}}}catch(err){_iterator.e(err);}finally{_iterator.f();}setGroupItems(function(prevValue){var newValue=_toConsumableArray(prevValue);var _iterator2=_createForOfIteratorHelper(newValue),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var groupItem=_step2.value;groupItem.lockItemIds(tradeIds);}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}return newValue;});return newValue;});setOtherUser(function(prevValue){var newValue=CloneObject(prevValue);if(newValue.userId===parser.firstUserID){newValue.creditsCount=parser.firstUserNumCredits;newValue.itemCount=parser.firstUserNumItems;newValue.userItems=firstUserItems;}else{newValue.creditsCount=parser.secondUserNumCredits;newValue.itemCount=parser.secondUserNumItems;newValue.userItems=secondUserItems;}return newValue;});},[setGroupItems]);UseMessageEventHook(TradingListItemEvent,onTradingListItemEvent);var onTradingNotOpenEvent=useCallback(function(event){var parser=event.getParser();},[]);UseMessageEventHook(TradingNotOpenEvent,onTradingNotOpenEvent);var onTradingOpenEvent=useCallback(function(event){var parser=event.getParser();var firstUser=new TradeUserData();var firstUserData=GetRoomSession().userDataManager.getUserData(parser.userID);firstUser.userItems=new AdvancedMap();var secondUser=new TradeUserData();var secondUserData=GetRoomSession().userDataManager.getUserData(parser.otherUserID);secondUser.userItems=new AdvancedMap();if(firstUserData.webID===GetSessionDataManager().userId){firstUser.userId=firstUserData.webID;firstUser.userName=firstUserData.name;firstUser.canTrade=parser.userCanTrade;secondUser.userId=secondUserData.webID;secondUser.userName=secondUserData.name;secondUser.canTrade=parser.otherUserCanTrade;}else if(secondUserData.webID===GetSessionDataManager().userId){firstUser.userId=secondUserData.webID;firstUser.userName=secondUserData.name;firstUser.canTrade=parser.otherUserCanTrade;secondUser.userId=firstUserData.webID;secondUser.userName=firstUserData.name;secondUser.canTrade=parser.userCanTrade;}setOwnUser(firstUser);setOtherUser(secondUser);setTradeState(TradeState.TRADING_STATE_RUNNING);},[]);UseMessageEventHook(TradingOpenEvent,onTradingOpenEvent);var onTradingOpenFailedEvent=useCallback(function(event){var parser=event.getParser();TradingNotificationMessage(parser.reason,parser.otherUserName);},[]);UseMessageEventHook(TradingOpenFailedEvent,onTradingOpenFailedEvent);var onTradingOtherNotAllowedEvent=useCallback(function(event){var parser=event.getParser();TradingNotificationMessage(TradingNotificationType.THEY_NOT_ALLOWED);},[]);UseMessageEventHook(TradingOtherNotAllowedEvent,onTradingOtherNotAllowedEvent);var onTradingYouAreNotAllowedEvent=useCallback(function(event){var parser=event.getParser();TradingNotificationMessage(TradingNotificationType.YOU_NOT_ALLOWED);},[]);UseMessageEventHook(TradingYouAreNotAllowedEvent,onTradingYouAreNotAllowedEvent);useEffect(function(){if(tradeState===TradeState.TRADING_STATE_READY)return;var id=activate();return function(){return deactivate(id);};},[tradeState,activate,deactivate]);return{ownUser:ownUser,otherUser:otherUser,tradeState:tradeState,setTradeState:setTradeState,isTrading:isTrading,groupItems:groupItems,progressTrade:progressTrade,removeItem:removeItem,stopTrading:stopTrading};};export var useInventoryTrade=function useInventoryTrade(){return useBetween(useInventoryTradeState);};","map":null,"metadata":{},"sourceType":"module"}