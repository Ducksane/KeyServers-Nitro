{"ast":null,"code":"import _createForOfIteratorHelper from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _slicedToArray from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{AvatarFigurePartType,FurnitureMannequinSaveLookComposer,FurnitureMannequinSaveNameComposer,FurnitureMultiStateComposer,HabboClubLevelEnum,RoomControllerLevel}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useState}from'react';import{GetAvatarRenderManager,GetClubMemberLevel,GetSessionDataManager,LocalizeText,RoomWidgetUpdateMannequinEvent,SendMessageComposer}from'../../../../../api';import{Base,Button,Column,Flex,LayoutAvatarImageView,LayoutCurrencyIcon,NitroCardContentView,NitroCardHeaderView,NitroCardView,Text}from'../../../../../common';import{UseEventDispatcherHook}from'../../../../../hooks';import{useRoomContext}from'../../../RoomContext';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var MODE_NONE=-1;var MODE_CONTROLLER=0;var MODE_UPDATE=1;var MODE_PEER=2;var MODE_NO_CLUB=3;var MODE_WRONG_GENDER=4;var ACTION_SET_NAME=1;var ACTION_WEAR=2;var ACTION_SAVE=3;var MANNEQUIN_FIGURE=['hd',99999,[99998]];var MANNEQUIN_CLOTHING_PART_TYPES=[AvatarFigurePartType.CHEST_ACCESSORY,AvatarFigurePartType.COAT_CHEST,AvatarFigurePartType.CHEST,AvatarFigurePartType.LEGS,AvatarFigurePartType.SHOES,AvatarFigurePartType.WAIST_ACCESSORY];export var FurnitureMannequinView=function FurnitureMannequinView(props){var _useState=useState(-1),_useState2=_slicedToArray(_useState,2),objectId=_useState2[0],setObjectId=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),figure=_useState4[0],setFigure=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),gender=_useState6[0],setGender=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),name=_useState8[0],setName=_useState8[1];var _useState9=useState(HabboClubLevelEnum.NO_CLUB),_useState10=_slicedToArray(_useState9,2),clubLevel=_useState10[0],setClubLevel=_useState10[1];var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),renderedFigure=_useState12[0],setRenderedFigure=_useState12[1];var _useState13=useState(HabboClubLevelEnum.NO_CLUB),_useState14=_slicedToArray(_useState13,2),renderedClubLevel=_useState14[0],setRenderedClubLevel=_useState14[1];var _useState15=useState(MODE_NONE),_useState16=_slicedToArray(_useState15,2),mode=_useState16[0],setMode=_useState16[1];var _useRoomContext=useRoomContext(),_useRoomContext$roomS=_useRoomContext.roomSession,roomSession=_useRoomContext$roomS===void 0?null:_useRoomContext$roomS,_useRoomContext$event=_useRoomContext.eventDispatcher,eventDispatcher=_useRoomContext$event===void 0?null:_useRoomContext$event;var onRoomWidgetUpdateMannequinEvent=useCallback(function(event){var figureContainer=GetAvatarRenderManager().createFigureContainer(event.figure);var figureClubLevel=GetAvatarRenderManager().getFigureClubLevel(figureContainer,event.gender,MANNEQUIN_CLOTHING_PART_TYPES);setObjectId(event.objectId);setFigure(event.figure);setGender(event.gender);setName(event.name);setClubLevel(figureClubLevel);if(roomSession.isRoomOwner||roomSession.controllerLevel>=RoomControllerLevel.GUEST||GetSessionDataManager().isModerator){setMode(MODE_CONTROLLER);}else if(GetSessionDataManager().gender.toLowerCase()!==event.gender.toLowerCase()){setMode(MODE_WRONG_GENDER);}else if(GetClubMemberLevel()<figureClubLevel){setMode(MODE_NO_CLUB);}else{setMode(MODE_PEER);}},[roomSession]);UseEventDispatcherHook(RoomWidgetUpdateMannequinEvent.MANNEQUIN_UPDATE,eventDispatcher,onRoomWidgetUpdateMannequinEvent);var getMergedFigureContainer=function getMergedFigureContainer(figure,targetFigure){var figureContainer=GetAvatarRenderManager().createFigureContainer(figure);var targetFigureContainer=GetAvatarRenderManager().createFigureContainer(targetFigure);var _iterator=_createForOfIteratorHelper(MANNEQUIN_CLOTHING_PART_TYPES),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var part=_step.value;figureContainer.removePart(part);}}catch(err){_iterator.e(err);}finally{_iterator.f();}var _iterator2=_createForOfIteratorHelper(targetFigureContainer.getPartTypeIds()),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _part=_step2.value;figureContainer.updatePart(_part,targetFigureContainer.getPartSetId(_part),targetFigureContainer.getPartColorIds(_part));}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}return figureContainer;};var transformAsMannequinFigure=function transformAsMannequinFigure(figureContainer){var _iterator3=_createForOfIteratorHelper(figureContainer.getPartTypeIds()),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var part=_step3.value;if(MANNEQUIN_CLOTHING_PART_TYPES.indexOf(part)>=0)continue;figureContainer.removePart(part);}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}figureContainer.updatePart(MANNEQUIN_FIGURE[0],MANNEQUIN_FIGURE[1],MANNEQUIN_FIGURE[2]);};var processAction=useCallback(function(action){var value=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;switch(action){case ACTION_SAVE:SendMessageComposer(new FurnitureMannequinSaveLookComposer(objectId));break;case ACTION_WEAR:SendMessageComposer(new FurnitureMultiStateComposer(objectId));break;case ACTION_SET_NAME:SendMessageComposer(new FurnitureMannequinSaveNameComposer(objectId,name));return;}setMode(MODE_NONE);},[objectId,name]);var handleKeyDown=function handleKeyDown(event){if(event.key!=='Enter')return;processAction(ACTION_SET_NAME);};useEffect(function(){switch(mode){case MODE_CONTROLLER:case MODE_WRONG_GENDER:{var figureContainer=GetAvatarRenderManager().createFigureContainer(figure);transformAsMannequinFigure(figureContainer);setRenderedFigure(figureContainer.getFigureString());setRenderedClubLevel(clubLevel);break;}case MODE_UPDATE:{var _figureContainer=GetAvatarRenderManager().createFigureContainer(GetSessionDataManager().figure);transformAsMannequinFigure(_figureContainer);setRenderedFigure(_figureContainer.getFigureString());setRenderedClubLevel(GetAvatarRenderManager().getFigureClubLevel(_figureContainer,GetSessionDataManager().gender,MANNEQUIN_CLOTHING_PART_TYPES));break;}case MODE_PEER:case MODE_NO_CLUB:{var _figureContainer2=getMergedFigureContainer(GetSessionDataManager().figure,figure);setRenderedFigure(_figureContainer2.getFigureString());setRenderedClubLevel(clubLevel);break;}}},[mode,figure,clubLevel]);if(mode===MODE_NONE)return null;return/*#__PURE__*/_jsxs(NitroCardView,{className:\"nitro-mannequin\",theme:\"primary-slim\",children:[/*#__PURE__*/_jsx(NitroCardHeaderView,{headerText:LocalizeText('mannequin.widget.title'),onCloseClick:function onCloseClick(event){return setMode(MODE_NONE);}}),/*#__PURE__*/_jsx(NitroCardContentView,{center:true,children:/*#__PURE__*/_jsxs(Flex,{gap:2,overflow:\"hidden\",children:[/*#__PURE__*/_jsx(Column,{children:/*#__PURE__*/_jsxs(Base,{position:\"relative\",className:\"mannequin-preview\",children:[/*#__PURE__*/_jsx(LayoutAvatarImageView,{figure:renderedFigure,direction:2}),clubLevel>0&&/*#__PURE__*/_jsx(LayoutCurrencyIcon,{className:\"position-absolute end-2 bottom-2\",type:\"hc\"})]})}),/*#__PURE__*/_jsxs(Column,{justifyContent:\"between\",overflow:\"auto\",children:[mode===MODE_CONTROLLER&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control\",value:name,onChange:function onChange(event){return setName(event.target.value);},onKeyDown:function onKeyDown(event){return handleKeyDown(event);}}),/*#__PURE__*/_jsxs(Column,{gap:1,children:[/*#__PURE__*/_jsx(Button,{variant:\"success\",onClick:function onClick(event){return setMode(MODE_UPDATE);},children:LocalizeText('mannequin.widget.style')}),/*#__PURE__*/_jsx(Button,{variant:\"success\",onClick:function onClick(event){return processAction(ACTION_WEAR);},children:LocalizeText('mannequin.widget.wear')})]})]}),mode===MODE_UPDATE&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Column,{gap:1,children:[/*#__PURE__*/_jsx(Text,{bold:true,children:name}),/*#__PURE__*/_jsx(Text,{wrap:true,children:LocalizeText('mannequin.widget.savetext')})]}),/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",justifyContent:\"between\",children:[/*#__PURE__*/_jsx(Text,{underline:true,pointer:true,onClick:function onClick(event){return setMode(MODE_CONTROLLER);},children:LocalizeText('mannequin.widget.back')}),/*#__PURE__*/_jsx(Button,{variant:\"success\",onClick:function onClick(event){return processAction(ACTION_SAVE);},children:LocalizeText('mannequin.widget.save')})]})]}),mode===MODE_PEER&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Column,{gap:1,children:[/*#__PURE__*/_jsx(Text,{bold:true,children:name}),/*#__PURE__*/_jsx(Text,{children:LocalizeText('mannequin.widget.weartext')})]}),/*#__PURE__*/_jsx(Button,{variant:\"success\",onClick:function onClick(event){return processAction(ACTION_WEAR);},children:LocalizeText('mannequin.widget.wear')})]}),mode===MODE_NO_CLUB&&/*#__PURE__*/_jsx(Text,{children:LocalizeText('mannequin.widget.clubnotification')}),mode===MODE_WRONG_GENDER&&/*#__PURE__*/_jsx(Text,{children:LocalizeText('mannequin.widget.wronggender')})]})]})})]});};","map":null,"metadata":{},"sourceType":"module"}