{"ast":null,"code":"import _toConsumableArray from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _createForOfIteratorHelper from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _slicedToArray from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{useCallback,useEffect,useState}from'react';import{CatalogPage,CatalogType,FilterCatalogNode,FurnitureOffer,GetOfferNodes,GetSessionDataManager,LocalizeText,PageLocalization,SearchResult}from'../../../../../api';import{Button,Flex}from'../../../../../common';import{useCatalog}from'../../../../../hooks';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var CatalogSearchView=function CatalogSearchView(props){var _useState=useState(''),_useState2=_slicedToArray(_useState,2),searchValue=_useState2[0],setSearchValue=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),needsProcessing=_useState4[0],setNeedsProcessing=_useState4[1];var _useCatalog=useCatalog(),_useCatalog$currentTy=_useCatalog.currentType,currentType=_useCatalog$currentTy===void 0?null:_useCatalog$currentTy,_useCatalog$rootNode=_useCatalog.rootNode,rootNode=_useCatalog$rootNode===void 0?null:_useCatalog$rootNode,_useCatalog$offersToN=_useCatalog.offersToNodes,offersToNodes=_useCatalog$offersToN===void 0?null:_useCatalog$offersToN,_useCatalog$searchRes=_useCatalog.searchResult,searchResult=_useCatalog$searchRes===void 0?null:_useCatalog$searchRes,_useCatalog$setSearch=_useCatalog.setSearchResult,setSearchResult=_useCatalog$setSearch===void 0?null:_useCatalog$setSearch,_useCatalog$setCurren=_useCatalog.setCurrentPage,setCurrentPage=_useCatalog$setCurren===void 0?null:_useCatalog$setCurren;var updateSearchValue=function updateSearchValue(value){if(!value||!value.length){setSearchValue('');if(searchResult)setSearchResult(null);}else{setSearchValue(value);setNeedsProcessing(true);}};var processSearch=useCallback(function(search){setNeedsProcessing(false);search=search.toLocaleLowerCase().replace(' ','');if(!search||!search.length)return;var furnitureDatas=GetSessionDataManager().getAllFurnitureData({loadFurnitureData:null});if(!furnitureDatas||!furnitureDatas.length)return;var foundFurniture=[];var foundFurniLines=[];var _iterator=_createForOfIteratorHelper(furnitureDatas),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var _furniture=_step.value;if(currentType===CatalogType.BUILDER&&!_furniture.availableForBuildersClub)continue;if(currentType===CatalogType.NORMAL&&_furniture.excludeDynamic)continue;var searchValues=[_furniture.className,_furniture.name,_furniture.description].join(' ').replace(/ /gi,'').toLowerCase();if(currentType===CatalogType.BUILDER&&_furniture.purchaseOfferId===-1&&_furniture.rentOfferId===-1){if(_furniture.furniLine!==''&&foundFurniLines.indexOf(_furniture.furniLine)<0){if(searchValues.indexOf(search)>=0)foundFurniLines.push(_furniture.furniLine);}}else{var foundNodes=[].concat(_toConsumableArray(GetOfferNodes(offersToNodes,_furniture.purchaseOfferId)),_toConsumableArray(GetOfferNodes(offersToNodes,_furniture.rentOfferId)));if(foundNodes.length){if(searchValues.indexOf(search)>=0)foundFurniture.push(_furniture);if(foundFurniture.length===250)break;}}}}catch(err){_iterator.e(err);}finally{_iterator.f();}var offers=[];for(var _i=0,_foundFurniture=foundFurniture;_i<_foundFurniture.length;_i++){var furniture=_foundFurniture[_i];offers.push(new FurnitureOffer(furniture));}var nodes=[];FilterCatalogNode(search,foundFurniLines,rootNode,nodes);setCurrentPage(new CatalogPage(-1,'default_3x3',new PageLocalization([],[]),offers,false,1));setSearchResult(new SearchResult(search,offers,nodes.filter(function(node){return node.isVisible;})));},[offersToNodes,currentType,rootNode,setCurrentPage,setSearchResult]);useEffect(function(){if(!needsProcessing)return;var timeout=setTimeout(function(){return processSearch(searchValue);},300);return function(){return clearTimeout(timeout);};},[searchValue,needsProcessing,processSearch]);return/*#__PURE__*/_jsxs(Flex,{gap:1,children:[/*#__PURE__*/_jsx(Flex,{fullWidth:true,alignItems:\"center\",position:\"relative\",children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control form-control-sm\",placeholder:LocalizeText('generic.search'),value:searchValue,onChange:function onChange(event){return updateSearchValue(event.target.value);},onKeyDown:function onKeyDown(event){return(event.code==='Enter'||event.code==='NumpadEnter')&&processSearch(searchValue);}})}),(!searchValue||!searchValue.length)&&/*#__PURE__*/_jsx(Button,{variant:\"primary\",className:\"catalog-search-button\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"search\"})}),searchValue&&!!searchValue.length&&/*#__PURE__*/_jsx(Button,{variant:\"primary\",className:\"catalog-search-button\",onClick:function onClick(event){return updateSearchValue('');},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"times\"})})]});};","map":null,"metadata":{},"sourceType":"module"}