{"ast":null,"code":"import _createForOfIteratorHelper from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _classCallCheck from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/createClass.js\";import{AvatarFigurePartType,NitroAlphaFilter,NitroContainer,NitroSprite,TextureUtils}from'@nitrots/nitro-renderer';import{GetAvatarRenderManager}from'../../../api';import{FigureData}from'./FigureData';export var AvatarEditorGridPartItem=/*#__PURE__*/function(){function AvatarEditorGridPartItem(partSet,partColors){var useColors=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var isDisabled=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;_classCallCheck(this,AvatarEditorGridPartItem);this._renderManager=void 0;this._partSet=void 0;this._partColors=void 0;this._useColors=void 0;this._isDisabled=void 0;this._thumbContainer=void 0;this._imageUrl=void 0;this._maxColorIndex=void 0;this._isValidFigure=void 0;this._isHC=void 0;this._isSellable=void 0;this._isClear=void 0;this._isSelected=void 0;this._disposed=void 0;this._isInitalized=void 0;this._notifier=void 0;this._renderManager=GetAvatarRenderManager();this._partSet=partSet;this._partColors=partColors;this._useColors=useColors;this._isDisabled=isDisabled;this._thumbContainer=null;this._imageUrl=null;this._maxColorIndex=0;this._isValidFigure=false;this._isHC=false;this._isSellable=false;this._isClear=false;this._isSelected=false;this._disposed=false;this._isInitalized=false;if(partSet){var colors=partSet.parts;var _iterator=_createForOfIteratorHelper(colors),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var color=_step.value;this._maxColorIndex=Math.max(this._maxColorIndex,color.colorLayerIndex);}}catch(err){_iterator.e(err);}finally{_iterator.f();}}}_createClass(AvatarEditorGridPartItem,[{key:\"init\",value:function init(){if(this._isInitalized)return;this._isInitalized=true;this.update();}},{key:\"dispose\",value:function dispose(){if(this._disposed)return;this._renderManager=null;this._partSet=null;this._partColors=null;this._imageUrl=null;this._disposed=true;this._isInitalized=false;if(this._thumbContainer){this._thumbContainer.destroy();this._thumbContainer=null;}}},{key:\"update\",value:function update(){this.updateThumbVisualization();}},{key:\"analyzeFigure\",value:function analyzeFigure(){if(!this._renderManager||!this._partSet||!this._partSet.parts||!this._partSet.parts.length)return false;var figureContainer=this._renderManager.createFigureContainer(this.partSet.type+'-'+this.partSet.id);if(!this._renderManager.isFigureContainerReady(figureContainer)){this._renderManager.downloadAvatarFigure(figureContainer,this);return false;}this._isValidFigure=true;return true;}},{key:\"renderThumb\",value:function renderThumb(){if(!this._renderManager||!this._partSet)return null;if(!this._isValidFigure){if(!this.analyzeFigure())return null;}var parts=this._partSet.parts.concat().sort(this.sortByDrawOrder);var container=new NitroContainer();var _iterator2=_createForOfIteratorHelper(parts),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var part=_step2.value;if(!part)continue;var asset=null;var direction=0;var hasAsset=false;while(!hasAsset&&direction<AvatarEditorGridPartItem.THUMB_DIRECTIONS.length){var assetName=FigureData.SCALE+'_'+FigureData.STD+'_'+part.type+'_'+part.id+'_'+AvatarEditorGridPartItem.THUMB_DIRECTIONS[direction]+'_'+FigureData.DEFAULT_FRAME;asset=this._renderManager.getAssetByName(assetName);if(asset&&asset.texture){hasAsset=true;}else{direction++;}}if(!hasAsset)continue;var x=asset.offsetX;var y=asset.offsetY;var partColor=null;if(this._useColors&&part.colorLayerIndex>0){var color=this._partColors[part.colorLayerIndex-1];if(color)partColor=color;}var sprite=new NitroSprite(asset.texture);sprite.position.set(x,y);if(partColor)sprite.tint=partColor.rgb;container.addChild(sprite);}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}return container;}},{key:\"updateThumbVisualization\",value:function updateThumbVisualization(){if(!this._isInitalized)return;var container=this._thumbContainer;if(!container)container=this.renderThumb();if(!container)return;if(this._partSet){this._isHC=this._partSet.clubLevel>0;this._isSellable=this._partSet.isSellable;}else{this._isHC=false;this._isSellable=false;}if(this._isDisabled)this.setAlpha(container,0.2);this._imageUrl=TextureUtils.generateImageUrl(container);if(this.notify)this.notify();}},{key:\"setAlpha\",value:function setAlpha(container,alpha){container.filters=[AvatarEditorGridPartItem.ALPHA_FILTER];return container;}},{key:\"sortByDrawOrder\",value:function sortByDrawOrder(a,b){var indexA=AvatarEditorGridPartItem.DRAW_ORDER.indexOf(a.type);var indexB=AvatarEditorGridPartItem.DRAW_ORDER.indexOf(b.type);if(indexA<indexB)return-1;if(indexA>indexB)return 1;if(a.index<b.index)return-1;if(a.index>b.index)return 1;return 0;}},{key:\"resetFigure\",value:function resetFigure(figure){if(!this.analyzeFigure())return;this.update();}},{key:\"disposed\",get:function get(){return this._disposed;}},{key:\"id\",get:function get(){if(!this._partSet)return-1;return this._partSet.id;}},{key:\"partSet\",get:function get(){return this._partSet;}},{key:\"partColors\",set:function set(partColors){this._partColors=partColors;this.update();}},{key:\"isDisabled\",get:function get(){return this._isDisabled;}},{key:\"thumbContainer\",set:function set(container){this._thumbContainer=container;this.update();}},{key:\"imageUrl\",get:function get(){return this._imageUrl;}},{key:\"maxColorIndex\",get:function get(){return this._maxColorIndex;}},{key:\"isHC\",get:function get(){return this._isHC;}},{key:\"isSellable\",get:function get(){return this._isSellable;}},{key:\"isClear\",get:function get(){return this._isClear;},set:function set(flag){this._isClear=flag;}},{key:\"isSelected\",get:function get(){return this._isSelected;},set:function set(flag){this._isSelected=flag;if(this.notify)this.notify();}},{key:\"notify\",get:function get(){return this._notifier;},set:function set(notifier){this._notifier=notifier;}}]);return AvatarEditorGridPartItem;}();AvatarEditorGridPartItem.ALPHA_FILTER=new NitroAlphaFilter(0.2);AvatarEditorGridPartItem.THUMB_DIRECTIONS=[2,6,0,4,3,1];AvatarEditorGridPartItem.DRAW_ORDER=[AvatarFigurePartType.LEFT_HAND_ITEM,AvatarFigurePartType.LEFT_HAND,AvatarFigurePartType.LEFT_SLEEVE,AvatarFigurePartType.LEFT_COAT_SLEEVE,AvatarFigurePartType.BODY,AvatarFigurePartType.SHOES,AvatarFigurePartType.LEGS,AvatarFigurePartType.CHEST,AvatarFigurePartType.CHEST_ACCESSORY,AvatarFigurePartType.COAT_CHEST,AvatarFigurePartType.CHEST_PRINT,AvatarFigurePartType.WAIST_ACCESSORY,AvatarFigurePartType.RIGHT_HAND,AvatarFigurePartType.RIGHT_SLEEVE,AvatarFigurePartType.RIGHT_COAT_SLEEVE,AvatarFigurePartType.HEAD,AvatarFigurePartType.FACE,AvatarFigurePartType.EYES,AvatarFigurePartType.HAIR,AvatarFigurePartType.HAIR_BIG,AvatarFigurePartType.FACE_ACCESSORY,AvatarFigurePartType.EYE_ACCESSORY,AvatarFigurePartType.HEAD_ACCESSORY,AvatarFigurePartType.HEAD_ACCESSORY_EXTRA,AvatarFigurePartType.RIGHT_HAND_ITEM];","map":null,"metadata":{},"sourceType":"module"}