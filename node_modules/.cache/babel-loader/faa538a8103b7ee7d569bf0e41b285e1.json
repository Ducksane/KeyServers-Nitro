{"ast":null,"code":"import _createForOfIteratorHelper from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _classCallCheck from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _assertThisInitialized from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";import _inherits from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/home/muphy/Documents/habboom/Nitro-Edit-main/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import{PetFigureUpdateEvent}from'../../communication';import{NewFriendRequestEvent}from'../../communication/messages/incoming/friendlist/NewFriendRequestEvent';import{BotErrorEvent}from'../../communication/messages/incoming/notifications/BotErrorEvent';import{PetPlacingErrorEvent}from'../../communication/messages/incoming/notifications/PetPlacingErrorEvent';import{RoomDoorbellEvent}from'../../communication/messages/incoming/room/access/doorbell/RoomDoorbellEvent';import{FavoriteMembershipUpdateMessageEvent}from'../../communication/messages/incoming/room/engine/FavoriteMembershipUpdateMessageEvent';import{PetInfoEvent}from'../../communication/messages/incoming/room/pet/PetInfoEvent';import{PetStatusUpdateEvent}from'../../communication/messages/incoming/room/pet/PetStatusUpdateEvent';import{RoomUnitDanceEvent}from'../../communication/messages/incoming/room/unit/RoomUnitDanceEvent';import{RoomUnitEvent}from'../../communication/messages/incoming/room/unit/RoomUnitEvent';import{RoomUnitInfoEvent}from'../../communication/messages/incoming/room/unit/RoomUnitInfoEvent';import{RoomUnitRemoveEvent}from'../../communication/messages/incoming/room/unit/RoomUnitRemoveEvent';import{UserCurrentBadgesEvent}from'../../communication/messages/incoming/user/data/UserCurrentBadgesEvent';import{UserNameChangeMessageEvent}from'../../communication/messages/incoming/user/data/UserNameChangeMessageEvent';import{RoomSessionPetFigureUpdateEvent,RoomSessionPetStatusUpdateEvent,RoomSessionUserFigureUpdateEvent}from'../events';import{RoomSessionDanceEvent}from'../events/RoomSessionDanceEvent';import{RoomSessionDoorbellEvent}from'../events/RoomSessionDoorbellEvent';import{RoomSessionErrorMessageEvent}from'../events/RoomSessionErrorMessageEvent';import{RoomSessionFavoriteGroupUpdateEvent}from'../events/RoomSessionFavoriteGroupUpdateEvent';import{RoomSessionFriendRequestEvent}from'../events/RoomSessionFriendRequestEvent';import{RoomSessionPetInfoUpdateEvent}from'../events/RoomSessionPetInfoUpdateEvent';import{RoomSessionUserBadgesEvent}from'../events/RoomSessionUserBadgesEvent';import{RoomSessionUserDataUpdateEvent}from'../events/RoomSessionUserDataUpdateEvent';import{RoomPetData}from'../RoomPetData';import{RoomUserData}from'../RoomUserData';import{BaseHandler}from'./BaseHandler';export var RoomUsersHandler=/*#__PURE__*/function(_BaseHandler){_inherits(RoomUsersHandler,_BaseHandler);var _super=_createSuper(RoomUsersHandler);function RoomUsersHandler(connection,listener){var _this;_classCallCheck(this,RoomUsersHandler);_this=_super.call(this,connection,listener);connection.addMessageEvent(new RoomUnitEvent(_this.onRoomUnitEvent.bind(_assertThisInitialized(_this))));connection.addMessageEvent(new RoomUnitInfoEvent(_this.onRoomUnitInfoEvent.bind(_assertThisInitialized(_this))));connection.addMessageEvent(new RoomUnitRemoveEvent(_this.onRoomUnitRemoveEvent.bind(_assertThisInitialized(_this))));connection.addMessageEvent(new RoomUnitDanceEvent(_this.onRoomUnitDanceEvent.bind(_assertThisInitialized(_this))));connection.addMessageEvent(new UserCurrentBadgesEvent(_this.onUserCurrentBadgesEvent.bind(_assertThisInitialized(_this))));connection.addMessageEvent(new RoomDoorbellEvent(_this.onRoomDoorbellEvent.bind(_assertThisInitialized(_this))));connection.addMessageEvent(new UserNameChangeMessageEvent(_this.onUserNameChangeMessageEvent.bind(_assertThisInitialized(_this))));connection.addMessageEvent(new NewFriendRequestEvent(_this.onNewFriendRequestEvent.bind(_assertThisInitialized(_this))));connection.addMessageEvent(new PetInfoEvent(_this.onPetInfoEvent.bind(_assertThisInitialized(_this))));connection.addMessageEvent(new PetStatusUpdateEvent(_this.onPetStatusUpdateEvent.bind(_assertThisInitialized(_this))));connection.addMessageEvent(new PetFigureUpdateEvent(_this.onPetFigureUpdateEvent.bind(_assertThisInitialized(_this))));connection.addMessageEvent(new PetPlacingErrorEvent(_this.onPetPlacingError.bind(_assertThisInitialized(_this))));connection.addMessageEvent(new BotErrorEvent(_this.onBotError.bind(_assertThisInitialized(_this))));connection.addMessageEvent(new FavoriteMembershipUpdateMessageEvent(_this.onFavoriteMembershipUpdateMessageEvent.bind(_assertThisInitialized(_this))));return _this;}_createClass(RoomUsersHandler,[{key:\"onRoomUnitEvent\",value:function onRoomUnitEvent(event){if(!this.listener)return;var session=this.listener.getSession(this.roomId);if(!session)return;var users=event.getParser().users;var usersToAdd=[];if(users&&users.length){var _iterator=_createForOfIteratorHelper(users),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var user=_step.value;if(!user)continue;var userData=new RoomUserData(user.roomIndex);userData.name=user.name;userData.custom=user.custom;userData.activityPoints=user.activityPoints;userData.figure=user.figure;userData.type=user.userType;userData.webID=user.webID;userData.groupId=user.groupID;userData.groupName=user.groupName;userData.groupStatus=user.groupStatus;userData.sex=user.sex;userData.ownerId=user.ownerId;userData.ownerName=user.ownerName;userData.rarityLevel=user.rarityLevel;userData.hasSaddle=user.hasSaddle;userData.isRiding=user.isRiding;userData.canBreed=user.canBreed;userData.canHarvest=user.canHarvest;userData.canRevive=user.canRevive;userData.hasBreedingPermission=user.hasBreedingPermission;userData.petLevel=user.petLevel;userData.botSkills=user.botSkills;userData.isModerator=user.isModerator;if(!session.userDataManager.getUserData(user.roomIndex))usersToAdd.push(userData);session.userDataManager.updateUserData(userData);}}catch(err){_iterator.e(err);}finally{_iterator.f();}}this.listener.events.dispatchEvent(new RoomSessionUserDataUpdateEvent(session,usersToAdd));}},{key:\"onRoomUnitInfoEvent\",value:function onRoomUnitInfoEvent(event){if(!this.listener)return;var session=this.listener.getSession(this.roomId);if(!session)return;var parser=event.getParser();if(!parser)return;session.userDataManager.updateFigure(parser.unitId,parser.figure,parser.gender,false,false);session.userDataManager.updateMotto(parser.unitId,parser.motto);session.userDataManager.updateAchievementScore(parser.unitId,parser.achievementScore);this.listener.events.dispatchEvent(new RoomSessionUserFigureUpdateEvent(session,parser.unitId,parser.figure,parser.gender,parser.motto,parser.achievementScore));}},{key:\"onRoomUnitRemoveEvent\",value:function onRoomUnitRemoveEvent(event){if(!this.listener)return;var session=this.listener.getSession(this.roomId);if(!session)return;session.userDataManager.removeUserData(event.getParser().unitId);}},{key:\"onRoomUnitDanceEvent\",value:function onRoomUnitDanceEvent(event){if(!this.listener)return;var parser=event.getParser();if(!parser)return;var session=this.listener.getSession(this.roomId);if(!session)return;this.listener.events.dispatchEvent(new RoomSessionDanceEvent(session,parser.unitId,parser.danceId));}},{key:\"onUserCurrentBadgesEvent\",value:function onUserCurrentBadgesEvent(event){if(!this.listener)return;var parser=event.getParser();if(!parser)return;var session=this.listener.getSession(this.roomId);if(!session)return;session.userDataManager.setUserBadges(parser.userId,parser.badges);this.listener.events.dispatchEvent(new RoomSessionUserBadgesEvent(session,parser.userId,parser.badges));}},{key:\"onRoomDoorbellEvent\",value:function onRoomDoorbellEvent(event){if(!this.listener)return;var parser=event.getParser();if(!parser)return;var username=parser.userName;if(!username||!username.length)return;var session=this.listener.getSession(this.roomId);if(!session)return;this.listener.events.dispatchEvent(new RoomSessionDoorbellEvent(RoomSessionDoorbellEvent.DOORBELL,session,username));}},{key:\"onUserNameChangeMessageEvent\",value:function onUserNameChangeMessageEvent(event){if(!this.listener)return;var parser=event.getParser();if(!parser)return;var session=this.listener.getSession(this.roomId);if(!session)return;session.userDataManager.updateName(parser.id,parser.newName);}},{key:\"onNewFriendRequestEvent\",value:function onNewFriendRequestEvent(event){if(!this.listener)return;var parser=event.getParser();if(!parser)return;var session=this.listener.getSession(this.roomId);if(!session)return;var request=parser.request;this.listener.events.dispatchEvent(new RoomSessionFriendRequestEvent(session,request.requestId,request.requesterUserId,request.requesterName));}},{key:\"onPetInfoEvent\",value:function onPetInfoEvent(event){if(!this.listener)return;var parser=event.getParser();if(!parser)return;var session=this.listener.getSession(this.roomId);if(!session)return;var petData=new RoomPetData();petData.id=parser.id;petData.level=parser.level;petData.maximumLevel=parser.maximumLevel;petData.experience=parser.experience;petData.levelExperienceGoal=parser.levelExperienceGoal;petData.energy=parser.energy;petData.maximumEnergy=parser.maximumEnergy;petData.happyness=parser.happyness;petData.maximumHappyness=parser.maximumHappyness;petData.ownerId=parser.ownerId;petData.ownerName=parser.ownerName;petData.respect=parser.respect;petData.age=parser.age;petData.unknownRarity=parser.unknownRarity;petData.saddle=parser.saddle;petData.rider=parser.rider;petData.breedable=parser.breedable;petData.fullyGrown=parser.fullyGrown;petData.rarityLevel=parser.rarityLevel;petData.dead=parser.dead;petData.skillTresholds=parser.skillTresholds;petData.publiclyRideable=parser.publiclyRideable;petData.maximumTimeToLive=parser.maximumTimeToLive;petData.remainingTimeToLive=parser.remainingTimeToLive;petData.remainingGrowTime=parser.remainingGrowTime;petData.publiclyBreedable=parser.publiclyBreedable;this.listener.events.dispatchEvent(new RoomSessionPetInfoUpdateEvent(session,petData));}},{key:\"onPetStatusUpdateEvent\",value:function onPetStatusUpdateEvent(event){if(!this.listener)return;var parser=event.getParser();if(!parser)return;var session=this.listener.getSession(this.roomId);if(!session)return;session.userDataManager.updatePetBreedingStatus(parser.roomIndex,parser.canBreed,parser.canHarvest,parser.canRevive,parser.hasBreedingPermission);this.listener.events.dispatchEvent(new RoomSessionPetStatusUpdateEvent(session,parser.petId,parser.canBreed,parser.canHarvest,parser.canRevive,parser.hasBreedingPermission));}},{key:\"onPetFigureUpdateEvent\",value:function onPetFigureUpdateEvent(event){if(!this.listener)return;var parser=event.getParser();if(!parser)return;var session=this.listener.getSession(this.roomId);if(!session)return;var figure=parser.figureData.figuredata;session.userDataManager.updateFigure(parser.roomIndex,figure,'',parser.hasSaddle,parser.isRiding);this.listener.events.dispatchEvent(new RoomSessionPetFigureUpdateEvent(session,parser.petId,figure));}},{key:\"onPetPlacingError\",value:function onPetPlacingError(event){if(!event)return;if(!this.listener)return;var parser=event.getParser();if(!parser)return;var session=this.listener.getSession(this.roomId);if(!session)return;var type=null;switch(parser.errorCode){case 0:type=RoomSessionErrorMessageEvent.RSEME_PETS_FORBIDDEN_IN_HOTEL;break;case 1:type=RoomSessionErrorMessageEvent.RSEME_PETS_FORBIDDEN_IN_FLAT;break;case 2:type=RoomSessionErrorMessageEvent.RSEME_MAX_PETS;break;case 3:type=RoomSessionErrorMessageEvent.RSEME_NO_FREE_TILES_FOR_PET;break;case 4:type=RoomSessionErrorMessageEvent.RSEME_SELECTED_TILE_NOT_FREE_FOR_PET;break;case 5:type=RoomSessionErrorMessageEvent.RSEME_MAX_NUMBER_OF_OWN_PETS;break;}if(!type||type.length==0)return;this.listener.events.dispatchEvent(new RoomSessionErrorMessageEvent(type,session));}},{key:\"onBotError\",value:function onBotError(event){if(!event)return;if(!this.listener)return;var parser=event.getParser();if(!parser)return;var session=this.listener.getSession(this.roomId);if(!session)return;var type=null;switch(parser.errorCode){case 0:type=RoomSessionErrorMessageEvent.RSEME_BOTS_FORBIDDEN_IN_HOTEL;break;case 1:type=RoomSessionErrorMessageEvent.RSEME_BOTS_FORBIDDEN_IN_FLAT;break;case 2:type=RoomSessionErrorMessageEvent.RSEME_BOT_LIMIT_REACHED;break;case 3:type=RoomSessionErrorMessageEvent.RSEME_SELECTED_TILE_NOT_FREE_FOR_BOT;break;case 4:type=RoomSessionErrorMessageEvent.RSEME_BOT_NAME_NOT_ACCEPTED;break;}if(!type||type.length==0)return;this.listener.events.dispatchEvent(new RoomSessionErrorMessageEvent(type,session));}},{key:\"onFavoriteMembershipUpdateMessageEvent\",value:function onFavoriteMembershipUpdateMessageEvent(event){if(!this.listener)return;var parser=event.getParser();var session=this.listener.getSession(this.roomId);if(!session)return;var userData=session.userDataManager.getUserDataByIndex(parser.roomIndex);if(!userData)return;userData.groupId=parser.groupId;userData.groupName=parser.groupName;this.listener.events.dispatchEvent(new RoomSessionFavoriteGroupUpdateEvent(session,parser.roomIndex,parser.groupId,parser.status,parser.groupName));}}]);return RoomUsersHandler;}(BaseHandler);","map":null,"metadata":{},"sourceType":"module"}