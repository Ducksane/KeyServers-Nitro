{"ast":null,"code":"import _slicedToArray from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{GetClubOffersMessageComposer,PurchaseFromCatalogComposer}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useMemo,useState}from'react';import{CatalogPurchaseState,LocalizeText,SendMessageComposer}from'../../../../../api';import{AutoGrid,Button,Column,Flex,Grid,LayoutCurrencyIcon,LayoutGridItem,LayoutLoadingSpinnerView,Text}from'../../../../../common';import{CatalogPurchasedEvent,CatalogPurchaseFailureEvent}from'../../../../../events';import{useCatalog,usePurse,UseUiEvent}from'../../../../../hooks';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var CatalogLayoutVipBuyView=function CatalogLayoutVipBuyView(props){var _useState=useState(null),_useState2=_slicedToArray(_useState,2),pendingOffer=_useState2[0],setPendingOffer=_useState2[1];var _useState3=useState(CatalogPurchaseState.NONE),_useState4=_slicedToArray(_useState3,2),purchaseState=_useState4[0],setPurchaseState=_useState4[1];var _useCatalog=useCatalog(),_useCatalog$currentPa=_useCatalog.currentPage,currentPage=_useCatalog$currentPa===void 0?null:_useCatalog$currentPa,_useCatalog$catalogOp=_useCatalog.catalogOptions,catalogOptions=_useCatalog$catalogOp===void 0?null:_useCatalog$catalogOp;var _usePurse=usePurse(),_usePurse$purse=_usePurse.purse,purse=_usePurse$purse===void 0?null:_usePurse$purse,_usePurse$getCurrency=_usePurse.getCurrencyAmount,getCurrencyAmount=_usePurse$getCurrency===void 0?null:_usePurse$getCurrency;var _catalogOptions$clubO=catalogOptions.clubOffers,clubOffers=_catalogOptions$clubO===void 0?null:_catalogOptions$clubO;var onCatalogEvent=useCallback(function(event){switch(event.type){case CatalogPurchasedEvent.PURCHASE_SUCCESS:setPurchaseState(CatalogPurchaseState.NONE);return;case CatalogPurchaseFailureEvent.PURCHASE_FAILED:setPurchaseState(CatalogPurchaseState.FAILED);return;}},[]);UseUiEvent(CatalogPurchasedEvent.PURCHASE_SUCCESS,onCatalogEvent);UseUiEvent(CatalogPurchaseFailureEvent.PURCHASE_FAILED,onCatalogEvent);var getOfferText=useCallback(function(offer){var offerText='';if(offer.months>0){offerText=LocalizeText('catalog.vip.item.header.months',['num_months'],[offer.months.toString()]);}if(offer.extraDays>0){if(offerText!=='')offerText+=' ';offerText+=' '+LocalizeText('catalog.vip.item.header.days',['num_days'],[offer.extraDays.toString()]);}return offerText;},[]);var getPurchaseHeader=useCallback(function(){if(!purse)return'';var extensionOrSubscription=purse.clubDays>0||purse.clubPeriods>0?'extension.':'subscription.';var daysOrMonths=pendingOffer.months===0?'days':'months';var daysOrMonthsText=pendingOffer.months===0?pendingOffer.extraDays:pendingOffer.months;var locale=LocalizeText('catalog.vip.buy.confirm.'+extensionOrSubscription+daysOrMonths);return locale.replace('%NUM_'+daysOrMonths.toUpperCase()+'%',daysOrMonthsText.toString());},[pendingOffer,purse]);var getPurchaseValidUntil=useCallback(function(){var locale=LocalizeText('catalog.vip.buy.confirm.end_date');locale=locale.replace('%month%',pendingOffer.month.toString());locale=locale.replace('%day%',pendingOffer.day.toString());locale=locale.replace('%year%',pendingOffer.year.toString());return locale;},[pendingOffer]);var getSubscriptionDetails=useMemo(function(){var clubDays=purse.clubDays;var clubPeriods=purse.clubPeriods;var totalDays=clubPeriods*31+clubDays;return LocalizeText('catalog.vip.extend.info',['days'],[totalDays.toString()]);},[purse]);var purchaseSubscription=useCallback(function(){if(!pendingOffer)return;setPurchaseState(CatalogPurchaseState.PURCHASE);SendMessageComposer(new PurchaseFromCatalogComposer(currentPage.pageId,pendingOffer.offerId,null,1));},[pendingOffer,currentPage]);var setOffer=useCallback(function(offer){setPurchaseState(CatalogPurchaseState.NONE);setPendingOffer(offer);},[]);var getPurchaseButton=useCallback(function(){if(!pendingOffer)return null;if(pendingOffer.priceCredits>getCurrencyAmount(-1)){return/*#__PURE__*/_jsx(Button,{fullWidth:true,variant:\"danger\",children:LocalizeText('catalog.alert.notenough.title')});}if(pendingOffer.priceActivityPoints>getCurrencyAmount(pendingOffer.priceActivityPointsType)){return/*#__PURE__*/_jsx(Button,{fullWidth:true,variant:\"danger\",children:LocalizeText('catalog.alert.notenough.activitypoints.title.'+pendingOffer.priceActivityPointsType)});}switch(purchaseState){case CatalogPurchaseState.CONFIRM:return/*#__PURE__*/_jsx(Button,{fullWidth:true,variant:\"warning\",onClick:purchaseSubscription,children:LocalizeText('catalog.marketplace.confirm_title')});case CatalogPurchaseState.PURCHASE:return/*#__PURE__*/_jsx(Button,{fullWidth:true,variant:\"primary\",disabled:true,children:/*#__PURE__*/_jsx(LayoutLoadingSpinnerView,{})});case CatalogPurchaseState.FAILED:return/*#__PURE__*/_jsx(Button,{fullWidth:true,variant:\"danger\",disabled:true,children:LocalizeText('generic.failed')});case CatalogPurchaseState.NONE:default:return/*#__PURE__*/_jsx(Button,{fullWidth:true,variant:\"success\",onClick:function onClick(){return setPurchaseState(CatalogPurchaseState.CONFIRM);},children:LocalizeText('buy')});}},[pendingOffer,purchaseState,purchaseSubscription,getCurrencyAmount]);useEffect(function(){if(!clubOffers)SendMessageComposer(new GetClubOffersMessageComposer(1));},[clubOffers]);return/*#__PURE__*/_jsxs(Grid,{children:[/*#__PURE__*/_jsxs(Column,{fullHeight:true,size:7,overflow:\"hidden\",justifyContent:\"between\",children:[/*#__PURE__*/_jsx(AutoGrid,{columnCount:1,className:\"nitro-catalog-layout-vip-buy-grid\",children:clubOffers&&clubOffers.length>0&&clubOffers.map(function(offer,index){return/*#__PURE__*/_jsxs(LayoutGridItem,{column:false,center:false,alignItems:\"center\",justifyContent:\"between\",itemActive:pendingOffer===offer,className:\"p-1\",onClick:function onClick(){return setOffer(offer);},children:[/*#__PURE__*/_jsx(\"i\",{className:\"icon-hc-banner\"}),/*#__PURE__*/_jsxs(Column,{justifyContent:\"end\",gap:0,children:[/*#__PURE__*/_jsx(Text,{textEnd:true,children:getOfferText(offer)}),/*#__PURE__*/_jsxs(Flex,{justifyContent:\"end\",gap:1,children:[offer.priceCredits>0&&/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",justifyContent:\"end\",gap:1,children:[/*#__PURE__*/_jsx(Text,{children:offer.priceCredits}),/*#__PURE__*/_jsx(LayoutCurrencyIcon,{type:-1})]}),offer.priceActivityPoints>0&&/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",justifyContent:\"end\",gap:1,children:[/*#__PURE__*/_jsx(Text,{children:offer.priceActivityPoints}),/*#__PURE__*/_jsx(LayoutCurrencyIcon,{type:offer.priceActivityPointsType})]})]})]})]},index);})}),/*#__PURE__*/_jsx(Text,{center:true,dangerouslySetInnerHTML:{__html:LocalizeText('catalog.vip.buy.hccenter')}})]}),/*#__PURE__*/_jsxs(Column,{size:5,overflow:\"hidden\",children:[/*#__PURE__*/_jsxs(Column,{fullHeight:true,center:true,overflow:\"hidden\",children:[currentPage.localization.getImage(1)&&/*#__PURE__*/_jsx(\"img\",{alt:\"\",src:currentPage.localization.getImage(1)}),/*#__PURE__*/_jsx(Text,{center:true,overflow:\"auto\",dangerouslySetInnerHTML:{__html:getSubscriptionDetails}})]}),pendingOffer&&/*#__PURE__*/_jsxs(Column,{fullWidth:true,grow:true,justifyContent:\"end\",children:[/*#__PURE__*/_jsxs(Flex,{alignItems:\"end\",children:[/*#__PURE__*/_jsxs(Column,{grow:true,gap:0,children:[/*#__PURE__*/_jsx(Text,{fontWeight:\"bold\",children:getPurchaseHeader()}),/*#__PURE__*/_jsx(Text,{children:getPurchaseValidUntil()})]}),/*#__PURE__*/_jsxs(Column,{gap:1,children:[pendingOffer.priceCredits>0&&/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",justifyContent:\"end\",gap:1,children:[/*#__PURE__*/_jsx(Text,{children:pendingOffer.priceCredits}),/*#__PURE__*/_jsx(LayoutCurrencyIcon,{type:-1})]}),pendingOffer.priceActivityPoints>0&&/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",justifyContent:\"end\",gap:1,children:[/*#__PURE__*/_jsx(Text,{children:pendingOffer.priceActivityPoints}),/*#__PURE__*/_jsx(LayoutCurrencyIcon,{type:pendingOffer.priceActivityPointsType})]})]})]}),getPurchaseButton()]})]})]});};","map":null,"metadata":{},"sourceType":"module"}