{"ast":null,"code":"import _slicedToArray from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{FriendFurniConfirmLockMessageComposer,LoveLockFurniFinishedEvent,LoveLockFurniFriendConfirmedEvent,LoveLockFurniStartEvent,RoomEngineTriggerWidgetEvent,RoomObjectVariable}from'@nitrots/nitro-renderer';import{useCallback,useState}from'react';import{GetRoomEngine,GetRoomSession,LocalizeText,RoomWidgetUpdateRoomObjectEvent}from'../../../../../api';import{DraggableWindow,LayoutAvatarImageView,NitroCardContentView,NitroCardHeaderView,NitroCardView}from'../../../../../common';import{UseEventDispatcherHook,UseMessageEventHook,UseRoomEngineEvent}from'../../../../../hooks';import{useRoomContext}from'../../../RoomContext';import{FurnitureEngravingLockData}from'./FriendFurniLockData';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export var FurnitureFriendFurniView=function FurnitureFriendFurniView(props){var _useRoomContext=useRoomContext(),_useRoomContext$event=_useRoomContext.eventDispatcher,eventDispatcher=_useRoomContext$event===void 0?null:_useRoomContext$event,_useRoomContext$widge=_useRoomContext.widgetHandler,widgetHandler=_useRoomContext$widge===void 0?null:_useRoomContext$widge;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),engravingLockData=_useState2[0],setEngravingLockData=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),engravingStage=_useState4[0],setEngravingStage=_useState4[1];var onNitroEvent=function onNitroEvent(event){switch(event.type){case RoomEngineTriggerWidgetEvent.REQUEST_FRIEND_FURNITURE_ENGRAVING:{var widgetEvent=event;var roomObject=GetRoomEngine().getRoomObject(widgetEvent.roomId,widgetEvent.objectId,widgetEvent.category);if(!roomObject)return;var data=roomObject.model.getValue(RoomObjectVariable.FURNITURE_DATA);var type=roomObject.model.getValue(RoomObjectVariable.FURNITURE_FRIENDFURNI_ENGRAVING);if(data[0]==='1'){if(data.length!==6)return;setEngravingLockData(new FurnitureEngravingLockData(widgetEvent.objectId,widgetEvent.category,type,[data[1],data[2]],[data[3],data[4]],data[5]));setEngravingStage(0);}return;}case RoomWidgetUpdateRoomObjectEvent.FURNI_REMOVED:{var _widgetEvent=event;setEngravingLockData(function(prevState){if(!prevState||_widgetEvent.id!==prevState.objectId||_widgetEvent.category!==prevState.category)return prevState;return null;});return;}}};UseRoomEngineEvent(RoomEngineTriggerWidgetEvent.REQUEST_FRIEND_FURNITURE_ENGRAVING,onNitroEvent);UseEventDispatcherHook(RoomWidgetUpdateRoomObjectEvent.FURNI_REMOVED,eventDispatcher,onNitroEvent);var onLoveLockFurniStartEvent=useCallback(function(event){var parser=event.getParser();setEngravingLockData(new FurnitureEngravingLockData(parser.furniId));setEngravingStage(parser.start?1:2);},[]);UseMessageEventHook(LoveLockFurniStartEvent,onLoveLockFurniStartEvent);var processAction=useCallback(function(type){var value=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;switch(type){case'close_view':setEngravingLockData(null);return;case'accept_request':GetRoomSession().connection.send(new FriendFurniConfirmLockMessageComposer(engravingLockData.objectId,true));processAction('close_request');return;case'reject_request':GetRoomSession().connection.send(new FriendFurniConfirmLockMessageComposer(engravingLockData.objectId,false));processAction('close_request');return;case'close_request':setEngravingStage(0);setEngravingLockData(null);return;}},[engravingLockData]);var onLoveLockDoneEvent=useCallback(function(event){processAction('close_request');},[processAction]);UseMessageEventHook(LoveLockFurniFinishedEvent,onLoveLockDoneEvent);UseMessageEventHook(LoveLockFurniFriendConfirmedEvent,onLoveLockDoneEvent);return/*#__PURE__*/_jsxs(_Fragment,{children:[engravingStage>0&&/*#__PURE__*/_jsxs(NitroCardView,{className:\"nitro-engraving-lock\",theme:\"primary-slim\",children:[/*#__PURE__*/_jsx(NitroCardHeaderView,{headerText:LocalizeText('friend.furniture.confirm.lock.caption'),onCloseClick:function onCloseClick(event){return processAction('close_request');}}),/*#__PURE__*/_jsxs(NitroCardContentView,{children:[/*#__PURE__*/_jsx(\"h5\",{className:\"text-black text-center fw-bold mt-2 mb-2\",children:LocalizeText('friend.furniture.confirm.lock.subtitle')}),/*#__PURE__*/_jsx(\"div\",{className:\"d-flex justify-content-center mb-2\",children:/*#__PURE__*/_jsx(\"div\",{className:'engraving-lock-stage-'+engravingStage})}),engravingStage===2&&/*#__PURE__*/_jsx(\"div\",{className:\"text-small text-black text-center mb-2\",children:LocalizeText('friend.furniture.confirm.lock.other.locked')}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary w-100 me-2\",onClick:function onClick(event){return processAction('reject_request');},children:LocalizeText('friend.furniture.confirm.lock.button.cancel')}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-success w-100\",onClick:function onClick(event){return processAction('accept_request');},children:LocalizeText('friend.furniture.confirm.lock.button.confirm')})]})]})]}),engravingLockData&&engravingLockData.usernames.length>0&&/*#__PURE__*/_jsx(DraggableWindow,{handleSelector:\".nitro-engraving-lock-view\",children:/*#__PURE__*/_jsxs(\"div\",{className:'nitro-engraving-lock-view engraving-lock-'+engravingLockData.type,children:[/*#__PURE__*/_jsx(\"div\",{className:\"engraving-lock-close\",onClick:function onClick(event){return processAction('close_view');}}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"engraving-lock-avatar\",children:/*#__PURE__*/_jsx(LayoutAvatarImageView,{figure:engravingLockData.figures[0],direction:2})}),/*#__PURE__*/_jsx(\"div\",{className:\"engraving-lock-avatar\",children:/*#__PURE__*/_jsx(LayoutAvatarImageView,{figure:engravingLockData.figures[1],direction:4})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center mt-1\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[engravingLockData.type===0&&LocalizeText('lovelock.engraving.caption'),engravingLockData.type===3&&LocalizeText('wildwest.engraving.caption')]}),/*#__PURE__*/_jsx(\"div\",{children:engravingLockData.date}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"me-4\",children:engravingLockData.usernames[0]}),/*#__PURE__*/_jsx(\"div\",{children:engravingLockData.usernames[1]})]})]})]})})]});};","map":null,"metadata":{},"sourceType":"module"}