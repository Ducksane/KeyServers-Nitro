{"ast":null,"code":"import _slicedToArray from\"C:/Users/Administrator/Desktop/nitro/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{CancelMarketplaceOfferMessageComposer,GetMarketplaceOwnOffersMessageComposer,MarketplaceCancelOfferResultEvent,MarketplaceOwnOffersEvent,RedeemMarketplaceOfferCreditsMessageComposer}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useMemo,useState}from'react';import{LocalizeText,NotificationAlertType,NotificationUtilities,SendMessageComposer}from'../../../../../../api';import{Button,Column,Text}from'../../../../../../common';import{UseMessageEventHook}from'../../../../../../hooks';import{CatalogLayoutMarketplaceItemView,OWN_OFFER}from'./CatalogLayoutMarketplaceItemView';import{MarketplaceOfferData}from'./common/MarketplaceOfferData';import{MarketPlaceOfferState}from'./common/MarketplaceOfferState';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var CatalogLayoutMarketplaceOwnItemsView=function CatalogLayoutMarketplaceOwnItemsView(props){var _useState=useState(0),_useState2=_slicedToArray(_useState,2),creditsWaiting=_useState2[0],setCreditsWaiting=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),offers=_useState4[0],setOffers=_useState4[1];var onMarketPlaceOwnOffersEvent=useCallback(function(event){var parser=event.getParser();if(!parser)return;var offers=parser.offers.map(function(offer){var newOffer=new MarketplaceOfferData(offer.offerId,offer.furniId,offer.furniType,offer.extraData,offer.stuffData,offer.price,offer.status,offer.averagePrice,offer.offerCount);newOffer.timeLeftMinutes=offer.timeLeftMinutes;return newOffer;});setCreditsWaiting(parser.creditsWaiting);setOffers(offers);},[]);UseMessageEventHook(MarketplaceOwnOffersEvent,onMarketPlaceOwnOffersEvent);var onMarketplaceCancelOfferResultEvent=useCallback(function(event){var parser=event.getParser();if(!parser)return;if(!parser.success){NotificationUtilities.simpleAlert(LocalizeText('catalog.marketplace.cancel_failed'),NotificationAlertType.DEFAULT,null,null,LocalizeText('catalog.marketplace.operation_failed.topic'));return;}setOffers(function(prevValue){return prevValue.filter(function(value){return value.offerId!==parser.offerId;});});},[]);UseMessageEventHook(MarketplaceCancelOfferResultEvent,onMarketplaceCancelOfferResultEvent);var soldOffers=useMemo(function(){return offers.filter(function(value){return value.status===MarketPlaceOfferState.SOLD;});},[offers]);var redeemSoldOffers=useCallback(function(){setOffers(function(prevValue){var idsToDelete=soldOffers.map(function(value){return value.offerId;});return prevValue.filter(function(value){return idsToDelete.indexOf(value.offerId)===-1;});});SendMessageComposer(new RedeemMarketplaceOfferCreditsMessageComposer());},[soldOffers]);var takeItemBack=function takeItemBack(offerData){SendMessageComposer(new CancelMarketplaceOfferMessageComposer(offerData.offerId));};useEffect(function(){SendMessageComposer(new GetMarketplaceOwnOffersMessageComposer());},[]);return/*#__PURE__*/_jsxs(Column,{overflow:\"hidden\",children:[creditsWaiting<=0&&/*#__PURE__*/_jsx(Text,{center:true,className:\"bg-muted rounded p-1\",children:LocalizeText('catalog.marketplace.redeem.no_sold_items')}),creditsWaiting>0&&/*#__PURE__*/_jsxs(Column,{center:true,gap:1,className:\"bg-muted rounded p-2\",children:[/*#__PURE__*/_jsx(Text,{children:LocalizeText('catalog.marketplace.redeem.get_credits',['count','credits'],[soldOffers.length.toString(),creditsWaiting.toString()])}),/*#__PURE__*/_jsx(Button,{className:\"mt-1\",onClick:redeemSoldOffers,children:LocalizeText('catalog.marketplace.offer.redeem')})]}),/*#__PURE__*/_jsxs(Column,{gap:1,overflow:\"hidden\",children:[/*#__PURE__*/_jsx(Text,{truncate:true,shrink:true,fontWeight:\"bold\",children:LocalizeText('catalog.marketplace.items_found',['count'],[offers.length.toString()])}),/*#__PURE__*/_jsx(Column,{overflow:\"auto\",className:\"nitro-catalog-layout-marketplace-grid\",children:offers.length>0&&offers.map(function(offer){return/*#__PURE__*/_jsx(CatalogLayoutMarketplaceItemView,{offerData:offer,type:OWN_OFFER,onClick:takeItemBack},offer.offerId);})})]})]});};","map":null,"metadata":{},"sourceType":"module"}