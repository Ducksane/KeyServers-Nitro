{"ast":null,"code":"import _createForOfIteratorHelper from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _classCallCheck from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"C:/Users/Luis/Downloads/Habboom/Nitro-Edit/node_modules/@babel/runtime/helpers/esm/createClass.js\";import{AssetManager}from'../../../../core/asset/AssetManager';import{Nitro}from'../../../../nitro/Nitro';import{GraphicAsset}from'./GraphicAsset';import{GraphicAssetPalette}from'./GraphicAssetPalette';export var GraphicAssetCollection=/*#__PURE__*/function(){function GraphicAssetCollection(data,spritesheet){_classCallCheck(this,GraphicAssetCollection);this._referenceCount=void 0;this._referenceTimestamp=void 0;this._name=void 0;this._baseTexture=void 0;this._data=void 0;this._textures=void 0;this._assets=void 0;this._palettes=void 0;this._paletteAssetNames=void 0;if(!data)throw new Error('invalid_collection');this._name=data.name;this._baseTexture=spritesheet&&spritesheet.baseTexture||null;this._data=data;this._textures=new Map();this._assets=new Map();this._palettes=new Map();this._paletteAssetNames=[];if(spritesheet)this.addLibraryAsset(spritesheet.textures);this.define(data);}_createClass(GraphicAssetCollection,[{key:\"dispose\",value:function dispose(){if(this._palettes){var _iterator=_createForOfIteratorHelper(this._palettes.values()),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var palette=_step.value;palette.dispose();}}catch(err){_iterator.e(err);}finally{_iterator.f();}this._palettes.clear();}if(this._paletteAssetNames){this.disposePaletteAssets();this._paletteAssetNames=null;}if(this._assets){var _iterator2=_createForOfIteratorHelper(this._assets.values()),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var asset=_step2.value;asset.recycle();}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}this._assets.clear();}}},{key:\"addReference\",value:function addReference(){this._referenceCount++;this._referenceTimestamp=Nitro.instance.time;}},{key:\"removeReference\",value:function removeReference(){this._referenceCount--;if(this._referenceCount<=0){this._referenceCount=0;this._referenceTimestamp=Nitro.instance.time;this.disposePaletteAssets(false);}}},{key:\"define\",value:function define(data){var assets=data.assets;var palettes=data.palettes;if(assets)this.defineAssets(assets);if(palettes)this.definePalettes(palettes);}},{key:\"defineAssets\",value:function defineAssets(assets){if(!assets)return;for(var name in assets){var asset=assets[name];if(!asset)continue;var x=-asset.x||0;var y=-asset.y||0;var flipH=false;var flipV=false;var usesPalette=asset.usesPalette||false;var source=asset.source||'';if(asset.flipH&&source.length)flipH=true;// if(asset.flipV && source.length) flipV = true;\nif(!source.length)source=name;var texture=this.getLibraryAsset(source);if(!texture)continue;var didAddAsset=this.createAsset(name,source,texture,flipH,flipV,x,y,usesPalette);if(!didAddAsset){var existingAsset=this.getAsset(name);if(existingAsset&&existingAsset.name!==existingAsset.source){didAddAsset=this.replaceAsset(name,source,texture,flipH,flipV,x,y,usesPalette);}}}}},{key:\"definePalettes\",value:function definePalettes(palettes){if(!palettes)return;for(var name in palettes){var palette=palettes[name];if(!palette)continue;var id=palette.id.toString();if(this._palettes.get(id))continue;var colorOne=0xFFFFFF;var colorTwo=0xFFFFFF;var color=palette.color1;if(color&&color.length>0)colorOne=parseInt(color,16);color=palette.color2;if(color&&color.length>0)colorTwo=parseInt(color,16);this._palettes.set(id,new GraphicAssetPalette(palette.rgb,colorOne,colorTwo));}}},{key:\"createAsset\",value:function createAsset(name,source,texture,flipH,flipV,x,y,usesPalette){if(this._assets.get(name))return false;var graphicAsset=GraphicAsset.createAsset(name,source,texture,x,y,flipH,flipV,usesPalette);this._assets.set(name,graphicAsset);return true;}},{key:\"replaceAsset\",value:function replaceAsset(name,source,texture,flipH,flipV,x,y,usesPalette){var existing=this._assets.get(name);if(existing){this._assets.delete(name);existing.recycle();}return this.createAsset(name,source,texture,flipH,flipV,x,y,usesPalette);}},{key:\"getAsset\",value:function getAsset(name){if(!name)return null;var existing=this._assets.get(name);if(!existing)return null;return existing;}},{key:\"getAssetWithPalette\",value:function getAssetWithPalette(name,paletteName){var saveName=name+'@'+paletteName;var asset=this.getAsset(saveName);if(!asset){asset=this.getAsset(name);if(!asset||!asset.usesPalette)return asset;var palette=this.getPalette(paletteName);if(palette){var texture=palette.applyPalette(asset.texture);if(texture){this._paletteAssetNames.push(saveName);this.createAsset(saveName,asset.source+'@'+paletteName,texture,asset.flipH,asset.flipV,asset.x,asset.y,false);asset=this.getAsset(saveName);}}}return asset;}},{key:\"getTexture\",value:function getTexture(name){return this._textures.get(name);}},{key:\"getPaletteNames\",value:function getPaletteNames(){return Array.from(this._palettes.keys());}},{key:\"getPaletteColors\",value:function getPaletteColors(paletteName){var palette=this.getPalette(paletteName);if(palette)return[palette.primaryColor,palette.secondaryColor];return null;}},{key:\"getPalette\",value:function getPalette(name){if(!name)return null;var existing=this._palettes.get(name);if(!existing)return null;return existing;}},{key:\"addAsset\",value:function addAsset(name,texture,override){var x=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var y=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var flipH=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var flipV=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;if(!name||!texture)return false;var existingTexture=this.getLibraryAsset(name);if(!existingTexture){this._textures.set(name,texture);return this.createAsset(name,name,texture,flipH,flipV,x,y,false);}if(override){existingTexture.baseTexture=texture.baseTexture;existingTexture.frame=texture.frame;existingTexture.trim=texture.trim;existingTexture.updateUvs();return true;}return false;}},{key:\"disposeAsset\",value:function disposeAsset(name){var existing=this._assets.get(name);if(!existing)return;this._assets.delete(name);var texture=this.getLibraryAsset(existing.source);if(texture){this._textures.delete(existing.source);texture.destroy(true);}existing.recycle();}},{key:\"getLibraryAsset\",value:function getLibraryAsset(name){if(!name)return null;name=this._name+'_'+name;var texture=this._textures.get(name);if(!texture)return null;return texture;}},{key:\"addLibraryAsset\",value:function addLibraryAsset(textures){if(!textures)return;for(var name in textures){var texture=textures[name];if(!texture)continue;this._textures.set(AssetManager.removeFileExtension(name),texture);}}},{key:\"disposePaletteAssets\",value:function disposePaletteAssets(){var disposeAll=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(this._paletteAssetNames){if(disposeAll||this._paletteAssetNames.length>GraphicAssetCollection.PALETTE_ASSET_DISPOSE_THRESHOLD){var _iterator3=_createForOfIteratorHelper(this._paletteAssetNames),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var name=_step3.value;this.disposeAsset(name);}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}this._paletteAssetNames=[];}}}},{key:\"referenceCount\",get:function get(){return this._referenceCount;}},{key:\"referenceTimestamp\",get:function get(){return this._referenceTimestamp;}},{key:\"name\",get:function get(){return this._name;}},{key:\"baseTexture\",get:function get(){return this._baseTexture;}},{key:\"data\",get:function get(){return this._data;}},{key:\"textures\",get:function get(){return this._textures;}},{key:\"assets\",get:function get(){return this._assets;}}]);return GraphicAssetCollection;}();GraphicAssetCollection.PALETTE_ASSET_DISPOSE_THRESHOLD=10;","map":null,"metadata":{},"sourceType":"module"}