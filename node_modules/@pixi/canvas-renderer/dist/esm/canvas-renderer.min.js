/*!
 * @pixi/canvas-renderer - v6.3.0
 * Compiled Wed, 23 Mar 2022 18:58:56 UTC
 *
 * @pixi/canvas-renderer is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
import{RenderTexture as e,BaseRenderTexture as t,CanvasResource as o,AbstractRenderer as r,Renderer as i,BaseTexture as n,Texture as a}from"@pixi/core";import{CanvasRenderTarget as h,hex2string as s,rgb2hex as l,sayHello as c,hex2rgb as d}from"@pixi/utils";import{SHAPES as u,Matrix as p}from"@pixi/math";import{BLEND_MODES as g,SCALE_MODES as v,RENDERER_TYPE as f}from"@pixi/constants";import{settings as m}from"@pixi/settings";var T=function(e,t){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};var C=function(){function e(e){this._foundShapes=[],this.renderer=e}return e.prototype.pushMask=function(e){var t=this.renderer,o=e.maskObject||e;t.context.save();var r=this._foundShapes;if(this.recursiveFindShapes(o,r),r.length>0){var i=t.context;i.beginPath();for(var n=0;n<r.length;n++){var a=r[n],h=a.transform.worldTransform;this.renderer.setContextTransform(h),this.renderGraphicsShape(a)}r.length=0,i.clip()}},e.prototype.recursiveFindShapes=function(e,t){e.geometry&&e.geometry.graphicsData&&t.push(e);var o=e.children;if(o)for(var r=0;r<o.length;r++)this.recursiveFindShapes(o[r],t)},e.prototype.renderGraphicsShape=function(e){e.finishPoly();var t=this.renderer.context,o=e.geometry.graphicsData,r=o.length;if(0!==r)for(var i=0;i<r;i++){var n=o[i],a=n.shape;if(a.type===u.POLY){var h=a.points,s=n.holes,l=void 0,c=void 0,d=void 0,p=void 0;t.moveTo(h[0],h[1]);for(var g=1;g<h.length/2;g++)t.lineTo(h[2*g],h[2*g+1]);if(s.length>0){l=0,d=h[0],p=h[1];for(g=2;g+2<h.length;g+=2)l+=(h[g]-d)*(h[g+3]-p)-(h[g+2]-d)*(h[g+1]-p);for(var v=0;v<s.length;v++)if(h=s[v].shape.points){c=0,d=h[0],p=h[1];for(g=2;g+2<h.length;g+=2)c+=(h[g]-d)*(h[g+3]-p)-(h[g+2]-d)*(h[g+1]-p);if(c*l<0){t.moveTo(h[0],h[1]);for(g=2;g<h.length;g+=2)t.lineTo(h[g],h[g+1])}else{t.moveTo(h[h.length-2],h[h.length-1]);for(g=h.length-4;g>=0;g-=2)t.lineTo(h[g],h[g+1])}s[v].shape.closeStroke&&t.closePath()}}h[0]===h[h.length-2]&&h[1]===h[h.length-1]&&t.closePath()}else if(a.type===u.RECT)t.rect(a.x,a.y,a.width,a.height),t.closePath();else if(a.type===u.CIRC)t.arc(a.x,a.y,a.radius,0,2*Math.PI),t.closePath();else if(a.type===u.ELIP){var f=2*a.width,m=2*a.height,T=a.x-f/2,C=a.y-m/2,y=f/2*.5522848,x=m/2*.5522848,_=T+f,S=C+m,b=T+f/2,R=C+m/2;t.moveTo(T,R),t.bezierCurveTo(T,R-x,b-y,C,b,C),t.bezierCurveTo(b+y,C,_,R-x,_,R),t.bezierCurveTo(_,R+x,b+y,S,b,S),t.bezierCurveTo(b-y,S,T,R+x,T,R),t.closePath()}else if(a.type===u.RREC){var O=a.x,w=a.y,I=a.width,M=a.height,E=a.radius,A=Math.min(I,M)/2;E=E>A?A:E,t.moveTo(O,w+E),t.lineTo(O,w+M-E),t.quadraticCurveTo(O,w+M,O+E,w+M),t.lineTo(O+I-E,w+M),t.quadraticCurveTo(O+I,w+M,O+I,w+M-E),t.lineTo(O+I,w+E),t.quadraticCurveTo(O+I,w,O+I-E,w),t.lineTo(O+E,w),t.quadraticCurveTo(O,w,O,w+E),t.closePath()}}},e.prototype.popMask=function(e){e.context.restore(),e.invalidateBlendMode()},e.prototype.destroy=function(){},e}();function y(e){var t=document.createElement("canvas");t.width=6,t.height=1;var o=t.getContext("2d");return o.fillStyle=e,o.fillRect(0,0,6,1),t}function x(){if("undefined"==typeof document)return!1;var e=y("#ff00ff"),t=y("#ffff00"),o=document.createElement("canvas");o.width=6,o.height=1;var r=o.getContext("2d");r.globalCompositeOperation="multiply",r.drawImage(e,0,0),r.drawImage(t,2,0);var i=r.getImageData(2,0,1,1);if(!i)return!1;var n=i.data;return 255===n[0]&&0===n[1]&&0===n[2]}var _=new p,S=function(r){function i(e){var t,o=r.call(this,f.CANVAS,e)||this;if(o.refresh=!0,o.maskManager=new C(o),o.smoothProperty="imageSmoothingEnabled",o.blendModes=(void 0===t&&(t=[]),x()?(t[g.NORMAL]="source-over",t[g.ADD]="lighter",t[g.MULTIPLY]="multiply",t[g.SCREEN]="screen",t[g.OVERLAY]="overlay",t[g.DARKEN]="darken",t[g.LIGHTEN]="lighten",t[g.COLOR_DODGE]="color-dodge",t[g.COLOR_BURN]="color-burn",t[g.HARD_LIGHT]="hard-light",t[g.SOFT_LIGHT]="soft-light",t[g.DIFFERENCE]="difference",t[g.EXCLUSION]="exclusion",t[g.HUE]="hue",t[g.SATURATION]="saturate",t[g.COLOR]="color",t[g.LUMINOSITY]="luminosity"):(t[g.NORMAL]="source-over",t[g.ADD]="lighter",t[g.MULTIPLY]="source-over",t[g.SCREEN]="source-over",t[g.OVERLAY]="source-over",t[g.DARKEN]="source-over",t[g.LIGHTEN]="source-over",t[g.COLOR_DODGE]="source-over",t[g.COLOR_BURN]="source-over",t[g.HARD_LIGHT]="source-over",t[g.SOFT_LIGHT]="source-over",t[g.DIFFERENCE]="source-over",t[g.EXCLUSION]="source-over",t[g.HUE]="source-over",t[g.SATURATION]="source-over",t[g.COLOR]="source-over",t[g.LUMINOSITY]="source-over"),t[g.NORMAL_NPM]=t[g.NORMAL],t[g.ADD_NPM]=t[g.ADD],t[g.SCREEN_NPM]=t[g.SCREEN],t[g.SRC_IN]="source-in",t[g.SRC_OUT]="source-out",t[g.SRC_ATOP]="source-atop",t[g.DST_OVER]="destination-over",t[g.DST_IN]="destination-in",t[g.DST_OUT]="destination-out",t[g.DST_ATOP]="destination-atop",t[g.XOR]="xor",t[g.SUBTRACT]="source-over",t),o.renderingToScreen=!1,o._activeBlendMode=null,o._projTransform=null,o._outerBlend=!1,o.rootContext=o.view.getContext("2d",{alpha:o.useContextAlpha}),o.context=o.rootContext,!o.rootContext.imageSmoothingEnabled){var n=o.rootContext;n.webkitImageSmoothingEnabled?o.smoothProperty="webkitImageSmoothingEnabled":n.mozImageSmoothingEnabled?o.smoothProperty="mozImageSmoothingEnabled":n.oImageSmoothingEnabled?o.smoothProperty="oImageSmoothingEnabled":n.msImageSmoothingEnabled&&(o.smoothProperty="msImageSmoothingEnabled")}return o.initPlugins(i.__plugins),c("Canvas"),o.resize(o.options.width,o.options.height),o}return function(e,t){function o(){this.constructor=e}T(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}(i,r),i.prototype.addSystem=function(){return this},i.prototype.render=function(r,i){if(this.view){var n,a,c,d;i&&(i instanceof e||i instanceof t?(n=i,a=arguments[2],c=arguments[3],d=arguments[4]):(n=i.renderTexture,a=i.clear,c=i.transform,d=i.skipUpdateTransform)),this.renderingToScreen=!n,this.emit("prerender");var u=this.resolution;n?((n=n.castToBaseTexture())._canvasRenderTarget||(n._canvasRenderTarget=new h(n.width,n.height,n.resolution),n.resource=new o(n._canvasRenderTarget.canvas),n.valid=!0),this.context=n._canvasRenderTarget.context,this.resolution=n._canvasRenderTarget.resolution):this.context=this.rootContext;var p=this.context;if(this._projTransform=c||null,n||(this._lastObjectRendered=r),!d){var v=r.enableTempParent();r.updateTransform(),r.disableTempParent(v)}if(p.save(),p.setTransform(1,0,0,1,0,0),p.globalAlpha=1,this._activeBlendMode=g.NORMAL,this._outerBlend=!1,p.globalCompositeOperation=this.blendModes[g.NORMAL],void 0!==a?a:this.clearBeforeRender)if(this.renderingToScreen)p.clearRect(0,0,this.width,this.height),this.backgroundAlpha>0&&(p.globalAlpha=this.useContextAlpha?this.backgroundAlpha:1,p.fillStyle=this._backgroundColorString,p.fillRect(0,0,this.width,this.height),p.globalAlpha=1);else{(n=n)._canvasRenderTarget.clear();var f=n.clearColor;f[3]>0&&(p.globalAlpha=this.useContextAlpha?f[3]:1,p.fillStyle=s(l(f)),p.fillRect(0,0,n.realWidth,n.realHeight),p.globalAlpha=1)}var m=this.context;this.context=p,r.renderCanvas(this),this.context=m,p.restore(),this.resolution=u,this._projTransform=null,this.emit("postrender")}},i.prototype.setContextTransform=function(e,t,o){var r=e,i=this._projTransform,n=this.resolution;o=o||n,i&&((r=_).copyFrom(e),r.prepend(i)),t?this.context.setTransform(r.a*o,r.b*o,r.c*o,r.d*o,r.tx*n|0,r.ty*n|0):this.context.setTransform(r.a*o,r.b*o,r.c*o,r.d*o,r.tx*n,r.ty*n)},i.prototype.clear=function(e,t){void 0===e&&(e=this._backgroundColorString),void 0===t&&(t=this.backgroundAlpha);var o=this.context;o.clearRect(0,0,this.width,this.height),e&&(o.globalAlpha=this.useContextAlpha?t:1,o.fillStyle=e,o.fillRect(0,0,this.width,this.height),o.globalAlpha=1)},i.prototype.setBlendMode=function(e,t){var o=e===g.SRC_IN||e===g.SRC_OUT||e===g.DST_IN||e===g.DST_ATOP;!t&&o&&(e=g.NORMAL),this._activeBlendMode!==e&&(this._activeBlendMode=e,this._outerBlend=o,this.context.globalCompositeOperation=this.blendModes[e])},i.prototype.destroy=function(e){r.prototype.destroy.call(this,e),this.context=null,this.refresh=!0,this.maskManager.destroy(),this.maskManager=null,this.smoothProperty=null},i.prototype.resize=function(e,t){r.prototype.resize.call(this,e,t),this.smoothProperty&&(this.rootContext[this.smoothProperty]=m.SCALE_MODE===v.LINEAR)},i.prototype.invalidateBlendMode=function(){this._activeBlendMode=this.blendModes.indexOf(this.context.globalCompositeOperation)},i.registerPlugin=function(e,t){i.__plugins=i.__plugins||{},i.__plugins[e]=t},i}(r),b={canvas:null,getTintedCanvas:function(e,t){var o=e.texture,r="#"+("00000"+(0|(t=b.roundColor(t))).toString(16)).slice(-6);o.tintCache=o.tintCache||{};var i,n=o.tintCache[r];if(n){if(n.tintId===o._updateID)return o.tintCache[r];i=o.tintCache[r]}else i=document.createElement("canvas");if(b.tintMethod(o,t,i),i.tintId=o._updateID,b.convertTintToImage){var a=new Image;a.src=i.toDataURL(),o.tintCache[r]=a}else o.tintCache[r]=i;return i},getTintedPattern:function(e,t){var o="#"+("00000"+(0|(t=b.roundColor(t))).toString(16)).slice(-6);e.patternCache=e.patternCache||{};var r=e.patternCache[o];return r&&r.tintId===e._updateID?r:(b.canvas||(b.canvas=document.createElement("canvas")),b.tintMethod(e,t,b.canvas),(r=b.canvas.getContext("2d").createPattern(b.canvas,"repeat")).tintId=e._updateID,e.patternCache[o]=r,r)},tintWithMultiply:function(e,t,o){var r=o.getContext("2d"),i=e._frame.clone(),n=e.baseTexture.resolution;i.x*=n,i.y*=n,i.width*=n,i.height*=n,o.width=Math.ceil(i.width),o.height=Math.ceil(i.height),r.save(),r.fillStyle="#"+("00000"+(0|t).toString(16)).slice(-6),r.fillRect(0,0,i.width,i.height),r.globalCompositeOperation="multiply";var a=e.baseTexture.getDrawableSource();r.drawImage(a,i.x,i.y,i.width,i.height,0,0,i.width,i.height),r.globalCompositeOperation="destination-atop",r.drawImage(a,i.x,i.y,i.width,i.height,0,0,i.width,i.height),r.restore()},tintWithOverlay:function(e,t,o){var r=o.getContext("2d"),i=e._frame.clone(),n=e.baseTexture.resolution;i.x*=n,i.y*=n,i.width*=n,i.height*=n,o.width=Math.ceil(i.width),o.height=Math.ceil(i.height),r.save(),r.globalCompositeOperation="copy",r.fillStyle="#"+("00000"+(0|t).toString(16)).slice(-6),r.fillRect(0,0,i.width,i.height),r.globalCompositeOperation="destination-atop",r.drawImage(e.baseTexture.getDrawableSource(),i.x,i.y,i.width,i.height,0,0,i.width,i.height),r.restore()},tintWithPerPixel:function(e,t,o){var r=o.getContext("2d"),i=e._frame.clone(),n=e.baseTexture.resolution;i.x*=n,i.y*=n,i.width*=n,i.height*=n,o.width=Math.ceil(i.width),o.height=Math.ceil(i.height),r.save(),r.globalCompositeOperation="copy",r.drawImage(e.baseTexture.getDrawableSource(),i.x,i.y,i.width,i.height,0,0,i.width,i.height),r.restore();for(var a=d(t),h=a[0],s=a[1],l=a[2],c=r.getImageData(0,0,i.width,i.height),u=c.data,p=0;p<u.length;p+=4)u[p+0]*=h,u[p+1]*=s,u[p+2]*=l;r.putImageData(c,0,0)},roundColor:function(e){var t=b.cacheStepsPerColorChannel,o=d(e);return o[0]=Math.min(255,o[0]/t*t),o[1]=Math.min(255,o[1]/t*t),o[2]=Math.min(255,o[2]/t*t),l(o)},cacheStepsPerColorChannel:8,convertTintToImage:!1,canUseMultiply:x(),tintMethod:null};b.tintMethod=b.canUseMultiply?b.tintWithMultiply:b.tintWithPerPixel;var R=i.create;i.create=function(e){if(!(e&&e.forceCanvas))try{return R(e)}catch(e){}return new S(e)},n.prototype.getDrawableSource=function(){var e=this.resource;return e?e.bitmap||e.source:null},t.prototype._canvasRenderTarget=null,a.prototype.patternCache=null,a.prototype.tintCache=null;export{S as CanvasRenderer,x as canUseNewCanvasBlendModes,b as canvasUtils};
//# sourceMappingURL=canvas-renderer.min.js.map
