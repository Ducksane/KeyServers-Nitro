/*!
 * @pixi/canvas-renderer - v6.3.0
 * Compiled Wed, 23 Mar 2022 18:58:56 UTC
 *
 * @pixi/canvas-renderer is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var core=require("@pixi/core"),utils=require("@pixi/utils"),math=require("@pixi/math"),constants=require("@pixi/constants"),settings=require("@pixi/settings"),extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function __extends(t,e){function n(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var CanvasMaskManager=function(){function t(t){this._foundShapes=[],this.renderer=t}return t.prototype.pushMask=function(t){var e=this.renderer,n=t.maskObject||t;e.context.save();var o=this._foundShapes;if(this.recursiveFindShapes(n,o),o.length>0){var a=e.context;a.beginPath();for(var r=0;r<o.length;r++){var s=o[r],i=s.transform.worldTransform;this.renderer.setContextTransform(i),this.renderGraphicsShape(s)}o.length=0,a.clip()}},t.prototype.recursiveFindShapes=function(t,e){t.geometry&&t.geometry.graphicsData&&e.push(t);var n=t.children;if(n)for(var o=0;o<n.length;o++)this.recursiveFindShapes(n[o],e)},t.prototype.renderGraphicsShape=function(t){t.finishPoly();var e=this.renderer.context,n=t.geometry.graphicsData,o=n.length;if(0!==o)for(var a=0;a<o;a++){var r=n[a],s=r.shape;if(s.type===math.SHAPES.POLY){var i=s.points,c=r.holes,l=void 0,h=void 0,d=void 0,u=void 0;e.moveTo(i[0],i[1]);for(var p=1;p<i.length/2;p++)e.lineTo(i[2*p],i[2*p+1]);if(c.length>0){l=0,d=i[0],u=i[1];for(p=2;p+2<i.length;p+=2)l+=(i[p]-d)*(i[p+3]-u)-(i[p+2]-d)*(i[p+1]-u);for(var v=0;v<c.length;v++)if(i=c[v].shape.points){h=0,d=i[0],u=i[1];for(p=2;p+2<i.length;p+=2)h+=(i[p]-d)*(i[p+3]-u)-(i[p+2]-d)*(i[p+1]-u);if(h*l<0){e.moveTo(i[0],i[1]);for(p=2;p<i.length;p+=2)e.lineTo(i[p],i[p+1])}else{e.moveTo(i[i.length-2],i[i.length-1]);for(p=i.length-4;p>=0;p-=2)e.lineTo(i[p],i[p+1])}c[v].shape.closeStroke&&e.closePath()}}i[0]===i[i.length-2]&&i[1]===i[i.length-1]&&e.closePath()}else if(s.type===math.SHAPES.RECT)e.rect(s.x,s.y,s.width,s.height),e.closePath();else if(s.type===math.SHAPES.CIRC)e.arc(s.x,s.y,s.radius,0,2*Math.PI),e.closePath();else if(s.type===math.SHAPES.ELIP){var E=2*s.width,g=2*s.height,D=s.x-E/2,S=s.y-g/2,_=E/2*.5522848,M=g/2*.5522848,f=D+E,m=S+g,O=D+E/2,C=S+g/2;e.moveTo(D,C),e.bezierCurveTo(D,C-M,O-_,S,O,S),e.bezierCurveTo(O+_,S,f,C-M,f,C),e.bezierCurveTo(f,C+M,O+_,m,O,m),e.bezierCurveTo(O-_,m,D,C+M,D,C),e.closePath()}else if(s.type===math.SHAPES.RREC){var T=s.x,N=s.y,x=s.width,L=s.height,y=s.radius,B=Math.min(x,L)/2;y=y>B?B:y,e.moveTo(T,N+y),e.lineTo(T,N+L-y),e.quadraticCurveTo(T,N+L,T+y,N+L),e.lineTo(T+x-y,N+L),e.quadraticCurveTo(T+x,N+L,T+x,N+L-y),e.lineTo(T+x,N+y),e.quadraticCurveTo(T+x,N,T+x-y,N),e.lineTo(T+y,N),e.quadraticCurveTo(T,N,T,N+y),e.closePath()}}},t.prototype.popMask=function(t){t.context.restore(),t.invalidateBlendMode()},t.prototype.destroy=function(){},t}();function createColoredCanvas(t){var e=document.createElement("canvas");e.width=6,e.height=1;var n=e.getContext("2d");return n.fillStyle=t,n.fillRect(0,0,6,1),e}function canUseNewCanvasBlendModes(){if("undefined"==typeof document)return!1;var t=createColoredCanvas("#ff00ff"),e=createColoredCanvas("#ffff00"),n=document.createElement("canvas");n.width=6,n.height=1;var o=n.getContext("2d");o.globalCompositeOperation="multiply",o.drawImage(t,0,0),o.drawImage(e,2,0);var a=o.getImageData(2,0,1,1);if(!a)return!1;var r=a.data;return 255===r[0]&&0===r[1]&&0===r[2]}function mapCanvasBlendModesToPixi(t){return void 0===t&&(t=[]),canUseNewCanvasBlendModes()?(t[constants.BLEND_MODES.NORMAL]="source-over",t[constants.BLEND_MODES.ADD]="lighter",t[constants.BLEND_MODES.MULTIPLY]="multiply",t[constants.BLEND_MODES.SCREEN]="screen",t[constants.BLEND_MODES.OVERLAY]="overlay",t[constants.BLEND_MODES.DARKEN]="darken",t[constants.BLEND_MODES.LIGHTEN]="lighten",t[constants.BLEND_MODES.COLOR_DODGE]="color-dodge",t[constants.BLEND_MODES.COLOR_BURN]="color-burn",t[constants.BLEND_MODES.HARD_LIGHT]="hard-light",t[constants.BLEND_MODES.SOFT_LIGHT]="soft-light",t[constants.BLEND_MODES.DIFFERENCE]="difference",t[constants.BLEND_MODES.EXCLUSION]="exclusion",t[constants.BLEND_MODES.HUE]="hue",t[constants.BLEND_MODES.SATURATION]="saturate",t[constants.BLEND_MODES.COLOR]="color",t[constants.BLEND_MODES.LUMINOSITY]="luminosity"):(t[constants.BLEND_MODES.NORMAL]="source-over",t[constants.BLEND_MODES.ADD]="lighter",t[constants.BLEND_MODES.MULTIPLY]="source-over",t[constants.BLEND_MODES.SCREEN]="source-over",t[constants.BLEND_MODES.OVERLAY]="source-over",t[constants.BLEND_MODES.DARKEN]="source-over",t[constants.BLEND_MODES.LIGHTEN]="source-over",t[constants.BLEND_MODES.COLOR_DODGE]="source-over",t[constants.BLEND_MODES.COLOR_BURN]="source-over",t[constants.BLEND_MODES.HARD_LIGHT]="source-over",t[constants.BLEND_MODES.SOFT_LIGHT]="source-over",t[constants.BLEND_MODES.DIFFERENCE]="source-over",t[constants.BLEND_MODES.EXCLUSION]="source-over",t[constants.BLEND_MODES.HUE]="source-over",t[constants.BLEND_MODES.SATURATION]="source-over",t[constants.BLEND_MODES.COLOR]="source-over",t[constants.BLEND_MODES.LUMINOSITY]="source-over"),t[constants.BLEND_MODES.NORMAL_NPM]=t[constants.BLEND_MODES.NORMAL],t[constants.BLEND_MODES.ADD_NPM]=t[constants.BLEND_MODES.ADD],t[constants.BLEND_MODES.SCREEN_NPM]=t[constants.BLEND_MODES.SCREEN],t[constants.BLEND_MODES.SRC_IN]="source-in",t[constants.BLEND_MODES.SRC_OUT]="source-out",t[constants.BLEND_MODES.SRC_ATOP]="source-atop",t[constants.BLEND_MODES.DST_OVER]="destination-over",t[constants.BLEND_MODES.DST_IN]="destination-in",t[constants.BLEND_MODES.DST_OUT]="destination-out",t[constants.BLEND_MODES.DST_ATOP]="destination-atop",t[constants.BLEND_MODES.XOR]="xor",t[constants.BLEND_MODES.SUBTRACT]="source-over",t}var tempMatrix=new math.Matrix,CanvasRenderer=function(t){function e(n){var o=t.call(this,constants.RENDERER_TYPE.CANVAS,n)||this;if(o.refresh=!0,o.maskManager=new CanvasMaskManager(o),o.smoothProperty="imageSmoothingEnabled",o.blendModes=mapCanvasBlendModesToPixi(),o.renderingToScreen=!1,o._activeBlendMode=null,o._projTransform=null,o._outerBlend=!1,o.rootContext=o.view.getContext("2d",{alpha:o.useContextAlpha}),o.context=o.rootContext,!o.rootContext.imageSmoothingEnabled){var a=o.rootContext;a.webkitImageSmoothingEnabled?o.smoothProperty="webkitImageSmoothingEnabled":a.mozImageSmoothingEnabled?o.smoothProperty="mozImageSmoothingEnabled":a.oImageSmoothingEnabled?o.smoothProperty="oImageSmoothingEnabled":a.msImageSmoothingEnabled&&(o.smoothProperty="msImageSmoothingEnabled")}return o.initPlugins(e.__plugins),utils.sayHello("Canvas"),o.resize(o.options.width,o.options.height),o}return __extends(e,t),e.prototype.addSystem=function(){return this},e.prototype.render=function(t,e){if(this.view){var n,o,a,r;e&&(e instanceof core.RenderTexture||e instanceof core.BaseRenderTexture?(n=e,o=arguments[2],a=arguments[3],r=arguments[4]):(n=e.renderTexture,o=e.clear,a=e.transform,r=e.skipUpdateTransform)),this.renderingToScreen=!n,this.emit("prerender");var s=this.resolution;n?((n=n.castToBaseTexture())._canvasRenderTarget||(n._canvasRenderTarget=new utils.CanvasRenderTarget(n.width,n.height,n.resolution),n.resource=new core.CanvasResource(n._canvasRenderTarget.canvas),n.valid=!0),this.context=n._canvasRenderTarget.context,this.resolution=n._canvasRenderTarget.resolution):this.context=this.rootContext;var i=this.context;if(this._projTransform=a||null,n||(this._lastObjectRendered=t),!r){var c=t.enableTempParent();t.updateTransform(),t.disableTempParent(c)}if(i.save(),i.setTransform(1,0,0,1,0,0),i.globalAlpha=1,this._activeBlendMode=constants.BLEND_MODES.NORMAL,this._outerBlend=!1,i.globalCompositeOperation=this.blendModes[constants.BLEND_MODES.NORMAL],void 0!==o?o:this.clearBeforeRender)if(this.renderingToScreen)i.clearRect(0,0,this.width,this.height),this.backgroundAlpha>0&&(i.globalAlpha=this.useContextAlpha?this.backgroundAlpha:1,i.fillStyle=this._backgroundColorString,i.fillRect(0,0,this.width,this.height),i.globalAlpha=1);else{(n=n)._canvasRenderTarget.clear();var l=n.clearColor;l[3]>0&&(i.globalAlpha=this.useContextAlpha?l[3]:1,i.fillStyle=utils.hex2string(utils.rgb2hex(l)),i.fillRect(0,0,n.realWidth,n.realHeight),i.globalAlpha=1)}var h=this.context;this.context=i,t.renderCanvas(this),this.context=h,i.restore(),this.resolution=s,this._projTransform=null,this.emit("postrender")}},e.prototype.setContextTransform=function(t,e,n){var o=t,a=this._projTransform,r=this.resolution;n=n||r,a&&((o=tempMatrix).copyFrom(t),o.prepend(a)),e?this.context.setTransform(o.a*n,o.b*n,o.c*n,o.d*n,o.tx*r|0,o.ty*r|0):this.context.setTransform(o.a*n,o.b*n,o.c*n,o.d*n,o.tx*r,o.ty*r)},e.prototype.clear=function(t,e){void 0===t&&(t=this._backgroundColorString),void 0===e&&(e=this.backgroundAlpha);var n=this.context;n.clearRect(0,0,this.width,this.height),t&&(n.globalAlpha=this.useContextAlpha?e:1,n.fillStyle=t,n.fillRect(0,0,this.width,this.height),n.globalAlpha=1)},e.prototype.setBlendMode=function(t,e){var n=t===constants.BLEND_MODES.SRC_IN||t===constants.BLEND_MODES.SRC_OUT||t===constants.BLEND_MODES.DST_IN||t===constants.BLEND_MODES.DST_ATOP;!e&&n&&(t=constants.BLEND_MODES.NORMAL),this._activeBlendMode!==t&&(this._activeBlendMode=t,this._outerBlend=n,this.context.globalCompositeOperation=this.blendModes[t])},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this.context=null,this.refresh=!0,this.maskManager.destroy(),this.maskManager=null,this.smoothProperty=null},e.prototype.resize=function(e,n){t.prototype.resize.call(this,e,n),this.smoothProperty&&(this.rootContext[this.smoothProperty]=settings.settings.SCALE_MODE===constants.SCALE_MODES.LINEAR)},e.prototype.invalidateBlendMode=function(){this._activeBlendMode=this.blendModes.indexOf(this.context.globalCompositeOperation)},e.registerPlugin=function(t,n){e.__plugins=e.__plugins||{},e.__plugins[t]=n},e}(core.AbstractRenderer),canvasUtils={canvas:null,getTintedCanvas:function(t,e){var n=t.texture,o="#"+("00000"+(0|(e=canvasUtils.roundColor(e))).toString(16)).slice(-6);n.tintCache=n.tintCache||{};var a,r=n.tintCache[o];if(r){if(r.tintId===n._updateID)return n.tintCache[o];a=n.tintCache[o]}else a=document.createElement("canvas");if(canvasUtils.tintMethod(n,e,a),a.tintId=n._updateID,canvasUtils.convertTintToImage){var s=new Image;s.src=a.toDataURL(),n.tintCache[o]=s}else n.tintCache[o]=a;return a},getTintedPattern:function(t,e){var n="#"+("00000"+(0|(e=canvasUtils.roundColor(e))).toString(16)).slice(-6);t.patternCache=t.patternCache||{};var o=t.patternCache[n];return o&&o.tintId===t._updateID?o:(canvasUtils.canvas||(canvasUtils.canvas=document.createElement("canvas")),canvasUtils.tintMethod(t,e,canvasUtils.canvas),(o=canvasUtils.canvas.getContext("2d").createPattern(canvasUtils.canvas,"repeat")).tintId=t._updateID,t.patternCache[n]=o,o)},tintWithMultiply:function(t,e,n){var o=n.getContext("2d"),a=t._frame.clone(),r=t.baseTexture.resolution;a.x*=r,a.y*=r,a.width*=r,a.height*=r,n.width=Math.ceil(a.width),n.height=Math.ceil(a.height),o.save(),o.fillStyle="#"+("00000"+(0|e).toString(16)).slice(-6),o.fillRect(0,0,a.width,a.height),o.globalCompositeOperation="multiply";var s=t.baseTexture.getDrawableSource();o.drawImage(s,a.x,a.y,a.width,a.height,0,0,a.width,a.height),o.globalCompositeOperation="destination-atop",o.drawImage(s,a.x,a.y,a.width,a.height,0,0,a.width,a.height),o.restore()},tintWithOverlay:function(t,e,n){var o=n.getContext("2d"),a=t._frame.clone(),r=t.baseTexture.resolution;a.x*=r,a.y*=r,a.width*=r,a.height*=r,n.width=Math.ceil(a.width),n.height=Math.ceil(a.height),o.save(),o.globalCompositeOperation="copy",o.fillStyle="#"+("00000"+(0|e).toString(16)).slice(-6),o.fillRect(0,0,a.width,a.height),o.globalCompositeOperation="destination-atop",o.drawImage(t.baseTexture.getDrawableSource(),a.x,a.y,a.width,a.height,0,0,a.width,a.height),o.restore()},tintWithPerPixel:function(t,e,n){var o=n.getContext("2d"),a=t._frame.clone(),r=t.baseTexture.resolution;a.x*=r,a.y*=r,a.width*=r,a.height*=r,n.width=Math.ceil(a.width),n.height=Math.ceil(a.height),o.save(),o.globalCompositeOperation="copy",o.drawImage(t.baseTexture.getDrawableSource(),a.x,a.y,a.width,a.height,0,0,a.width,a.height),o.restore();for(var s=utils.hex2rgb(e),i=s[0],c=s[1],l=s[2],h=o.getImageData(0,0,a.width,a.height),d=h.data,u=0;u<d.length;u+=4)d[u+0]*=i,d[u+1]*=c,d[u+2]*=l;o.putImageData(h,0,0)},roundColor:function(t){var e=canvasUtils.cacheStepsPerColorChannel,n=utils.hex2rgb(t);return n[0]=Math.min(255,n[0]/e*e),n[1]=Math.min(255,n[1]/e*e),n[2]=Math.min(255,n[2]/e*e),utils.rgb2hex(n)},cacheStepsPerColorChannel:8,convertTintToImage:!1,canUseMultiply:canUseNewCanvasBlendModes(),tintMethod:null};canvasUtils.tintMethod=canvasUtils.canUseMultiply?canvasUtils.tintWithMultiply:canvasUtils.tintWithPerPixel;var parentCreate=core.Renderer.create;core.Renderer.create=function(t){if(!(t&&t.forceCanvas))try{return parentCreate(t)}catch(t){}return new CanvasRenderer(t)},core.BaseTexture.prototype.getDrawableSource=function(){var t=this.resource;return t?t.bitmap||t.source:null},core.BaseRenderTexture.prototype._canvasRenderTarget=null,core.Texture.prototype.patternCache=null,core.Texture.prototype.tintCache=null,exports.CanvasRenderer=CanvasRenderer,exports.canUseNewCanvasBlendModes=canUseNewCanvasBlendModes,exports.canvasUtils=canvasUtils;
//# sourceMappingURL=canvas-renderer.min.js.map
