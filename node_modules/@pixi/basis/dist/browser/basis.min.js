/*!
 * @pixi/basis - v6.3.0
 * Compiled Wed, 23 Mar 2022 18:58:56 UTC
 *
 * @pixi/basis is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
this.PIXI=this.PIXI||{};var _pixi_basis=function(e,r,t,n,s,a){"use strict";var o,i,c,u;function l(e,r,t,n){return new(t||(t=Promise))(function(s,a){function o(e){try{c(n.next(e))}catch(e){a(e)}}function i(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){e.done?s(e.value):new t(function(r){r(e.value)}).then(o,i)}c((n=n.apply(e,r||[])).next())})}function T(e,r){var t,n,s,a,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(a){return function(i){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,n&&(s=2&a[0]?n.return:a[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,a[1])).done)return s;switch(n=0,s&&(a=[2&a[0],s.value]),a[0]){case 0:case 1:s=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!s||a[1]>s[0]&&a[1]<s[3])){o.label=a[1];break}if(6===a[0]&&o.label<s[1]){o.label=s[1],s=a;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(a);break}s[2]&&o.ops.pop(),o.trys.pop();continue}a=r.call(e,o)}catch(e){a=[6,e],n=0}finally{t=s=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,i])}}}(u=e.BASIS_FORMATS||(e.BASIS_FORMATS={}))[u.cTFETC1=0]="cTFETC1",u[u.cTFETC2=1]="cTFETC2",u[u.cTFBC1=2]="cTFBC1",u[u.cTFBC3=3]="cTFBC3",u[u.cTFBC4=4]="cTFBC4",u[u.cTFBC5=5]="cTFBC5",u[u.cTFBC7=6]="cTFBC7",u[u.cTFPVRTC1_4_RGB=8]="cTFPVRTC1_4_RGB",u[u.cTFPVRTC1_4_RGBA=9]="cTFPVRTC1_4_RGBA",u[u.cTFASTC_4x4=10]="cTFASTC_4x4",u[u.cTFATC_RGB=11]="cTFATC_RGB",u[u.cTFATC_RGBA_INTERPOLATED_ALPHA=12]="cTFATC_RGBA_INTERPOLATED_ALPHA",u[u.cTFRGBA32=13]="cTFRGBA32",u[u.cTFRGB565=14]="cTFRGB565",u[u.cTFBGR565=15]="cTFBGR565",u[u.cTFRGBA4444=16]="cTFRGBA4444";var f=((o={})[e.BASIS_FORMATS.cTFETC1]=s.INTERNAL_FORMATS.COMPRESSED_RGB_ETC1_WEBGL,o[e.BASIS_FORMATS.cTFBC1]=s.INTERNAL_FORMATS.COMPRESSED_RGB_S3TC_DXT1_EXT,o[e.BASIS_FORMATS.cTFBC3]=s.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,o[e.BASIS_FORMATS.cTFPVRTC1_4_RGB]=s.INTERNAL_FORMATS.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,o[e.BASIS_FORMATS.cTFPVRTC1_4_RGBA]=s.INTERNAL_FORMATS.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,o[e.BASIS_FORMATS.cTFATC_RGB]=s.INTERNAL_FORMATS.COMPRESSED_RGB_ATC_WEBGL,o[e.BASIS_FORMATS.cTFASTC_4x4]=s.INTERNAL_FORMATS.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL,o),_=((i={})[e.BASIS_FORMATS.cTFRGBA32]=t.TYPES.UNSIGNED_BYTE,i[e.BASIS_FORMATS.cTFRGB565]=t.TYPES.UNSIGNED_SHORT_5_6_5,i[e.BASIS_FORMATS.cTFRGBA4444]=t.TYPES.UNSIGNED_SHORT_4_4_4_4,i),d=Object.keys(f).map(function(e){return Number(e)}).reduce(function(e,r){return e[f[r]]=r,e},{}),A=((c={})[e.BASIS_FORMATS.cTFBC3]=!0,c[e.BASIS_FORMATS.cTFPVRTC1_4_RGBA]=!0,c[e.BASIS_FORMATS.cTFASTC_4x4]=!0,c);var S=function(){function e(){var r=this;this.requests={},this.onMessage=function(e){var t=e.data;if("init"===t.type){if(!t.success)throw new Error("BasisResource.TranscoderWorker failed to initialize.");r.isInit=!0,r.onInit()}else if("transcode"===t.type){--r.load;var n=t.requestID;t.success?r.requests[n].resolve(t):r.requests[n].reject(),delete r.requests[n]}},this.isInit=!1,this.load=0,this.initPromise=new Promise(function(e){r.onInit=e}),e.wasmSource||console.warn("PIXI.resources.BasisResource.TranscoderWorker has not been given the transcoder WASM binary!"),this.worker=new Worker(e.workerURL),this.worker.onmessage=this.onMessage,this.worker.postMessage({type:"init",jsSource:e.jsSource,wasmSource:e.wasmSource})}return Object.defineProperty(e,"workerURL",{get:function(){if(!e._workerURL){var r=function(){var e,r={init:function(r){return self.BASIS?(self.BASIS({wasmBinary:r.wasmSource}).then(function(r){r.initializeBasis(),e=r,self.postMessage({type:"init",success:!0})}),null):(console.warn("jsSource was not prepended?"),{type:"init",success:!1})},transcode:function(r){var t=r.basisData,n=new e.BasisFile(t),s=n.getNumImages(),a=n.getHasAlpha()?r.rgbaFormat:r.rgbFormat,o=new Array(s),i=!1;if(!n.startTranscoding())return n.close(),n.delete(),{type:"transcode",requestID:r.requestID,success:!1,imageArray:null};for(var c=0;c<s;c++){for(var u=n.getNumLevels(c),l={imageID:c,levelArray:new Array,width:null,height:null},T=0;T<u;T++){var f=i?14:a,_=n.getImageWidth(c,T),d=n.getImageHeight(c,T),A=n.getImageTranscodedSizeInBytes(c,T,f),S=_+3&-4,R=d+3&-4;0===T&&(l.width=S,l.height=R);var B=new Uint8Array(A);if(!n.transcodeImage(B,c,T,f,!1,!1)){if(i)return console.error("Basis failed to transcode image "+c+", level "+T+"!"),{type:"transcode",requestID:r.requestID,success:!1};console.warn("Basis failed to transcode image "+c+", level "+T+"! Retrying to an uncompressed texture format!"),c=-1,i=!0;break}l.levelArray.push({levelID:T,levelWidth:_,levelHeight:d,levelBuffer:B})}o[c]=l}return n.close(),n.delete(),{type:"transcode",requestID:r.requestID,success:!0,basisFormat:i?14:a,imageArray:o}}};self.onmessage=function(e){var t=e.data,n=r[t.type](t);n&&self.postMessage(n)}}.toString(),t=r.indexOf("{"),n=r.lastIndexOf("}");r=r.slice(t+1,n),e.jsSource&&(r=e.jsSource+"\n"+r),e._workerURL=URL.createObjectURL(new Blob([r]))}return e._workerURL},enumerable:!1,configurable:!0}),e.prototype.initAsync=function(){return this.initPromise},e.prototype.transcodeAsync=function(r,t,n){return l(this,void 0,Promise,function(){var s,a,o=this;return T(this,function(i){return++this.load,s=e._tempID++,a=new Promise(function(e,r){o.requests[s]={resolve:e,reject:r}}),this.worker.postMessage({requestID:s,basisData:r,rgbaFormat:t,rgbFormat:n,type:"transcode"}),[2,a]})})},e.loadTranscoder=function(r,t){var n=fetch(r).then(function(e){return e.text()}).then(function(r){e.jsSource=r}),s=fetch(t).then(function(e){return e.arrayBuffer()}).then(function(r){e.wasmSource=r});return Promise.all([n,s]).then(function(r){return e.onTranscoderInitialized.emit(),r})},e.setTranscoder=function(r,t){e.jsSource=r,e.wasmSource=t},e.onTranscoderInitialized=new a.Runner("onTranscoderInitialized"),e._tempID=0,e}();r.LoaderResource.setExtensionXhrType("basis",r.LoaderResource.XHR_RESPONSE_TYPE.BUFFER);var R=function(){function r(){}return r.use=function(e,t){"basis"===e.extension&&e.data?r.basisBinding||r.TranscoderWorker.wasmSource?r.transcode(e,t):S.onTranscoderInitialized.add(function(){r.transcode(e,t)}):t()},r.transcode=function(e,t){return l(this,void 0,Promise,function(){var n,s,a;return T(this,function(o){switch(o.label){case 0:return o.trys.push([0,4,,5]),n=e.data,s=void 0,"undefined"!=typeof Worker&&r.TranscoderWorker.wasmSource?[4,r.transcodeAsync(n)]:[3,2];case 1:return s=o.sent(),[3,3];case 2:s=r.transcodeSync(n),o.label=3;case 3:return Object.assign(e,r.registerTextures(e.url,s,e.metadata)),[3,5];case 4:return a=o.sent(),t(a),[2];case 5:return t(),[2]}})})},r.registerTextures=function(r,a,o){var i={textures:{},texture:null};if(!a)return i;var c=_[a.basisFormat],u=a.basisFormat!==e.BASIS_FORMATS.cTFRGBA32?t.FORMATS.RGB:t.FORMATS.RGBA;return a.map(function(e){return new n.Texture(new n.BaseTexture(e,Object.assign({mipmap:e instanceof s.CompressedTextureResource&&e.levels>1?t.MIPMAP_MODES.ON_MANUAL:t.MIPMAP_MODES.OFF,alphaMode:t.ALPHA_MODES.NO_PREMULTIPLIED_ALPHA,type:c,format:u},o)))}).forEach(function(e,t){var s=e.baseTexture,a=r+"-"+(t+1);n.BaseTexture.addToCache(s,a),n.Texture.addToCache(e,a),0===t&&(n.BaseTexture.addToCache(s,r),n.Texture.addToCache(e,r),i.texture=e),i.textures[a]=e}),i},r.transcodeAsync=function(e){return l(this,void 0,Promise,function(){var t,a,o,i,c,u,l,_,d,A;return T(this,function(T){switch(T.label){case 0:for(t=r.workerPool,a=268435456,o=null,d=0,A=t.length;d<A;d++)t[d].load<a&&(o=t[d],a=o.load);return o||(o=new S,t.push(o)),[4,o.initAsync()];case 1:return T.sent(),[4,o.transcodeAsync(new Uint8Array(e),r.defaultRGBAFormat.basisFormat,r.defaultRGBFormat.basisFormat)];case 2:if(i=T.sent(),c=i.basisFormat,u=i.imageArray,c>12)l=u.map(function(e){return new n.BufferResource(new Uint16Array(e.levelArray[0].levelBuffer.buffer),{width:e.width,height:e.height})});else for(_=f[i.basisFormat],l=new Array(u.length),d=0,A=u.length;d<A;d++)l[d]=new s.CompressedTextureResource(null,{format:_,width:u[d].width,height:u[d].height,levelBuffers:u[d].levelArray,levels:u[d].levelArray.length});return l.basisFormat=c,[2,l]}})})},r.transcodeSync=function(t){var a=r.basisBinding,o=new Uint8Array(t),i=new a.BasisFile(o),c=i.getNumImages(),u=i.getHasAlpha()?r.defaultRGBAFormat.basisFormat:r.defaultRGBFormat.basisFormat,l=e.BASIS_FORMATS.cTFRGB565,T=new Array(c),_=r.fallbackMode;if(!i.startTranscoding())return i.close(),i.delete(),null;for(var d=0;d<c;d++){for(var A=_?1:i.getNumLevels(d),S=i.getImageWidth(d,0),R=i.getImageHeight(d,0),B=S+3&-4,F=R+3&-4,h=new Array(A),I=0;I<A;I++){var m=i.getImageWidth(d,I),g=i.getImageHeight(d,I),v=i.getImageTranscodedSizeInBytes(d,0,_?l:u);if(h[I]={levelID:I,levelBuffer:new Uint8Array(v),levelWidth:m,levelHeight:g},i.transcodeImage(h[I].levelBuffer,d,0,_?l:u,!1,!1));else{if(_)break;d=-1,_=!0}}var E=void 0;E=_?new n.BufferResource(new Uint16Array(h[0].levelBuffer.buffer),{width:S,height:R}):new s.CompressedTextureResource(null,{format:f[u],width:B,height:F,levelBuffers:h,levels:A}),T[d]=E}i.close(),i.delete();var w=T;return w.basisFormat=_?l:u,w},r.autoDetectFormats=function(n){if(!n){var s=document.createElement("canvas").getContext("webgl");if(!s)return void console.error("WebGL not available for BASIS transcoding. Silently failing.");n={s3tc:s.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:s.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:s.getExtension("WEBGL_compressed_texture_etc"),etc1:s.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:s.getExtension("WEBGL_compressed_texture_pvrtc")||s.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:s.getExtension("WEBGL_compressed_texture_atc"),astc:s.getExtension("WEBGL_compressed_texture_astc")}}var a={};for(var o in n){var i=n[o];i&&Object.assign(a,Object.getPrototypeOf(i))}for(var c=0;c<2;c++){var u=!!c,l=void 0,T=void 0;for(var f in a)if(void 0!==(T=d[l=a[f]])&&(u&&A[T]||!u&&!A[T]))break;l?r[u?"defaultRGBAFormat":"defaultRGBFormat"]={textureFormat:l,basisFormat:T}:(r[u?"defaultRGBAFormat":"defaultRGBFormat"]={textureFormat:t.TYPES.UNSIGNED_SHORT_5_6_5,basisFormat:e.BASIS_FORMATS.cTFRGB565},r.fallbackMode=!0)}},r.bindTranscoder=function(e){r.basisBinding=e},r.loadTranscoder=function(e,t){return r.TranscoderWorker.loadTranscoder(e,t)},r.setTranscoder=function(e,t){r.TranscoderWorker.setTranscoder(e,t)},Object.defineProperty(r,"TRANSCODER_WORKER_POOL_LIMIT",{get:function(){return this.workerPool.length||1},set:function(e){for(var r=this.workerPool.length;r<e;r++)this.workerPool[r]=new S,this.workerPool[r].initAsync()},enumerable:!1,configurable:!0}),r.fallbackMode=!1,r.workerPool=[],r.TranscoderWorker=S,r}();return R.autoDetectFormats(),r.Loader.registerPlugin(R),e.BASIS_FORMATS_ALPHA=A,e.BASIS_FORMAT_TO_INTERNAL_FORMAT=f,e.BASIS_FORMAT_TO_TYPE=_,e.BasisLoader=R,e.INTERNAL_FORMAT_TO_BASIS_FORMAT=d,e}({},PIXI,PIXI,PIXI,PIXI,PIXI);Object.assign(this.PIXI,_pixi_basis);
//# sourceMappingURL=basis.min.js.map
